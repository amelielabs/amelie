open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }]
connect E0 S0 localhost:3485
# test: select from expr where
explain select * from [1, 2, 3] where true
[{
  "bytecode": {
    "coordinator": {
      "00": "set                 0      0      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "int                 1      -      0     # 2",
      "04": "push                1      0      0     ",
      "05": "int                 1      -      0     # 3",
      "06": "push                1      0      0     ",
      "07": "array               1      3      0     ",
      "08": "cursor_open_expr    0      1      10    ",
      "09": "jmp                 15     0      0     ",
      "10": "bool                2      1      0     ",
      "11": "jntr                14     2      0     ",
      "12": "cursor_read         2      0      0     ",
      "13": "set_add             0      2      0     ",
      "14": "cursor_next         0      10     0     ",
      "15": "cursor_close        0      0      0     ",
      "16": "cte_set             0      0      0     ",
      "17": "body                0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  }
}]
select * from [1, 2, 3] where true
[1, 2, 3]
select * from [1, 2, 3] where false
[]
# test: select from expr where #2
select ** from {"a": 1, "b": 2, "c": 3} where true
["a", "b", "c"]
select ** from {"a": 1, "b": 2, "c": 3} where false
[]
select ** from {} where true
[]
# test: select from expr where star
select * from [1, 2, 3] where * = 2
[2]
select * from [1, 2, 3] where * >= 2
[2, 3]
select * from [1, 2, 3] where * <> 2
[1, 3]
# test: select from expr where star #2
select ** from {"a": 1, "b": 2, "c": 3} where * = 2
["b"]
select ** from {"a": 1, "b": 2, "c": 3} where * >= 2
["b", "c"]
select ** from {"a": 1, "b": 2, "c": 3} where * <> 2
["a", "c"]
select * from [] where true
[]
# test: select from table where star
create table test (id int primary key serial, data int default 0)
[]
insert into test () values ()
[]
insert into test () values ()
[]
insert into test () values ()
[]
explain select * from test where *[0] >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      0     ",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      0      0     ",
      "01": "int_min             1      0      0     ",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 14     0      0     ",
      "05": "cursor_read         1      0      0     ",
      "06": "int                 2      -      0     # 0",
      "07": "idx                 3      1      2     ",
      "08": "int                 1      -      0     # 0",
      "09": "gte                 2      3      1     ",
      "10": "jntr                13     2      0     ",
      "11": "cursor_read         1      0      0     ",
      "12": "set_add             0      1      0     ",
      "13": "cursor_next         0      5      0     ",
      "14": "cursor_close        0      0      0     ",
      "15": "result              0      0      0     ",
      "16": "ret                 0      0      0     "
    }
  }
}]
select * from test where *[0] >= 0
[[0, 0], [1, 0], [2, 0]]
drop table test
[]
# test: select from table where column
create table test (id int primary key serial, data int default 0)
[]
insert into test () values ()
[]
insert into test () values ()
[]
insert into test () values ()
[]
explain select * from test where id >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      0     ",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      0      0     ",
      "01": "int                 1      -      0     # 0",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 12     0      0     ",
      "05": "cursor_idx          1      0      0     ",
      "06": "int                 2      -      0     # 0",
      "07": "gte                 3      1      2     ",
      "08": "jntr                11     3      0     ",
      "09": "cursor_read         1      0      0     ",
      "10": "set_add             0      1      0     ",
      "11": "cursor_next         0      5      0     ",
      "12": "cursor_close        0      0      0     ",
      "13": "result              0      0      0     ",
      "14": "ret                 0      0      0     "
    }
  }
}]
select * from test where id >= 0
[[0, 0], [1, 0], [2, 0]]
drop table test
[]
# test: select from table where column.path
create table test (id int primary key serial, data object)
[]
insert into test (data) values ({"data": 123})
[]
insert into test (data) values ({"data": 123})
[]
insert into test (data) values ({"data": 123})
[]
select * from test
[[0, {
  "data": 123
}], [1, {
  "data": 123
}], [2, {
  "data": 123
}]]
explain select * from test where data.data >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      0     ",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      0      0     ",
      "01": "int_min             1      0      0     ",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 12     0      0     ",
      "05": "cursor_idx          1      0      1     # data",
      "06": "int                 2      -      0     # 0",
      "07": "gte                 3      1      2     ",
      "08": "jntr                11     3      0     ",
      "09": "cursor_read         1      0      0     ",
      "10": "set_add             0      1      0     ",
      "11": "cursor_next         0      5      0     ",
      "12": "cursor_close        0      0      0     ",
      "13": "result              0      0      0     ",
      "14": "ret                 0      0      0     "
    }
  }
}]
select * from test where data.data >= 0
[[0, {
  "data": 123
}], [1, {
  "data": 123
}], [2, {
  "data": 123
}]]
drop table test
[]
# test: select from table where column.path #2
create table test (id int primary key serial, data object)
[]
insert into test (data) values ({"data": {"data": 123}})
[]
insert into test (data) values ({"data": {"data": 123}})
[]
insert into test (data) values ({"data": {"data": 123}})
[]
select * from test
[[0, {
  "data": {
    "data": 123
  }
}], [1, {
  "data": {
    "data": 123
  }
}], [2, {
  "data": {
    "data": 123
  }
}]]
explain select * from test where data.data.data >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      0     ",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      0      0     ",
      "01": "int_min             1      0      0     ",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 12     0      0     ",
      "05": "cursor_idx          1      0      1     # data.data",
      "06": "int                 2      -      0     # 0",
      "07": "gte                 3      1      2     ",
      "08": "jntr                11     3      0     ",
      "09": "cursor_read         1      0      0     ",
      "10": "set_add             0      1      0     ",
      "11": "cursor_next         0      5      0     ",
      "12": "cursor_close        0      0      0     ",
      "13": "result              0      0      0     ",
      "14": "ret                 0      0      0     "
    }
  }
}]
select * from test where data.data.data >= 0
[[0, {
  "data": {
    "data": 123
  }
}], [1, {
  "data": {
    "data": 123
  }
}], [2, {
  "data": {
    "data": 123
  }
}]]
drop table test
[]
# test: select from table where target.column
create table test (id int primary key serial, data int default 0)
[]
insert into test () values ()
[]
insert into test () values ()
[]
insert into test () values ()
[]
explain select * from test where test.id >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      0     ",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      0      0     ",
      "01": "int                 1      -      0     # 0",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 12     0      0     ",
      "05": "cursor_idx          1      0      0     ",
      "06": "int                 2      -      0     # 0",
      "07": "gte                 3      1      2     ",
      "08": "jntr                11     3      0     ",
      "09": "cursor_read         1      0      0     ",
      "10": "set_add             0      1      0     ",
      "11": "cursor_next         0      5      0     ",
      "12": "cursor_close        0      0      0     ",
      "13": "result              0      0      0     ",
      "14": "ret                 0      0      0     "
    }
  }
}]
select * from test where test.id >= 0
[[0, 0], [1, 0], [2, 0]]
drop table test
[]
# test: select from table where target.column.path
create table test (id int primary key serial, data object)
[]
insert into test (data) values ({"data": 123})
[]
insert into test (data) values ({"data": 123})
[]
insert into test (data) values ({"data": 123})
[]
explain select * from test where test.data.data >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      0     ",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      0      0     ",
      "01": "int_min             1      0      0     ",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 12     0      0     ",
      "05": "cursor_idx          1      0      1     # data",
      "06": "int                 2      -      0     # 0",
      "07": "gte                 3      1      2     ",
      "08": "jntr                11     3      0     ",
      "09": "cursor_read         1      0      0     ",
      "10": "set_add             0      1      0     ",
      "11": "cursor_next         0      5      0     ",
      "12": "cursor_close        0      0      0     ",
      "13": "result              0      0      0     ",
      "14": "ret                 0      0      0     "
    }
  }
}]
select * from test where test.data.data >= 0
[[0, {
  "data": 123
}], [1, {
  "data": 123
}], [2, {
  "data": 123
}]]
drop table test
[]
# test: select from table where alias.column
create table test (id int primary key serial, data int default 0)
[]
insert into test () values ()
[]
insert into test () values ()
[]
insert into test () values ()
[]
explain select * from test alias where alias.id >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      0     ",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      0      0     ",
      "01": "int                 1      -      0     # 0",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 12     0      0     ",
      "05": "cursor_idx          1      0      0     ",
      "06": "int                 2      -      0     # 0",
      "07": "gte                 3      1      2     ",
      "08": "jntr                11     3      0     ",
      "09": "cursor_read         1      0      0     ",
      "10": "set_add             0      1      0     ",
      "11": "cursor_next         0      5      0     ",
      "12": "cursor_close        0      0      0     ",
      "13": "result              0      0      0     ",
      "14": "ret                 0      0      0     "
    }
  }
}]
select * from test alias where alias.id >= 0
[[0, 0], [1, 0], [2, 0]]
drop table test
[]
# test: select from table where alias.column.path
create table test (id int primary key serial, data object)
[]
insert into test (data) values ({"data": 123})
[]
insert into test (data) values ({"data": 123})
[]
insert into test (data) values ({"data": 123})
[]
explain select * from test alias where alias.data.data >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      0     ",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      0      0     ",
      "01": "int_min             1      0      0     ",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 12     0      0     ",
      "05": "cursor_idx          1      0      1     # data",
      "06": "int                 2      -      0     # 0",
      "07": "gte                 3      1      2     ",
      "08": "jntr                11     3      0     ",
      "09": "cursor_read         1      0      0     ",
      "10": "set_add             0      1      0     ",
      "11": "cursor_next         0      5      0     ",
      "12": "cursor_close        0      0      0     ",
      "13": "result              0      0      0     ",
      "14": "ret                 0      0      0     "
    }
  }
}]
select * from test alias where alias.data.data >= 0
[[0, {
  "data": 123
}], [1, {
  "data": 123
}], [2, {
  "data": 123
}]]
drop table test
[]
# test: where true/false
create table test (id int primary key)
[]
insert into test values (1), (2), (3)
[]
explain select * from test where true
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      0     ",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      0      0     ",
      "01": "int_min             1      0      0     ",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 10     0      0     ",
      "05": "bool                1      1      0     ",
      "06": "jntr                9      1      0     ",
      "07": "cursor_read         1      0      0     ",
      "08": "set_add             0      1      0     ",
      "09": "cursor_next         0      5      0     ",
      "10": "cursor_close        0      0      0     ",
      "11": "result              0      0      0     ",
      "12": "ret                 0      0      0     "
    }
  }
}]
select * from test where true
[[1], [2], [3]]
select * from test where false
[]
drop table test
[]
# test: where gte
create table test (id int primary key)
[]
insert into test values (1), (2), (3)
[]
explain select * from test where id >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      0     ",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      0      0     ",
      "01": "int                 1      -      0     # 0",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 12     0      0     ",
      "05": "cursor_idx          1      0      0     ",
      "06": "int                 2      -      0     # 0",
      "07": "gte                 3      1      2     ",
      "08": "jntr                11     3      0     ",
      "09": "cursor_read         1      0      0     ",
      "10": "set_add             0      1      0     ",
      "11": "cursor_next         0      5      0     ",
      "12": "cursor_close        0      0      0     ",
      "13": "result              0      0      0     ",
      "14": "ret                 0      0      0     "
    }
  }
}]
select * from test where id >= 0
[[1], [2], [3]]
select * from test where id >= 1
[[1], [2], [3]]
select * from test where id >= 2
[[2], [3]]
select * from test where id >= 3
[[3]]
select * from test where id >= 4
[]
# test: where gt
select * from test where id > 0
[[1], [2], [3]]
select * from test where id > 1
[[2], [3]]
select * from test where id > 2
[[3]]
select * from test where id > 3
[]
select * from test where id > 9
[]
# test: where lte
explain select * from test where id <= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      0     ",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      0      0     ",
      "01": "int_min             1      0      0     ",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 16     0      0     ",
      "05": "cursor_idx          1      0      0     ",
      "06": "int                 2      -      0     # 0",
      "07": "lte                 3      1      2     ",
      "08": "jntr                4      3      0     ",
      "09": "cursor_idx          1      0      0     ",
      "10": "int                 2      -      0     # 0",
      "11": "lte                 3      1      2     ",
      "12": "jntr                15     3      0     ",
      "13": "cursor_read         1      0      0     ",
      "14": "set_add             0      1      0     ",
      "15": "cursor_next         0      5      0     ",
      "16": "cursor_close        0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  }
}]
select * from test where id <= 0
[]
select * from test where id <= 1
[[1]]
select * from test where id <= 2
[[1], [2]]
select * from test where id <= 3
[[1], [2], [3]]
select * from test where id <= 8
[[1], [2], [3]]
# test: where lt
explain select * from test where id < 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      0     ",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      0      0     ",
      "01": "int_min             1      0      0     ",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 16     0      0     ",
      "05": "cursor_idx          1      0      0     ",
      "06": "int                 2      -      0     # 0",
      "07": "lt                  3      1      2     ",
      "08": "jntr                4      3      0     ",
      "09": "cursor_idx          1      0      0     ",
      "10": "int                 2      -      0     # 0",
      "11": "lt                  3      1      2     ",
      "12": "jntr                15     3      0     ",
      "13": "cursor_read         1      0      0     ",
      "14": "set_add             0      1      0     ",
      "15": "cursor_next         0      5      0     ",
      "16": "cursor_close        0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  }
}]
select * from test where id < 0
[]
select * from test where id < 1
[]
select * from test where id < 2
[[1]]
select * from test where id < 3
[[1], [2]]
select * from test where id < 8
[[1], [2], [3]]
drop table test
[]
# test: where point lookup
create table test (id int primary key)
[]
insert into test values (1), (2), (3)
[]
select * from test where id = 2
[[2]]
drop table test
[]
# test: where point lookup nested
create table test (obj object, primary key(obj.id int))
[]
insert into test {"id": 1}
[]
insert into test {"id": 2}
[]
insert into test {"id": 3}
[]
select * from test where obj.id = 2
[[{
  "id": 2
}]]
drop table test
[]
disconnect S0
close E0
