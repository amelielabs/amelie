open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }]
connect E0 S0 localhost:3485
# test: case expr
select case
{"code": 1, "msg": "bad expression"}
select case 1
{"code": 1, "msg": "CASE <expr> expected"}
select case 1 then
{"code": 1, "msg": "CASE <expr> expected"}
select case 1 then 1
{"code": 1, "msg": "CASE <expr> expected"}
select case 1 when 1 then 1
{"code": 1, "msg": "CASE <expr> expected"}
select case 1 when 1 then 1 end
1
explain select case 1 when 1 then 1 end
"
bytecode [coordinator]
--------
 0                 jmp        2      0      0
 1                 jmp       11      0      0
 2                 int        1      1      0
 3                 int        2      1      0
 4                 equ        3      1      2
 5                jntr        9      3      0
 6                 int        1      1      0
 7                swap        0      1      0
 8                 jmp        1      0      0
 9                null        1      0      0
10                swap        0      1      0
11                 nop        0      0      0
12             cte_set        0      0      0
13                body        0      0      0
14                 ret        0      0      0

"
select case 0 when 1 then 1 when 2 then 2 end
null
explain select case 0 when 1 then 1 when 2 then 2 end
"
bytecode [coordinator]
--------
 0                 jmp        2      0      0
 1                 jmp       18      0      0
 2                 int        1      0      0
 3                 int        2      1      0
 4                 equ        3      1      2
 5                jntr        9      3      0
 6                 int        1      1      0
 7                swap        0      1      0
 8                 jmp        1      0      0
 9                 int        1      0      0
10                 int        2      2      0
11                 equ        3      1      2
12                jntr       16      3      0
13                 int        1      2      0
14                swap        0      1      0
15                 jmp        1      0      0
16                null        1      0      0
17                swap        0      1      0
18                 nop        0      0      0
19             cte_set        0      0      0
20                body        0      0      0
21                 ret        0      0      0

"
select case 0 when 1 then 1 when 2 then 2 else 'else' end
"else"
explain select case 0 when 1 then 1 when 2 then 2 else 'else' end
"
bytecode [coordinator]
--------
 0                 jmp        2      0      0
 1                 jmp       18      0      0
 2                 int        1      0      0
 3                 int        2      1      0
 4                 equ        3      1      2
 5                jntr        9      3      0
 6                 int        1      1      0
 7                swap        0      1      0
 8                 jmp        1      0      0
 9                 int        1      0      0
10                 int        2      2      0
11                 equ        3      1      2
12                jntr       16      3      0
13                 int        1      2      0
14                swap        0      1      0
15                 jmp        1      0      0
16              string        1      0      0      # else
17                swap        0      1      0
18                 nop        0      0      0
19             cte_set        0      0      0
20                body        0      0      0
21                 ret        0      0      0

"
select case [1,2,3] when [1,0] then 1 when [1,2,3] then 2 end
2
select case [1,2,3] when [1,0] then 1 when [1,2,3,4] then 2 end
null
select case [1,2,3] when [1,0] then 1 when [1,2,3,4] then 2 else [] end
[]
select case [1,2,3] when [1,0] then 1 when [1,2,3,4] then 2 else [] else [2] end
{"code": 1, "msg": "CASE ELSE redefined"}
select case [1,2,3] when [1,0] then 1 when [1,2,3,4] then 2 else [] else [2] when null then null end
{"code": 1, "msg": "CASE ELSE redefined"}
select case null when [1,0] then 1 when [1,2,3,4] then 2 else [] else [2] when null then null end
{"code": 1, "msg": "CASE ELSE redefined"}
select case null when [1,0] then 1 when [1,2,3,4] then 2 else [] when null then null end
null
explain select case null when [1,0] then 1 when [1,2,3,4] then 2 else [] when null then null end
"
bytecode [coordinator]
--------
 0                 jmp        2      0      0
 1                 jmp       37      0      0
 2                null        1      0      0
 3                 int        2      1      0
 4                push        2      0      0
 5                 int        2      0      0
 6                push        2      0      0
 7               array        2      2      0
 8                 equ        3      1      2
 9                jntr       13      3      0
10                 int        1      1      0
11                swap        0      1      0
12                 jmp        1      0      0
13                null        1      0      0
14                 int        2      1      0
15                push        2      0      0
16                 int        2      2      0
17                push        2      0      0
18                 int        2      3      0
19                push        2      0      0
20                 int        2      4      0
21                push        2      0      0
22               array        2      4      0
23                 equ        3      1      2
24                jntr       28      3      0
25                 int        1      2      0
26                swap        0      1      0
27                 jmp        1      0      0
28                null        1      0      0
29                null        2      0      0
30                 equ        3      1      2
31                jntr       35      3      0
32                null        1      0      0
33                swap        0      1      0
34                 jmp        1      0      0
35               array        1      0      0
36                swap        0      1      0
37                 nop        0      0      0
38             cte_set        0      0      0
39                body        0      0      0
40                 ret        0      0      0

"
select case end
{"code": 1, "msg": "CASE <WHEN|ELSE> expected"}
select case else end
{"code": 1, "msg": "bad expression"}
select case else 1 end
1
# test: case
select case
{"code": 1, "msg": "bad expression"}
select case when 1
{"code": 1, "msg": "CASE WHEN expr <THEN> expected"}
select case when 1 then 1
{"code": 1, "msg": "CASE <expr> expected"}
select case when 1 then 1 end
1
explain select case when 1 then 1 end
"
bytecode [coordinator]
--------
 0                 jmp        2      0      0
 1                 jmp        9      0      0
 2                 int        1      1      0
 3                jntr        7      1      0
 4                 int        2      1      0
 5                swap        0      2      0
 6                 jmp        1      0      0
 7                null        1      0      0
 8                swap        0      1      0
 9                 nop        0      0      0
10             cte_set        0      0      0
11                body        0      0      0
12                 ret        0      0      0

"
select case else
{"code": 1, "msg": "bad expression"}
select case else end
{"code": 1, "msg": "bad expression"}
select case else 1 end
1
select case when 1=1 then 1 end
1
select case when 1=0 then 1 when 1=3 when 1=1 then 'yes' end
{"code": 1, "msg": "CASE WHEN expr <THEN> expected"}
select case when 1=0 then 1 when 1=3 then 2 when 1=1 then 'yes' end
"yes"
select case when 1=0 then 1 when 1=3 then 2 else 'no' end
"no"
select case when 1=0 then 1 when 1=3 then 2 end
null
select case when [1,2,3] = [1,2,3] then true end
true
select case when select [1,2,3] = select [1,2,3] then true end
true
select case when select [1,2,3] = select [1,2,3,4] then true end
null
select case when select [1,2,3] = select [1,2,3,4] then true else 'else' end
"else"
select case when select [1,2,3] = select [1,2,3,4] then true else 'else' else null end
{"code": 1, "msg": "CASE ELSE redefined"}
disconnect S0
close E0
