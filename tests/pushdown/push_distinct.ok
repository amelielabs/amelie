open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }], "backends": 3;
connect E0 S0 127.0.0.1:3485;
# test: select distinct * from table empty
create table test (id serial primary key, data int default 0);
explain select distinct * from test;
[{
  "main": {
    "00": "send_all            0      0      20    # test (select, closing)",
    "01": "union               1      2      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set_ordered         0      2      2     ",
    "01": "table_open_part     1      2      12    # test (primary)",
    "02": "table_readi64       2      1      -     # id",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      -     # data",
    "05": "push                2      0      0     ",
    "06": "table_readi64       2      1      -     # id",
    "07": "push                2      0      0     ",
    "08": "table_readi32       2      1      -     # data",
    "09": "push                2      0      0     ",
    "10": "set_add             0      0      0     ",
    "11": "table_next          1      2      0     ",
    "12": "free                1      0      0     ",
    "13": "set_sort            0      0      0     ",
    "14": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select distinct * from test;
[]
# test: select distinct * from table
insert into test generate 20;
update test set data = id / 2;
select * from test;
[[2, 1], [8, 4], [0, 0], [4, 2], [7, 3], [10, 5], [11, 5], [12, 6], [13, 6], [16, 8], [19, 9], [1, 0], [3, 1], [5, 2], [6, 3], [9, 4], [14, 7], [15, 7], [17, 8], [18, 9]]
select * from test order by id;
[[0, 0], [1, 0], [2, 1], [3, 1], [4, 2], [5, 2], [6, 3], [7, 3], [8, 4], [9, 4], [10, 5], [11, 5], [12, 6], [13, 6], [14, 7], [15, 7], [16, 8], [17, 8], [18, 9], [19, 9]]
explain select distinct * from test;
[{
  "main": {
    "00": "send_all            0      0      20    # test (select, closing)",
    "01": "union               1      2      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set_ordered         0      2      2     ",
    "01": "table_open_part     1      2      12    # test (primary)",
    "02": "table_readi64       2      1      -     # id",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      -     # data",
    "05": "push                2      0      0     ",
    "06": "table_readi64       2      1      -     # id",
    "07": "push                2      0      0     ",
    "08": "table_readi32       2      1      -     # data",
    "09": "push                2      0      0     ",
    "10": "set_add             0      0      0     ",
    "11": "table_next          1      2      0     ",
    "12": "free                1      0      0     ",
    "13": "set_sort            0      0      0     ",
    "14": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select distinct * from test;
[[0, 0], [1, 0], [2, 1], [3, 1], [4, 2], [5, 2], [6, 3], [7, 3], [8, 4], [9, 4], [10, 5], [11, 5], [12, 6], [13, 6], [14, 7], [15, 7], [16, 8], [17, 8], [18, 9], [19, 9]]
# test: select distinct from table #2
explain select distinct id from test;
[{
  "main": {
    "00": "send_all            0      0      19    # test (select, closing)",
    "01": "union               1      2      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set_ordered         0      1      1     ",
    "01": "table_open_part     1      1      8     # test (primary)",
    "02": "table_readi64       2      1      -     # id",
    "03": "push                2      0      0     ",
    "04": "table_readi64       2      1      -     # id",
    "05": "push                2      0      0     ",
    "06": "set_add             0      0      0     ",
    "07": "table_next          1      2      0     ",
    "08": "free                1      0      0     ",
    "09": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select distinct id from test;
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]
select distinct data from test;
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
# test: select distinct from table #3
explain select distinct id, data from test;
[{
  "main": {
    "00": "send_all            0      0      20    # test (select, closing)",
    "01": "union               1      2      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set_ordered         0      2      2     ",
    "01": "table_open_part     1      2      12    # test (primary)",
    "02": "table_readi64       2      1      -     # id",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      -     # data",
    "05": "push                2      0      0     ",
    "06": "table_readi64       2      1      -     # id",
    "07": "push                2      0      0     ",
    "08": "table_readi32       2      1      -     # data",
    "09": "push                2      0      0     ",
    "10": "set_add             0      0      0     ",
    "11": "table_next          1      2      0     ",
    "12": "free                1      0      0     ",
    "13": "set_sort            0      0      0     ",
    "14": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select distinct id, data from test;
[[0, 0], [1, 0], [2, 1], [3, 1], [4, 2], [5, 2], [6, 3], [7, 3], [8, 4], [9, 4], [10, 5], [11, 5], [12, 6], [13, 6], [14, 7], [15, 7], [16, 8], [17, 8], [18, 9], [19, 9]]
# test: select distinct from table limit
explain select distinct data from test limit 4;
[{
  "main": {
    "00": "send_all            0      0      19    # test (select, closing)",
    "01": "union               1      2      0     ",
    "02": "int                 2      -      0     # 4",
    "03": "union_limit         1      2      0     ",
    "04": "recv                1      0      0     ",
    "05": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set_ordered         0      1      1     ",
    "01": "table_open_part     1      1      8     # test (primary)",
    "02": "table_readi32       2      1      -     # data",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      -     # data",
    "05": "push                2      0      0     ",
    "06": "set_add             0      0      0     ",
    "07": "table_next          1      2      0     ",
    "08": "free                1      0      0     ",
    "09": "set_sort            0      0      0     ",
    "10": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select distinct data from test limit 4;
[0, 1, 2, 3]
# test: select distinct from table limit 0
explain select distinct data from test limit 0;
[{
  "main": {
    "00": "send_all            0      0      19    # test (select, closing)",
    "01": "union               1      2      0     ",
    "02": "int                 2      -      0     # 0",
    "03": "union_limit         1      2      0     ",
    "04": "recv                1      0      0     ",
    "05": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set_ordered         0      1      1     ",
    "01": "table_open_part     1      1      8     # test (primary)",
    "02": "table_readi32       2      1      -     # data",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      -     # data",
    "05": "push                2      0      0     ",
    "06": "set_add             0      0      0     ",
    "07": "table_next          1      2      0     ",
    "08": "free                1      0      0     ",
    "09": "set_sort            0      0      0     ",
    "10": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select distinct data from test limit 0;
[]
# test: select distinct from table limit/offset
explain select distinct data from test limit 1 offset 1;
[{
  "main": {
    "00": "send_all            0      0      19    # test (select, closing)",
    "01": "union               1      2      0     ",
    "02": "int                 2      -      0     # 1",
    "03": "union_limit         1      2      0     ",
    "04": "int                 2      -      0     # 1",
    "05": "union_offset        1      2      0     ",
    "06": "recv                1      0      0     ",
    "07": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set_ordered         0      1      1     ",
    "01": "table_open_part     1      1      8     # test (primary)",
    "02": "table_readi32       2      1      -     # data",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      -     # data",
    "05": "push                2      0      0     ",
    "06": "set_add             0      0      0     ",
    "07": "table_next          1      2      0     ",
    "08": "free                1      0      0     ",
    "09": "set_sort            0      0      0     ",
    "10": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select distinct data from test limit 1 offset 0;
[0]
select distinct data from test limit 1 offset 1;
[1]
select distinct data from test limit 1 offset 2;
[2]
select distinct data from test limit 1 offset 3;
[3]
# test: select distinct from table offset
explain select distinct data from test offset 1;
[{
  "main": {
    "00": "send_all            0      0      19    # test (select, closing)",
    "01": "union               1      2      0     ",
    "02": "int                 2      -      0     # 1",
    "03": "union_offset        1      2      0     ",
    "04": "recv                1      0      0     ",
    "05": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set_ordered         0      1      1     ",
    "01": "table_open_part     1      1      8     # test (primary)",
    "02": "table_readi32       2      1      -     # data",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      -     # data",
    "05": "push                2      0      0     ",
    "06": "set_add             0      0      0     ",
    "07": "table_next          1      2      0     ",
    "08": "free                1      0      0     ",
    "09": "set_sort            0      0      0     ",
    "10": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select distinct data from test offset 0;
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
select distinct data from test offset 1;
[1, 2, 3, 4, 5, 6, 7, 8, 9]
select distinct data from test offset 2;
[2, 3, 4, 5, 6, 7, 8, 9]
select distinct data from test offset 3;
[3, 4, 5, 6, 7, 8, 9]
# test: select distinct from table order by
explain select distinct data from test order by data;
{"msg": "explain select distinct data from test order by data❰;❱ ⟵ ORDER BY and DISTINCT cannot be combined"}
select distinct data from test order by data;
{"msg": "select distinct data from test order by data❰;❱ ⟵ ORDER BY and DISTINCT cannot be combined"}
# test: select distinct on
select distinct;
{"msg": "select distinct❰;❱ ⟵ bad expression"}
select distinct 123;
{"msg": "select distinct ❰123❱ ⟵ column 123 is not in the SELECT expr list"}
select distinct on;
{"msg": "select distinct on❰;❱ ⟵ ( expected"}
select distinct on (;
{"msg": "select distinct on (❰;❱ ⟵ bad expression"}
select distinct on (123;
{"msg": "select distinct on (123❰;❱ ⟵ ) expected"}
select distinct on (123,;
{"msg": "select distinct on (123,❰;❱ ⟵ bad expression"}
select distinct on (123,);
{"msg": "select distinct on (123,❰)❱ ⟵ bad expression"}
select distinct on (123,);
{"msg": "select distinct on (123,❰)❱ ⟵ bad expression"}
explain select * from test order by data;
[{
  "main": {
    "00": "send_all            0      0      19    # test (select, closing)",
    "01": "union               1      1      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set_ordered         0      2      1     ",
    "01": "table_open_part     1      1      10    # test (primary)",
    "02": "table_readi64       2      1      -     # id",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      -     # data",
    "05": "push                2      0      0     ",
    "06": "table_readi32       2      1      -     # data",
    "07": "push                2      0      0     ",
    "08": "set_add             0      0      0     ",
    "09": "table_next          1      2      0     ",
    "10": "free                1      0      0     ",
    "11": "set_sort            0      0      0     ",
    "12": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
explain select distinct on (data) * from test;
[{
  "main": {
    "00": "send_all            0      0      19    # test (select, closing)",
    "01": "union               1      2      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set_ordered         0      2      1     ",
    "01": "table_open_part     1      1      10    # test (primary)",
    "02": "table_readi64       2      1      -     # id",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      -     # data",
    "05": "push                2      0      0     ",
    "06": "table_readi32       2      1      -     # data",
    "07": "push                2      0      0     ",
    "08": "set_add             0      0      0     ",
    "09": "table_next          1      2      0     ",
    "10": "free                1      0      0     ",
    "11": "set_sort            0      0      0     ",
    "12": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select distinct on (data) * from test;
[[0, 0], [2, 1], [4, 2], [7, 3], [8, 4], [10, 5], [12, 6], [14, 7], [16, 8], [19, 9]]
select distinct on (id) * from test;
[[0, 0], [1, 0], [2, 1], [3, 1], [4, 2], [5, 2], [6, 3], [7, 3], [8, 4], [9, 4], [10, 5], [11, 5], [12, 6], [13, 6], [14, 7], [15, 7], [16, 8], [17, 8], [18, 9], [19, 9]]
# test: select distinct on from table order by
explain select distinct on (data) * from test order by data, id;
{"msg": "explain select distinct on (data) * from test order by data, id❰;❱ ⟵ ORDER BY and DISTINCT cannot be combined"}
# test: select distinct * from table table #3
delete from test;
insert into test values (1, 0), (2, 0), (3, 1), (4, 2), (5, 2);
select distinct * from test;
[[1, 0], [2, 0], [3, 1], [4, 2], [5, 2]]
select distinct id from test;
[1, 2, 3, 4, 5]
select distinct data from test;
[0, 1, 2]
drop table test;
disconnect S0;
close E0;
