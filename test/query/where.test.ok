open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }]
connect E0 S0 localhost:3485
# test: select expr where
select 1 * where false
{"msg": "bad expression"}
# test: select from table where column
create table test (id int primary key serial, data int default 0)
insert into test () values ()
insert into test () values ()
insert into test () values ()
explain select * from test where id >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 0",
      "02": "push                1      0      0     ",
      "03": "table_open          0      0      5     # public.test (primary)",
      "04": "jmp                 15     0      0     ",
      "05": "table_readi32       1      0      0     ",
      "06": "int                 2      -      0     # 0",
      "07": "gteii               3      1      2     ",
      "08": "jntr                14     3      0     ",
      "09": "table_readi32       1      0      0     ",
      "10": "push                1      0      0     ",
      "11": "table_readi32       1      0      1     ",
      "12": "push                1      0      0     ",
      "13": "set_add             0      0      0     ",
      "14": "table_next          0      5      0     ",
      "15": "table_close         0      0      0     ",
      "16": "result              0      0      0     ",
      "17": "ret                 0      0      0     "
    }
  }
}]
select * from test where id >= 0
[[0, 0], [1, 0], [2, 0]]
drop table test
# test: select from table where column.path
create table test (id int primary key serial, data json)
insert into test (data) values ({"data": 123})
insert into test (data) values ({"data": 123})
insert into test (data) values ({"data": 123})
select * from test
[[0, {
  "data": 123
}], [1, {
  "data": 123
}], [2, {
  "data": 123
}]]
explain select * from test where data.data >= 0
{"msg": "unsupported operation: <json> >= <int>"}
explain select * from test where data.data::int >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "table_open          0      0      3     # public.test (primary)",
      "02": "jmp                 17     0      0     ",
      "03": "table_readj         1      0      1     ",
      "04": "string              2      20     0     # data",
      "05": "dotjs               3      1      2     ",
      "06": "push                3      0      0     ",
      "07": "call                1      -      1     # public.int()",
      "08": "int                 2      -      0     # 0",
      "09": "gteii               3      1      2     ",
      "10": "jntr                16     3      0     ",
      "11": "table_readi32       1      0      0     ",
      "12": "push                1      0      0     ",
      "13": "table_readj         1      0      1     ",
      "14": "push                1      0      0     ",
      "15": "set_add             0      0      0     ",
      "16": "table_next          0      3      0     ",
      "17": "table_close         0      0      0     ",
      "18": "result              0      0      0     ",
      "19": "ret                 0      0      0     "
    }
  }
}]
select * from test where data.data::int >= 0
[[0, {
  "data": 123
}], [1, {
  "data": 123
}], [2, {
  "data": 123
}]]
drop table test
# test: select from table where column.path #2
create table test (id int primary key serial, data json)
insert into test (data) values ({"data": {"data": 123}})
insert into test (data) values ({"data": {"data": 123}})
insert into test (data) values ({"data": {"data": 123}})
select * from test
[[0, {
  "data": {
    "data": 123
  }
}], [1, {
  "data": {
    "data": 123
  }
}], [2, {
  "data": {
    "data": 123
  }
}]]
explain select * from test where data.data.data::int >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "table_open          0      0      3     # public.test (primary)",
      "02": "jmp                 17     0      0     ",
      "03": "table_readj         1      0      1     ",
      "04": "string              2      20     0     # data.data",
      "05": "dotjs               3      1      2     ",
      "06": "push                3      0      0     ",
      "07": "call                1      -      1     # public.int()",
      "08": "int                 2      -      0     # 0",
      "09": "gteii               3      1      2     ",
      "10": "jntr                16     3      0     ",
      "11": "table_readi32       1      0      0     ",
      "12": "push                1      0      0     ",
      "13": "table_readj         1      0      1     ",
      "14": "push                1      0      0     ",
      "15": "set_add             0      0      0     ",
      "16": "table_next          0      3      0     ",
      "17": "table_close         0      0      0     ",
      "18": "result              0      0      0     ",
      "19": "ret                 0      0      0     "
    }
  }
}]
select * from test where data.data.data::int >= 0
[[0, {
  "data": {
    "data": 123
  }
}], [1, {
  "data": {
    "data": 123
  }
}], [2, {
  "data": {
    "data": 123
  }
}]]
drop table test
# test: select from table where target.column
create table test (id int primary key serial, data int default 0)
insert into test () values ()
insert into test () values ()
insert into test () values ()
explain select * from test where test.id >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 0",
      "02": "push                1      0      0     ",
      "03": "table_open          0      0      5     # public.test (primary)",
      "04": "jmp                 15     0      0     ",
      "05": "table_readi32       1      0      0     ",
      "06": "int                 2      -      0     # 0",
      "07": "gteii               3      1      2     ",
      "08": "jntr                14     3      0     ",
      "09": "table_readi32       1      0      0     ",
      "10": "push                1      0      0     ",
      "11": "table_readi32       1      0      1     ",
      "12": "push                1      0      0     ",
      "13": "set_add             0      0      0     ",
      "14": "table_next          0      5      0     ",
      "15": "table_close         0      0      0     ",
      "16": "result              0      0      0     ",
      "17": "ret                 0      0      0     "
    }
  }
}]
select * from test where test.id >= 0
[[0, 0], [1, 0], [2, 0]]
drop table test
# test: select from table where target.column.path
create table test (id int primary key serial, data json)
insert into test (data) values ({"data": 123})
insert into test (data) values ({"data": 123})
insert into test (data) values ({"data": 123})
explain select * from test where test.data.data::int >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "table_open          0      0      3     # public.test (primary)",
      "02": "jmp                 17     0      0     ",
      "03": "table_readj         1      0      1     ",
      "04": "string              2      20     0     # data",
      "05": "dotjs               3      1      2     ",
      "06": "push                3      0      0     ",
      "07": "call                1      -      1     # public.int()",
      "08": "int                 2      -      0     # 0",
      "09": "gteii               3      1      2     ",
      "10": "jntr                16     3      0     ",
      "11": "table_readi32       1      0      0     ",
      "12": "push                1      0      0     ",
      "13": "table_readj         1      0      1     ",
      "14": "push                1      0      0     ",
      "15": "set_add             0      0      0     ",
      "16": "table_next          0      3      0     ",
      "17": "table_close         0      0      0     ",
      "18": "result              0      0      0     ",
      "19": "ret                 0      0      0     "
    }
  }
}]
select * from test where test.data.data::int >= 0
[[0, {
  "data": 123
}], [1, {
  "data": 123
}], [2, {
  "data": 123
}]]
drop table test
# test: select from table where alias.column
create table test (id int primary key serial, data int default 0)
insert into test () values ()
insert into test () values ()
insert into test () values ()
explain select * from test alias where alias.id >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 0",
      "02": "push                1      0      0     ",
      "03": "table_open          0      0      5     # public.test (primary)",
      "04": "jmp                 15     0      0     ",
      "05": "table_readi32       1      0      0     ",
      "06": "int                 2      -      0     # 0",
      "07": "gteii               3      1      2     ",
      "08": "jntr                14     3      0     ",
      "09": "table_readi32       1      0      0     ",
      "10": "push                1      0      0     ",
      "11": "table_readi32       1      0      1     ",
      "12": "push                1      0      0     ",
      "13": "set_add             0      0      0     ",
      "14": "table_next          0      5      0     ",
      "15": "table_close         0      0      0     ",
      "16": "result              0      0      0     ",
      "17": "ret                 0      0      0     "
    }
  }
}]
select * from test alias where alias.id >= 0
[[0, 0], [1, 0], [2, 0]]
drop table test
# test: select from table where alias.column.path
create table test (id int primary key serial, data json)
insert into test (data) values ({"data": 123})
insert into test (data) values ({"data": 123})
insert into test (data) values ({"data": 123})
explain select * from test alias where alias.data.data::int >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "table_open          0      0      3     # public.test (primary)",
      "02": "jmp                 17     0      0     ",
      "03": "table_readj         1      0      1     ",
      "04": "string              2      20     0     # data",
      "05": "dotjs               3      1      2     ",
      "06": "push                3      0      0     ",
      "07": "call                1      -      1     # public.int()",
      "08": "int                 2      -      0     # 0",
      "09": "gteii               3      1      2     ",
      "10": "jntr                16     3      0     ",
      "11": "table_readi32       1      0      0     ",
      "12": "push                1      0      0     ",
      "13": "table_readj         1      0      1     ",
      "14": "push                1      0      0     ",
      "15": "set_add             0      0      0     ",
      "16": "table_next          0      3      0     ",
      "17": "table_close         0      0      0     ",
      "18": "result              0      0      0     ",
      "19": "ret                 0      0      0     "
    }
  }
}]
select * from test alias where alias.data.data::int >= 0
[[0, {
  "data": 123
}], [1, {
  "data": 123
}], [2, {
  "data": 123
}]]
drop table test
# test: select from table where *
create table test (id int primary key serial, data int default 0)
insert into test () values ()
insert into test () values ()
insert into test () values ()
explain select * from test alias where *
{"msg": "bad expression"}
drop table test
# test: select from table where true/false
create table test (id int primary key)
insert into test values (1), (2), (3)
explain select * from test where true
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      1      0     ",
      "01": "table_open          0      0      3     # public.test (primary)",
      "02": "jmp                 9      0      0     ",
      "03": "bool                1      1      0     ",
      "04": "jntr                8      1      0     ",
      "05": "table_readi32       1      0      0     ",
      "06": "push                1      0      0     ",
      "07": "set_add             0      0      0     ",
      "08": "table_next          0      3      0     ",
      "09": "table_close         0      0      0     ",
      "10": "result              0      0      0     ",
      "11": "ret                 0      0      0     "
    }
  }
}]
select * from test where true
[1, 2, 3]
select * from test where false
[]
drop table test
# test: select from table where >=
create table test (id int primary key)
insert into test values (1), (2), (3)
explain select * from test where id >= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      1      0     ",
      "01": "int                 1      -      0     # 0",
      "02": "push                1      0      0     ",
      "03": "table_open          0      0      5     # public.test (primary)",
      "04": "jmp                 13     0      0     ",
      "05": "table_readi32       1      0      0     ",
      "06": "int                 2      -      0     # 0",
      "07": "gteii               3      1      2     ",
      "08": "jntr                12     3      0     ",
      "09": "table_readi32       1      0      0     ",
      "10": "push                1      0      0     ",
      "11": "set_add             0      0      0     ",
      "12": "table_next          0      5      0     ",
      "13": "table_close         0      0      0     ",
      "14": "result              0      0      0     ",
      "15": "ret                 0      0      0     "
    }
  }
}]
select * from test where id >= 0
[1, 2, 3]
select * from test where id >= 1
[1, 2, 3]
select * from test where id >= 2
[2, 3]
select * from test where id >= 3
[3]
select * from test where id >= 4
[]
# test: select from table where >
select * from test where id > 0
[1, 2, 3]
select * from test where id > 1
[2, 3]
select * from test where id > 2
[3]
select * from test where id > 3
[]
select * from test where id > 9
[]
# test: select from table where <=
explain select * from test where id <= 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      1      0     ",
      "01": "table_open          0      0      3     # public.test (primary)",
      "02": "jmp                 15     0      0     ",
      "03": "table_readi32       1      0      0     ",
      "04": "int                 2      -      0     # 0",
      "05": "lteii               3      1      2     ",
      "06": "jntr                2      3      0     ",
      "07": "table_readi32       1      0      0     ",
      "08": "int                 2      -      0     # 0",
      "09": "lteii               3      1      2     ",
      "10": "jntr                14     3      0     ",
      "11": "table_readi32       1      0      0     ",
      "12": "push                1      0      0     ",
      "13": "set_add             0      0      0     ",
      "14": "table_next          0      3      0     ",
      "15": "table_close         0      0      0     ",
      "16": "result              0      0      0     ",
      "17": "ret                 0      0      0     "
    }
  }
}]
select * from test where id <= 0
[]
select * from test where id <= 1
[1]
select * from test where id <= 2
[1, 2]
select * from test where id <= 3
[1, 2, 3]
select * from test where id <= 8
[1, 2, 3]
# test: select from table where <
explain select * from test where id < 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      1      0     ",
      "01": "table_open          0      0      3     # public.test (primary)",
      "02": "jmp                 15     0      0     ",
      "03": "table_readi32       1      0      0     ",
      "04": "int                 2      -      0     # 0",
      "05": "ltii                3      1      2     ",
      "06": "jntr                2      3      0     ",
      "07": "table_readi32       1      0      0     ",
      "08": "int                 2      -      0     # 0",
      "09": "ltii                3      1      2     ",
      "10": "jntr                14     3      0     ",
      "11": "table_readi32       1      0      0     ",
      "12": "push                1      0      0     ",
      "13": "set_add             0      0      0     ",
      "14": "table_next          0      3      0     ",
      "15": "table_close         0      0      0     ",
      "16": "result              0      0      0     ",
      "17": "ret                 0      0      0     "
    }
  }
}]
select * from test where id < 0
[]
select * from test where id < 1
[]
select * from test where id < 2
[1]
select * from test where id < 3
[1, 2]
select * from test where id < 8
[1, 2, 3]
drop table test
# test: select from table where = (point lookup)
create table test (id int primary key)
insert into test values (1), (2), (3)
explain select * from test where id = 2
[{
  "bytecode": {
    "coordinator": {
      "00": "send_lookup         0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      1      0     ",
      "01": "int                 1      -      0     # 2",
      "02": "push                1      0      0     ",
      "03": "table_open_lookup   0      0      5     # public.test (primary)",
      "04": "jmp                 13     0      0     ",
      "05": "table_readi32       1      0      0     ",
      "06": "int                 2      -      0     # 2",
      "07": "equii               3      1      2     ",
      "08": "jntr                12     3      0     ",
      "09": "table_readi32       1      0      0     ",
      "10": "push                1      0      0     ",
      "11": "set_add             0      0      0     ",
      "12": "jmp                 4      0      0     ",
      "13": "table_close         0      0      0     ",
      "14": "result              0      0      0     ",
      "15": "ret                 0      0      0     "
    }
  }
}]
select * from test where id = 2
[2]
drop table test
disconnect S0
close E0
