#

open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }], "backends": 3
connect E0 S0 localhost:3485

# test: create wal on start
show wal
select system.wal()
show lsn
show all

# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485

show wal
select system.wal()
show lsn
show all

# test: create table
create table test (id int serial primary key, data int default 0)
show lsn
select serial("public", "test")

# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485

# test: validate state
show lsn
select serial("public", "test")

# test: insert
insert into test () values (), (), ()
show lsn
select serial("public", "test")
select * from test

# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485

# test: validate state
show lsn
select serial("public", "test")
select * from test

# test: update
update test set data = id
show lsn
select serial("public", "test")
select * from test

# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485

# test: validate state
show lsn
select serial("public", "test")
select * from test

# test: upsert
insert into test values (2, 0) on conflict do update set data = data + 1
show lsn
select serial("public", "test")
select * from test

# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485

# test: validate state
show lsn
select serial("public", "test")
select * from test

# test: delete
delete from test where id in (0, 1)
show lsn
select serial("public", "test")
select * from test

# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485

# test: validate state
show lsn
select serial("public", "test")
select * from test

disconnect S0
close E0
