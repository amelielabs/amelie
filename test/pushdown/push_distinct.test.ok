env_open E0 "cluster_shards": 3
connect E0 S0
connect: on_connect
# test: select distinct star from table empty
create table test (id int primary key serial, data int default 0)
explain select distinct * from test
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                bool        0      1      0
 2                push        0      0      0
 3          merge_recv        0      0     -1
 4            send_set        0      0      0
 5                 ret        0      0      0


bytecode [shard 0]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6         cursor_read        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 1]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6         cursor_read        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 2]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6         cursor_read        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0

"
select distinct * from test
insert into test generate 20
update test set data = id / 2
select * from test
[0, 0]
[2, 1]
[1, 0]
[3, 1]
[6, 3]
[12, 6]
[4, 2]
[7, 3]
[14, 7]
[5, 2]
[10, 5]
[15, 7]
[8, 4]
[11, 5]
[17, 8]
[9, 4]
[19, 9]
[13, 6]
[16, 8]
[18, 9]
select * from test order by id
[0, 0]
[1, 0]
[2, 1]
[3, 1]
[4, 2]
[5, 2]
[6, 3]
[7, 3]
[8, 4]
[9, 4]
[10, 5]
[11, 5]
[12, 6]
[13, 6]
[14, 7]
[15, 7]
[16, 8]
[17, 8]
[18, 9]
[19, 9]
# test: select distinct star from table
explain select distinct * from test
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                bool        0      1      0
 2                push        0      0      0
 3          merge_recv        0      0     -1
 4            send_set        0      0      0
 5                 ret        0      0      0


bytecode [shard 0]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6         cursor_read        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 1]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6         cursor_read        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 2]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6         cursor_read        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0

"
select distinct * from test
[0, 0]
[1, 0]
[2, 1]
[3, 1]
[4, 2]
[5, 2]
[6, 3]
[7, 3]
[8, 4]
[9, 4]
[10, 5]
[11, 5]
[12, 6]
[13, 6]
[14, 7]
[15, 7]
[16, 8]
[17, 8]
[18, 9]
[19, 9]
# test: select distinct from table
explain select distinct id from test
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                bool        0      1      0
 2                push        0      0      0
 3          merge_recv        0      0     -1
 4            send_set        0      0      0
 5                 ret        0      0      0


bytecode [shard 0]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      0
 6          cursor_idx        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 1]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      0
 6          cursor_idx        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 2]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      0
 6          cursor_idx        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0

"
select distinct id from test
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
select distinct data from test
0
1
2
3
4
5
6
7
8
9
# test: select distinct from table #2
explain select distinct id, data from test
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                bool        0      1      0
 2                push        0      0      0
 3          merge_recv        0      0     -1
 4            send_set        0      0      0
 5                 ret        0      0      0


bytecode [shard 0]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      3      5      # public.test (primary)
 4                 jmp       16      0      0
 5          cursor_idx        1      0      0
 6                push        1      0      0
 7          cursor_idx        1      0      1
 8                push        1      0      0
 9               array        1      2      0
10          cursor_idx        2      0      0
11                push        2      0      0
12          cursor_idx        2      0      1
13                push        2      0      0
14             set_add        0      1      0
15         cursor_next        0      5      0
16        cursor_close        0      0      0
17            set_sort        0      0      0
18               ready        0      0      0
19                 ret        0      0      0


bytecode [shard 1]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      3      5      # public.test (primary)
 4                 jmp       16      0      0
 5          cursor_idx        1      0      0
 6                push        1      0      0
 7          cursor_idx        1      0      1
 8                push        1      0      0
 9               array        1      2      0
10          cursor_idx        2      0      0
11                push        2      0      0
12          cursor_idx        2      0      1
13                push        2      0      0
14             set_add        0      1      0
15         cursor_next        0      5      0
16        cursor_close        0      0      0
17            set_sort        0      0      0
18               ready        0      0      0
19                 ret        0      0      0


bytecode [shard 2]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      3      5      # public.test (primary)
 4                 jmp       16      0      0
 5          cursor_idx        1      0      0
 6                push        1      0      0
 7          cursor_idx        1      0      1
 8                push        1      0      0
 9               array        1      2      0
10          cursor_idx        2      0      0
11                push        2      0      0
12          cursor_idx        2      0      1
13                push        2      0      0
14             set_add        0      1      0
15         cursor_next        0      5      0
16        cursor_close        0      0      0
17            set_sort        0      0      0
18               ready        0      0      0
19                 ret        0      0      0

"
select distinct id, data from test
[0, 0]
[1, 0]
[2, 1]
[3, 1]
[4, 2]
[5, 2]
[6, 3]
[7, 3]
[8, 4]
[9, 4]
[10, 5]
[11, 5]
[12, 6]
[13, 6]
[14, 7]
[15, 7]
[16, 8]
[17, 8]
[18, 9]
[19, 9]
# test: select distinct from table limit
explain select distinct data from test limit 4
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                bool        0      1      0
 2                push        0      0      0
 3                 int        0      4      0
 4          merge_recv        1      0      0
 5            send_set        1      0      0
 6                 ret        0      0      0


bytecode [shard 0]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 1]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 2]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0

"
select distinct data from test limit 4
0
1
2
3
# test: select distinct from table limit 0
explain select distinct data from test limit 0
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                bool        0      1      0
 2                push        0      0      0
 3                 int        0      0      0
 4          merge_recv        1      0      0
 5            send_set        1      0      0
 6                 ret        0      0      0


bytecode [shard 0]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 1]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 2]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0

"
select distinct data from test limit 0
# test: select distinct from table limit/offset
explain select distinct data from test limit 1 offset 1
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                bool        0      1      0
 2                push        0      0      0
 3                 int        0      1      0
 4                 int        1      1      0
 5          merge_recv        2      0      0
 6            send_set        2      0      0
 7                 ret        0      0      0


bytecode [shard 0]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 1]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 2]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0

"
select distinct data from test limit 1 offset 0
0
select distinct data from test limit 1 offset 1
1
select distinct data from test limit 1 offset 2
2
select distinct data from test limit 1 offset 3
3
# test: select distinct from table offset
explain select distinct data from test offset 1
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                bool        0      1      0
 2                push        0      0      0
 3                 int        0      1      0
 4          merge_recv        1      0     -1
 5            send_set        1      0      0
 6                 ret        0      0      0


bytecode [shard 0]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 1]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 2]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0

"
select distinct data from test offset 0
0
1
2
3
4
5
6
7
8
9
select distinct data from test offset 1
1
2
3
4
5
6
7
8
9
select distinct data from test offset 2
2
3
4
5
6
7
8
9
select distinct data from test offset 3
3
4
5
6
7
8
9
# test: select distinct from table order by
explain select distinct data from test order by data
query: on_error
{"code": 1, "msg": "ORDER BY and DISTINCT cannot be combined"}
select distinct data from test order by data
query: on_error
{"code": 1, "msg": "ORDER BY and DISTINCT cannot be combined"}
# test: select distinct from table group by
explain select distinct count(*) from test
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1    group_merge_recv        0      0      0
 2         set_ordered        1     20      0
 3    cursor_open_expr        1      0      5
 4                 jmp       10      0      0
 5      group_get_aggr        2      1      0
 6      group_get_aggr        3      1      0
 7                push        3      0      0
 8             set_add        1      2      0
 9         cursor_next        1      5      0
10        cursor_close        1      0      0
11            set_sort        1      0      0
12                bool        0      1      0
13                push        0      0      0
14               merge        0      1     -1
15            send_set        0      0      0
16                 ret        0      0      0


bytecode [shard 0]
--------
 0               group        0      0      0
 1      group_add_aggr        0      0      0
 2                null        1      0      0
 3                push        1      0      0
 4           group_add        0      0      0
 5             int_min        1      0      0
 6                push        1      0      0
 7         cursor_open        0      0      9      # public.test (primary)
 8                 jmp       13      0      0
 9         cursor_read        1      0      0
10                push        1      0      0
11           group_add        0      0      0
12         cursor_next        0      9      0
13        cursor_close        0      0      0
14               ready        0      0      0
15                 ret        0      0      0


bytecode [shard 1]
--------
 0               group        0      0      0
 1      group_add_aggr        0      0      0
 2                null        1      0      0
 3                push        1      0      0
 4           group_add        0      0      0
 5             int_min        1      0      0
 6                push        1      0      0
 7         cursor_open        0      0      9      # public.test (primary)
 8                 jmp       13      0      0
 9         cursor_read        1      0      0
10                push        1      0      0
11           group_add        0      0      0
12         cursor_next        0      9      0
13        cursor_close        0      0      0
14               ready        0      0      0
15                 ret        0      0      0


bytecode [shard 2]
--------
 0               group        0      0      0
 1      group_add_aggr        0      0      0
 2                null        1      0      0
 3                push        1      0      0
 4           group_add        0      0      0
 5             int_min        1      0      0
 6                push        1      0      0
 7         cursor_open        0      0      9      # public.test (primary)
 8                 jmp       13      0      0
 9         cursor_read        1      0      0
10                push        1      0      0
11           group_add        0      0      0
12         cursor_next        0      9      0
13        cursor_close        0      0      0
14               ready        0      0      0
15                 ret        0      0      0

"
select distinct count(*) from test
20
explain select distinct count(*) from test group by id
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1    group_merge_recv        0      0      0
 2         set_ordered        1     20      0
 3    cursor_open_expr        1      0      5
 4                 jmp       10      0      0
 5      group_get_aggr        2      1      0
 6      group_get_aggr        3      1      0
 7                push        3      0      0
 8             set_add        1      2      0
 9         cursor_next        1      5      0
10        cursor_close        1      0      0
11            set_sort        1      0      0
12                bool        0      1      0
13                push        0      0      0
14               merge        0      1     -1
15            send_set        0      0      0
16                 ret        0      0      0


bytecode [shard 0]
--------
 0               group        0      1      0
 1      group_add_aggr        0      0      0
 2             int_min        1      0      0
 3                push        1      0      0
 4         cursor_open        0      0      6      # public.test (primary)
 5                 jmp       12      0      0
 6          cursor_idx        1      0      0
 7                push        1      0      0
 8         cursor_read        1      0      0
 9                push        1      0      0
10           group_add        0      0      0
11         cursor_next        0      6      0
12        cursor_close        0      0      0
13               ready        0      0      0
14                 ret        0      0      0


bytecode [shard 1]
--------
 0               group        0      1      0
 1      group_add_aggr        0      0      0
 2             int_min        1      0      0
 3                push        1      0      0
 4         cursor_open        0      0      6      # public.test (primary)
 5                 jmp       12      0      0
 6          cursor_idx        1      0      0
 7                push        1      0      0
 8         cursor_read        1      0      0
 9                push        1      0      0
10           group_add        0      0      0
11         cursor_next        0      6      0
12        cursor_close        0      0      0
13               ready        0      0      0
14                 ret        0      0      0


bytecode [shard 2]
--------
 0               group        0      1      0
 1      group_add_aggr        0      0      0
 2             int_min        1      0      0
 3                push        1      0      0
 4         cursor_open        0      0      6      # public.test (primary)
 5                 jmp       12      0      0
 6          cursor_idx        1      0      0
 7                push        1      0      0
 8         cursor_read        1      0      0
 9                push        1      0      0
10           group_add        0      0      0
11         cursor_next        0      6      0
12        cursor_close        0      0      0
13               ready        0      0      0
14                 ret        0      0      0

"
select distinct count(*) from test group by id
1
# test: select distinct on
select distinct
query: on_error
{"code": 1, "msg": "bad expression"}
select distinct 123
123
select distinct on
query: on_error
{"code": 1, "msg": "DISTINCT <(> expected"}
select distinct on (
query: on_error
{"code": 1, "msg": "bad expression"}
select distinct on (123
query: on_error
{"code": 1, "msg": "DISTINCT (<)> expected"}
select distinct on (123,
query: on_error
{"code": 1, "msg": "bad expression"}
select distinct on (123,)
query: on_error
{"code": 1, "msg": "bad expression"}
select distinct on (123,)
query: on_error
{"code": 1, "msg": "bad expression"}
# test: select distinct on from table
explain select distinct on (*) * from test
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                bool        0      1      0
 2                push        0      0      0
 3          merge_recv        0      0     -1
 4            send_set        0      0      0
 5                 ret        0      0      0


bytecode [shard 0]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6         cursor_read        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 1]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6         cursor_read        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 2]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6         cursor_read        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0

"
select distinct on (*) * from test
[0, 0]
[1, 0]
[2, 1]
[3, 1]
[4, 2]
[5, 2]
[6, 3]
[7, 3]
[8, 4]
[9, 4]
[10, 5]
[11, 5]
[12, 6]
[13, 6]
[14, 7]
[15, 7]
[16, 8]
[17, 8]
[18, 9]
[19, 9]
explain select * from test order by data
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                bool        0      0      0
 2                push        0      0      0
 3          merge_recv        0      0     -1
 4            send_set        0      0      0
 5                 ret        0      0      0


bytecode [shard 0]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 1]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 2]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0

"
explain select distinct on (data) * from test
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                bool        0      1      0
 2                push        0      0      0
 3          merge_recv        0      0     -1
 4            send_set        0      0      0
 5                 ret        0      0      0


bytecode [shard 0]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 1]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0


bytecode [shard 2]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0

"
select distinct on (data) * from test
[0, 0]
[3, 1]
[4, 2]
[6, 3]
[8, 4]
[10, 5]
[13, 6]
[14, 7]
[16, 8]
[18, 9]
select distinct on (id) * from test
[0, 0]
[1, 0]
[2, 1]
[3, 1]
[4, 2]
[5, 2]
[6, 3]
[7, 3]
[8, 4]
[9, 4]
[10, 5]
[11, 5]
[12, 6]
[13, 6]
[14, 7]
[15, 7]
[16, 8]
[17, 8]
[18, 9]
[19, 9]
# test: select distinct on from table order by
explain select distinct on (data) * from test order by data, id
query: on_error
{"code": 1, "msg": "ORDER BY and DISTINCT cannot be combined"}
# test: select distinct on from table group by
explain select distinct on (count(*)) * from test group by id
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1    group_merge_recv        0      0      0
 2         set_ordered        1     20      0
 3    cursor_open_expr        1      0      5
 4                 jmp       10      0      0
 5         cursor_read        2      1      0
 6      group_get_aggr        3      1      0
 7                push        3      0      0
 8             set_add        1      2      0
 9         cursor_next        1      5      0
10        cursor_close        1      0      0
11            set_sort        1      0      0
12                bool        0      1      0
13                push        0      0      0
14               merge        0      1     -1
15            send_set        0      0      0
16                 ret        0      0      0


bytecode [shard 0]
--------
 0               group        0      1      0
 1      group_add_aggr        0      0      0
 2             int_min        1      0      0
 3                push        1      0      0
 4         cursor_open        0      0      6      # public.test (primary)
 5                 jmp       12      0      0
 6          cursor_idx        1      0      0
 7                push        1      0      0
 8         cursor_read        1      0      0
 9                push        1      0      0
10           group_add        0      0      0
11         cursor_next        0      6      0
12        cursor_close        0      0      0
13               ready        0      0      0
14                 ret        0      0      0


bytecode [shard 1]
--------
 0               group        0      1      0
 1      group_add_aggr        0      0      0
 2             int_min        1      0      0
 3                push        1      0      0
 4         cursor_open        0      0      6      # public.test (primary)
 5                 jmp       12      0      0
 6          cursor_idx        1      0      0
 7                push        1      0      0
 8         cursor_read        1      0      0
 9                push        1      0      0
10           group_add        0      0      0
11         cursor_next        0      6      0
12        cursor_close        0      0      0
13               ready        0      0      0
14                 ret        0      0      0


bytecode [shard 2]
--------
 0               group        0      1      0
 1      group_add_aggr        0      0      0
 2             int_min        1      0      0
 3                push        1      0      0
 4         cursor_open        0      0      6      # public.test (primary)
 5                 jmp       12      0      0
 6          cursor_idx        1      0      0
 7                push        1      0      0
 8         cursor_read        1      0      0
 9                push        1      0      0
10           group_add        0      0      0
11         cursor_next        0      6      0
12        cursor_close        0      0      0
13               ready        0      0      0
14                 ret        0      0      0

"
select distinct on (count(*)) * from test group by id
0
select distinct on (count(*)) count(*) from test group by id
1
select distinct count(*) from test group by id
1
select count(*) from test group by id
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
drop table test
# test: select distinct star from reference empty
create table test (id int primary key serial, data int default 0) reference
explain select distinct * from test
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6         cursor_read        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12                bool        1      1      0
13                push        1      0      0
14               merge        1      0     -1
15            send_set        1      0      0
16                recv        0      0      0
17                 ret        0      0      0

"
select distinct * from test
insert into test generate 20
update test set data = id / 2
select * from test
[0, 0]
[1, 0]
[2, 1]
[3, 1]
[4, 2]
[5, 2]
[6, 3]
[7, 3]
[8, 4]
[9, 4]
[10, 5]
[11, 5]
[12, 6]
[13, 6]
[14, 7]
[15, 7]
[16, 8]
[17, 8]
[18, 9]
[19, 9]
select * from test order by id
[0, 0]
[1, 0]
[2, 1]
[3, 1]
[4, 2]
[5, 2]
[6, 3]
[7, 3]
[8, 4]
[9, 4]
[10, 5]
[11, 5]
[12, 6]
[13, 6]
[14, 7]
[15, 7]
[16, 8]
[17, 8]
[18, 9]
[19, 9]
# test: select distinct star from reference
explain select distinct * from test
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6         cursor_read        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12                bool        1      1      0
13                push        1      0      0
14               merge        1      0     -1
15            send_set        1      0      0
16                recv        0      0      0
17                 ret        0      0      0

"
select distinct * from test
[0, 0]
[1, 0]
[2, 1]
[3, 1]
[4, 2]
[5, 2]
[6, 3]
[7, 3]
[8, 4]
[9, 4]
[10, 5]
[11, 5]
[12, 6]
[13, 6]
[14, 7]
[15, 7]
[16, 8]
[17, 8]
[18, 9]
[19, 9]
# test: select distinct from reference
explain select distinct id from test
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      0
 6          cursor_idx        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12                bool        1      1      0
13                push        1      0      0
14               merge        1      0     -1
15            send_set        1      0      0
16                recv        0      0      0
17                 ret        0      0      0

"
select distinct id from test
0
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
select distinct data from test
0
1
2
3
4
5
6
7
8
9
# test: select distinct from reference #2
explain select distinct id, data from test
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      3      5      # public.test (primary)
 4                 jmp       16      0      0
 5          cursor_idx        1      0      0
 6                push        1      0      0
 7          cursor_idx        1      0      1
 8                push        1      0      0
 9               array        1      2      0
10          cursor_idx        2      0      0
11                push        2      0      0
12          cursor_idx        2      0      1
13                push        2      0      0
14             set_add        0      1      0
15         cursor_next        0      5      0
16        cursor_close        0      0      0
17            set_sort        0      0      0
18                bool        1      1      0
19                push        1      0      0
20               merge        1      0     -1
21            send_set        1      0      0
22                recv        0      0      0
23                 ret        0      0      0

"
select distinct id, data from test
[0, 0]
[1, 0]
[2, 1]
[3, 1]
[4, 2]
[5, 2]
[6, 3]
[7, 3]
[8, 4]
[9, 4]
[10, 5]
[11, 5]
[12, 6]
[13, 6]
[14, 7]
[15, 7]
[16, 8]
[17, 8]
[18, 9]
[19, 9]
# test: select distinct from reference limit
explain select distinct data from test limit 4
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12                bool        1      1      0
13                push        1      0      0
14                 int        1      4      0
15               merge        2      0      1
16            send_set        2      0      0
17                recv        0      0      0
18                 ret        0      0      0

"
select distinct data from test limit 4
0
1
2
3
# test: select distinct from reference limit 0
explain select distinct data from test limit 0
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12                bool        1      1      0
13                push        1      0      0
14                 int        1      0      0
15               merge        2      0      1
16            send_set        2      0      0
17                recv        0      0      0
18                 ret        0      0      0

"
select distinct data from test limit 0
# test: select distinct from reference limit/offset
explain select distinct data from test limit 1 offset 1
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12                bool        1      1      0
13                push        1      0      0
14                 int        1      1      0
15                 int        2      1      0
16               merge        3      0      1
17            send_set        3      0      0
18                recv        0      0      0
19                 ret        0      0      0

"
select distinct data from test limit 1 offset 0
0
select distinct data from test limit 1 offset 1
1
select distinct data from test limit 1 offset 2
2
select distinct data from test limit 1 offset 3
3
# test: select distinct from reference offset
explain select distinct data from test offset 1
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5          cursor_idx        1      0      1
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12                bool        1      1      0
13                push        1      0      0
14                 int        1      1      0
15               merge        2      0     -1
16            send_set        2      0      0
17                recv        0      0      0
18                 ret        0      0      0

"
select distinct data from test offset 0
0
1
2
3
4
5
6
7
8
9
select distinct data from test offset 1
1
2
3
4
5
6
7
8
9
select distinct data from test offset 2
2
3
4
5
6
7
8
9
select distinct data from test offset 3
3
4
5
6
7
8
9
# test: select distinct from reference order by
explain select distinct data from test order by data
query: on_error
{"code": 1, "msg": "ORDER BY and DISTINCT cannot be combined"}
select distinct data from test order by data
query: on_error
{"code": 1, "msg": "ORDER BY and DISTINCT cannot be combined"}
# test: select distinct from reference group by
explain select distinct count(*) from test
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1               group        1      0      0
 2      group_add_aggr        1      0      0
 3                null        2      0      0
 4                push        2      0      0
 5           group_add        1      0      0
 6             int_min        2      0      0
 7                push        2      0      0
 8         cursor_open        0      2     10      # public.test (primary)
 9                 jmp       14      0      0
10         cursor_read        2      0      0
11                push        2      0      0
12           group_add        1      0      0
13         cursor_next        0     10      0
14        cursor_close        0      0      0
15    cursor_open_expr        1      1     17
16                 jmp       22      0      0
17      group_get_aggr        2      1      0
18      group_get_aggr        3      1      0
19                push        3      0      0
20             set_add        0      2      0
21         cursor_next        1     17      0
22        cursor_close        1      0      0
23            set_sort        0      0      0
24                bool        1      1      0
25                push        1      0      0
26               merge        1      0     -1
27            send_set        1      0      0
28                recv        0      0      0
29                 ret        0      0      0

"
select distinct count(*) from test
20
explain select distinct count(*) from test group by id
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1               group        1      1      0
 2      group_add_aggr        1      0      0
 3             int_min        2      0      0
 4                push        2      0      0
 5         cursor_open        0      2      7      # public.test (primary)
 6                 jmp       13      0      0
 7          cursor_idx        2      0      0
 8                push        2      0      0
 9         cursor_read        2      0      0
10                push        2      0      0
11           group_add        1      0      0
12         cursor_next        0      7      0
13        cursor_close        0      0      0
14    cursor_open_expr        1      1     16
15                 jmp       21      0      0
16      group_get_aggr        2      1      0
17      group_get_aggr        3      1      0
18                push        3      0      0
19             set_add        0      2      0
20         cursor_next        1     16      0
21        cursor_close        1      0      0
22            set_sort        0      0      0
23                bool        1      1      0
24                push        1      0      0
25               merge        1      0     -1
26            send_set        1      0      0
27                recv        0      0      0
28                 ret        0      0      0

"
select distinct count(*) from test group by id
1
# test: select distinct on from reference
explain select distinct on (*) * from test
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6         cursor_read        2      0      0
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12                bool        1      1      0
13                push        1      0      0
14               merge        1      0     -1
15            send_set        1      0      0
16                recv        0      0      0
17                 ret        0      0      0

"
select distinct on (*) * from test
[0, 0]
[1, 0]
[2, 1]
[3, 1]
[4, 2]
[5, 2]
[6, 3]
[7, 3]
[8, 4]
[9, 4]
[10, 5]
[11, 5]
[12, 6]
[13, 6]
[14, 7]
[15, 7]
[16, 8]
[17, 8]
[18, 9]
[19, 9]
explain select * from test order by data
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12                bool        1      0      0
13                push        1      0      0
14               merge        1      0     -1
15            send_set        1      0      0
16                recv        0      0      0
17                 ret        0      0      0

"
explain select distinct on (data) * from test
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      2      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12                bool        1      1      0
13                push        1      0      0
14               merge        1      0     -1
15            send_set        1      0      0
16                recv        0      0      0
17                 ret        0      0      0

"
select distinct on (data) * from test
[0, 0]
[2, 1]
[4, 2]
[6, 3]
[8, 4]
[10, 5]
[12, 6]
[14, 7]
[16, 8]
[18, 9]
select distinct on (id) * from test
[0, 0]
[1, 0]
[2, 1]
[3, 1]
[4, 2]
[5, 2]
[6, 3]
[7, 3]
[8, 4]
[9, 4]
[10, 5]
[11, 5]
[12, 6]
[13, 6]
[14, 7]
[15, 7]
[16, 8]
[17, 8]
[18, 9]
[19, 9]
# test: select distinct on from reference order by
explain select distinct on (data) * from test order by data, id
query: on_error
{"code": 1, "msg": "ORDER BY and DISTINCT cannot be combined"}
# test: select distinct on from reference group by
explain select distinct on (count(*)) * from test group by id
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1               group        1      1      0
 2      group_add_aggr        1      0      0
 3             int_min        2      0      0
 4                push        2      0      0
 5         cursor_open        0      2      7      # public.test (primary)
 6                 jmp       13      0      0
 7          cursor_idx        2      0      0
 8                push        2      0      0
 9         cursor_read        2      0      0
10                push        2      0      0
11           group_add        1      0      0
12         cursor_next        0      7      0
13        cursor_close        0      0      0
14    cursor_open_expr        1      1     16
15                 jmp       21      0      0
16         cursor_read        2      1      0
17      group_get_aggr        3      1      0
18                push        3      0      0
19             set_add        0      2      0
20         cursor_next        1     16      0
21        cursor_close        1      0      0
22            set_sort        0      0      0
23                bool        1      1      0
24                push        1      0      0
25               merge        1      0     -1
26            send_set        1      0      0
27                recv        0      0      0
28                 ret        0      0      0

"
select distinct on (count(*)) * from test group by id
0
select distinct on (count(*)) count(*) from test group by id
1
select distinct count(*) from test group by id
1
select count(*) from test group by id
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
drop table test
# test: select distinct star from expr empty
explain select distinct * from []
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1               array        1      0      0
 2    cursor_open_expr        0      1      4
 3                 jmp        9      0      0
 4         cursor_read        2      0      0
 5         cursor_read        3      0      0
 6                push        3      0      0
 7             set_add        0      2      0
 8         cursor_next        0      4      0
 9        cursor_close        0      0      0
10            set_sort        0      0      0
11                bool        1      1      0
12                push        1      0      0
13               merge        1      0     -1
14            send_set        1      0      0
15                recv        0      0      0
16                 ret        0      0      0

"
select distinct * from []
# test: select distinct star from expr
explain select distinct * from [0,1,2,3,4,2,3,4]
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1                 int        1      0      0
 2                push        1      0      0
 3                 int        1      1      0
 4                push        1      0      0
 5                 int        1      2      0
 6                push        1      0      0
 7                 int        1      3      0
 8                push        1      0      0
 9                 int        1      4      0
10                push        1      0      0
11                 int        1      2      0
12                push        1      0      0
13                 int        1      3      0
14                push        1      0      0
15                 int        1      4      0
16                push        1      0      0
17               array        1      8      0
18    cursor_open_expr        0      1     20
19                 jmp       25      0      0
20         cursor_read        2      0      0
21         cursor_read        3      0      0
22                push        3      0      0
23             set_add        0      2      0
24         cursor_next        0     20      0
25        cursor_close        0      0      0
26            set_sort        0      0      0
27                bool        1      1      0
28                push        1      0      0
29               merge        1      0     -1
30            send_set        1      0      0
31                recv        0      0      0
32                 ret        0      0      0

"
select distinct * from [0,1,2,3,4,2,3,4]
0
1
2
3
4
# test: select distinct from expr limit
explain select distinct * from [0,1,2,3,4,2,3,4] limit 2
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1                 int        1      0      0
 2                push        1      0      0
 3                 int        1      1      0
 4                push        1      0      0
 5                 int        1      2      0
 6                push        1      0      0
 7                 int        1      3      0
 8                push        1      0      0
 9                 int        1      4      0
10                push        1      0      0
11                 int        1      2      0
12                push        1      0      0
13                 int        1      3      0
14                push        1      0      0
15                 int        1      4      0
16                push        1      0      0
17               array        1      8      0
18    cursor_open_expr        0      1     20
19                 jmp       25      0      0
20         cursor_read        2      0      0
21         cursor_read        3      0      0
22                push        3      0      0
23             set_add        0      2      0
24         cursor_next        0     20      0
25        cursor_close        0      0      0
26            set_sort        0      0      0
27                bool        1      1      0
28                push        1      0      0
29                 int        1      2      0
30               merge        2      0      1
31            send_set        2      0      0
32                recv        0      0      0
33                 ret        0      0      0

"
select distinct * from [0,1,2,3,4,2,3,4] limit 2
0
1
# test: select distinct from expr limit 0
explain select distinct * from [0,1,2,3,4,2,3,4] limit 0
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1                 int        1      0      0
 2                push        1      0      0
 3                 int        1      1      0
 4                push        1      0      0
 5                 int        1      2      0
 6                push        1      0      0
 7                 int        1      3      0
 8                push        1      0      0
 9                 int        1      4      0
10                push        1      0      0
11                 int        1      2      0
12                push        1      0      0
13                 int        1      3      0
14                push        1      0      0
15                 int        1      4      0
16                push        1      0      0
17               array        1      8      0
18    cursor_open_expr        0      1     20
19                 jmp       25      0      0
20         cursor_read        2      0      0
21         cursor_read        3      0      0
22                push        3      0      0
23             set_add        0      2      0
24         cursor_next        0     20      0
25        cursor_close        0      0      0
26            set_sort        0      0      0
27                bool        1      1      0
28                push        1      0      0
29                 int        1      0      0
30               merge        2      0      1
31            send_set        2      0      0
32                recv        0      0      0
33                 ret        0      0      0

"
select distinct * from [0,1,2,3,4,2,3,4] limit 0
# test: select distinct from expr limit/offset
explain select distinct * from [0,1,2,3,4,2,3,4] limit 1 offset 1
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1                 int        1      0      0
 2                push        1      0      0
 3                 int        1      1      0
 4                push        1      0      0
 5                 int        1      2      0
 6                push        1      0      0
 7                 int        1      3      0
 8                push        1      0      0
 9                 int        1      4      0
10                push        1      0      0
11                 int        1      2      0
12                push        1      0      0
13                 int        1      3      0
14                push        1      0      0
15                 int        1      4      0
16                push        1      0      0
17               array        1      8      0
18    cursor_open_expr        0      1     20
19                 jmp       25      0      0
20         cursor_read        2      0      0
21         cursor_read        3      0      0
22                push        3      0      0
23             set_add        0      2      0
24         cursor_next        0     20      0
25        cursor_close        0      0      0
26            set_sort        0      0      0
27                bool        1      1      0
28                push        1      0      0
29                 int        1      1      0
30                 int        2      1      0
31               merge        3      0      1
32            send_set        3      0      0
33                recv        0      0      0
34                 ret        0      0      0

"
select distinct * from [0,1,2,3,4,2,3,4] limit 1 offset 0
0
select distinct * from [0,1,2,3,4,2,3,4] limit 1 offset 1
1
select distinct * from [0,1,2,3,4,2,3,4] limit 1 offset 2
2
select distinct * from [0,1,2,3,4,2,3,4] limit 1 offset 3
3
# test: select distinct from expr offset
explain select distinct * from [0,1,2,3,4,2,3,4] offset 1
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1                 int        1      0      0
 2                push        1      0      0
 3                 int        1      1      0
 4                push        1      0      0
 5                 int        1      2      0
 6                push        1      0      0
 7                 int        1      3      0
 8                push        1      0      0
 9                 int        1      4      0
10                push        1      0      0
11                 int        1      2      0
12                push        1      0      0
13                 int        1      3      0
14                push        1      0      0
15                 int        1      4      0
16                push        1      0      0
17               array        1      8      0
18    cursor_open_expr        0      1     20
19                 jmp       25      0      0
20         cursor_read        2      0      0
21         cursor_read        3      0      0
22                push        3      0      0
23             set_add        0      2      0
24         cursor_next        0     20      0
25        cursor_close        0      0      0
26            set_sort        0      0      0
27                bool        1      1      0
28                push        1      0      0
29                 int        1      1      0
30               merge        2      0     -1
31            send_set        2      0      0
32                recv        0      0      0
33                 ret        0      0      0

"
select distinct * from [0,1,2,3,4,2,3,4] offset 0
0
1
2
3
4
select distinct * from [0,1,2,3,4,2,3,4] offset 1
1
2
3
4
select distinct * from [0,1,2,3,4,2,3,4] offset 2
2
3
4
select distinct * from [0,1,2,3,4,2,3,4] offset 3
3
4
# test: select distinct from expr order by
explain select distinct * from [0,1,2,3,4,2,3,4] order by *
query: on_error
{"code": 1, "msg": "ORDER BY and DISTINCT cannot be combined"}
select distinct * from [0,1,2,3,4,2,3,4] order by *
query: on_error
{"code": 1, "msg": "ORDER BY and DISTINCT cannot be combined"}
# test: select distinct from expr group by
explain select distinct count(*) from [0,1,2,3,4,2,3,4] group by *
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1               group        1      1      0
 2      group_add_aggr        1      0      0
 3                 int        2      0      0
 4                push        2      0      0
 5                 int        2      1      0
 6                push        2      0      0
 7                 int        2      2      0
 8                push        2      0      0
 9                 int        2      3      0
10                push        2      0      0
11                 int        2      4      0
12                push        2      0      0
13                 int        2      2      0
14                push        2      0      0
15                 int        2      3      0
16                push        2      0      0
17                 int        2      4      0
18                push        2      0      0
19               array        2      8      0
20    cursor_open_expr        0      2     22
21                 jmp       28      0      0
22         cursor_read        3      0      0
23                push        3      0      0
24         cursor_read        3      0      0
25                push        3      0      0
26           group_add        1      0      0
27         cursor_next        0     22      0
28        cursor_close        0      0      0
29    cursor_open_expr        1      1     31
30                 jmp       36      0      0
31      group_get_aggr        2      1      0
32      group_get_aggr        3      1      0
33                push        3      0      0
34             set_add        0      2      0
35         cursor_next        1     31      0
36        cursor_close        1      0      0
37            set_sort        0      0      0
38                bool        1      1      0
39                push        1      0      0
40               merge        1      0     -1
41            send_set        1      0      0
42                recv        0      0      0
43                 ret        0      0      0

"
select distinct *, count(*) from [0,1,2,3,4,2,3,4] group by *
[0, 1]
[1, 1]
[2, 2]
[3, 2]
[4, 2]
select distinct * from [0,1,2,3,4,2,3,4] group by *
0
1
2
3
4
select distinct count(*) from [0,1,2,3,4,2,3,4] group by *
1
2
# test: select distinct on from expr
explain select distinct on (*) * from [0,1,2,3,4,2,3,4]
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1                 int        1      0      0
 2                push        1      0      0
 3                 int        1      1      0
 4                push        1      0      0
 5                 int        1      2      0
 6                push        1      0      0
 7                 int        1      3      0
 8                push        1      0      0
 9                 int        1      4      0
10                push        1      0      0
11                 int        1      2      0
12                push        1      0      0
13                 int        1      3      0
14                push        1      0      0
15                 int        1      4      0
16                push        1      0      0
17               array        1      8      0
18    cursor_open_expr        0      1     20
19                 jmp       25      0      0
20         cursor_read        2      0      0
21         cursor_read        3      0      0
22                push        3      0      0
23             set_add        0      2      0
24         cursor_next        0     20      0
25        cursor_close        0      0      0
26            set_sort        0      0      0
27                bool        1      1      0
28                push        1      0      0
29               merge        1      0     -1
30            send_set        1      0      0
31                recv        0      0      0
32                 ret        0      0      0

"
select distinct on (*) * from [0,1,2,3,4,2,3,4]
0
1
2
3
4
disconnect S0
env_close E0
