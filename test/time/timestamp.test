#

open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }]
connect E0 S0 localhost:3485

# test: timestamp parsing
select '2'::timestamp
select '2a'::timestamp
select 'a'::timestamp
select '_a'::timestamp
select '_'::timestamp
select '-'::timestamp
select '--'::timestamp
select '-- ::'::timestamp
select '1969-0-0'::timestamp
select '1969-0-0 0:0:0'::timestamp
select '1970-0-0 00:00:00'::timestamp
select '1970-00-00 00:00:00'::timestamp
select timestamp '1970-00-00 00:00:00'
select timestamp('1970-00-00 00:00:00')

# test: epoch
select '1970-01-01 00:00:00'::timestamp
select timestamp '1970-01-01 00:00:00'
select timestamp('1970-01-01 00:00:00')

# test: day overflow
select '1970-01-33 00:00:00'::timestamp

# test: month overflow
select '1970-13-01 00:00:00'::timestamp

# test: second overflow
select '1970-01-01 00:00:70'::timestamp

# test: minute overflow
select '1970-01-01 00:70:00'::timestamp

# test: hour overflow
select '1970-01-01 28:00:00'::timestamp

# test: 24hour
select '1970-01-01 24:00:00'::timestamp

# test: ms
select '1970-01-01 00:00:00.'::timestamp
select '1970-01-01 00:00:00.0'::timestamp
select '1970-01-01 00:00:00.00'::timestamp
select '1970-01-01 00:00:00.000'::timestamp
select '1970-01-01 00:00:00.001'::timestamp
select '1970-01-01 00:00:00.001'::timestamp()
select timestamp '1970-01-01 00:00:00.001'
select timestamp('1970-01-01 00:00:00.001')

# test: us
select '1970-01-01 00:00:00.0010'::timestamp
select '1970-01-01 00:00:00.00100'::timestamp
select '1970-01-01 00:00:00.000001'::timestamp
select '1970-01-01 00:00:00.000000'::timestamp
select '1970-01-01 00:00:00.999999'::timestamp
select timestamp '1970-01-01 00:00:00.999999'
select timestamp('1970-01-01 00:00:00.999999')
select timestamp('1970-01-01 00:00:00.999999', 123)

# test: zulu
select '1970-01-01 00:00:00.999999Z'::timestamp
select '1970-01-01 00:00:00.999999Zjunk'::timestamp
select timestamp '1970-01-01 00:00:00.999999Zjunk'

# test: timezone
select '1970-01-01 00:00:00.999999+'::timestamp
select '1970-01-01 00:00:00.999999+0'::timestamp
select '1970-01-01 00:00:00.999999+00'::timestamp
select '1970-01-01 00:00:00.999999-00'::timestamp
select '1970-01-01 00:00:00.999999-000'::timestamp

# test: timezone (ignore)
select '1970-01-01 00:00:00.999999+00'::timestamp
select '1970-01-01 00:00:00.999999+01'::timestamp
select '1970-01-01 00:00:00.999999+02'::timestamp
select '1970-01-01 00:00:00.999999+03'::timestamp

# test: convertion (string)
select '1970-01-01 01:12:59.909090'::timestamp
select '1970-01-01 01:12:59.909090'::timestamp::string
select '1970-01-01 01:12:59.909090'::timestamp::string::timestamp
select '1970-01-01 01:12:59.909090'::timestamp::string::timestamp::string
select timestamp '1970-01-01 01:12:59.909090'::string::timestamp::string
select timestamp('1970-01-01 01:12:59.909090')::string::timestamp::string

# test: convertion (document)
select ['1970-01-01 01:12:59.909090'::timestamp]
select ['1970-01-01 01:12:59.909090'::timestamp::string]
select ['1970-01-01 01:12:59.909090'::timestamp::string::timestamp]
select ['1970-01-01 01:12:59.909090'::timestamp::string::timestamp::string]

# test: add
select '1970-01-01 01:12:59.909090'::timestamp + 1
select '1970-01-01 01:12:59.909090'::timestamp + '1 hour'
select '1970-01-01 00:00:00.000000'::timestamp + '1 hour'::interval

select '1970-01-01 00:00:00.000000'::timestamp + '1 year'::interval
select '1971-01-01 00:00:00.000000'::timestamp + '1 year'::interval

select '1 year'::interval + '1 year'::interval
select '1970-01-01 00:00:00.000000'::timestamp + '1 year'::interval + '1 year'::interval

# test: sub
select '1970-01-01 01:12:59.909090'::timestamp + 1
select '1970-01-01 01:12:59.909090'::timestamp - '1 hour'
select '1970-01-01 00:00:00.000000'::timestamp - '1 hour'::interval
select '1973-01-01 00:00:00.000000'::timestamp - '1 year'::interval
select '1 year'::interval - '1 year'::interval
select '1980-01-01 00:00:00.000000'::timestamp - '1 year'::interval - '1 year'::interval
select '1980-01-01 00:00:00.000000'::timestamp - '-1 year'::interval - '-1 year'::interval

# test: eq
select '1970-01-01 01:12:59.909090'::timestamp = '1970-01-01 01:12:59.909090'::timestamp
select '1970-01-01 01:12:59.909090'::timestamp = '1970-01-01 01:12:59.909099'::timestamp

# test: lte
select '1970-01-01 01:12:59.909090'::timestamp <= '1970-01-01 01:12:59.909090'::timestamp
select '1970-01-01 01:12:58'::timestamp <= '1970-01-01 01:12:59.909090'::timestamp
select '1970-01-01 01:13:00'::timestamp <= '1970-01-01 01:12:59'::timestamp
select '1970-01-01 01:12:59.909090'::timestamp <= '1970-01-01 01:12:59.909099'::timestamp

# test: lt
select '1970-01-01 01:12:59.909090'::timestamp < '1970-01-01 01:12:59.909090'::timestamp
select '1970-01-01 01:12:58'::timestamp < '1970-01-01 01:12:59.909090'::timestamp
select '1970-01-01 01:13:00'::timestamp < '1970-01-01 01:12:59'::timestamp
select '1970-01-01 01:12:59.909090'::timestamp < '1970-01-01 01:12:59.909099'::timestamp

# test: gte
select '1970-01-01 01:12:59.909090'::timestamp >= '1970-01-01 01:12:59.909090'::timestamp
select '1970-01-01 01:12:58'::timestamp >= '1970-01-01 01:12:59.909090'::timestamp
select '1970-01-01 01:13:00'::timestamp >= '1970-01-01 01:12:59'::timestamp
select '1970-01-01 01:12:59.909090'::timestamp >= '1970-01-01 01:12:59.909099'::timestamp

# test: gt
select '1970-01-01 01:12:59.909090'::timestamp > '1970-01-01 01:12:59.909090'::timestamp
select '1970-01-01 01:12:58'::timestamp > '1970-01-01 01:12:59.909090'::timestamp
select '1970-01-01 01:13:00'::timestamp > '1970-01-01 01:12:59'::timestamp
select '1970-01-01 01:12:59.909090'::timestamp > '1970-01-01 01:12:59.909099'::timestamp

# test: between
select timestamp '1970-01-01 01:12:59.909090' between timestamp '1970-01-01 01:12:59' and timestamp '1970-01-02 00:00:01'

# test: timestamp column
create table test (id int primary key, ts timestamp)
insert into test values (0, "1970-01-01 01:12:59.909090")
insert into test values (0, "1970-01-01 01:12:59.909090"::timestamptz)
insert into test values (0, "1970-01-01 01:12:59.909090"::timestamp)
insert into test values (1, "1970-01-01 01:13:00"::timestamp)
insert into test values (2, "1970-01-01 01:13:01"::timestamp)
select * from test
select * from test where ts > "1970-01-01 01:12:59.909090"::timestamp;
explain select * from test where ts > "1970-01-01 01:12:59.909090"::timestamp;

select * from test where ts > timestamp "1970-01-01 01:12:59.909090"
explain select * from test where ts > timestamp "1970-01-01 01:12:59.909090"

select * from test where ts = "1970-01-01 01:13:01"::timestamp;
drop table test

# test: timestamp column (key)
create table test (id timestamp primary key)
insert into test values ("1970-01-01 00:00:01.000001"::timestamp)
insert into test values ("1970-01-01 00:00:01.000002"::timestamp)
insert into test values ("1970-01-01 00:00:01.000003"::timestamp)
insert into test values ("1970-01-01 00:00:02.000000"::timestamp)
insert into test values ("1970-01-01 00:00:03.000000"::timestamp)
insert into test values ("1970-01-01 00:00:04.000000"::timestamp)
explain select * from test

select * from test
select * from test order by id

select * from test where id > timestamp '1970-01-01 00:00:01.000002'
explain select * from test where id > timestamp '1970-01-01 00:00:01.000002'

select * from test where id >= timestamp '1970-01-01 00:00:01.000002'
explain select * from test where id >= timestamp '1970-01-01 00:00:01.000002'

select * from test where id < timestamp '1970-01-01 00:00:01.000003'
explain select * from test where id < timestamp '1970-01-01 00:00:01.000003'

select * from test where id = timestamp '1970-01-01 00:00:01.000003'
explain select * from test where id = timestamp '1970-01-01 00:00:01.000003'
drop table test

# test: timestamp column (secondary index)
create table test (id timestamp primary key)
insert into test values ("1970-01-01 00:00:01.000001"::timestamp)
insert into test values ("1970-01-01 00:00:01.000002"::timestamp)
insert into test values ("1970-01-01 00:00:01.000003"::timestamp)
insert into test values ("1970-01-01 00:00:02.000000"::timestamp)
insert into test values ("1970-01-01 00:00:03.000000"::timestamp)
insert into test values ("1970-01-01 00:00:04.000000"::timestamp)
create index i on test (id) with (type = 'hash')
select * from test use index (i)

select * from test where id > timestamp '1970-01-01 00:00:01.000003'
explain select * from test where id > timestamp '1970-01-01 00:00:01.000003'
select count(*) from test where id > timestamp '1970-01-01 00:00:01.000003'

select * from test where id = timestamp '1970-01-01 00:00:01.000003'
explain select * from test where id = timestamp '1970-01-01 00:00:01.000003'
select count(*) from test where id = timestamp '1970-01-01 00:00:01.000003'

drop table test

disconnect S0
close E0
