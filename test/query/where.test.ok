env_open E0
connect E0 S0
connect: on_connect
# test: select from expr where
explain select * from [1, 2, 3] where true
"
bytecode [coordinator]
--------
 0                 int        0      1      0
 1                push        0      0      0
 2                 int        0      2      0
 3                push        0      0      0
 4                 int        0      3      0
 5                push        0      0      0
 6               array        0      3      0
 7    cursor_open_expr        0      0      9
 8                 jmp       14      0      0
 9                bool        1      1      0
10                jntr       13      1      0
11         cursor_read        1      0      0
12                send        1      0      0
13         cursor_next        0      9      0
14        cursor_close        0      0      0
15                recv        0      0      0
16                 ret        0      0      0

"
select * from [1, 2, 3] where true
1
2
3
select * from [1, 2, 3] where false
# test: select from expr where #2
select ** from {"a": 1, "b": 2, "c": 3} where true
"a"
"b"
"c"
select ** from {"a": 1, "b": 2, "c": 3} where false
select ** from {} where true
# test: select from expr where star
select * from [1, 2, 3] where * = 2
2
select * from [1, 2, 3] where * >= 2
2
3
select * from [1, 2, 3] where * <> 2
1
3
# test: select from expr where star #2
select ** from {"a": 1, "b": 2, "c": 3} where * = 2
"b"
select ** from {"a": 1, "b": 2, "c": 3} where * >= 2
"b"
"c"
select ** from {"a": 1, "b": 2, "c": 3} where * <> 2
"a"
"c"
select * from [] where true
# test: select from table where star
create table test (id int primary key serial, data int default 0)
insert into test () values ()
insert into test () values ()
insert into test () values ()
explain select * from test where *[0] >= 0
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       13      0      0
 4         cursor_read        0      0      0
 5                 int        1      0      0
 6                 idx        2      0      1
 7                 int        0      0      0
 8                 gte        1      2      0
 9                jntr       12      1      0
10         cursor_read        0      0      0
11                send        0      0      0
12         cursor_next        0      4      0
13        cursor_close        0      0      0
14               ready        0     -1      0
15                 ret        0      0      0

"
select * from test where *[0] >= 0
[0, 0]
[1, 0]
[2, 0]
drop table test
# test: select from table where column
create table test (id int primary key serial, data int default 0)
insert into test () values ()
insert into test () values ()
insert into test () values ()
explain select * from test where id >= 0
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0                 int        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       11      0      0
 4          cursor_idx        0      0      0
 5                 int        1      0      0
 6                 gte        2      0      1
 7                jntr       10      2      0
 8         cursor_read        0      0      0
 9                send        0      0      0
10         cursor_next        0      4      0
11        cursor_close        0      0      0
12               ready        0     -1      0
13                 ret        0      0      0

"
select * from test where id >= 0
[0, 0]
[1, 0]
[2, 0]
drop table test
# test: select from table where column.path
create table test (id int primary key serial, data object)
insert into test (data) values ({"data": 123})
insert into test (data) values ({"data": 123})
insert into test (data) values ({"data": 123})
select * from test
[0, {"data": 123}]
[1, {"data": 123}]
[2, {"data": 123}]
explain select * from test where data.data >= 0
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       11      0      0
 4          cursor_idx        0      0      1      # data
 5                 int        1      0      0
 6                 gte        2      0      1
 7                jntr       10      2      0
 8         cursor_read        0      0      0
 9                send        0      0      0
10         cursor_next        0      4      0
11        cursor_close        0      0      0
12               ready        0     -1      0
13                 ret        0      0      0

"
select * from test where data.data >= 0
[0, {"data": 123}]
[1, {"data": 123}]
[2, {"data": 123}]
drop table test
# test: select from table where column.path #2
create table test (id int primary key serial, data object)
insert into test (data) values ({"data": {"data": 123}})
insert into test (data) values ({"data": {"data": 123}})
insert into test (data) values ({"data": {"data": 123}})
select * from test
[0, {"data": {"data": 123}}]
[1, {"data": {"data": 123}}]
[2, {"data": {"data": 123}}]
explain select * from test where data.data.data >= 0
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       11      0      0
 4          cursor_idx        0      0      1      # data.data
 5                 int        1      0      0
 6                 gte        2      0      1
 7                jntr       10      2      0
 8         cursor_read        0      0      0
 9                send        0      0      0
10         cursor_next        0      4      0
11        cursor_close        0      0      0
12               ready        0     -1      0
13                 ret        0      0      0

"
select * from test where data.data.data >= 0
[0, {"data": {"data": 123}}]
[1, {"data": {"data": 123}}]
[2, {"data": {"data": 123}}]
drop table test
# test: select from table where target.column
create table test (id int primary key serial, data int default 0)
insert into test () values ()
insert into test () values ()
insert into test () values ()
explain select * from test where test.id >= 0
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0                 int        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       11      0      0
 4          cursor_idx        0      0      0
 5                 int        1      0      0
 6                 gte        2      0      1
 7                jntr       10      2      0
 8         cursor_read        0      0      0
 9                send        0      0      0
10         cursor_next        0      4      0
11        cursor_close        0      0      0
12               ready        0     -1      0
13                 ret        0      0      0

"
select * from test where test.id >= 0
[0, 0]
[1, 0]
[2, 0]
drop table test
# test: select from table where target.column.path
create table test (id int primary key serial, data object)
insert into test (data) values ({"data": 123})
insert into test (data) values ({"data": 123})
insert into test (data) values ({"data": 123})
explain select * from test where test.data.data >= 0
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       11      0      0
 4          cursor_idx        0      0      1      # data
 5                 int        1      0      0
 6                 gte        2      0      1
 7                jntr       10      2      0
 8         cursor_read        0      0      0
 9                send        0      0      0
10         cursor_next        0      4      0
11        cursor_close        0      0      0
12               ready        0     -1      0
13                 ret        0      0      0

"
select * from test where test.data.data >= 0
[0, {"data": 123}]
[1, {"data": 123}]
[2, {"data": 123}]
drop table test
# test: select from table where alias.column
create table test (id int primary key serial, data int default 0)
insert into test () values ()
insert into test () values ()
insert into test () values ()
explain select * from test alias where alias.id >= 0
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0                 int        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       11      0      0
 4          cursor_idx        0      0      0
 5                 int        1      0      0
 6                 gte        2      0      1
 7                jntr       10      2      0
 8         cursor_read        0      0      0
 9                send        0      0      0
10         cursor_next        0      4      0
11        cursor_close        0      0      0
12               ready        0     -1      0
13                 ret        0      0      0

"
select * from test alias where alias.id >= 0
[0, 0]
[1, 0]
[2, 0]
drop table test
# test: select from table where alias.column.path
create table test (id int primary key serial, data object)
insert into test (data) values ({"data": 123})
insert into test (data) values ({"data": 123})
insert into test (data) values ({"data": 123})
explain select * from test alias where alias.data.data >= 0
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       11      0      0
 4          cursor_idx        0      0      1      # data
 5                 int        1      0      0
 6                 gte        2      0      1
 7                jntr       10      2      0
 8         cursor_read        0      0      0
 9                send        0      0      0
10         cursor_next        0      4      0
11        cursor_close        0      0      0
12               ready        0     -1      0
13                 ret        0      0      0

"
select * from test alias where alias.data.data >= 0
[0, {"data": 123}]
[1, {"data": 123}]
[2, {"data": 123}]
drop table test
# test: where true/false
create table test (id int primary key)
insert into test values (1), (2), (3)
explain select * from test where true
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp        9      0      0
 4                bool        0      1      0
 5                jntr        8      0      0
 6         cursor_read        0      0      0
 7                send        0      0      0
 8         cursor_next        0      4      0
 9        cursor_close        0      0      0
10               ready        0     -1      0
11                 ret        0      0      0

"
select * from test where true
[1]
[2]
[3]
select * from test where false
drop table test
# test: where gte
create table test (id int primary key)
insert into test values (1), (2), (3)
explain select * from test where id >= 0
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0                 int        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       11      0      0
 4          cursor_idx        0      0      0
 5                 int        1      0      0
 6                 gte        2      0      1
 7                jntr       10      2      0
 8         cursor_read        0      0      0
 9                send        0      0      0
10         cursor_next        0      4      0
11        cursor_close        0      0      0
12               ready        0     -1      0
13                 ret        0      0      0

"
select * from test where id >= 0
[1]
[2]
[3]
select * from test where id >= 1
[1]
[2]
[3]
select * from test where id >= 2
[2]
[3]
select * from test where id >= 3
[3]
select * from test where id >= 4
# test: where gt
select * from test where id > 0
[1]
[2]
[3]
select * from test where id > 1
[2]
[3]
select * from test where id > 2
[3]
select * from test where id > 3
select * from test where id > 9
# test: where lte
explain select * from test where id <= 0
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       15      0      0
 4          cursor_idx        0      0      0
 5                 int        1      0      0
 6                 lte        2      0      1
 7                jntr        3      2      0
 8          cursor_idx        0      0      0
 9                 int        1      0      0
10                 lte        2      0      1
11                jntr       14      2      0
12         cursor_read        0      0      0
13                send        0      0      0
14         cursor_next        0      4      0
15        cursor_close        0      0      0
16               ready        0     -1      0
17                 ret        0      0      0

"
select * from test where id <= 0
select * from test where id <= 1
[1]
select * from test where id <= 2
[1]
[2]
select * from test where id <= 3
[1]
[2]
[3]
select * from test where id <= 8
[1]
[2]
[3]
# test: where lt
explain select * from test where id < 0
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       15      0      0
 4          cursor_idx        0      0      0
 5                 int        1      0      0
 6                  lt        2      0      1
 7                jntr        3      2      0
 8          cursor_idx        0      0      0
 9                 int        1      0      0
10                  lt        2      0      1
11                jntr       14      2      0
12         cursor_read        0      0      0
13                send        0      0      0
14         cursor_next        0      4      0
15        cursor_close        0      0      0
16               ready        0     -1      0
17                 ret        0      0      0

"
select * from test where id < 0
select * from test where id < 1
select * from test where id < 2
[1]
select * from test where id < 3
[1]
[2]
select * from test where id < 8
[1]
[2]
[3]
drop table test
# test: where point lookup
create table test (id int primary key)
insert into test values (1), (2), (3)
select * from test where id = 2
[2]
drop table test
# test: where point lookup nested
create table test (obj object, primary key(obj.id int))
insert into test {"id": 1}
insert into test {"id": 2}
insert into test {"id": 3}
select * from test where obj.id = 2
[{"id": 2}]
drop table test
disconnect S0
env_close E0
