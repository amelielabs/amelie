open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }], "backends": 3;
connect E0 S0 127.0.0.1:3485;
create table ref (id int primary key, data int default 0);
insert into ref (id) values (1), (2), (3);
create table test (id int primary key, data int default 0);
insert into test (id) values (1), (2), (3);
# test: select from table, ref
explain select test.*, ref.* from test, ref;
[{
  "main": {
    "00": "send_all            0      0      35    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      4      0     ",
    "01": "table_open_part     1      0      15    # test (primary)",
    "02": "table_open          2      18     13    # ref (primary)",
    "03": "table_readi32       3      1      0     ",
    "04": "push                3      0      0     ",
    "05": "table_readi32       3      1      1     ",
    "06": "push                3      0      0     ",
    "07": "table_readi32       3      2      0     ",
    "08": "push                3      0      0     ",
    "09": "table_readi32       3      2      1     ",
    "10": "push                3      0      0     ",
    "11": "set_add             0      0      0     ",
    "12": "table_next          2      3      0     ",
    "13": "free                2      0      0     ",
    "14": "table_next          1      2      0     ",
    "15": "free                1      0      0     ",
    "16": "ret                 0      0      -     "
  },
  "access": [["test", "ro"], ["ref", "ro_exclusive"]]
}]
select test.*, ref.* from test, ref;
[[1, 0, 1, 0], [1, 0, 2, 0], [1, 0, 3, 0], [3, 0, 1, 0], [3, 0, 2, 0], [3, 0, 3, 0], [2, 0, 1, 0], [2, 0, 2, 0], [2, 0, 3, 0]]
# test: select from ref, table
explain select test.*, ref.* from ref, test;
[{
  "main": {
    "00": "send_all            0      0      35    # ref (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      4      0     ",
    "01": "table_open_part     1      0      15    # ref (primary)",
    "02": "table_open          2      17     13    # test (primary)",
    "03": "table_readi32       3      2      0     ",
    "04": "push                3      0      0     ",
    "05": "table_readi32       3      2      1     ",
    "06": "push                3      0      0     ",
    "07": "table_readi32       3      1      0     ",
    "08": "push                3      0      0     ",
    "09": "table_readi32       3      1      1     ",
    "10": "push                3      0      0     ",
    "11": "set_add             0      0      0     ",
    "12": "table_next          2      3      0     ",
    "13": "free                2      0      0     ",
    "14": "table_next          1      2      0     ",
    "15": "free                1      0      0     ",
    "16": "ret                 0      0      -     "
  },
  "access": [["ref", "ro"], ["test", "ro_exclusive"]]
}]
select test.*, ref.* from ref, test;
[[1, 0, 1, 0], [2, 0, 1, 0], [3, 0, 1, 0], [1, 0, 3, 0], [2, 0, 3, 0], [3, 0, 3, 0], [1, 0, 2, 0], [2, 0, 2, 0], [3, 0, 2, 0]]
# test: select from table, table
explain select t.* from test, test t;
[{
  "main": {
    "00": "send_all            0      0      36    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      11    # test (primary)",
    "02": "table_open          2      18     9     # test (primary)",
    "03": "table_readi32       3      2      0     ",
    "04": "push                3      0      0     ",
    "05": "table_readi32       3      2      1     ",
    "06": "push                3      0      0     ",
    "07": "set_add             0      0      0     ",
    "08": "table_next          2      3      0     ",
    "09": "free                2      0      0     ",
    "10": "table_next          1      2      0     ",
    "11": "free                1      0      0     ",
    "12": "ret                 0      0      -     "
  },
  "access": [["test", "ro_exclusive"]]
}]
select t.* from test, test t;
[[1, 0], [2, 0], [3, 0], [1, 0], [2, 0], [3, 0], [1, 0], [2, 0], [3, 0]]
# test: select from table join table
explain select test.id, ref.id from test join ref on true;
[{
  "main": {
    "00": "send_all            0      0      35    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      13    # test (primary)",
    "02": "table_open          2      18     11    # ref (primary)",
    "03": "bool                3      1      0     ",
    "04": "jntr                10     3      0     ",
    "05": "table_readi32       3      1      0     ",
    "06": "push                3      0      0     ",
    "07": "table_readi32       3      2      0     ",
    "08": "push                3      0      0     ",
    "09": "set_add             0      0      0     ",
    "10": "table_next          2      3      0     ",
    "11": "free                2      0      0     ",
    "12": "table_next          1      2      0     ",
    "13": "free                1      0      0     ",
    "14": "ret                 0      0      -     "
  },
  "access": [["test", "ro"], ["ref", "ro_exclusive"]]
}]
select test.id, ref.id from test join ref on true;
[[1, 1], [1, 2], [1, 3], [3, 1], [3, 2], [3, 3], [2, 1], [2, 2], [2, 3]]
# test: select from table join table on
explain select test.id, ref.id from test join ref on test.id = ref.id;
[{
  "main": {
    "00": "send_all            0      0      35    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      16    # test (primary)",
    "02": "table_readi32       2      1      0     ",
    "03": "push                2      0      0     ",
    "04": "table_openl         2      18     14    # ref (primary)",
    "05": "table_readi32       3      1      0     ",
    "06": "table_readi32       4      2      0     ",
    "07": "equii               5      3      4     ",
    "08": "jntr                14     5      0     ",
    "09": "table_readi32       3      1      0     ",
    "10": "push                3      0      0     ",
    "11": "table_readi32       3      2      0     ",
    "12": "push                3      0      0     ",
    "13": "set_add             0      0      0     ",
    "14": "free                2      0      0     ",
    "15": "table_next          1      2      0     ",
    "16": "free                1      0      0     ",
    "17": "ret                 0      0      -     "
  },
  "access": [["test", "ro"], ["ref", "ro_exclusive"]]
}]
select test.id, ref.id from test join ref on test.id = ref.id;
[[1, 1], [3, 3], [2, 2]]
# test: select from table join table on #2
explain select test.id, ref.id from test join ref on test.id = ref.id join ref ref2 on test.id = ref2.id;
[{
  "main": {
    "00": "send_all            0      0      52    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      24    # test (primary)",
    "02": "table_readi32       2      1      0     ",
    "03": "push                2      0      0     ",
    "04": "table_openl         2      18     22    # ref (primary)",
    "05": "table_readi32       3      1      0     ",
    "06": "push                3      0      0     ",
    "07": "table_openl         3      35     21    # ref (primary)",
    "08": "table_readi32       4      1      0     ",
    "09": "table_readi32       5      2      0     ",
    "10": "equii               6      4      5     ",
    "11": "table_readi32       4      1      0     ",
    "12": "table_readi32       5      3      0     ",
    "13": "equii               7      4      5     ",
    "14": "and                 4      6      7     ",
    "15": "jntr                21     4      0     ",
    "16": "table_readi32       4      1      0     ",
    "17": "push                4      0      0     ",
    "18": "table_readi32       4      2      0     ",
    "19": "push                4      0      0     ",
    "20": "set_add             0      0      0     ",
    "21": "free                3      0      0     ",
    "22": "free                2      0      0     ",
    "23": "table_next          1      2      0     ",
    "24": "free                1      0      0     ",
    "25": "ret                 0      0      -     "
  },
  "access": [["test", "ro"], ["ref", "ro_exclusive"]]
}]
select test.id, ref.id from test join ref on test.id = ref.id join ref ref2 on test.id = ref2.id;
[[1, 1], [3, 3], [2, 2]]
# test: select from table join table on #3
explain select test.id, ref.id from test join ref on test.id = ref.id join ref ref2 on test.id = ref2.id where test.id > 0;
[{
  "main": {
    "00": "send_all            0      0      52    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "push_int            -      0      0     # 0",
    "02": "table_open_part     1      0      29    # test (primary)",
    "03": "table_readi32       2      1      0     ",
    "04": "push                2      0      0     ",
    "05": "table_openl         2      18     27    # ref (primary)",
    "06": "table_readi32       3      1      0     ",
    "07": "push                3      0      0     ",
    "08": "table_openl         3      35     26    # ref (primary)",
    "09": "table_readi32       4      1      0     ",
    "10": "table_readi32       5      2      0     ",
    "11": "equii               6      4      5     ",
    "12": "table_readi32       4      1      0     ",
    "13": "table_readi32       5      3      0     ",
    "14": "equii               7      4      5     ",
    "15": "and                 4      6      7     ",
    "16": "table_readi32       5      1      0     ",
    "17": "int                 6      -      0     # 0",
    "18": "gtii                7      5      6     ",
    "19": "and                 5      4      7     ",
    "20": "jntr                26     5      0     ",
    "21": "table_readi32       4      1      0     ",
    "22": "push                4      0      0     ",
    "23": "table_readi32       4      2      0     ",
    "24": "push                4      0      0     ",
    "25": "set_add             0      0      0     ",
    "26": "free                3      0      0     ",
    "27": "free                2      0      0     ",
    "28": "table_next          1      3      0     ",
    "29": "free                1      0      0     ",
    "30": "ret                 0      0      -     "
  },
  "access": [["test", "ro"], ["ref", "ro_exclusive"]]
}]
select test.id, ref.id from test join ref on test.id = ref.id join ref ref2 on test.id = ref2.id where test.id > 0;
[[1, 1], [3, 3], [2, 2]]
# test: select from table join table on #4
explain select test.id, ref.id from test, ref where test.id = ref.id;
[{
  "main": {
    "00": "send_all            0      0      35    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      16    # test (primary)",
    "02": "table_readi32       2      1      0     ",
    "03": "push                2      0      0     ",
    "04": "table_openl         2      18     14    # ref (primary)",
    "05": "table_readi32       3      1      0     ",
    "06": "table_readi32       4      2      0     ",
    "07": "equii               5      3      4     ",
    "08": "jntr                14     5      0     ",
    "09": "table_readi32       3      1      0     ",
    "10": "push                3      0      0     ",
    "11": "table_readi32       3      2      0     ",
    "12": "push                3      0      0     ",
    "13": "set_add             0      0      0     ",
    "14": "free                2      0      0     ",
    "15": "table_next          1      2      0     ",
    "16": "free                1      0      0     ",
    "17": "ret                 0      0      -     "
  },
  "access": [["test", "ro"], ["ref", "ro_exclusive"]]
}]
select test.id, ref.id from test, ref where test.id = ref.id;
[[1, 1], [3, 3], [2, 2]]
explain select test.id, ref.id from test, ref where ref.id = test.id;
[{
  "main": {
    "00": "send_all            0      0      35    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      16    # test (primary)",
    "02": "table_readi32       2      1      0     ",
    "03": "push                2      0      0     ",
    "04": "table_openl         2      18     14    # ref (primary)",
    "05": "table_readi32       3      2      0     ",
    "06": "table_readi32       4      1      0     ",
    "07": "equii               5      3      4     ",
    "08": "jntr                14     5      0     ",
    "09": "table_readi32       3      1      0     ",
    "10": "push                3      0      0     ",
    "11": "table_readi32       3      2      0     ",
    "12": "push                3      0      0     ",
    "13": "set_add             0      0      0     ",
    "14": "free                2      0      0     ",
    "15": "table_next          1      2      0     ",
    "16": "free                1      0      0     ",
    "17": "ret                 0      0      -     "
  },
  "access": [["test", "ro"], ["ref", "ro_exclusive"]]
}]
select test.id, ref.id from test, ref where ref.id = test.id;
[[1, 1], [3, 3], [2, 2]]
explain select test.id, ref.id from test, ref where ref.id = 1;
[{
  "main": {
    "00": "send_all            0      0      35    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      15    # test (primary)",
    "02": "push_int            -      0      0     # 1",
    "03": "table_openl         2      18     13    # ref (primary)",
    "04": "table_readi32       3      2      0     ",
    "05": "int                 4      -      0     # 1",
    "06": "equii               5      3      4     ",
    "07": "jntr                13     5      0     ",
    "08": "table_readi32       3      1      0     ",
    "09": "push                3      0      0     ",
    "10": "table_readi32       3      2      0     ",
    "11": "push                3      0      0     ",
    "12": "set_add             0      0      0     ",
    "13": "free                2      0      0     ",
    "14": "table_next          1      2      0     ",
    "15": "free                1      0      0     ",
    "16": "ret                 0      0      -     "
  },
  "access": [["test", "ro"], ["ref", "ro_exclusive"]]
}]
select test.id, ref.id from test, ref where ref.id = 1;
[[1, 1], [3, 1], [2, 1]]
explain select test.id, ref.id from test, ref where ref.id = 1 and test.id = 1;
[{
  "main": {
    "00": "send_lookup         0      -      0     # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "push_int            -      0      0     # 1",
    "02": "table_open_partl    1      0      19    # test (primary)",
    "03": "push_int            -      0      0     # 1",
    "04": "table_openl         2      18     18    # ref (primary)",
    "05": "table_readi32       3      2      0     ",
    "06": "int                 4      -      0     # 1",
    "07": "equii               5      3      4     ",
    "08": "table_readi32       3      1      0     ",
    "09": "int                 4      -      0     # 1",
    "10": "equii               6      3      4     ",
    "11": "and                 3      5      6     ",
    "12": "jntr                18     3      0     ",
    "13": "table_readi32       3      1      0     ",
    "14": "push                3      0      0     ",
    "15": "table_readi32       3      2      0     ",
    "16": "push                3      0      0     ",
    "17": "set_add             0      0      0     ",
    "18": "free                2      0      0     ",
    "19": "free                1      0      0     ",
    "20": "ret                 0      0      -     "
  },
  "access": [["test", "ro"], ["ref", "ro_exclusive"]]
}]
select test.id, ref.id from test, ref where ref.id = 1 and test.id = 1;
[[1, 1]]
explain select test.id, ref.id from test, ref where ref.id >= test.id;
[{
  "main": {
    "00": "send_all            0      0      35    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      17    # test (primary)",
    "02": "table_readi32       2      1      0     ",
    "03": "push                2      0      0     ",
    "04": "table_open          2      18     15    # ref (primary)",
    "05": "table_readi32       3      2      0     ",
    "06": "table_readi32       4      1      0     ",
    "07": "gteii               5      3      4     ",
    "08": "jntr                14     5      0     ",
    "09": "table_readi32       3      1      0     ",
    "10": "push                3      0      0     ",
    "11": "table_readi32       3      2      0     ",
    "12": "push                3      0      0     ",
    "13": "set_add             0      0      0     ",
    "14": "table_next          2      5      0     ",
    "15": "free                2      0      0     ",
    "16": "table_next          1      2      0     ",
    "17": "free                1      0      0     ",
    "18": "ret                 0      0      -     "
  },
  "access": [["test", "ro"], ["ref", "ro_exclusive"]]
}]
select test.id, ref.id from test, ref where ref.id >= test.id;
[[1, 1], [1, 2], [1, 3], [3, 3], [2, 2], [2, 3]]
# test: select from table join using
explain select test.id, ref.id from test join ref using;
{"msg": "explain select test.id, ref.id from test join ref using❰;❱ ⟵ ( expected"}
explain select test.id, ref.id from test join ref using(;
{"msg": "explain select test.id, ref.id from test join ref using(❰;❱ ⟵ name expected"}
explain select test.id, ref.id from test join ref using(1;
{"msg": "explain select test.id, ref.id from test join ref using(❰1❱ ⟵ name expected"}
explain select test.id, ref.id from test join ref using(id;
{"msg": "explain select test.id, ref.id from test join ref using(id❰;❱ ⟵ ) expected"}
explain select test.id, ref.id from test join ref using(id);
[{
  "main": {
    "00": "send_all            0      0      35    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      16    # test (primary)",
    "02": "table_readi32       2      1      0     ",
    "03": "push                2      0      0     ",
    "04": "table_openl         2      18     14    # ref (primary)",
    "05": "table_readi32       3      1      0     ",
    "06": "table_readi32       4      2      0     ",
    "07": "equii               5      3      4     ",
    "08": "jntr                14     5      0     ",
    "09": "table_readi32       3      1      0     ",
    "10": "push                3      0      0     ",
    "11": "table_readi32       3      2      0     ",
    "12": "push                3      0      0     ",
    "13": "set_add             0      0      0     ",
    "14": "free                2      0      0     ",
    "15": "table_next          1      2      0     ",
    "16": "free                1      0      0     ",
    "17": "ret                 0      0      -     "
  },
  "access": [["test", "ro"], ["ref", "ro_exclusive"]]
}]
select test.id, ref.id from test join ref using(id);
[[1, 1], [3, 3], [2, 2]]
# test: select from table join using (not found)
select test.id, ref.id from test join ref using(unknown);
{"msg": "select test.id, ref.id from test join ref using(❰unknown❱ ⟵ column test.unknown not found"}
# test: select from table join using #2
explain select test.id, ref.id from test join ref using (id) join ref ref2 using (id) where test.id > 0;
[{
  "main": {
    "00": "send_all            0      0      52    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "push_int            -      0      0     # 0",
    "02": "table_open_part     1      0      29    # test (primary)",
    "03": "table_readi32       2      1      0     ",
    "04": "push                2      0      0     ",
    "05": "table_openl         2      18     27    # ref (primary)",
    "06": "table_readi32       3      2      0     ",
    "07": "push                3      0      0     ",
    "08": "table_openl         3      35     26    # ref (primary)",
    "09": "table_readi32       4      1      0     ",
    "10": "table_readi32       5      2      0     ",
    "11": "equii               6      4      5     ",
    "12": "table_readi32       4      2      0     ",
    "13": "table_readi32       5      3      0     ",
    "14": "equii               7      4      5     ",
    "15": "and                 4      6      7     ",
    "16": "table_readi32       5      1      0     ",
    "17": "int                 6      -      0     # 0",
    "18": "gtii                7      5      6     ",
    "19": "and                 5      4      7     ",
    "20": "jntr                26     5      0     ",
    "21": "table_readi32       4      1      0     ",
    "22": "push                4      0      0     ",
    "23": "table_readi32       4      2      0     ",
    "24": "push                4      0      0     ",
    "25": "set_add             0      0      0     ",
    "26": "free                3      0      0     ",
    "27": "free                2      0      0     ",
    "28": "table_next          1      3      0     ",
    "29": "free                1      0      0     ",
    "30": "ret                 0      0      -     "
  },
  "access": [["test", "ro"], ["ref", "ro_exclusive"]]
}]
select test.id, ref.id from test join ref using (id) join ref ref2 using (id) where test.id > 0;
[[1, 1], [3, 3], [2, 2]]
select test.id, ref.id from test join ref using (id) join ref ref2 using (id2) where test.id > 0;
{"msg": "select test.id, ref.id from test join ref using (id) join ref ref2 using (❰id2❱ ⟵ column ref.id2 not found"}
# test: with (select from table) select from table, cte
explain with a as (select * from test) select * from test, a where test.id = a.id;
[{
  "main": {
    "00": "send_all            0      0      18    # test (select)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "push_ref            1      1      0     ",
    "04": "send_all            0      1      60    # test (select, closing)",
    "05": "union               2      0      0     ",
    "06": "recv                2      0      0     ",
    "07": "ret                 2      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      8     # test (primary)",
    "02": "table_readi32       2      1      0     ",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      1     ",
    "05": "push                2      0      0     ",
    "06": "set_add             0      0      0     ",
    "07": "table_next          1      2      0     ",
    "08": "free                1      0      0     ",
    "09": "ret                 0      0      -     ",
    "10": "set                 0      4      0     ",
    "11": "table_open_part     2      42     31    # test (primary)",
    "12": "ref                 3      0      0     ",
    "13": "store_open          4      3      28    ",
    "14": "table_readi32       5      2      0     ",
    "15": "store_read          6      4      0     ",
    "16": "equii               7      5      6     ",
    "17": "jntr                27     7      0     ",
    "18": "table_readi32       5      2      0     ",
    "19": "push                5      0      0     ",
    "20": "table_readi32       5      2      1     ",
    "21": "push                5      0      0     ",
    "22": "store_read          5      4      0     ",
    "23": "push                5      0      0     ",
    "24": "store_read          5      4      1     ",
    "25": "push                5      0      0     ",
    "26": "set_add             0      0      0     ",
    "27": "store_next          4      14     0     ",
    "28": "free                4      0      0     ",
    "29": "free                3      0      0     ",
    "30": "table_next          2      12     0     ",
    "31": "free                2      0      0     ",
    "32": "ret                 0      0      -     "
  },
  "access": [["test", "ro"]]
}]
with a as (select * from test) select * from test, a where test.id = a.id;
[[1, 0, 1, 0], [3, 0, 3, 0], [2, 0, 2, 0]]
# test: with (select from table) select from table, cte (point lookup)
explain with a as (select * from test) select * from test, a where test.id = 1;
[{
  "main": {
    "00": "send_all            0      0      18    # test (select)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "push_ref            1      1      0     ",
    "04": "send_lookup         0      -      1     # test (select, closing)",
    "05": "union               2      0      0     ",
    "06": "recv                2      0      0     ",
    "07": "ret                 2      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      8     # test (primary)",
    "02": "table_readi32       2      1      0     ",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      1     ",
    "05": "push                2      0      0     ",
    "06": "set_add             0      0      0     ",
    "07": "table_next          1      2      0     ",
    "08": "free                1      0      0     ",
    "09": "ret                 0      0      -     ",
    "10": "set                 0      4      0     ",
    "11": "push_int            -      0      0     # 1",
    "12": "table_open_partl    2      42     31    # test (primary)",
    "13": "ref                 3      0      0     ",
    "14": "store_open          4      3      29    ",
    "15": "table_readi32       5      2      0     ",
    "16": "int                 6      -      0     # 1",
    "17": "equii               7      5      6     ",
    "18": "jntr                28     7      0     ",
    "19": "table_readi32       5      2      0     ",
    "20": "push                5      0      0     ",
    "21": "table_readi32       5      2      1     ",
    "22": "push                5      0      0     ",
    "23": "store_read          5      4      0     ",
    "24": "push                5      0      0     ",
    "25": "store_read          5      4      1     ",
    "26": "push                5      0      0     ",
    "27": "set_add             0      0      0     ",
    "28": "store_next          4      15     0     ",
    "29": "free                4      0      0     ",
    "30": "free                3      0      0     ",
    "31": "free                2      0      0     ",
    "32": "ret                 0      0      -     "
  },
  "access": [["test", "ro"]]
}]
with a as (select * from test) select * from test, a where test.id = 1;
[[1, 0, 1, 0], [1, 0, 3, 0], [1, 0, 2, 0]]
# test: with (select from table) select from cte, table
explain with a as (select * from test) select * from a, test where test.id = a.id;
[{
  "main": {
    "00": "send_all            0      0      18    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "set                 0      4      0     ",
    "04": "dup                 2      1      0     ",
    "05": "store_open          3      2      24    ",
    "06": "store_read          4      3      0     ",
    "07": "push                4      0      0     ",
    "08": "table_openl         4      42     22    # test (primary)",
    "09": "table_readi32       5      4      0     ",
    "10": "store_read          6      3      0     ",
    "11": "equii               7      5      6     ",
    "12": "jntr                22     7      0     ",
    "13": "store_read          5      3      0     ",
    "14": "push                5      0      0     ",
    "15": "store_read          5      3      1     ",
    "16": "push                5      0      0     ",
    "17": "table_readi32       5      4      0     ",
    "18": "push                5      0      0     ",
    "19": "table_readi32       5      4      1     ",
    "20": "push                5      0      0     ",
    "21": "set_add             0      0      0     ",
    "22": "free                4      0      0     ",
    "23": "store_next          3      6      0     ",
    "24": "free                3      0      0     ",
    "25": "free                2      0      0     ",
    "26": "ret                 0      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      8     # test (primary)",
    "02": "table_readi32       2      1      0     ",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      1     ",
    "05": "push                2      0      0     ",
    "06": "set_add             0      0      0     ",
    "07": "table_next          1      2      0     ",
    "08": "free                1      0      0     ",
    "09": "ret                 0      0      -     "
  },
  "access": [["test", "ro_exclusive"]]
}]
with a as (select * from test) select * from a, test where test.id = a.id;
[[1, 0, 1, 0], [3, 0, 3, 0], [2, 0, 2, 0]]
# test: with (select from table) select from cte, table (point lookup)
explain with a as (select * from test) select * from a, test where test.id = 1;
[{
  "main": {
    "00": "send_all            0      0      18    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "set                 0      4      0     ",
    "04": "dup                 2      1      0     ",
    "05": "store_open          3      2      23    ",
    "06": "push_int            -      0      0     # 1",
    "07": "table_openl         4      42     21    # test (primary)",
    "08": "table_readi32       5      4      0     ",
    "09": "int                 6      -      0     # 1",
    "10": "equii               7      5      6     ",
    "11": "jntr                21     7      0     ",
    "12": "store_read          5      3      0     ",
    "13": "push                5      0      0     ",
    "14": "store_read          5      3      1     ",
    "15": "push                5      0      0     ",
    "16": "table_readi32       5      4      0     ",
    "17": "push                5      0      0     ",
    "18": "table_readi32       5      4      1     ",
    "19": "push                5      0      0     ",
    "20": "set_add             0      0      0     ",
    "21": "free                4      0      0     ",
    "22": "store_next          3      6      0     ",
    "23": "free                3      0      0     ",
    "24": "free                2      0      0     ",
    "25": "ret                 0      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      8     # test (primary)",
    "02": "table_readi32       2      1      0     ",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      1     ",
    "05": "push                2      0      0     ",
    "06": "set_add             0      0      0     ",
    "07": "table_next          1      2      0     ",
    "08": "free                1      0      0     ",
    "09": "ret                 0      0      -     "
  },
  "access": [["test", "ro_exclusive"]]
}]
with a as (select * from test) select * from a, test where test.id = 1;
[[1, 0, 1, 0], [3, 0, 1, 0], [2, 0, 1, 0]]
# test: select from table join group by
select test.id from test, ref group by test.id;
[1, 3, 2]
select test.id from test join ref on (test.id = ref.id) group by test.id;
[1, 3, 2]
select test.id from test join ref on (test.id = ref.id) group by ref.id;
{"msg": "select ❰test.id❱ ⟵ column test.id must appear in the GROUP BY clause or be used by an aggregate function"}
select id from test join ref on (test.id = ref.id) group by ref.id;
{"msg": "select ❰id❱ ⟵ column id must appear in the GROUP BY clause or be used by an aggregate function"}
select ref.id from test join ref on (test.id = ref.id) group by id;
{"msg": "select ref.id from test join ref on (test.id = ref.id) group by ❰id❱ ⟵ column name is ambiguous"}
explain select ref.id from test join ref on (test.id = ref.id) group by ref.id;
[{
  "main": {
    "00": "send_all            0      0      35    # test (select, closing)",
    "01": "recv_aggs           1      0      35    ",
    "02": "set                 2      1      0     ",
    "03": "store_open          3      1      8     ",
    "04": "store_read          4      3      0     ",
    "05": "push                4      0      0     ",
    "06": "set_add             2      0      0     ",
    "07": "store_next          3      4      0     ",
    "08": "free                3      0      0     ",
    "09": "free                1      0      0     ",
    "10": "ret                 2      0      -     "
  },
  "pushdown": {
    "00": "set                 0      0      1     ",
    "01": "table_open_part     1      0      14    # test (primary)",
    "02": "table_readi32       2      1      0     ",
    "03": "push                2      0      0     ",
    "04": "table_openl         2      18     12    # ref (primary)",
    "05": "table_readi32       3      1      0     ",
    "06": "table_readi32       4      2      0     ",
    "07": "equii               5      3      4     ",
    "08": "jntr                12     5      0     ",
    "09": "table_readi32       3      2      0     ",
    "10": "push                3      0      0     ",
    "11": "set_get             3      0      0     ",
    "12": "free                2      0      0     ",
    "13": "table_next          1      2      0     ",
    "14": "free                1      0      0     ",
    "15": "ret                 0      0      -     "
  },
  "access": [["test", "ro"], ["ref", "ro_exclusive"]]
}]
select ref.id from test join ref on (test.id = ref.id) group by ref.id;
[1, 3, 2]
select ref.id, count(*) from test join ref on (test.id = ref.id) group by ref.id;
[[1, 1], [3, 1], [2, 1]]
select ref.id, count(test.id) + count(ref.id) from test join ref on (test.id = ref.id) group by ref.id;
[[1, 2], [3, 2], [2, 2]]
# test: select from table join group by path
create table ref2 (id int primary key, data json);
insert into ref2 values (1, {"id": 1}), (2, {"id": 2}), (3, {"id": 3});
select ref2.data from test join ref2 on (test.id = ref2.id) group by ref2.id;
{"msg": "select ❰ref2.data❱ ⟵ column ref2.data must appear in the GROUP BY clause or be used by an aggregate function"}
select ref2.data.id, ref2.data.id::type from test join ref2 on (test.id = ref2.id) group by ref2.data.id;
[[1, "json"], [3, "json"], [2, "json"]]
select ref2.data.id, ref2.data.id::type from test join ref2 on (test.id = ref2.id) group by 1;
[[1, "json"], [3, "json"], [2, "json"]]
select ref2.data, ref2.data.id from test join ref2 on (test.id = ref2.id) group by ref2.data;
[[{
  "id": 1
}, 1], [{
  "id": 3
}, 3], [{
  "id": 2
}, 2]]
drop table ref;
drop table ref2;
drop table test;
disconnect S0;
close E0;
