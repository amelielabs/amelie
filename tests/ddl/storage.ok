open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }];
connect E0 S0 127.0.0.1:3485;
# test: ensure main storage exists
select show('storage', 'main');
[{
  "name": "main",
  "path": "main"
}]
show storage main;
[{
  "name": "main",
  "path": "main"
}]
show storages;
[{
  "name": "main",
  "path": "main"
}]
# test: create storage statement parsing
create;
{"msg": "create❰;❱ ⟵ USER|REPLICA|STORAGE|DATABASE|TABLE|INDEX|FUNCTION expected"}
create storage;
{"msg": "create storage❰;❱ ⟵ name expected"}
create storage 123;
{"msg": "create storage ❰123❱ ⟵ name expected"}
create storage if;
{"msg": "create storage if❰;❱ ⟵ NOT expected"}
create storage if not;
{"msg": "create storage if not❰;❱ ⟵ EXISTS expected"}
create storage if not 123;
{"msg": "create storage if not ❰123❱ ⟵ EXISTS expected"}
create storage if not exists;
{"msg": "create storage if not exists❰;❱ ⟵ name expected"}
create storage test abc;
{"msg": "create storage test ❰abc❱ ⟵ ; expected"}
create storage test (;
{"msg": "create storage test (❰;❱ ⟵ name expected"}
# test: create storage
create storage test;
show storages;
[{
  "name": "main",
  "path": "main"
}, {
  "name": "test",
  "path": "test"
}]
select show('storages');
[[{
  "name": "main",
  "path": "main"
}, {
  "name": "test",
  "path": "test"
}]]
# test: create storage if not exists
create storage test;
{"msg": "storage 'test': already exists"}
create storage if not exists test;
show storages;
[{
  "name": "main",
  "path": "main"
}, {
  "name": "test",
  "path": "test"
}]
# test: create storage ()
create storage test2 ();
drop storage test2;
# test: create storage (options)
create storage test2 (path;
{"msg": "create storage test2 (path❰;❱ ⟵ string expected"}
create storage test2 (path 1;
{"msg": "create storage test2 (path ❰1❱ ⟵ string expected"}
create storage test2 (path true;
{"msg": "create storage test2 (path ❰true❱ ⟵ string expected"}
create storage test2 (path '';
{"msg": "create storage test2 (path ''❰;❱ ⟵ , expected"}
create storage test2 (path 'test_');
show storage test2;
[{
  "name": "test2",
  "path": "test_"
}]
drop storage test2;
create storage test2 (path 'test_', path '_test');
show storage test2;
[{
  "name": "test2",
  "path": "_test"
}]
drop storage test2;
# test: drop storage statement parsing
drop storage;
{"msg": "drop storage❰;❱ ⟵ name expected"}
drop storage 123;
{"msg": "drop storage ❰123❱ ⟵ name expected"}
drop storage if;
{"msg": "drop storage if❰;❱ ⟵ EXISTS expected"}
drop storage if exists;
{"msg": "drop storage if exists❰;❱ ⟵ name expected"}
drop storage test abc;
{"msg": "drop storage test ❰abc❱ ⟵ ; expected"}
# test: drop storage
drop storage test;
show storages;
[{
  "name": "main",
  "path": "main"
}]
# test: drop storage if exists
drop storage test;
{"msg": "storage 'test': not exists"}
drop storage if exists test;
show storages;
[{
  "name": "main",
  "path": "main"
}]
# test: drop main storage
drop storage main;
{"msg": "storage 'main': system storage cannot be dropped"}
show storages;
[{
  "name": "main",
  "path": "main"
}]
# test: alter storage statment parsing
alter storage;
{"msg": "alter storage❰;❱ ⟵ name expected"}
alter storage 123;
{"msg": "alter storage ❰123❱ ⟵ name expected"}
alter storage test;
{"msg": "alter storage test❰;❱ ⟵ RENAME expected"}
alter storage test rename;
{"msg": "alter storage test rename❰;❱ ⟵ TO expected"}
alter storage test rename to;
{"msg": "alter storage test rename to❰;❱ ⟵ name expected"}
alter storage test rename "hello";
{"msg": "alter storage test rename ❰\"hello\"❱ ⟵ TO expected"}
# test: alter storage rename
create storage test;
show storages;
[{
  "name": "main",
  "path": "main"
}, {
  "name": "test",
  "path": "test"
}]
alter storage test rename to test2;
show storages;
[{
  "name": "main",
  "path": "main"
}, {
  "name": "test2",
  "path": "test"
}]
drop storage test2;
# test: alter storage main
alter storage main rename to _public;
{"msg": "storage 'main': system storage cannot be renamed"}
disconnect S0;
close E0;
