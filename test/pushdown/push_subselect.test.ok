open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }], "backends": 3
connect E0 S0 localhost:3485
create table test (id int primary key, data int default 0)
insert into test (id) values (1), (2), (3)
# test: select (select from table)
explain select (select * from test)
{"msg": "FROM: undefined distributed table"}
select (select * from test)
{"msg": "FROM: undefined distributed table"}
# test: select (select from table) from shared
create shared table test2 (id int primary key)
insert into test2 (id) values (1), (2), (3)
explain select (select * from test) from test2
{"msg": "subqueries to distributed tables are not supported"}
select (select * from test) from test2
{"msg": "subqueries to distributed tables are not supported"}
# test: select (select from table) from (select from shared)
explain select (select * from test) from (select * from test2) t
{"msg": "subqueries to distributed tables are not supported"}
select (select * from test) from (select * from test2) t
{"msg": "subqueries to distributed tables are not supported"}
drop table test2
# test: select from (select from table)
explain select * from (select * from test) t
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "set                 1      2      0     ",
      "06": "store_open          1      0      8     ",
      "07": "jmp                 14     0      0     ",
      "08": "store_read          2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "store_read          2      1      1     ",
      "11": "push                2      0      0     ",
      "12": "set_add             1      0      0     ",
      "13": "store_next          1      8      0     ",
      "14": "store_open          1      1      0     ",
      "15": "cte_set             0      1      0     ",
      "16": "body                0      0      0     ",
      "17": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # -2147483648",
      "02": "push                1      0      0     ",
      "03": "table_open          0      0      5     # public.test (primary)",
      "04": "jmp                 11     0      0     ",
      "05": "table_readi32       1      0      0     ",
      "06": "push                1      0      0     ",
      "07": "table_readi32       1      0      1     ",
      "08": "push                1      0      0     ",
      "09": "set_add             0      0      0     ",
      "10": "table_next          0      5      0     ",
      "11": "table_close         0      0      0     ",
      "12": "result              0      0      0     ",
      "13": "ret                 0      0      0     "
    }
  }
}]
select * from (select * from test) t
[[1, 0], [2, 0], [3, 0]]
# test: select from (select (select from shared) from table)
create shared table test2 (id int primary key)
insert into test2 (id) values (1), (2), (3)
explain select * from (select (select * from test2) from test) t
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "set                 1      1      0     ",
      "06": "store_open          2      0      8     ",
      "07": "jmp                 12     0      0     ",
      "08": "store_read          2      2      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          2      8      0     ",
      "12": "store_open          2      1      0     ",
      "13": "cte_set             0      1      0     ",
      "14": "body                0      0      0     ",
      "15": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      1      0     ",
      "01": "int                 1      -      0     # -2147483648",
      "02": "push                1      0      0     ",
      "03": "table_open          1      0      5     # public.test (primary)",
      "04": "jmp                 18     0      0     ",
      "05": "set                 1      1      0     ",
      "06": "int                 2      -      0     # -2147483648",
      "07": "push                2      0      0     ",
      "08": "table_open          0      20     10    # public.test2 (primary)",
      "09": "jmp                 14     0      0     ",
      "10": "table_readi32       2      0      0     ",
      "11": "push                2      0      0     ",
      "12": "set_add             1      0      0     ",
      "13": "table_next          0      10     0     ",
      "14": "table_close         0      0      0     ",
      "15": "push                1      0      0     ",
      "16": "set_add             0      0      0     ",
      "17": "table_next          1      5      0     ",
      "18": "table_close         1      0      0     ",
      "19": "result              0      0      0     ",
      "20": "ret                 0      0      0     "
    }
  }
}]
select * from (select (select * from test2) from test) t
[[1, 2, 3], [1, 2, 3], [1, 2, 3]]
drop table test2
# test: select from (select (select from table) from table)
explain select * from (select (select * from test t) from test) g
{"msg": "subqueries to distributed tables are not supported"}
select * from (select (select * from test t) from test) g
{"msg": "subqueries to distributed tables are not supported"}
# test: select (select expr) from (select from table)
explain select (select t.*) from (select * from test) t
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "set                 1      1      0     ",
      "06": "store_open          1      0      8     ",
      "07": "jmp                 17     0      0     ",
      "08": "set                 2      2      0     ",
      "09": "store_read          3      1      0     ",
      "10": "push                3      0      0     ",
      "11": "store_read          3      1      1     ",
      "12": "push                3      0      0     ",
      "13": "set_add             2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_add             1      0      0     ",
      "16": "store_next          1      8      0     ",
      "17": "store_open          1      1      0     ",
      "18": "cte_set             0      1      0     ",
      "19": "body                0      0      0     ",
      "20": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # -2147483648",
      "02": "push                1      0      0     ",
      "03": "table_open          0      0      5     # public.test (primary)",
      "04": "jmp                 11     0      0     ",
      "05": "table_readi32       1      0      0     ",
      "06": "push                1      0      0     ",
      "07": "table_readi32       1      0      1     ",
      "08": "push                1      0      0     ",
      "09": "set_add             0      0      0     ",
      "10": "table_next          0      5      0     ",
      "11": "table_close         0      0      0     ",
      "12": "result              0      0      0     ",
      "13": "ret                 0      0      0     "
    }
  }
}]
select (select t.*) from (select * from test) t
[[[1, 0]], [[2, 0]], [[3, 0]]]
# test: select (select from shared) from (select from table)
create shared table test2 (id int primary key)
insert into test2 (id) values (1), (2), (3)
explain select (select t.*, * from test2) from (select * from test) t
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "set                 1      1      0     ",
      "06": "store_open          2      0      8     ",
      "07": "jmp                 25     0      0     ",
      "08": "set                 2      3      0     ",
      "09": "int                 3      -      0     # -2147483648",
      "10": "push                3      0      0     ",
      "11": "table_open          0      20     13    # public.test2 (primary)",
      "12": "jmp                 21     0      0     ",
      "13": "store_read          3      2      0     ",
      "14": "push                3      0      0     ",
      "15": "store_read          3      2      1     ",
      "16": "push                3      0      0     ",
      "17": "table_readi32       3      0      0     ",
      "18": "push                3      0      0     ",
      "19": "set_add             2      0      0     ",
      "20": "table_next          0      13     0     ",
      "21": "table_close         0      0      0     ",
      "22": "push                2      0      0     ",
      "23": "set_add             1      0      0     ",
      "24": "store_next          2      8      0     ",
      "25": "store_open          2      1      0     ",
      "26": "cte_set             0      1      0     ",
      "27": "body                0      0      0     ",
      "28": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # -2147483648",
      "02": "push                1      0      0     ",
      "03": "table_open          1      0      5     # public.test (primary)",
      "04": "jmp                 11     0      0     ",
      "05": "table_readi32       1      1      0     ",
      "06": "push                1      0      0     ",
      "07": "table_readi32       1      1      1     ",
      "08": "push                1      0      0     ",
      "09": "set_add             0      0      0     ",
      "10": "table_next          1      5      0     ",
      "11": "table_close         1      0      0     ",
      "12": "result              0      0      0     ",
      "13": "ret                 0      0      0     "
    }
  }
}]
select (select t.*, * from test2) from (select * from test) t
[[[1, 0, 1], [1, 0, 2], [1, 0, 3]], [[2, 0, 1], [2, 0, 2], [2, 0, 3]], [[3, 0, 1], [3, 0, 2], [3, 0, 3]]]
drop table test2
# test: select (select from table) from (select from table)
explain select (select t.*, z.* from test z) from (select * from test) t
{"msg": "subqueries to distributed tables are not supported"}
select (select t.*, z.* from test z) from (select * from test) t
{"msg": "subqueries to distributed tables are not supported"}
# test: insert returning (select from table)
explain insert into test (id) values (4) returning (select * from test t)
{"msg": "subqueries to distributed tables are not supported"}
insert into test (id) values (4) returning (select * from test t)
{"msg": "subqueries to distributed tables are not supported"}
# test: insert returning (select from shared)
create shared table test_ (id int primary key)
insert into test_ values (1),(2),(3)
insert into test (id) values (5) returning (select * from test_)
[[1, 2, 3]]
drop table test_
# test: insert returning (select from expr)
insert into test (id) values (6) returning *, select [1,2,3]
[[6, 0, [[1, 2, 3]]]]
insert into test (id) values (7) returning id, select [1,2,3]
[[7, [[1, 2, 3]]]]
drop table test
disconnect S0
close E0
