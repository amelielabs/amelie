open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }], "backends": 3
connect E0 S0 localhost:3485
# test: create table
create table test (id int serial primary key, data int default 0)
show lsn
[2]
select serial("public", "test")
[0]
# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
# test: validate state
show lsn
[2]
select serial("public", "test")
[0]
# test: alter table rename
alter table test rename to test2
show lsn
[3]
select serial("public", "test")
{"msg": "table 'test': not exists"}
select serial("public", "test2")
[0]
# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
# test: validate state
show lsn
[3]
select serial("public", "test")
{"msg": "table 'test': not exists"}
select serial("public", "test2")
[0]
# test: alter table set aggregated
alter table test2 set aggregated
select system.tables()['public.test2'].aggregated
[true]
# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
# test: validate state
show lsn
[4]
select system.tables()['public.test2'].aggregated
[true]
# test: alter table column add
insert into test2() values (), (), ()
select * from test2
[[0, 0], [1, 0], [2, 0]]
show lsn
[5]
select serial("public", "test2")
[3]
alter table test2 add column obj json
select * from test2
[[0, 0, null], [1, 0, null], [2, 0, null]]
select obj from test2
[null, null, null]
# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
# test: validate state
show lsn
[6]
select serial("public", "test2")
[0]
select * from test2
[[0, 0, null], [1, 0, null], [2, 0, null]]
# test: alter table column rename
alter table test2 rename column data to abc
select * from test2
[[0, 0, null], [1, 0, null], [2, 0, null]]
select data from test2
{"msg": "<test2.data> column not found"}
select abc from test2
[0, 0, 0]
# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
# test: validate state
show lsn
[7]
select serial("public", "test2")
[0]
select data from test2
{"msg": "<test2.data> column not found"}
select abc from test2
[0, 0, 0]
# test: alter table column drop
alter table test2 drop column abc
select abc from test2
{"msg": "<test2.abc> column not found"}
select * from test2
[[0, null], [1, null], [2, null]]
# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
# test: validate state
show lsn
[8]
select serial("public", "test2")
[0]
select * from test2
[[0, null], [1, null], [2, null]]
# test: create index
create index i on test2 (id)
select * from test2 use index (i)
[[0, null], [1, null], [2, null]]
# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
# test: validate state
show lsn
[9]
select serial("public", "test2")
[0]
select * from test2 use index (i)
[[0, null], [1, null], [2, null]]
# test: alter index rename
alter index i on test2 rename to i2
show lsn
[10]
select * from test2 use index (i2)
[[0, null], [1, null], [2, null]]
# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
# test: validate state
show lsn
[10]
select serial("public", "test2")
[0]
select * from test2 use index (i2)
[[0, null], [1, null], [2, null]]
# test: drop index
drop index i2 on test2
select * from test2 use index (i)
{"msg": "index 'i': not exists"}
select * from test2 use index (i2)
{"msg": "index 'i2': not exists"}
select * from test2
[[0, null], [1, null], [2, null]]
# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
# test: validate state
show lsn
[11]
select serial("public", "test2")
[0]
select * from test2 use index (i)
{"msg": "index 'i': not exists"}
select * from test2 use index (i2)
{"msg": "index 'i2': not exists"}
select * from test2
[[0, null], [1, null], [2, null]]
# test: truncate
truncate test2
select * from test2
[]
# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
# test: validate state
show lsn
[12]
select serial("public", "test2")
[0]
select * from test2
[]
# test: drop table
drop table test2
show lsn
[13]
select serial("public", "test2")
{"msg": "table 'test2': not exists"}
# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
# test: validate state
show lsn
[13]
select * from test2
{"msg": "<public.test2> table or view not found"}
show tables
[{}]
# test: create schema
create schema test
show schemas
[{
  "system": {
    "name": "system",
    "system": true,
    "create": false
  },
  "public": {
    "name": "public",
    "system": true,
    "create": true
  },
  "test": {
    "name": "test",
    "system": false,
    "create": true
  }
}]
show lsn
[14]
# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
# test: validate state
show lsn
[14]
show schemas
[{
  "system": {
    "name": "system",
    "system": true,
    "create": false
  },
  "public": {
    "name": "public",
    "system": true,
    "create": true
  },
  "test": {
    "name": "test",
    "system": false,
    "create": true
  }
}]
# test: alter schema rename
alter schema test rename to test2
show schemas
[{
  "system": {
    "name": "system",
    "system": true,
    "create": false
  },
  "public": {
    "name": "public",
    "system": true,
    "create": true
  },
  "test2": {
    "name": "test2",
    "system": false,
    "create": true
  }
}]
show lsn
[15]
# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
# test: validate state
show lsn
[15]
show schemas
[{
  "system": {
    "name": "system",
    "system": true,
    "create": false
  },
  "public": {
    "name": "public",
    "system": true,
    "create": true
  },
  "test2": {
    "name": "test2",
    "system": false,
    "create": true
  }
}]
# test: drop schema
drop schema test2
show lsn
[16]
show schemas
[{
  "system": {
    "name": "system",
    "system": true,
    "create": false
  },
  "public": {
    "name": "public",
    "system": true,
    "create": true
  }
}]
# test: restart
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
# test: validate state
show lsn
[16]
show schemas
[{
  "system": {
    "name": "system",
    "system": true,
    "create": false
  },
  "public": {
    "name": "public",
    "system": true,
    "create": true
  }
}]
disconnect S0
close E0
