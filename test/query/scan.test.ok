env_open E0
connect E0 S0
connect: on_connect
# test: scan key start
create table test (id int primary key, data int default 1)
insert into test (id) values (1), (2), (3)
explain select * from test where id > 1
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0                 int        0      1      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       11      0      0
 4          cursor_idx        0      0      0
 5                 int        1      1      0
 6                  gt        2      0      1
 7                jntr       10      2      0
 8         cursor_read        0      0      0
 9                send        0      0      0
10         cursor_next        0      4      0
11        cursor_close        0      0      0
12                 ret        0      0      0

"
select * from test where id > 1
[2, 1]
[3, 1]
# test: scan key start #2
explain select * from test where data >= 1 and id > 1
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0                 int        0      1      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       20      0      0
 4          cursor_idx        1      0      1
 5                 int        2      1      0
 6                 gte        3      1      2
 7                jntr       12      3      0
 8          cursor_idx        1      0      0
 9                 int        2      1      0
10                  gt        4      1      2
11                 jtr       14      4      0
12                bool        0      0      0
13                 jmp       15      0      0
14                bool        0      1      0
15                 nop        0      0      0
16                jntr       19      0      0
17         cursor_read        0      0      0
18                send        0      0      0
19         cursor_next        0      4      0
20        cursor_close        0      0      0
21                 ret        0      0      0

"
select * from test where data >= 1 and id > 1
[2, 1]
[3, 1]
# test: scan key start #3
explain select * from test where id > 1 and data >= 1
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0                 int        0      1      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       20      0      0
 4          cursor_idx        1      0      0
 5                 int        2      1      0
 6                  gt        3      1      2
 7                jntr       12      3      0
 8          cursor_idx        1      0      1
 9                 int        2      1      0
10                 gte        4      1      2
11                 jtr       14      4      0
12                bool        0      0      0
13                 jmp       15      0      0
14                bool        0      1      0
15                 nop        0      0      0
16                jntr       19      0      0
17         cursor_read        0      0      0
18                send        0      0      0
19         cursor_next        0      4      0
20        cursor_close        0      0      0
21                 ret        0      0      0

"
select * from test where id > 1 and data >= 1
[2, 1]
[3, 1]
drop table test
# test: scan key stop
create table test (id int primary key, data int default 1)
insert into test (id) values (1), (2), (3)
explain select * from test where id <= 1
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       15      0      0
 4          cursor_idx        0      0      0
 5                 int        1      1      0
 6                 lte        2      0      1
 7                jntr        3      2      0
 8          cursor_idx        0      0      0
 9                 int        1      1      0
10                 lte        2      0      1
11                jntr       14      2      0
12         cursor_read        0      0      0
13                send        0      0      0
14         cursor_next        0      4      0
15        cursor_close        0      0      0
16                 ret        0      0      0

"
select * from test where id <= 1
[1, 1]
# test: scan key stop #2
explain select * from test where data >= 1 and id <= 1
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       24      0      0
 4          cursor_idx        0      0      0
 5                 int        1      1      0
 6                 lte        2      0      1
 7                jntr        3      2      0
 8          cursor_idx        1      0      1
 9                 int        2      1      0
10                 gte        3      1      2
11                jntr       16      3      0
12          cursor_idx        1      0      0
13                 int        2      1      0
14                 lte        4      1      2
15                 jtr       18      4      0
16                bool        0      0      0
17                 jmp       19      0      0
18                bool        0      1      0
19                 nop        0      0      0
20                jntr       23      0      0
21         cursor_read        0      0      0
22                send        0      0      0
23         cursor_next        0      4      0
24        cursor_close        0      0      0
25                 ret        0      0      0

"
select * from test where data >= 1 and id <= 1
[1, 1]
# test: scan key stop #3
explain select * from test where id <= 1 and data >= 1
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       24      0      0
 4          cursor_idx        0      0      0
 5                 int        1      1      0
 6                 lte        2      0      1
 7                jntr        3      2      0
 8          cursor_idx        1      0      0
 9                 int        2      1      0
10                 lte        3      1      2
11                jntr       16      3      0
12          cursor_idx        1      0      1
13                 int        2      1      0
14                 gte        4      1      2
15                 jtr       18      4      0
16                bool        0      0      0
17                 jmp       19      0      0
18                bool        0      1      0
19                 nop        0      0      0
20                jntr       23      0      0
21         cursor_read        0      0      0
22                send        0      0      0
23         cursor_next        0      4      0
24        cursor_close        0      0      0
25                 ret        0      0      0

"
select * from test where id <= 1 and data >= 1
[1, 1]
drop table test
# test: scan point lookup
create table test (id int primary key)
insert into test values (1), (2), (3)
explain select * from test where id = 2
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1                 ret        0      0      0


bytecode [shard 0]
--------
 0                 int        0      2      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       11      0      0
 4          cursor_idx        0      0      0
 5                 int        1      2      0
 6                 equ        2      0      1
 7                jntr        3      2      0
 8         cursor_read        0      0      0
 9                send        0      0      0
10         cursor_next        0      4      0
11        cursor_close        0      0      0
12                 ret        0      0      0

"
select * from test where id = 2
[2]
drop table test
disconnect S0
env_close E0
