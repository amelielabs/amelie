#

open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }], "shards": 3
connect E0 S0 localhost:3485

# test: select from shared group by empty
create table test (id int primary key, data int) shared
explain select * from test group by id
select * from test group by id

# test: select from shared group by
insert into test values (0, 0)
insert into test values (1, 0)
insert into test values (2, 1)
insert into test values (3, 1)
insert into test values (4, 2)
select * from test
explain select * from test group by id
select * from test group by id

explain select * from test group by data
select * from test group by data

# test: select from shared group by keys only
select data from test group by id

# test: select from shared group by column
select id from test group by id
select data from test group by data

# test: select from shared group by column, column
select id, data from test group by id, data
select id, data from test group by data, id

# test: select expr from shared group by
select id, 100 + id from test group by id

# test: select from (select from shared  group by)
explain select * from (select * from test group by id)
select * from (select * from test group by id)
select 100 + * from (select * from test group by id)
select * from (select id, 100 + id from test group by id)

# test: select from shared group by limit
explain select id from test group by id limit 1
select id from test group by id limit 2
select id from test group by id limit 3
select id from test group by id limit 4

# test: select from shared group by limit/offset
explain select id from test group by id limit 1 offset 1
select id from test group by id limit 1 offset 1
select id from test group by id limit 1 offset 2
select id from test group by id limit 1 offset 3
select id from test group by id limit 1 offset 4

# test: select from shared group by offset
explain select id from test group by id offset 1
select id from test group by id offset 1
select id from test group by id offset 2
select id from test group by id offset 3
select id from test group by id offset 4

# test: select from (select from shared group by limit)
explain select * from (select id from test group by id limit 1)
select * from (select id from test group by id limit 1)
select * from (select id from test group by id limit 2)
select * from (select id from test group by id limit 3)
select * from (select id from test group by id limit 4)

# test: select from (select from shared group by limit/offset)
explain select * from (select id from test group by id limit 1 offset 1)
select * from (select id from test group by id limit 1 offset 1)
select * from (select id from test group by id limit 1 offset 2)
select * from (select id from test group by id limit 1 offset 3)
select * from (select id from test group by id limit 1 offset 4)

# test: select from (select from shared group by offset)
explain select * from (select id from test group by id offset 1)
select * from (select id from test group by id offset 1)
select * from (select id from test group by id offset 2)
select * from (select id from test group by id offset 3)
select * from (select id from test group by id offset 4)


# test: select from shared group by having
explain select id from test group by id having id >= 3
select id from test group by id having id >= 3
select id from test group by id having id = 0
select id from test group by id having id = 1
select id from test group by id having id = 2
select id from test group by id having id = 3
select id from test group by id having id = 4
select id from test group by id having id = 5
select id from test group by id having id >= 1 and id <= 3

# test: select from shared group by having limit
explain select id from test group by id having id >= 1 limit 1
select id from test group by id having id >= 1 limit 1
select id from test group by id having id >= 1 limit 2

# test: select from shared group by having limit/offset
explain select id from test group by id having id >= 1 limit 1 offset 1
select id from test group by id having id >= 1 limit 1 offset 1
select id from test group by id having id >= 1 limit 1 offset 2
select id from test group by id having id >= 1 limit 1 offset 3

# test: select from shared group by having offset
explain select id from test group by id having id >= 1 offset 1
select id from test group by id having id >= 1 offset 1
select id from test group by id having id >= 1 offset 2
select id from test group by id having id >= 1 offset 3

# test: select from (select from shared group by having)
explain select * from (select id from test group by id having id >= 3)
select * from (select id from test group by id having id >= 3)

# test: select from (select from shared group by having limit)
explain select * from (select id from test group by id having id >= 1 limit 1)
select * from (select id from test group by id having id >= 1 limit 1)
select * from (select id from test group by id having id >= 1 limit 2)

# test: select from (select from shared group by having limit/offset)
explain select * from (select id from test group by id having id >= 1 limit 1 offset 1)
select * from (select id from test group by id having id >= 1 limit 1 offset 1)
select * from (select id from test group by id having id >= 1 limit 1 offset 2)
select * from (select id from test group by id having id >= 1 limit 1 offset 3)

# test: select from (select from shared group by having offset)
explain select * from (select id from test group by id having id >= 1 offset 1)
select * from (select id from test group by id having id >= 1 offset 1)
select * from (select id from test group by id having id >= 1 offset 2)
select * from (select id from test group by id having id >= 1 offset 3)

# test: select from shared group by order by
explain select id from test group by id order by id
select id from test group by id order by id

# test: select from shared group by order by keys only
select id from test group by id order by data

# test: select from shared group by order by desc
explain select id from test group by id order by id desc
select id from test group by id order by id desc

# test: select from (select from shared group by order by)
explain select * from (select id from test group by id order by id desc)
select * from (select id from test group by id order by id desc)

# test: select from shared group by order by asc limit
explain select id from test group by id order by id asc limit 1
select id from test group by id order by id asc limit 1
select id from test group by id order by id asc limit 2
select id from test group by id order by id asc limit 3

# test: select from shared group by order by asc limit/offset
explain select id from test group by id order by id asc limit 1 offset 1
select id from test group by id order by id asc limit 1 offset 1
select id from test group by id order by id asc limit 1 offset 2
select id from test group by id order by id asc limit 1 offset 3

# test: select from shared group by order by asc offset
explain select id from test group by id order by id asc offset 1
select id from test group by id order by id asc offset 1
select id from test group by id order by id asc offset 2
select id from test group by id order by id asc offset 3

# test: select from shared group by order by desc limit
explain select id from test group by id order by id desc limit 1
select id from test group by id order by id desc limit 1
select id from test group by id order by id desc limit 2
select id from test group by id order by id desc limit 3

# test: select from shared group by order by desc limit/offset
explain select id from test group by id order by id desc limit 1 offset 1
select id from test group by id order by id desc limit 1 offset 1
select id from test group by id order by id desc limit 1 offset 2
select id from test group by id order by id desc limit 1 offset 3

# test: select from shared group by order by desc offset
explain select id from test group by id order by id desc offset 1
select id from test group by id order by id desc offset 0
select id from test group by id order by id desc offset 1
select id from test group by id order by id desc offset 2
select id from test group by id order by id desc offset 3

# test: select from (select from shared group by order by asc limit)
explain select * from (select id from test group by id order by id asc limit 1)
select * from (select id from test group by id order by id asc limit 0)
select * from (select id from test group by id order by id asc limit 1)
select * from (select id from test group by id order by id asc limit 2)
select * from (select id from test group by id order by id asc limit 3)

# test: select from (select from shared group by order by asc limit/offset)
explain select * from (select id from test group by id order by id asc limit 1 offset 1)
select * from (select id from test group by id order by id asc limit 1 offset 1)
select * from (select id from test group by id order by id asc limit 1 offset 2)
select * from (select id from test group by id order by id asc limit 1 offset 3)

# test: select from (select from shared group by order by asc offset)
explain select * from (select id from test group by id order by id asc offset 1)
select * from (select id from test group by id order by id asc offset 0)
select * from (select id from test group by id order by id asc offset 1)
select * from (select id from test group by id order by id asc offset 2)
select * from (select id from test group by id order by id asc offset 3)

# test: select from (select from shared group by order by desc limit)
explain select * from (select id from test group by id order by id desc limit 1)
select * from (select id from test group by id order by id desc limit 0)
select * from (select id from test group by id order by id desc limit 1)
select * from (select id from test group by id order by id desc limit 2)
select * from (select id from test group by id order by id desc limit 3)

# test: select from (select from shared group by order by desc limit/offset)
explain select * from (select id from test group by id order by id desc limit 1 offset 1)
select * from (select id from test group by id order by id desc limit 1 offset 1)
select * from (select id from test group by id order by id desc limit 1 offset 2)
select * from (select id from test group by id order by id desc limit 1 offset 3)

# test: select from (select from shared group by order by desc offset)
explain select * from (select id from test group by id order by id desc offset 1)
select * from (select id from test group by id order by id desc offset 0)
select * from (select id from test group by id order by id desc offset 1)
select * from (select id from test group by id order by id desc offset 2)
select * from (select id from test group by id order by id desc offset 3)

# test: select from shared group by having order by
explain select data from test where data > 0 group by data having data >= 1 order by data
select data from test where data > 0 group by data having data >= 1 order by data

# test: select from shared group by having order by limit
explain select data from test where data > 0 group by data having data >= 1 order by data limit 1
select data from test where data > 0 group by data having data >= 1 order by data limit 1

# test: select from shared group by having order by limit/offset
explain select data from test where data > 0 group by data having data >= 1 order by data limit 1 offset 1
select data from test where data > 0 group by data having data >= 1 order by data limit 1 offset 1

# test: select from shared group by having order by offset
explain select data from test where data > 0 group by data having data >= 1 order by data offset 1
select data from test where data > 0 group by data having data >= 1 order by data offset 1

# test: select from (select from shared group by having order by)
explain select * from (select data from test where data > 0 group by data having data >= 1 order by data)
select * from (select data from test where data > 0 group by data having data >= 1 order by data)

# test: select from (select from shared group by having order by limit)
explain select * from (select data from test where data > 0 group by data having data >= 1 order by data limit 1)
select * from (select data from test where data > 0 group by data having data >= 1 order by data limit 1)

# test: select from (select from shared group by having order by desc limit)
explain select * from (select data from test where data > 0 group by data having data >= 1 order by data desc limit 1)
select * from (select data from test where data > 0 group by data having data >= 1 order by data desc limit 1)

# test: select from (select from shared group by having order by limit/offset)
explain select * from (select data from test where data > 0 group by data having data >= 1 order by data limit 1 offset 1)
select * from (select data from test where data > 0 group by data having data >= 1 order by data limit 1 offset 1)

# test: select from (select from shared group by having order by offset)
explain select * from (select data from test where data > 0 group by data having data >= 1 order by data offset 1)
select * from (select data from test where data > 0 group by data having data >= 1 order by data offset 1)
drop table test

disconnect S0
close E0
