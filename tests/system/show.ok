open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }];
connect E0 S0 127.0.0.1:3485;
# test: show statement parsing
show;
{"msg": "show❰;❱ ⟵ name expected"}
show all junk;
{"msg": "show() ⟵ unexpected name argument"}
show 1234;
{"msg": "show ❰1234❱ ⟵ name expected"}
# test: show users
create user test;
show users abc;
{"msg": "show() ⟵ unexpected name argument"}
show users;
[{
  "name": "test"
}]
prefer return=json;
show users;
[{"name": "test"}]
prefer;
# test: show user
show user;
{"msg": "show() ⟵ name is missing for 'user'"}
show user unknown;
[null]
show user test;
[{
  "name": "test"
}]
show user test;
[{
  "name": "test"
}]
prefer return=json;
show user test;
[{"name": "test"}]
prefer;
# test: show schemas
create schema test;
show schemas;
[{
  "name": "system",
  "system": true
}, {
  "name": "public",
  "system": true
}, {
  "name": "test",
  "system": false
}]
show schema test;
[{
  "name": "test",
  "system": false
}]
prefer return=json;
show schema test;
[{"name": "test", "system": false}]
prefer;
# test: show tables
create table test (id int primary key);
show tables;
[{
  "schema": "public",
  "name": "test",
  "unlogged": false
}]
# test: show table
show table;
{"msg": "show() ⟵ name is missing for 'table'"}
show table test;
[{
  "schema": "public",
  "name": "test",
  "unlogged": false
}]
prefer return=json;
show table test;
[{"schema": "public", "name": "test", "unlogged": false}]
prefer;
# test: show functions
create function test_fn (id int) return json
begin
	return {
		"a": 2 + 2,
		"b": id
	};
end;
select test_fn(123);
[{
  "a": 4,
  "b": 123
}]
select test_fn(123).a;
[4]
select 123::test_fn().a;
[4]
show functions;
[{
  "schema": "public",
  "name": "test_fn"
}]
show functions extended;
[{
  "schema": "public",
  "name": "test_fn",
  "text": "begin\n\treturn {\n\t\t\"a\": 2 + 2,\n\t\t\"b\": id\n\t};\nend",
  "type": 5,
  "args": [{
    "name": "id",
    "type": 2,
    "type_size": 4,
    "constraints": [["default", null]]
  }],
  "returning": []
}]
# test: show function;
show function;
{"msg": "show() ⟵ name is missing for 'function'"}
show function test_fn;
[{
  "schema": "public",
  "name": "test_fn"
}]
show function test_fn extended;
[{
  "schema": "public",
  "name": "test_fn",
  "text": "begin\n\treturn {\n\t\t\"a\": 2 + 2,\n\t\t\"b\": id\n\t};\nend",
  "type": 5,
  "args": [{
    "name": "id",
    "type": 2,
    "type_size": 4,
    "constraints": [["default", null]]
  }],
  "returning": []
}]
# test: show wal
show wal;
[{
  "lsn": 4,
  "lsn_min": 1,
  "files": 1,
  "slots": 0,
  "slots_min": -1,
  "writes": 3,
  "writes_bytes": 514,
  "ops": 3,
  "checkpoint": 1
}]
# test: show replicas
show replicas;
[]
# test: show replica
show replica abc;
{"msg": "failed to parse uuid"}
show replica 'abc';
{"msg": "failed to parse uuid"}
show replica '00000000-0000-0000-0000-000000000000';
[null]
# test: show state
select system.state();
[{
  "version": "0.7.0",
  "directory": "_output/E0",
  "uuid": "00000000-0000-0000-0000-000000000000",
  "frontends": 1,
  "backends": 1,
  "checkpoint": 1,
  "lsn": 4,
  "psn": 1,
  "read_only": false
}]
select system.state().directory;
["_output/E0"]
select system.state()["directory"];
["_output/E0"]
select system.state(123);
{"msg": "state(❰int❱ ⟵ function has no arguments"}
# test: show config
show config;
[{
  "uuid": "00000000-0000-0000-0000-000000000000",
  "timezone": "UTC",
  "format": "json-pretty",
  "log_enable": true,
  "log_to_file": true,
  "log_to_stdout": false,
  "log_connections": true,
  "log_options": true,
  "tls_capath": "",
  "tls_ca": "",
  "tls_cert": "",
  "tls_key": "",
  "listen": [{
    "host": "127.0.0.1",
    "port": 3485
  }],
  "limit_send": 3145728,
  "limit_recv": 1048576,
  "limit_write": 0,
  "frontends": 1,
  "backends": 1,
  "cpu_affinity": true,
  "wal_worker": false,
  "wal_crc": true,
  "wal_sync_on_create": false,
  "wal_sync_on_close": false,
  "wal_sync_on_write": false,
  "wal_sync_interval": "1 sec",
  "wal_size": 67108864,
  "wal_truncate": 0,
  "repl_readahead": 262144,
  "repl_reconnect_ms": 3000,
  "checkpoint_interval": "5 min",
  "checkpoint_workers": 3,
  "checkpoint_crc": true,
  "checkpoint_compression": "zstd",
  "checkpoint_sync": false
}]
# test: show all
show all;
[{
  "uuid": "00000000-0000-0000-0000-000000000000",
  "timezone": "UTC",
  "format": "json-pretty",
  "log_enable": true,
  "log_to_file": true,
  "log_to_stdout": false,
  "log_connections": true,
  "log_options": true,
  "tls_capath": "",
  "tls_ca": "",
  "tls_cert": "",
  "tls_key": "",
  "listen": [{
    "host": "127.0.0.1",
    "port": 3485
  }],
  "limit_send": 3145728,
  "limit_recv": 1048576,
  "limit_write": 0,
  "frontends": 1,
  "backends": 1,
  "cpu_affinity": true,
  "wal_worker": false,
  "wal_crc": true,
  "wal_sync_on_create": false,
  "wal_sync_on_close": false,
  "wal_sync_on_write": false,
  "wal_sync_interval": "1 sec",
  "wal_size": 67108864,
  "wal_truncate": 0,
  "repl_readahead": 262144,
  "repl_reconnect_ms": 3000,
  "checkpoint_interval": "5 min",
  "checkpoint_workers": 3,
  "checkpoint_crc": true,
  "checkpoint_compression": "zstd",
  "checkpoint_sync": false
}]
select system.config().uuid;
["00000000-0000-0000-0000-000000000000"]
select system.config(123);
{"msg": "config(❰int❱ ⟵ function has no arguments"}
# test: show name
show log_enable;
[true]
show "log_enable";
[true]
# test: show unknown
show asdf;
{"msg": "show() ⟵ option 'asdf' is not found"}
# test: explain show
explain show log_enable;
[{
  "main": {
    "00": "string              0      0      0     # log_enable",
    "01": "push                0      0      0     ",
    "02": "string              0      11     0     # ",
    "03": "push                0      0      0     ",
    "04": "string              0      12     0     # ",
    "05": "push                0      0      0     ",
    "06": "bool                0      0      0     ",
    "07": "push                0      0      0     ",
    "08": "call                0      -      4     # system.show()",
    "09": "ret                 0      0      -     "
  },
  "access": []
}]
# test: show (local shadow)
prefer timezone=Asia/Tokyo, return=json;
show all;
[{"uuid": "00000000-0000-0000-0000-000000000000", "timezone": "Asia/Tokyo", "format": "json", "log_enable": true, "log_to_file": true, "log_to_stdout": false, "log_connections": true, "log_options": true, "tls_capath": "", "tls_ca": "", "tls_cert": "", "tls_key": "", "listen": [{"host": "127.0.0.1", "port": 3485}], "limit_send": 3145728, "limit_recv": 1048576, "limit_write": 0, "frontends": 1, "backends": 1, "cpu_affinity": true, "wal_worker": false, "wal_crc": true, "wal_sync_on_create": false, "wal_sync_on_close": false, "wal_sync_on_write": false, "wal_sync_interval": "1 sec", "wal_size": 67108864, "wal_truncate": 0, "repl_readahead": 262144, "repl_reconnect_ms": 3000, "checkpoint_interval": "5 min", "checkpoint_workers": 3, "checkpoint_crc": true, "checkpoint_compression": "zstd", "checkpoint_sync": false}]
show timezone;
["Asia/Tokyo"]
prefer;
show all;
[{
  "uuid": "00000000-0000-0000-0000-000000000000",
  "timezone": "UTC",
  "format": "json-pretty",
  "log_enable": true,
  "log_to_file": true,
  "log_to_stdout": false,
  "log_connections": true,
  "log_options": true,
  "tls_capath": "",
  "tls_ca": "",
  "tls_cert": "",
  "tls_key": "",
  "listen": [{
    "host": "127.0.0.1",
    "port": 3485
  }],
  "limit_send": 3145728,
  "limit_recv": 1048576,
  "limit_write": 0,
  "frontends": 1,
  "backends": 1,
  "cpu_affinity": true,
  "wal_worker": false,
  "wal_crc": true,
  "wal_sync_on_create": false,
  "wal_sync_on_close": false,
  "wal_sync_on_write": false,
  "wal_sync_interval": "1 sec",
  "wal_size": 67108864,
  "wal_truncate": 0,
  "repl_readahead": 262144,
  "repl_reconnect_ms": 3000,
  "checkpoint_interval": "5 min",
  "checkpoint_workers": 3,
  "checkpoint_crc": true,
  "checkpoint_compression": "zstd",
  "checkpoint_sync": false
}]
show timezone;
["UTC"]
disconnect S0;
close E0;
