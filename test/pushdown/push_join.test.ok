open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }], "shards": 3
connect E0 S0 localhost:3485
create table ref (id int primary key, data int default 0) reference
insert into ref (id) values (1), (2), (3)
create table test (id int primary key, data int default 0)
insert into test (id) values (1), (2), (3)
# test: select from table, expr
explain select test.*, t.* from test, [1,2,3] t
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                body        0      0      0
 7                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp       23      0      0
 5                 int        1      1      0
 6                push        1      0      0
 7                 int        1      2      0
 8                push        1      0      0
 9                 int        1      3      0
10                push        1      0      0
11               array        1      3      0
12    cursor_open_expr        1      1     14
13                 jmp       21      0      0
14         cursor_read        2      0      0
15                push        2      0      0
16         cursor_read        2      1      0
17                push        2      0      0
18               array        2      2      0
19             set_add        0      2      0
20         cursor_next        1     14      0
21        cursor_close        1      0      0
22         cursor_next        0      5      0
23        cursor_close        0      0      0
24              result        0      0      0
25                 ret        0      0      0

"
select test.*, t.* from test, [1,2,3] t
[[[1, 0], 1], [[1, 0], 2], [[1, 0], 3], [[2, 0], 1], [[2, 0], 2], [[2, 0], 3], [[3, 0], 1], [[3, 0], 2], [[3, 0], 3]]
# test: select from expr, table
explain select test.*, t.* from [1,2,3] t, test
{"code": 1, "msg": "FROM: undefined distributed table"}
select test.*, t.* from [1,2,3] t, test
{"code": 1, "msg": "FROM: undefined distributed table"}
# test: select from table, reference
explain select test.*, ref.* from test, ref
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                body        0      0      0
 7                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp       18      0      0
 5             int_min        1      0      0
 6                push        1      0      0
 7         cursor_open        1     20      9      # public.ref (primary)
 8                 jmp       16      0      0
 9         cursor_read        1      0      0
10                push        1      0      0
11         cursor_read        1      1      0
12                push        1      0      0
13               array        1      2      0
14             set_add        0      1      0
15         cursor_next        1      9      0
16        cursor_close        1      0      0
17         cursor_next        0      5      0
18        cursor_close        0      0      0
19              result        0      0      0
20                 ret        0      0      0

"
select test.*, ref.* from test, ref
[[[1, 0], [1, 0]], [[1, 0], [2, 0]], [[1, 0], [3, 0]], [[2, 0], [1, 0]], [[2, 0], [2, 0]], [[2, 0], [3, 0]], [[3, 0], [1, 0]], [[3, 0], [2, 0]], [[3, 0], [3, 0]]]
# test: select from reference, table
explain select test.*, ref.* from ref, test
{"code": 1, "msg": "subqueries to distributed tables are not supported"}
select test.*, ref.* from ref, test
{"code": 1, "msg": "subqueries to distributed tables are not supported"}
# test: select from table, table
explain select t.* from test, test t
{"code": 1, "msg": "subqueries to distributed tables are not supported"}
select t.* from test, test t
{"code": 1, "msg": "subqueries to distributed tables are not supported"}
# test: select from table join expr
explain select test.*, t.* from test join [1,2,3] t
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                body        0      0      0
 7                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp       23      0      0
 5                 int        1      1      0
 6                push        1      0      0
 7                 int        1      2      0
 8                push        1      0      0
 9                 int        1      3      0
10                push        1      0      0
11               array        1      3      0
12    cursor_open_expr        1      1     14
13                 jmp       21      0      0
14         cursor_read        2      0      0
15                push        2      0      0
16         cursor_read        2      1      0
17                push        2      0      0
18               array        2      2      0
19             set_add        0      2      0
20         cursor_next        1     14      0
21        cursor_close        1      0      0
22         cursor_next        0      5      0
23        cursor_close        0      0      0
24              result        0      0      0
25                 ret        0      0      0

"
select test.*, t.* from test join [1,2,3] t
[[[1, 0], 1], [[1, 0], 2], [[1, 0], 3], [[2, 0], 1], [[2, 0], 2], [[2, 0], 3], [[3, 0], 1], [[3, 0], 2], [[3, 0], 3]]
# test: select from table join expr on
explain select test.id, t.* from test join [1,2,3] t on (test.id = t.*)
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                body        0      0      0
 7                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp       27      0      0
 5                 int        1      1      0
 6                push        1      0      0
 7                 int        1      2      0
 8                push        1      0      0
 9                 int        1      3      0
10                push        1      0      0
11               array        1      3      0
12    cursor_open_expr        1      1     14
13                 jmp       25      0      0
14          cursor_idx        2      0      0
15         cursor_read        3      1      0
16                 equ        4      2      3
17                jntr       24      4      0
18          cursor_idx        2      0      0
19                push        2      0      0
20         cursor_read        2      1      0
21                push        2      0      0
22               array        2      2      0
23             set_add        0      2      0
24         cursor_next        1     14      0
25        cursor_close        1      0      0
26         cursor_next        0      5      0
27        cursor_close        0      0      0
28              result        0      0      0
29                 ret        0      0      0

"
select test.id, t.* from test join [1,2,3] t on (test.id = t.*)
[[1, 1], [2, 2], [3, 3]]
# test: select from table join expr on #2
explain select test.id, t.*, t2.* from test join [1,2,3] t join [3,2,1] t2 on (test.id = t.* = t2.*)
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                body        0      0      0
 7                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp       42      0      0
 5                 int        1      1      0
 6                push        1      0      0
 7                 int        1      2      0
 8                push        1      0      0
 9                 int        1      3      0
10                push        1      0      0
11               array        1      3      0
12    cursor_open_expr        1      1     14
13                 jmp       40      0      0
14                 int        2      3      0
15                push        2      0      0
16                 int        2      2      0
17                push        2      0      0
18                 int        2      1      0
19                push        2      0      0
20               array        2      3      0
21    cursor_open_expr        2      2     23
22                 jmp       38      0      0
23          cursor_idx        3      0      0
24         cursor_read        4      1      0
25                 equ        5      3      4
26         cursor_read        3      2      0
27                 equ        4      5      3
28                jntr       37      4      0
29          cursor_idx        3      0      0
30                push        3      0      0
31         cursor_read        3      1      0
32                push        3      0      0
33         cursor_read        3      2      0
34                push        3      0      0
35               array        3      3      0
36             set_add        0      3      0
37         cursor_next        2     23      0
38        cursor_close        2      0      0
39         cursor_next        1     14      0
40        cursor_close        1      0      0
41         cursor_next        0      5      0
42        cursor_close        0      0      0
43              result        0      0      0
44                 ret        0      0      0

"
select test.id, t.*, t2.* from test join [1,2,3] t join [3,2,1] t2 on (test.id = t.* = t2.*)
[[1, 1, 1], [2, 2, 1], [3, 3, 1]]
# test: select from table join reference
explain select test.id, ref.id from test join ref
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                body        0      0      0
 7                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp       18      0      0
 5             int_min        1      0      0
 6                push        1      0      0
 7         cursor_open        1     20      9      # public.ref (primary)
 8                 jmp       16      0      0
 9          cursor_idx        1      0      0
10                push        1      0      0
11          cursor_idx        1      1      0
12                push        1      0      0
13               array        1      2      0
14             set_add        0      1      0
15         cursor_next        1      9      0
16        cursor_close        1      0      0
17         cursor_next        0      5      0
18        cursor_close        0      0      0
19              result        0      0      0
20                 ret        0      0      0

"
select test.id, ref.id from test join ref
[[1, 1], [1, 2], [1, 3], [2, 1], [2, 2], [2, 3], [3, 1], [3, 2], [3, 3]]
# test: select from table join reference on
explain select test.id, ref.id from test join ref on (test.id = ref.id)
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                body        0      0      0
 7                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp       22      0      0
 5             int_min        1      0      0
 6                push        1      0      0
 7         cursor_open        1     20      9      # public.ref (primary)
 8                 jmp       20      0      0
 9          cursor_idx        1      0      0
10          cursor_idx        2      1      0
11                 equ        3      1      2
12                jntr       19      3      0
13          cursor_idx        1      0      0
14                push        1      0      0
15          cursor_idx        1      1      0
16                push        1      0      0
17               array        1      2      0
18             set_add        0      1      0
19         cursor_next        1      9      0
20        cursor_close        1      0      0
21         cursor_next        0      5      0
22        cursor_close        0      0      0
23              result        0      0      0
24                 ret        0      0      0

"
select test.id, ref.id from test join ref on (test.id = ref.id)
[[1, 1], [2, 2], [3, 3]]
# test: select from table join reference on #2
explain select test.id, ref.id from test join ref on (test.id = ref.id) join ref ref2 on (test.id = ref2.id)
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                body        0      0      0
 7                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp       37      0      0
 5             int_min        1      0      0
 6                push        1      0      0
 7         cursor_open        1     20      9      # public.ref (primary)
 8                 jmp       35      0      0
 9             int_min        1      0      0
10                push        1      0      0
11         cursor_open        2     39     13      # public.ref (primary)
12                 jmp       33      0      0
13          cursor_idx        2      0      0
14          cursor_idx        3      1      0
15                 equ        4      2      3
16                jntr       21      4      0
17          cursor_idx        2      0      0
18          cursor_idx        3      2      0
19                 equ        5      2      3
20                 jtr       23      5      0
21                bool        1      0      0
22                 jmp       24      0      0
23                bool        1      1      0
24                 nop        0      0      0
25                jntr       32      1      0
26          cursor_idx        1      0      0
27                push        1      0      0
28          cursor_idx        1      1      0
29                push        1      0      0
30               array        1      2      0
31             set_add        0      1      0
32         cursor_next        2     13      0
33        cursor_close        2      0      0
34         cursor_next        1      9      0
35        cursor_close        1      0      0
36         cursor_next        0      5      0
37        cursor_close        0      0      0
38              result        0      0      0
39                 ret        0      0      0

"
select test.id, ref.id from test join ref on (test.id = ref.id) join ref ref2 on (test.id = ref2.id)
[[1, 1], [2, 2], [3, 3]]
drop table ref
drop table test
disconnect S0
close E0
