#pragma once

//
// amelie.
//
// Real-Time SQL OLTP Database.
//
// Copyright (c) 2024 Dmitry Simonenko.
// Copyright (c) 2024 Amelie Labs.
//
// AGPL-3.0 Licensed.
//

typedef struct OpDesc OpDesc;

enum
{
	// control flow
	CNOP,
	CJMP,
	CJTR,
	CJNTR,
	CJGTED,
	CJLTD,

	// values
	CFREE,
	CDUP,
	CMOV,

	// stack
	CPUSH,
	CPUSH_REF,
	CPUSH_DEFAULT,
	CPUSH_VAR,
	CPUSH_NULLS,
	CPUSH_BOOL,
	CPUSH_INT,
	CPUSH_DOUBLE,
	CPUSH_STRING,
	CPUSH_JSON,
	CPUSH_INTERVAL,
	CPUSH_TIMESTAMP,
	CPUSH_DATE,
	CPUSH_VECTOR,
	CPUSH_UUID,
	CPUSH_VALUE,
	CPOP,

	// consts
	CNULL,
	CBOOL,
	CINT,
	CDOUBLE,
	CSTRING,
	CJSON,
	CJSON_OBJ,
	CJSON_ARRAY,
	CINTERVAL,
	CTIMESTAMP,
	CDATE,
	CVECTOR,
	CUUID,
	CVALUE,

	// argument
	CEXCLUDED,

	// null operations
	CNULLOP,
	CIS,

	// logical (any)
	CAND,
	COR,
	CNOT,

	// bitwise operations
	CBORII,
	CBANDII,
	CBXORII,
	CBSHLII,
	CBSHRII,
	CBINVI,

	// equ
	CEQUII,
	CEQUIF,
	CEQUFI,
	CEQUFF,
	CEQULL,
	CEQUSS,
	CEQUJJ,
	CEQUVV,
	CEQUUU,

	// gte
	CGTEII,
	CGTEIF,
	CGTEFI,
	CGTEFF,
	CGTELL,
	CGTESS,
	CGTEVV,
	CGTEUU,

	// gt
	CGTII,
	CGTIF,
	CGTFI,
	CGTFF,
	CGTLL,
	CGTSS,
	CGTVV,
	CGTUU,

	// lte
	CLTEII,
	CLTEIF,
	CLTEFI,
	CLTEFF,
	CLTELL,
	CLTESS,
	CLTEVV,
	CLTEUU,

	// lt
	CLTII,
	CLTIF,
	CLTFI,
	CLTFF,
	CLTLL,
	CLTSS,
	CLTVV,
	CLTUU,

	// add
	CADDII,
	CADDIF,
	CADDFI,
	CADDFF,
	CADDTL,
	CADDLL,
	CADDLT,
	CADDDI,
	CADDID,
	CADDDL,
	CADDLD,
	CADDVV,

	// sub
	CSUBII,
	CSUBIF,
	CSUBFI,
	CSUBFF,
	CSUBTL,
	CSUBTT,
	CSUBLL,
	CSUBDI,
	CSUBDL,
	CSUBVV,

	// mul
	CMULII,
	CMULIF,
	CMULFI,
	CMULFF,
	CMULVV,

	// div
	CDIVII,
	CDIVIF,
	CDIVFI,
	CDIVFF,

	// mod
	CMODII,

	// neg
	CNEGI,
	CNEGF,
	CNEGL,

	// cat
	CCATSS,

	// idx
	CIDXJS,
	CIDXJI,
	CIDXVI,

	// dot
	CDOTJS,

	// like
	CLIKESS,

	// set operations
	CIN,
	CALL,
	CANY,
	CEXISTS,

	// set
	CSET,
	CSET_ORDERED,
	CSET_DISTINCT,
	CSET_PTR,
	CSET_SORT,
	CSET_ADD,
	CSET_GET,
	CSET_AGG,
	CSET_AGG_MERGE,
	CSELF,

	// union
	CUNION,
	CUNION_LIMIT,
	CUNION_OFFSET,
	CUNION_ADD,
	CRECV_AGGS,
	CRECV,

	// table cursor
	CTABLE_OPEN,
	CTABLE_OPENL,
	CTABLE_OPEN_PART,
	CTABLE_OPEN_PARTL,
	CTABLE_PREPARE,
	CTABLE_NEXT,
	CTABLE_READB,
	CTABLE_READI8,
	CTABLE_READI16,
	CTABLE_READI32,
	CTABLE_READI64,
	CTABLE_READF32,
	CTABLE_READF64,
	CTABLE_READT,
	CTABLE_READL,
	CTABLE_READD,
	CTABLE_READS,
	CTABLE_READJ,
	CTABLE_READV,
	CTABLE_READU,

	// store cursor
	CSTORE_OPEN,
	CSTORE_NEXT,
	CSTORE_READ,

	// json cursor
	CJSON_OPEN,
	CJSON_NEXT,
	CJSON_READ,

	// aggs
	CAGG,
	CCOUNT,
	CAVGI,
	CAVGF,

	// dml
	CINSERT,
	CUPSERT,
	CDELETE,
	CUPDATE,
	CUPDATE_STORE,

	// system
	CCHECKPOINT,

	// user
	CUSER_CREATE_TOKEN,
	CUSER_CREATE,
	CUSER_DROP,
	CUSER_ALTER,

	// replica
	CREPLICA_CREATE,
	CREPLICA_DROP,

	// replication
	CREPL_START,
	CREPL_STOP,
	CREPL_SUBSCRIBE,
	CREPL_UNSUBSCRIBE,

	// ddl
	CDDL,
	CDDL_CREATE_INDEX,
	CDDL_REFRESH,
	CDDL_FLUSH,

	// result
	CSEND_SHARD,
	CSEND_LOOKUP,
	CSEND_ALL,
	CCLOSE,

	// var
	CVAR,
	CVAR_MOV,
	CVAR_SET,
	CFIRST,
	CREF,

	// call/return
	CCALL,
	CCALL_UDF,

	// locking
	CLOCK,
	CUNLOCK,

	CRET
};

struct OpDesc
{
	int   id;
	char* name;
};

extern OpDesc ops[];

void op_dump(Program*, Code*, Buf*);
