#

open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }];
connect E0 S0 127.0.0.1:3485;

# test: ensure system databases exists
show databases;

# test: create database statement parsing
create;
create database;
create database 123;
create database if;
create database if not;
create database if not 123;
create database if not exists;
create database test abc;

# test: create database
create database test;

show databases;
select show('databases');

# test: create database if not exists
create database test;
create database if not exists test;
show databases;

# test: drop database statement parsing
drop database;
drop database 123;
drop database if;
drop database if exists;
drop database test abc;

# test: drop database
drop database test;
show databases;

# test: drop database if exists
drop database test;
drop database if exists test;
show databases;

# test: drop main database
drop database main;
show databases;

# test: drop database cascade
create database test;
drop database test cascade;
show databases;

# test: drop connected database
create database test;
show databases;

connect E0 S1 127.0.0.1:3485/test;
switch S1;
drop database test;
select 1;

disconnect S1;
switch S0;

# test: drop database cascade (with relations)
create database test;
connect E0 S1 127.0.0.1:3485/test;
switch S1;

create table a(id int primary key);
create table b(id int primary key);
create function fn() begin select * from a; end;

drop database test;
drop database test cascade;
select 1;

disconnect S1;
switch S0;

show tables;
show functions;
show databases;

# test: alter database statment parsing
alter database;
alter database 123;
alter database test;
alter database test rename;
alter database test rename to;
alter database test rename "hello";

# test: alter database rename
create database test;
show databases;

alter database test rename to test2;
show databases;
drop database test2;

# test: alter database main
alter database main rename to _public;

# test: alter database rename cascade (udf dep)
create database test;
connect E0 S1 127.0.0.1:3485/test;
switch S1;

create table a(id int primary key);
insert into a values (1), (2), (3);

create table b(id int primary key);
create function fn() return int
begin
	total int = 0;
	select count(*) into total from a;
	return total;
end;
select fn();

# error
alter database test rename to test2;
drop function fn;

# test: alter database rename cascade
alter database test rename to test2;
select 1;

disconnect S1;
connect E0 S1 127.0.0.1:3485/test2;
switch S1;

show tables;
show functions;
show databases;

disconnect S1;
switch S0;

show tables;
show functions;
show databases;

drop database test2;
drop database test2 cascade;

disconnect S0;
close E0;
