open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }];
connect E0 S0 127.0.0.1:3485;
# test: case expr
select case;
{"msg": "select case❰;❱ ⟵ bad expression"}
select case 1;
{"msg": "select case 1❰;❱ ⟵ WHEN, ELSE or END expected"}
select case 1 then;
{"msg": "select case 1 ❰then❱ ⟵ WHEN, ELSE or END expected"}
select case 1 then 1;
{"msg": "select case 1 ❰then❱ ⟵ WHEN, ELSE or END expected"}
select case 1 when 1 then 1;
{"msg": "select case 1 when 1 then 1❰;❱ ⟵ WHEN, ELSE or END expected"}
select case 1 when 1 then 1 end;
[1]
select (case 1 when 1 then 1 end)::type;
["int"]
explain select case 1 when 1 then 1 end;
[{
  "main": {
    "00": "int                 1      -      0     # 1",
    "01": "int                 2      -      0     # 1",
    "02": "equii               3      1      2     ",
    "03": "jntr                7      3      0     ",
    "04": "int                 1      -      0     # 1",
    "05": "mov                 0      1      0     ",
    "06": "jmp                 9      0      0     ",
    "07": "null                1      0      0     ",
    "08": "mov                 0      1      0     ",
    "09": "ret                 0      0      -     "
  },
  "access": []
}]
select case 0 when 1 then 1 when 2 then 2 end;
[null]
select (case 0 when 1 then 1 when 2 then 2 end)::type;
["null"]
explain select case 0 when 1 then 1 when 2 then 2 end;
[{
  "main": {
    "00": "int                 1      -      0     # 0",
    "01": "int                 2      -      0     # 1",
    "02": "equii               3      1      2     ",
    "03": "jntr                7      3      0     ",
    "04": "int                 1      -      0     # 1",
    "05": "mov                 0      1      0     ",
    "06": "jmp                 16     0      0     ",
    "07": "int                 1      -      0     # 0",
    "08": "int                 2      -      0     # 2",
    "09": "equii               3      1      2     ",
    "10": "jntr                14     3      0     ",
    "11": "int                 1      -      0     # 2",
    "12": "mov                 0      1      0     ",
    "13": "jmp                 16     0      0     ",
    "14": "null                1      0      0     ",
    "15": "mov                 0      1      0     ",
    "16": "ret                 0      0      -     "
  },
  "access": []
}]
select case 0 when 1 then 1 when 2 then 2 else 'else' end;
{"msg": "select case 0 when 1 then 1 when 2 then 2 else ❰'else'❱ ⟵ CASE expression type mismatch"}
select (case 0 when 1 then 1 when 2 then 2 else 'else' end)::type;
{"msg": "select (case 0 when 1 then 1 when 2 then 2 else ❰'else'❱ ⟵ CASE expression type mismatch"}
explain select case 0 when 1 then 1 when 2 then 2 else 'else' end;
{"msg": "explain select case 0 when 1 then 1 when 2 then 2 else ❰'else'❱ ⟵ CASE expression type mismatch"}
select case [1,2,3] when [1,0] then 1 when [1,2,3] then 2 end;
[2]
select case [1,2,3] when [1,0] then 1 when [1,2,3,4] then 2 end;
[null]
select case [1,2,3] when [1,0] then 1 when [1,2,3,4] then 2 else 3 end;
[3]
select case [1,2,3] when [1,0] then 1 when [1,2,3,4] then 2 else 3 else 4 end;
{"msg": "select case [1,2,3] when [1,0] then 1 when [1,2,3,4] then 2 else 3 ❰else❱ ⟵ ELSE is redefined"}
select case [1,2,3] when [1,0] then 1 when [1,2,3,4] then 2 else 3 else 4 when null then null end;
{"msg": "select case [1,2,3] when [1,0] then 1 when [1,2,3,4] then 2 else 3 ❰else❱ ⟵ ELSE is redefined"}
select case null when [1,0] then 1 when [1,2,3,4] then 2 else 3 else 4 when null then null end;
{"msg": "select case null when [1,0] then 1 when [1,2,3,4] then 2 else 3 ❰else❱ ⟵ ELSE is redefined"}
select case null when [1,0] then 1 when [1,2,3,4] then 2 else 3 when null then null end;
[3]
explain select case null when [1,0] then 1 when [1,2,3,4] then 2 else 3 when null then null end;
[{
  "main": {
    "00": "null                1      0      0     ",
    "01": "json                2      0      0     ",
    "02": "nullop              3      1      2     ",
    "03": "jntr                7      3      0     ",
    "04": "int                 1      -      0     # 1",
    "05": "mov                 0      1      0     ",
    "06": "jmp                 23     0      0     ",
    "07": "null                1      0      0     ",
    "08": "json                2      4      0     ",
    "09": "nullop              3      1      2     ",
    "10": "jntr                14     3      0     ",
    "11": "int                 1      -      0     # 2",
    "12": "mov                 0      1      0     ",
    "13": "jmp                 23     0      0     ",
    "14": "null                1      0      0     ",
    "15": "null                2      0      0     ",
    "16": "nullop              3      1      2     ",
    "17": "jntr                21     3      0     ",
    "18": "null                1      0      0     ",
    "19": "mov                 0      1      0     ",
    "20": "jmp                 23     0      0     ",
    "21": "int                 1      -      0     # 3",
    "22": "mov                 0      1      0     ",
    "23": "ret                 0      0      -     "
  },
  "access": []
}]
select case end;
{"msg": "select case ❰end❱ ⟵ WHEN or ELSE expected"}
select case else end;
{"msg": "select case else ❰end❱ ⟵ bad expression"}
select case else 1 end;
[1]
select case null when 1 then 1 when null then 2 else 3 end;
[3]
# test: case
select case;
{"msg": "select case❰;❱ ⟵ bad expression"}
select case when 1;
{"msg": "select case when 1❰;❱ ⟵ THEN expected"}
select case when 1 then 1;
{"msg": "select case when 1 then 1❰;❱ ⟵ WHEN, ELSE or END expected"}
select case when 1 then 1 end;
[1]
explain select case when 1 then 1 end;
[{
  "main": {
    "00": "int                 1      -      0     # 1",
    "01": "jntr                5      1      0     ",
    "02": "int                 2      -      0     # 1",
    "03": "mov                 0      2      0     ",
    "04": "jmp                 7      0      0     ",
    "05": "null                1      0      0     ",
    "06": "mov                 0      1      0     ",
    "07": "ret                 0      0      -     "
  },
  "access": []
}]
select case else;
{"msg": "select case else❰;❱ ⟵ bad expression"}
select case else end;
{"msg": "select case else ❰end❱ ⟵ bad expression"}
select case else 1 end;
[1]
select case when 1=1 then 1 end;
[1]
select case when 1=0 then 1 when 1=3 when 1=1 then 'yes' end;
{"msg": "select case when 1=0 then 1 when 1=3 ❰when❱ ⟵ THEN expected"}
select case when 1=0 then 1 when 1=3 when 1=1 then 2 end;
{"msg": "select case when 1=0 then 1 when 1=3 ❰when❱ ⟵ THEN expected"}
select case when 1=0 then 1 when 1=3 then 2 when 1=1 then 3 end;
[3]
select case when 1=0 then 1 when 1=3 then 2 else null end;
[null]
select case when 1=0 then 1 when 1=3 then 2 else 3 end;
[3]
select case when 1=0 then 1 when 1=3 then 2 end;
[null]
select case when [1,2,3] = [1,2,3] then true end;
[true]
select case when 1=0 then 1 when null then 2 else 3 end;
[3]
disconnect S0;
close E0;
