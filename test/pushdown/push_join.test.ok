open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }], "backends": 3
connect E0 S0 localhost:3485
create shared table ref (id int primary key, data int default 0)
insert into ref (id) values (1), (2), (3)
create table test (id int primary key, data int default 0)
insert into test (id) values (1), (2), (3)
# test: select from table, shared
explain select test.*, ref.* from test, ref
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      4      0     ",
      "01": "table_open          0      0      3     # public.test (primary)",
      "02": "jmp                 17     0      0     ",
      "03": "table_open          1      20     5     # public.ref (primary)",
      "04": "jmp                 15     0      0     ",
      "05": "table_readi32       1      0      0     ",
      "06": "push                1      0      0     ",
      "07": "table_readi32       1      0      1     ",
      "08": "push                1      0      0     ",
      "09": "table_readi32       1      1      0     ",
      "10": "push                1      0      0     ",
      "11": "table_readi32       1      1      1     ",
      "12": "push                1      0      0     ",
      "13": "set_add             0      0      0     ",
      "14": "table_next          1      5      0     ",
      "15": "table_close         1      0      0     ",
      "16": "table_next          0      3      0     ",
      "17": "table_close         0      0      0     ",
      "18": "result              0      0      0     ",
      "19": "ret                 0      0      0     "
    }
  }
}]
select test.*, ref.* from test, ref
[[1, 0, 1, 0], [1, 0, 2, 0], [1, 0, 3, 0], [2, 0, 1, 0], [2, 0, 2, 0], [2, 0, 3, 0], [3, 0, 1, 0], [3, 0, 2, 0], [3, 0, 3, 0]]
# test: select from shared, table
explain select test.*, ref.* from ref, test
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      4      0     ",
      "01": "table_open          0      0      3     # public.ref (primary)",
      "02": "jmp                 17     0      0     ",
      "03": "table_open          1      19     5     # public.test (primary)",
      "04": "jmp                 15     0      0     ",
      "05": "table_readi32       1      1      0     ",
      "06": "push                1      0      0     ",
      "07": "table_readi32       1      1      1     ",
      "08": "push                1      0      0     ",
      "09": "table_readi32       1      0      0     ",
      "10": "push                1      0      0     ",
      "11": "table_readi32       1      0      1     ",
      "12": "push                1      0      0     ",
      "13": "set_add             0      0      0     ",
      "14": "table_next          1      5      0     ",
      "15": "table_close         1      0      0     ",
      "16": "table_next          0      3      0     ",
      "17": "table_close         0      0      0     ",
      "18": "result              0      0      0     ",
      "19": "ret                 0      0      0     "
    }
  }
}]
select test.*, ref.* from ref, test
[[1, 0, 1, 0], [1, 0, 2, 0], [1, 0, 3, 0], [2, 0, 1, 0], [2, 0, 2, 0], [2, 0, 3, 0], [3, 0, 1, 0], [3, 0, 2, 0], [3, 0, 3, 0]]
# test: select from table, table
explain select t.* from test, test t
{"msg": "direct JOIN with distributed table is not supported"}
select t.* from test, test t
{"msg": "direct JOIN with distributed table is not supported"}
# test: select from table join shared
explain select test.id, ref.id from test join ref on true
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "table_open          0      0      3     # public.test (primary)",
      "02": "jmp                 15     0      0     ",
      "03": "table_open          1      20     5     # public.ref (primary)",
      "04": "jmp                 13     0      0     ",
      "05": "bool                1      1      0     ",
      "06": "jntr                12     1      0     ",
      "07": "table_readi32       1      0      0     ",
      "08": "push                1      0      0     ",
      "09": "table_readi32       1      1      0     ",
      "10": "push                1      0      0     ",
      "11": "set_add             0      0      0     ",
      "12": "table_next          1      5      0     ",
      "13": "table_close         1      0      0     ",
      "14": "table_next          0      3      0     ",
      "15": "table_close         0      0      0     ",
      "16": "result              0      0      0     ",
      "17": "ret                 0      0      0     "
    }
  }
}]
select test.id, ref.id from test join ref on true
[[1, 1], [1, 2], [1, 3], [2, 1], [2, 2], [2, 3], [3, 1], [3, 2], [3, 3]]
# test: select from table join shared on
explain select test.id, ref.id from test join ref on test.id = ref.id
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "table_open          0      0      3     # public.test (primary)",
      "02": "jmp                 17     0      0     ",
      "03": "table_open          1      20     5     # public.ref (primary)",
      "04": "jmp                 15     0      0     ",
      "05": "table_readi32       1      0      0     ",
      "06": "table_readi32       2      1      0     ",
      "07": "equii               3      1      2     ",
      "08": "jntr                14     3      0     ",
      "09": "table_readi32       1      0      0     ",
      "10": "push                1      0      0     ",
      "11": "table_readi32       1      1      0     ",
      "12": "push                1      0      0     ",
      "13": "set_add             0      0      0     ",
      "14": "table_next          1      5      0     ",
      "15": "table_close         1      0      0     ",
      "16": "table_next          0      3      0     ",
      "17": "table_close         0      0      0     ",
      "18": "result              0      0      0     ",
      "19": "ret                 0      0      0     "
    }
  }
}]
select test.id, ref.id from test join ref on test.id = ref.id
[[1, 1], [2, 2], [3, 3]]
# test: select from table join shared on #2
explain select test.id, ref.id from test join ref on test.id = ref.id join ref ref2 on test.id = ref2.id
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "content             0      -      -     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "table_open          0      0      3     # public.test (primary)",
      "02": "jmp                 25     0      0     ",
      "03": "table_open          1      20     5     # public.ref (primary)",
      "04": "jmp                 23     0      0     ",
      "05": "table_open          2      39     7     # public.ref (primary)",
      "06": "jmp                 21     0      0     ",
      "07": "table_readi32       1      0      0     ",
      "08": "table_readi32       2      1      0     ",
      "09": "equii               3      1      2     ",
      "10": "table_readi32       1      0      0     ",
      "11": "table_readi32       2      2      0     ",
      "12": "equii               4      1      2     ",
      "13": "and                 1      3      4     ",
      "14": "jntr                20     1      0     ",
      "15": "table_readi32       1      0      0     ",
      "16": "push                1      0      0     ",
      "17": "table_readi32       1      1      0     ",
      "18": "push                1      0      0     ",
      "19": "set_add             0      0      0     ",
      "20": "table_next          2      7      0     ",
      "21": "table_close         2      0      0     ",
      "22": "table_next          1      5      0     ",
      "23": "table_close         1      0      0     ",
      "24": "table_next          0      3      0     ",
      "25": "table_close         0      0      0     ",
      "26": "result              0      0      0     ",
      "27": "ret                 0      0      0     "
    }
  }
}]
select test.id, ref.id from test join ref on test.id = ref.id join ref ref2 on test.id = ref2.id
[[1, 1], [2, 2], [3, 3]]
drop table ref
drop table test
disconnect S0
close E0
