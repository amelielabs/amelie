#

open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }]
connect E0 S0 localhost:3485

# test: append
select append(null)
select append(null, 0)
select []::append(1)
select []::append(1)::append(2)
select []::append(1)::append(2)::append(3)

# test: append update
create table test (id int primary key, data array)
insert into test values (0, [])
update test set data = data::append(1)::append(2)
select * from test
drop table test

# test: push
select push(null)
select push(null, 0)
select push([], 0)
select []::push()

select []::push(1)
select []::push(2)::push(1)
select []::push(2)::push(1)::push(0)

# test: push update
create table test (id int primary key, data array)
insert into test values (0, [])

update test set data = push(data, 1)
select * from test
update test set data = data::push(2)::push(1)
select * from test
drop table test

# test: pop
select pop()
select pop(null)
select pop([])

select []::pop
select [1]::pop
select [1,2]::pop
select [1,2,3]::pop
select [1,2,3]::pop::pop
select [1,2,3]::pop::pop::pop
select [1,2,3]::pop::pop::pop::pop

# test: pop update
create table test (id int primary key, data array)
insert into test values (0, [1,2,3,4])
update test set data = pop(data)
select * from test
update test set data = data::pop
select * from test
update test set data = data::pop::pop
select * from test
drop table test

# test: pop_back
select pop_back()
select pop_back(null)
select pop_back([])

select []::pop_back
select [1]::pop_back
select [1,2]::pop_back
select [1,2,3]::pop_back
select [1,2,3]::pop_back::pop_back
select [1,2,3]::pop_back::pop_back::pop_back
select [1,2,3]::pop_back::pop_back::pop_back::pop_back

# test: pop_back update
create table test (id int primary key, data array)
insert into test values (0, [1,2,3,4])
update test set data = data::pop_back
select * from test
update test set data = data::pop::pop_back
select * from test
drop table test

# test: put
select put(null)
select put(null, 0)
select put([], 0, 0)
select put([1], 0, 0)

select [1,2,3]::put(0, '0')
select [1,2,3]::put(0, '0')::put(1, '1')
select [1,2,3]::put(0, '0')::put(1, '1')

select [1,2,3]::put(0, '0')::put(2, '1')
select [1,2,3]::put(0, '0')::put(3, '1')
select [1,2,3]::put(0, '0')::put(-1, '1')

# test: put update
create table test (id int primary key, data array)
insert into test values (0, [1,2,3])
update test set data = data::put(1, null)
select * from test
drop table test

# test: remove
select remove(null)
select remove(null, 0)
select remove([], 0)
select remove([], 1)
select remove([1], 0)
select remove([1], -1)
select remove([1], -10)

select remove([1, 2], 3)
select remove([1, 2], 1)
select remove([1, 2], 1)
select remove([1, 2, 3], 1)
select remove([1, 2, 3], 0)
select remove([1, 2, 3], 2)

select []::append(1)::append(2)::append(3)
select []::append(1)::append(2)::append(3)::remove(0)
select []::append(1)::append(2)::append(3)::remove(0)::remove(0)
select []::append(1)::append(2)::append(3)::remove(0)::remove(0)::remove(0)

# test: remove update
create table test (id int primary key, data array)
insert into test values (0, [1,2,3])
update test set data = data::remove(1)
select * from test
drop table test

disconnect S0
close E0
