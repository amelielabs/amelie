open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }], "shards": 3
connect E0 S0 localhost:3485
# test: with(table), expr
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test) select * from a
[[1], [2], [3]]
explain with a as (select * from test) select * from a
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                 set        0      0      0
 7     cursor_open_cte        0      0      9
 8                 jmp       12      0      0
 9         cursor_read        1      0      0
10             set_add        0      1      0
11         cursor_next        0      9      0
12        cursor_close        0      0      0
13             cte_set        1      0      0
14                body        1      0      0
15                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0

"
drop table test
# test: with(shared), expr
create shared table test (id int primary key)
insert into test 1,2,3
with a as (select * from test) select * from a
[[1], [2], [3]]
explain with a as (select * from test) select * from a
"
bytecode [coordinator]
--------
 0          send_first        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                 set        0      0      0
 7     cursor_open_cte        0      0      9
 8                 jmp       12      0      0
 9         cursor_read        1      0      0
10             set_add        0      1      0
11         cursor_next        0      9      0
12        cursor_close        0      0      0
13             cte_set        1      0      0
14                body        1      0      0
15                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0

"
drop table test
# test: with(table), table
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test) select * from test
[[1], [2], [3]]
explain with a as (select * from test) select * from test
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1            send_all        1     11      0
 2                recv        0      0      0
 3                bool        0      0      0
 4                push        0      0      0
 5          merge_recv        0     -1     -1
 6             cte_set        0      0      0
 7                recv        1      0      0
 8                bool        0      0      0
 9                push        0      0      0
10          merge_recv        0     -1     -1
11             cte_set        1      0      0
12                body        1      0      0
13                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0
11                 set        0      0      0
12             int_min        1      0      0
13                push        1      0      0
14         cursor_open        0     20     16      # public.test (primary)
15                 jmp       19      0      0
16         cursor_read        1      0      0
17             set_add        0      1      0
18         cursor_next        0     16      0
19        cursor_close        0      0      0
20              result        0      0      0
21                 ret        0      0      0

"
drop table test
# test: with(shared), shared (pushdown)
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test) select * from test
[[1], [2], [3]]
explain with a as (select * from test) select * from test
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1            send_all        1     11      0
 2                recv        0      0      0
 3                bool        0      0      0
 4                push        0      0      0
 5          merge_recv        0     -1     -1
 6             cte_set        0      0      0
 7                recv        1      0      0
 8                bool        0      0      0
 9                push        0      0      0
10          merge_recv        0     -1     -1
11             cte_set        1      0      0
12                body        1      0      0
13                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0
11                 set        0      0      0
12             int_min        1      0      0
13                push        1      0      0
14         cursor_open        0     20     16      # public.test (primary)
15                 jmp       19      0      0
16         cursor_read        1      0      0
17             set_add        0      1      0
18         cursor_next        0     16      0
19        cursor_close        0      0      0
20              result        0      0      0
21                 ret        0      0      0

"
drop table test
# test: with(expr), table (pushdown)
create table test (id int primary key)
insert into test 1,2,3
explain with a as (select * from [5,6,7]) select test.*, a.* from test, a
"
bytecode [coordinator]
--------
 0                 set        0      0      0
 1                 int        1      5      0
 2                push        1      0      0
 3                 int        1      6      0
 4                push        1      0      0
 5                 int        1      7      0
 6                push        1      0      0
 7               array        1      3      0
 8    cursor_open_expr        0      1     10
 9                 jmp       13      0      0
10         cursor_read        2      0      0
11             set_add        0      2      0
12         cursor_next        0     10      0
13        cursor_close        0      0      0
14             cte_set        0      0      0
15            send_all        1      0      0
16                recv        1      0      0
17                bool        0      0      0
18                push        0      0      0
19          merge_recv        0     -1     -1
20             cte_set        1      0      0
21                body        1      0      0
22                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp       16      0      0
 5     cursor_open_cte        1      0      7
 6                 jmp       14      0      0
 7         cursor_read        1      0      0
 8                push        1      0      0
 9         cursor_read        1      1      0
10                push        1      0      0
11               array        1      2      0
12             set_add        0      1      0
13         cursor_next        1      7      0
14        cursor_close        1      0      0
15         cursor_next        0      5      0
16        cursor_close        0      0      0
17              result        0      0      0
18                 ret        0      0      0

"
with a as (select * from [5,6,7]) select test.*, a.* from test, a
[[[1], 5], [[1], 6], [[1], 7], [[2], 5], [[2], 6], [[2], 7], [[3], 5], [[3], 6], [[3], 7]]
drop table test
# test: with(expr), table (pushdown)
create table test (id int primary key)
insert into test 1,2,3
explain with a as (select * from [5,6,7]) select test.*, a.* from test, a
"
bytecode [coordinator]
--------
 0                 set        0      0      0
 1                 int        1      5      0
 2                push        1      0      0
 3                 int        1      6      0
 4                push        1      0      0
 5                 int        1      7      0
 6                push        1      0      0
 7               array        1      3      0
 8    cursor_open_expr        0      1     10
 9                 jmp       13      0      0
10         cursor_read        2      0      0
11             set_add        0      2      0
12         cursor_next        0     10      0
13        cursor_close        0      0      0
14             cte_set        0      0      0
15            send_all        1      0      0
16                recv        1      0      0
17                bool        0      0      0
18                push        0      0      0
19          merge_recv        0     -1     -1
20             cte_set        1      0      0
21                body        1      0      0
22                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp       16      0      0
 5     cursor_open_cte        1      0      7
 6                 jmp       14      0      0
 7         cursor_read        1      0      0
 8                push        1      0      0
 9         cursor_read        1      1      0
10                push        1      0      0
11               array        1      2      0
12             set_add        0      1      0
13         cursor_next        1      7      0
14        cursor_close        1      0      0
15         cursor_next        0      5      0
16        cursor_close        0      0      0
17              result        0      0      0
18                 ret        0      0      0

"
with a as (select * from [5,6,7]) select test.*, a.* from test, a
[[[1], 5], [[1], 6], [[1], 7], [[2], 5], [[2], 6], [[2], 7], [[3], 5], [[3], 6], [[3], 7]]
drop table test
# test: with(table), table (pushdown join)
create table test (id int primary key)
insert into test 1,2,3
with a (id) as (select * from test) select test.* from test join a on test.id = a.id
[[1], [2], [3]]
explain with a (id) as (select * from test) select test.* from test join a on test.id = a.id
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6            send_all        1     11      0
 7                recv        1      0      0
 8                bool        0      0      0
 9                push        0      0      0
10          merge_recv        0     -1     -1
11             cte_set        1      0      0
12                body        1      0      0
13                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0
11                 set        0      0      0
12             int_min        1      0      0
13                push        1      0      0
14         cursor_open        0     20     16      # public.test (primary)
15                 jmp       27      0      0
16     cursor_open_cte        1      0     18
17                 jmp       25      0      0
18          cursor_idx        1      0      0
19          cursor_idx        2      1      0
20                 equ        3      1      2
21                jntr       24      3      0
22         cursor_read        1      0      0
23             set_add        0      1      0
24         cursor_next        1     18      0
25        cursor_close        1      0      0
26         cursor_next        0     16      0
27        cursor_close        0      0      0
28              result        0      0      0
29                 ret        0      0      0

"
with a (id) as (select * from test) select test.* from test join a on test.id = a.id order by test.id
[[1], [2], [3]]
explain with a (id) as (select * from test) select test.* from test join a on test.id = a.id order by test.id
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6            send_all        1     11      0
 7                recv        1      0      0
 8                bool        0      0      0
 9                push        0      0      0
10          merge_recv        0     -1     -1
11             cte_set        1      0      0
12                body        1      0      0
13                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0
11         set_ordered        0     20      0
12             int_min        1      0      0
13                push        1      0      0
14         cursor_open        0     23     16      # public.test (primary)
15                 jmp       29      0      0
16     cursor_open_cte        1      0     18
17                 jmp       27      0      0
18          cursor_idx        1      0      0
19          cursor_idx        2      1      0
20                 equ        3      1      2
21                jntr       26      3      0
22         cursor_read        1      0      0
23          cursor_idx        2      0      0
24                push        2      0      0
25             set_add        0      1      0
26         cursor_next        1     18      0
27        cursor_close        1      0      0
28         cursor_next        0     16      0
29        cursor_close        0      0      0
30            set_sort        0      0      0
31              result        0      0      0
32                 ret        0      0      0

"
drop table test
# test: with (expr), with(table), table (pushdown join)
create table test (id int primary key)
insert into test 1,2,3
with z (id) as (select [*] from [1,2,3]), a (id) as (select * from test) select test.* from test join a on test.id = a.id join z on test.id = z.id
[[1], [2], [3]]
explain with z (id) as (select [*] from [1,2,3]), a (id) as (select * from test) select test.* from test join a on test.id = a.id join z on test.id = z.id
"
bytecode [coordinator]
--------
 0                 set        0      0      0
 1                 int        1      1      0
 2                push        1      0      0
 3                 int        1      2      0
 4                push        1      0      0
 5                 int        1      3      0
 6                push        1      0      0
 7               array        1      3      0
 8    cursor_open_expr        0      1     10
 9                 jmp       15      0      0
10         cursor_read        2      0      0
11                push        2      0      0
12               array        2      1      0
13             set_add        0      2      0
14         cursor_next        0     10      0
15        cursor_close        0      0      0
16             cte_set        0      0      0
17            send_all        1      0      0
18                recv        1      0      0
19                bool        0      0      0
20                push        0      0      0
21          merge_recv        0     -1     -1
22             cte_set        1      0      0
23            send_all        2     11      0
24                recv        2      0      0
25                bool        0      0      0
26                push        0      0      0
27          merge_recv        0     -1     -1
28             cte_set        2      0      0
29                body        2      0      0
30                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0
11                 set        0      0      0
12             int_min        1      0      0
13                push        1      0      0
14         cursor_open        0     20     16      # public.test (primary)
15                 jmp       40      0      0
16     cursor_open_cte        1      1     18
17                 jmp       38      0      0
18     cursor_open_cte        2      0     20
19                 jmp       36      0      0
20          cursor_idx        2      0      0
21          cursor_idx        3      1      0
22                 equ        4      2      3
23                jntr       28      4      0
24          cursor_idx        2      0      0
25          cursor_idx        3      2      0
26                 equ        5      2      3
27                 jtr       30      5      0
28                bool        1      0      0
29                 jmp       31      0      0
30                bool        1      1      0
31                 nop        0      0      0
32                jntr       35      1      0
33         cursor_read        1      0      0
34             set_add        0      1      0
35         cursor_next        2     20      0
36        cursor_close        2      0      0
37         cursor_next        1     18      0
38        cursor_close        1      0      0
39         cursor_next        0     16      0
40        cursor_close        0      0      0
41              result        0      0      0
42                 ret        0      0      0

"
drop table test
# test: a(table), b(a)
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test), b as (select * from a) select * from b
[[1], [2], [3]]
explain with a as (select * from test), b as (select * from a) select * from b
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                 set        0      0      0
 7     cursor_open_cte        0      0      9
 8                 jmp       12      0      0
 9         cursor_read        1      0      0
10             set_add        0      1      0
11         cursor_next        0      9      0
12        cursor_close        0      0      0
13             cte_set        1      0      0
14                 set        0      0      0
15     cursor_open_cte        0      1     17
16                 jmp       20      0      0
17         cursor_read        1      0      0
18             set_add        0      1      0
19         cursor_next        0     17      0
20        cursor_close        0      0      0
21             cte_set        2      0      0
22                body        2      0      0
23                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0

"
drop table test
# test: a(table), b(expr), c(a)
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test), b as (select [1,2,3]), c as (select * from a) select * from c
[[1], [2], [3]]
explain with a as (select * from test), b as (select [1,2,3]), c as (select * from a) select * from c
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                 int        0      1      0
 7                push        0      0      0
 8                 int        0      2      0
 9                push        0      0      0
10                 int        0      3      0
11                push        0      0      0
12               array        0      3      0
13             cte_set        1      0      0
14                 set        0      0      0
15     cursor_open_cte        0      0     17
16                 jmp       20      0      0
17         cursor_read        1      0      0
18             set_add        0      1      0
19         cursor_next        0     17      0
20        cursor_close        0      0      0
21             cte_set        2      0      0
22                 set        0      0      0
23     cursor_open_cte        0      2     25
24                 jmp       28      0      0
25         cursor_read        1      0      0
26             set_add        0      1      0
27         cursor_next        0     25      0
28        cursor_close        0      0      0
29             cte_set        3      0      0
30                body        3      0      0
31                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0

"
drop table test
# test: a(table), b(expr), c(table)
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test), b as (select [1,2,3]), c as (select * from test) select * from c
[[1], [2], [3]]
explain with a as (select * from test), b as (select [1,2,3]), c as (select * from test) select * from c
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                 int        0      1      0
 7                push        0      0      0
 8                 int        0      2      0
 9                push        0      0      0
10                 int        0      3      0
11                push        0      0      0
12               array        0      3      0
13             cte_set        1      0      0
14            send_all        2     11      0
15                recv        2      0      0
16                bool        0      0      0
17                push        0      0      0
18          merge_recv        0     -1     -1
19             cte_set        2      0      0
20                 set        0      0      0
21     cursor_open_cte        0      2     23
22                 jmp       26      0      0
23         cursor_read        1      0      0
24             set_add        0      1      0
25         cursor_next        0     23      0
26        cursor_close        0      0      0
27             cte_set        3      0      0
28                body        3      0      0
29                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0
11                 set        0      0      0
12             int_min        1      0      0
13                push        1      0      0
14         cursor_open        0     20     16      # public.test (primary)
15                 jmp       19      0      0
16         cursor_read        1      0      0
17             set_add        0      1      0
18         cursor_next        0     16      0
19        cursor_close        0      0      0
20              result        0      0      0
21                 ret        0      0      0

"
drop table test
# test: a(table), b(table), c(expr)
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test), b as (select * from test), c as (select [1,2,3]) select * from c
[1, 2, 3]
explain with a as (select * from test), b as (select * from test), c as (select [1,2,3]) select * from c
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1            send_all        1     11      0
 2                recv        0      0      0
 3                bool        0      0      0
 4                push        0      0      0
 5          merge_recv        0     -1     -1
 6             cte_set        0      0      0
 7                recv        1      0      0
 8                bool        0      0      0
 9                push        0      0      0
10          merge_recv        0     -1     -1
11             cte_set        1      0      0
12                 int        0      1      0
13                push        0      0      0
14                 int        0      2      0
15                push        0      0      0
16                 int        0      3      0
17                push        0      0      0
18               array        0      3      0
19             cte_set        2      0      0
20                 set        0      0      0
21     cursor_open_cte        0      2     23
22                 jmp       26      0      0
23         cursor_read        1      0      0
24             set_add        0      1      0
25         cursor_next        0     23      0
26        cursor_close        0      0      0
27             cte_set        3      0      0
28                body        3      0      0
29                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0
11                 set        0      0      0
12             int_min        1      0      0
13                push        1      0      0
14         cursor_open        0     20     16      # public.test (primary)
15                 jmp       19      0      0
16         cursor_read        1      0      0
17             set_add        0      1      0
18         cursor_next        0     16      0
19        cursor_close        0      0      0
20              result        0      0      0
21                 ret        0      0      0

"
drop table test
# test: a(table), b(table), c(expr), d(table)
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test), b as (select * from test), c as (select [1,2,3]), d as (select * from test) select * from d
[[1], [2], [3]]
explain with a as (select * from test), b as (select * from test), c as (select [1,2,3]), d as (select * from test) select * from d
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1            send_all        1     11      0
 2                recv        0      0      0
 3                bool        0      0      0
 4                push        0      0      0
 5          merge_recv        0     -1     -1
 6             cte_set        0      0      0
 7                recv        1      0      0
 8                bool        0      0      0
 9                push        0      0      0
10          merge_recv        0     -1     -1
11             cte_set        1      0      0
12                 int        0      1      0
13                push        0      0      0
14                 int        0      2      0
15                push        0      0      0
16                 int        0      3      0
17                push        0      0      0
18               array        0      3      0
19             cte_set        2      0      0
20            send_all        3     22      0
21                recv        3      0      0
22                bool        0      0      0
23                push        0      0      0
24          merge_recv        0     -1     -1
25             cte_set        3      0      0
26                 set        0      0      0
27     cursor_open_cte        0      3     29
28                 jmp       32      0      0
29         cursor_read        1      0      0
30             set_add        0      1      0
31         cursor_next        0     29      0
32        cursor_close        0      0      0
33             cte_set        4      0      0
34                body        4      0      0
35                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0
11                 set        0      0      0
12             int_min        1      0      0
13                push        1      0      0
14         cursor_open        0     20     16      # public.test (primary)
15                 jmp       19      0      0
16         cursor_read        1      0      0
17             set_add        0      1      0
18         cursor_next        0     16      0
19        cursor_close        0      0      0
20              result        0      0      0
21                 ret        0      0      0
22                 set        0      0      0
23             int_min        1      0      0
24                push        1      0      0
25         cursor_open        0     40     27      # public.test (primary)
26                 jmp       30      0      0
27         cursor_read        1      0      0
28             set_add        0      1      0
29         cursor_next        0     27      0
30        cursor_close        0      0      0
31              result        0      0      0
32                 ret        0      0      0

"
drop table test
# test: a(expr), b(table), c(expr)
create table test (id int primary key)
insert into test 1,2,3
with a as (select [1,2,3]), b as (select * from test), c as (select [1,2,3]) select b.*, c.* from b,c
[[[1], 1], [[1], 2], [[1], 3], [[2], 1], [[2], 2], [[2], 3], [[3], 1], [[3], 2], [[3], 3]]
explain with a as (select [1,2,3]), b as (select * from test), c as (select [1,2,3]) select b.*, c.* from b,c
"
bytecode [coordinator]
--------
 0                 int        0      1      0
 1                push        0      0      0
 2                 int        0      2      0
 3                push        0      0      0
 4                 int        0      3      0
 5                push        0      0      0
 6               array        0      3      0
 7             cte_set        0      0      0
 8            send_all        1      0      0
 9                recv        1      0      0
10                bool        0      0      0
11                push        0      0      0
12          merge_recv        0     -1     -1
13             cte_set        1      0      0
14                 int        0      1      0
15                push        0      0      0
16                 int        0      2      0
17                push        0      0      0
18                 int        0      3      0
19                push        0      0      0
20               array        0      3      0
21             cte_set        2      0      0
22                 set        0      0      0
23     cursor_open_cte        0      1     25
24                 jmp       36      0      0
25     cursor_open_cte        1      2     27
26                 jmp       34      0      0
27         cursor_read        1      0      0
28                push        1      0      0
29         cursor_read        1      1      0
30                push        1      0      0
31               array        1      2      0
32             set_add        0      1      0
33         cursor_next        1     27      0
34        cursor_close        1      0      0
35         cursor_next        0     25      0
36        cursor_close        0      0      0
37             cte_set        3      0      0
38                body        3      0      0
39                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0

"
drop table test
# test: a(expr), b(table), c(table)
create table test (id int primary key)
insert into test 1,2,3
with a as (select [1,2,3]), b as (select * from test), c as (select * from test) select * from c
[[1], [2], [3]]
explain with a as (select [1,2,3]), b as (select * from test), c as (select * from test) select * from c
"
bytecode [coordinator]
--------
 0                 int        0      1      0
 1                push        0      0      0
 2                 int        0      2      0
 3                push        0      0      0
 4                 int        0      3      0
 5                push        0      0      0
 6               array        0      3      0
 7             cte_set        0      0      0
 8            send_all        1      0      0
 9            send_all        2     11      0
10                recv        1      0      0
11                bool        0      0      0
12                push        0      0      0
13          merge_recv        0     -1     -1
14             cte_set        1      0      0
15                recv        2      0      0
16                bool        0      0      0
17                push        0      0      0
18          merge_recv        0     -1     -1
19             cte_set        2      0      0
20                 set        0      0      0
21     cursor_open_cte        0      2     23
22                 jmp       26      0      0
23         cursor_read        1      0      0
24             set_add        0      1      0
25         cursor_next        0     23      0
26        cursor_close        0      0      0
27             cte_set        3      0      0
28                body        3      0      0
29                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0
11                 set        0      0      0
12             int_min        1      0      0
13                push        1      0      0
14         cursor_open        0     20     16      # public.test (primary)
15                 jmp       19      0      0
16         cursor_read        1      0      0
17             set_add        0      1      0
18         cursor_next        0     16      0
19        cursor_close        0      0      0
20              result        0      0      0
21                 ret        0      0      0

"
drop table test
# test: a(table), b(a), c(table)
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test), b as (select * from a), c as (select * from test) select * from c
[[1], [2], [3]]
explain with a as (select * from test), b as (select * from a), c as (select * from test) select * from c
"
bytecode [coordinator]
--------
 0            send_all        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                 set        0      0      0
 7     cursor_open_cte        0      0      9
 8                 jmp       12      0      0
 9         cursor_read        1      0      0
10             set_add        0      1      0
11         cursor_next        0      9      0
12        cursor_close        0      0      0
13             cte_set        1      0      0
14            send_all        2     11      0
15                recv        2      0      0
16                bool        0      0      0
17                push        0      0      0
18          merge_recv        0     -1     -1
19             cte_set        2      0      0
20                 set        0      0      0
21     cursor_open_cte        0      2     23
22                 jmp       26      0      0
23         cursor_read        1      0      0
24             set_add        0      1      0
25         cursor_next        0     23      0
26        cursor_close        0      0      0
27             cte_set        3      0      0
28                body        3      0      0
29                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0
11                 set        0      0      0
12             int_min        1      0      0
13                push        1      0      0
14         cursor_open        0     20     16      # public.test (primary)
15                 jmp       19      0      0
16         cursor_read        1      0      0
17             set_add        0      1      0
18         cursor_next        0     16      0
19        cursor_close        0      0      0
20              result        0      0      0
21                 ret        0      0      0

"
drop table test
create shared table test (id int primary key)
insert into test 1,2,3
with a as (select * from test), b as (select * from a), c as (select * from test) select * from c
[[1], [2], [3]]
explain with a as (select * from test), b as (select * from a), c as (select * from test) select * from c
"
bytecode [coordinator]
--------
 0          send_first        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                 set        0      0      0
 7     cursor_open_cte        0      0      9
 8                 jmp       12      0      0
 9         cursor_read        1      0      0
10             set_add        0      1      0
11         cursor_next        0      9      0
12        cursor_close        0      0      0
13             cte_set        1      0      0
14          send_first        2     11      0
15                recv        2      0      0
16                bool        0      0      0
17                push        0      0      0
18          merge_recv        0     -1     -1
19             cte_set        2      0      0
20                 set        0      0      0
21     cursor_open_cte        0      2     23
22                 jmp       26      0      0
23         cursor_read        1      0      0
24             set_add        0      1      0
25         cursor_next        0     23      0
26        cursor_close        0      0      0
27             cte_set        3      0      0
28                body        3      0      0
29                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9              result        0      0      0
10                 ret        0      0      0
11                 set        0      0      0
12             int_min        1      0      0
13                push        1      0      0
14         cursor_open        0     20     16      # public.test (primary)
15                 jmp       19      0      0
16         cursor_read        1      0      0
17             set_add        0      1      0
18         cursor_next        0     16      0
19        cursor_close        0      0      0
20              result        0      0      0
21                 ret        0      0      0

"
drop table test
# test: with(update returning), expr
create shared table test (id int primary key, data int)
insert into test values (0, 0)
insert into test values (1, 0)
insert into test values (2, 0)
with a as (update test set data = data + 1 returning *) select * from a
[[0, 1], [1, 1], [2, 1]]
explain with a as (update test set data = data + 1 returning *) select * from a
"
bytecode [coordinator]
--------
 0          send_first        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                 set        0      0      0
 7     cursor_open_cte        0      0      9
 8                 jmp       12      0      0
 9         cursor_read        1      0      0
10             set_add        0      1      0
11         cursor_next        0      9      0
12        cursor_close        0      0      0
13             cte_set        1      0      0
14                body        1      0      0
15                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp       19      0      0
 5         cursor_read        1      0      0
 6                push        1      0      0
 7                null        1      0      0
 8                push        1      0      0
 9          cursor_idx        1      0      1
10                 int        2      1      0
11                 add        3      1      2
12                push        3      0      0
13              assign        1      3      1
14                push        1      0      0
15              update        0      0      0
16         cursor_read        1      0      0
17             set_add        0      1      0
18         cursor_next        0      5      0
19        cursor_close        0      0      0
20              result        0      0      0
21                 ret        0      0      0

"
drop table test
# test: with(delete returning), expr
create shared table test (id int primary key, data int)
insert into test values (0, 0)
insert into test values (1, 0)
insert into test values (2, 0)
with a as (delete from test returning *) select * from a
[[0, 0], [1, 0], [2, 0]]
explain with a as (delete from test returning *) select * from a
"
bytecode [coordinator]
--------
 0          send_first        0      0      0
 1                recv        0      0      0
 2                bool        0      0      0
 3                push        0      0      0
 4          merge_recv        0     -1     -1
 5             cte_set        0      0      0
 6                 set        0      0      0
 7     cursor_open_cte        0      0      9
 8                 jmp       12      0      0
 9         cursor_read        1      0      0
10             set_add        0      1      0
11         cursor_next        0      9      0
12        cursor_close        0      0      0
13             cte_set        1      0      0
14                body        1      0      0
15                 ret        0      0      0


bytecode [node]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        9      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7              delete        0      0      0
 8         cursor_next        0      5      0
 9        cursor_close        0      0      0
10              result        0      0      0
11                 ret        0      0      0

"
drop table test
disconnect S0
close E0
