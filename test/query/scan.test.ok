open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }]
connect E0 S0 localhost:3485
# test: key column
create table test (id int primary key, data int default 1)
insert into test (id) values (1), (2), (3)
explain select * from test where id > 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 15     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 1",
      "07": "gtii                3      1      2     ",
      "08": "jntr                14     3      0     ",
      "09": "cursor_readi32      1      0      0     ",
      "10": "push                1      0      0     ",
      "11": "cursor_readi32      1      0      1     ",
      "12": "push                1      0      0     ",
      "13": "set_add             0      0      0     ",
      "14": "cursor_next         0      5      0     ",
      "15": "cursor_close        0      0      0     ",
      "16": "result              0      0      0     ",
      "17": "ret                 0      0      0     "
    }
  }
}]
select * from test where id > 1
[[2, 1], [3, 1]]
explain select * from test where id >= 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 15     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 1",
      "07": "gteii               3      1      2     ",
      "08": "jntr                14     3      0     ",
      "09": "cursor_readi32      1      0      0     ",
      "10": "push                1      0      0     ",
      "11": "cursor_readi32      1      0      1     ",
      "12": "push                1      0      0     ",
      "13": "set_add             0      0      0     ",
      "14": "cursor_next         0      5      0     ",
      "15": "cursor_close        0      0      0     ",
      "16": "result              0      0      0     ",
      "17": "ret                 0      0      0     "
    }
  }
}]
select * from test where id >= 1
[[1, 1], [2, 1], [3, 1]]
drop table test
# test: key target.column
create table test (id int primary key, data int default 1)
insert into test (id) values (1), (2), (3)
explain select * from test where test.id > 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 15     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 1",
      "07": "gtii                3      1      2     ",
      "08": "jntr                14     3      0     ",
      "09": "cursor_readi32      1      0      0     ",
      "10": "push                1      0      0     ",
      "11": "cursor_readi32      1      0      1     ",
      "12": "push                1      0      0     ",
      "13": "set_add             0      0      0     ",
      "14": "cursor_next         0      5      0     ",
      "15": "cursor_close        0      0      0     ",
      "16": "result              0      0      0     ",
      "17": "ret                 0      0      0     "
    }
  }
}]
select * from test where test.id > 1
[[2, 1], [3, 1]]
drop table test
# test: key alias.column
create table test (id int primary key, data int default 1)
insert into test (id) values (1), (2), (3)
explain select * from test alias where alias.id > 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 15     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 1",
      "07": "gtii                3      1      2     ",
      "08": "jntr                14     3      0     ",
      "09": "cursor_readi32      1      0      0     ",
      "10": "push                1      0      0     ",
      "11": "cursor_readi32      1      0      1     ",
      "12": "push                1      0      0     ",
      "13": "set_add             0      0      0     ",
      "14": "cursor_next         0      5      0     ",
      "15": "cursor_close        0      0      0     ",
      "16": "result              0      0      0     ",
      "17": "ret                 0      0      0     "
    }
  }
}]
select * from test alias where alias.id > 1
[[2, 1], [3, 1]]
drop table test
# test: key column type mismatch
create table test (id int primary key, data int default 1)
explain select * from test where id > "hello"
{"msg": "unsupported operation: <int> > <string>"}
select * from test where id > "hello"
{"msg": "unsupported operation: <int> > <string>"}
drop table test
# test: key column type mismatch #2
create table test (id string primary key, data int default 1)
explain select * from test where id > 1
{"msg": "unsupported operation: <string> > <int>"}
select * from test where id > 1
{"msg": "unsupported operation: <string> > <int>"}
drop table test
# test: key gt (start condition)
create table test (id int primary key, data int default 1)
insert into test (id) values (1), (2), (3)
explain select * from test where id > 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 15     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 1",
      "07": "gtii                3      1      2     ",
      "08": "jntr                14     3      0     ",
      "09": "cursor_readi32      1      0      0     ",
      "10": "push                1      0      0     ",
      "11": "cursor_readi32      1      0      1     ",
      "12": "push                1      0      0     ",
      "13": "set_add             0      0      0     ",
      "14": "cursor_next         0      5      0     ",
      "15": "cursor_close        0      0      0     ",
      "16": "result              0      0      0     ",
      "17": "ret                 0      0      0     "
    }
  }
}]
select * from test where id > 1
[[2, 1], [3, 1]]
# test: key gt and gt (same key)
explain select * from test where id > 1 and id > 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 24     0      0     ",
      "05": "cursor_readi32      2      0      0     ",
      "06": "int                 3      -      0     # 1",
      "07": "gtii                4      2      3     ",
      "08": "jntr                13     4      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 1",
      "11": "gtii                5      2      3     ",
      "12": "jtr                 15     5      0     ",
      "13": "bool                1      0      0     ",
      "14": "jmp                 16     0      0     ",
      "15": "bool                1      1      0     ",
      "16": "nop                 0      0      0     ",
      "17": "jntr                23     1      0     ",
      "18": "cursor_readi32      1      0      0     ",
      "19": "push                1      0      0     ",
      "20": "cursor_readi32      1      0      1     ",
      "21": "push                1      0      0     ",
      "22": "set_add             0      0      0     ",
      "23": "cursor_next         0      5      0     ",
      "24": "cursor_close        0      0      0     ",
      "25": "result              0      0      0     ",
      "26": "ret                 0      0      0     "
    }
  }
}]
select * from test where id > 1 and id > 1
[[2, 1], [3, 1]]
# test: key gt and gt (less)
explain select * from test where id > 2 and id > 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 2",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 24     0      0     ",
      "05": "cursor_readi32      2      0      0     ",
      "06": "int                 3      -      0     # 2",
      "07": "gtii                4      2      3     ",
      "08": "jntr                13     4      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 1",
      "11": "gtii                5      2      3     ",
      "12": "jtr                 15     5      0     ",
      "13": "bool                1      0      0     ",
      "14": "jmp                 16     0      0     ",
      "15": "bool                1      1      0     ",
      "16": "nop                 0      0      0     ",
      "17": "jntr                23     1      0     ",
      "18": "cursor_readi32      1      0      0     ",
      "19": "push                1      0      0     ",
      "20": "cursor_readi32      1      0      1     ",
      "21": "push                1      0      0     ",
      "22": "set_add             0      0      0     ",
      "23": "cursor_next         0      5      0     ",
      "24": "cursor_close        0      0      0     ",
      "25": "result              0      0      0     ",
      "26": "ret                 0      0      0     "
    }
  }
}]
select * from test where id > 2 and id > 1
[[3, 1]]
# test: key gt and gt (greater)
explain select * from test where id > 1 and id > 2
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 2",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 24     0      0     ",
      "05": "cursor_readi32      2      0      0     ",
      "06": "int                 3      -      0     # 1",
      "07": "gtii                4      2      3     ",
      "08": "jntr                13     4      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 2",
      "11": "gtii                5      2      3     ",
      "12": "jtr                 15     5      0     ",
      "13": "bool                1      0      0     ",
      "14": "jmp                 16     0      0     ",
      "15": "bool                1      1      0     ",
      "16": "nop                 0      0      0     ",
      "17": "jntr                23     1      0     ",
      "18": "cursor_readi32      1      0      0     ",
      "19": "push                1      0      0     ",
      "20": "cursor_readi32      1      0      1     ",
      "21": "push                1      0      0     ",
      "22": "set_add             0      0      0     ",
      "23": "cursor_next         0      5      0     ",
      "24": "cursor_close        0      0      0     ",
      "25": "result              0      0      0     ",
      "26": "ret                 0      0      0     "
    }
  }
}]
select * from test where id > 1 and id > 2
[[3, 1]]
# test: key gt and eq (scan to point lookup)
explain select * from test where id > 1 and id = 2
[{
  "bytecode": {
    "coordinator": {
      "00": "send_hash           0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 2",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary, lookup)",
      "04": "jmp                 24     0      0     ",
      "05": "cursor_readi32      2      0      0     ",
      "06": "int                 3      -      0     # 1",
      "07": "gtii                4      2      3     ",
      "08": "jntr                13     4      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 2",
      "11": "equii               5      2      3     ",
      "12": "jtr                 15     5      0     ",
      "13": "bool                1      0      0     ",
      "14": "jmp                 16     0      0     ",
      "15": "bool                1      1      0     ",
      "16": "nop                 0      0      0     ",
      "17": "jntr                4      1      0     ",
      "18": "cursor_readi32      1      0      0     ",
      "19": "push                1      0      0     ",
      "20": "cursor_readi32      1      0      1     ",
      "21": "push                1      0      0     ",
      "22": "set_add             0      0      0     ",
      "23": "jmp                 4      0      0     ",
      "24": "cursor_close        0      0      0     ",
      "25": "result              0      0      0     ",
      "26": "ret                 0      0      0     "
    }
  }
}]
select * from test where id > 1 and id = 2
[[2, 1]]
# test: key lt (stop condition)
explain select * from test where id < 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # -2147483648",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 19     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 1",
      "07": "ltii                3      1      2     ",
      "08": "jntr                4      3      0     ",
      "09": "cursor_readi32      1      0      0     ",
      "10": "int                 2      -      0     # 1",
      "11": "ltii                3      1      2     ",
      "12": "jntr                18     3      0     ",
      "13": "cursor_readi32      1      0      0     ",
      "14": "push                1      0      0     ",
      "15": "cursor_readi32      1      0      1     ",
      "16": "push                1      0      0     ",
      "17": "set_add             0      0      0     ",
      "18": "cursor_next         0      5      0     ",
      "19": "cursor_close        0      0      0     ",
      "20": "result              0      0      0     ",
      "21": "ret                 0      0      0     "
    }
  }
}]
select * from test where id < 1
[]
explain select * from test where id <= 2
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # -2147483648",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 19     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 2",
      "07": "lteii               3      1      2     ",
      "08": "jntr                4      3      0     ",
      "09": "cursor_readi32      1      0      0     ",
      "10": "int                 2      -      0     # 2",
      "11": "lteii               3      1      2     ",
      "12": "jntr                18     3      0     ",
      "13": "cursor_readi32      1      0      0     ",
      "14": "push                1      0      0     ",
      "15": "cursor_readi32      1      0      1     ",
      "16": "push                1      0      0     ",
      "17": "set_add             0      0      0     ",
      "18": "cursor_next         0      5      0     ",
      "19": "cursor_close        0      0      0     ",
      "20": "result              0      0      0     ",
      "21": "ret                 0      0      0     "
    }
  }
}]
select * from test where id <= 2
[[1, 1], [2, 1]]
# test: key lt and lt (same)
explain select * from test where id < 1 and id < 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # -2147483648",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 28     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 1",
      "07": "ltii                3      1      2     ",
      "08": "jntr                4      3      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 1",
      "11": "ltii                4      2      3     ",
      "12": "jntr                17     4      0     ",
      "13": "cursor_readi32      2      0      0     ",
      "14": "int                 3      -      0     # 1",
      "15": "ltii                5      2      3     ",
      "16": "jtr                 19     5      0     ",
      "17": "bool                1      0      0     ",
      "18": "jmp                 20     0      0     ",
      "19": "bool                1      1      0     ",
      "20": "nop                 0      0      0     ",
      "21": "jntr                27     1      0     ",
      "22": "cursor_readi32      1      0      0     ",
      "23": "push                1      0      0     ",
      "24": "cursor_readi32      1      0      1     ",
      "25": "push                1      0      0     ",
      "26": "set_add             0      0      0     ",
      "27": "cursor_next         0      5      0     ",
      "28": "cursor_close        0      0      0     ",
      "29": "result              0      0      0     ",
      "30": "ret                 0      0      0     "
    }
  }
}]
select * from test where id < 1 and id < 1
[]
# test: key lt and lt (less)
explain select * from test where id < 2 and id < 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # -2147483648",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 28     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 1",
      "07": "ltii                3      1      2     ",
      "08": "jntr                4      3      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 2",
      "11": "ltii                4      2      3     ",
      "12": "jntr                17     4      0     ",
      "13": "cursor_readi32      2      0      0     ",
      "14": "int                 3      -      0     # 1",
      "15": "ltii                5      2      3     ",
      "16": "jtr                 19     5      0     ",
      "17": "bool                1      0      0     ",
      "18": "jmp                 20     0      0     ",
      "19": "bool                1      1      0     ",
      "20": "nop                 0      0      0     ",
      "21": "jntr                27     1      0     ",
      "22": "cursor_readi32      1      0      0     ",
      "23": "push                1      0      0     ",
      "24": "cursor_readi32      1      0      1     ",
      "25": "push                1      0      0     ",
      "26": "set_add             0      0      0     ",
      "27": "cursor_next         0      5      0     ",
      "28": "cursor_close        0      0      0     ",
      "29": "result              0      0      0     ",
      "30": "ret                 0      0      0     "
    }
  }
}]
select * from test where id < 2 and id < 1
[]
# test: key lt and lt (greater)
explain select * from test where id < 1 and id < 2
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # -2147483648",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 28     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 1",
      "07": "ltii                3      1      2     ",
      "08": "jntr                4      3      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 1",
      "11": "ltii                4      2      3     ",
      "12": "jntr                17     4      0     ",
      "13": "cursor_readi32      2      0      0     ",
      "14": "int                 3      -      0     # 2",
      "15": "ltii                5      2      3     ",
      "16": "jtr                 19     5      0     ",
      "17": "bool                1      0      0     ",
      "18": "jmp                 20     0      0     ",
      "19": "bool                1      1      0     ",
      "20": "nop                 0      0      0     ",
      "21": "jntr                27     1      0     ",
      "22": "cursor_readi32      1      0      0     ",
      "23": "push                1      0      0     ",
      "24": "cursor_readi32      1      0      1     ",
      "25": "push                1      0      0     ",
      "26": "set_add             0      0      0     ",
      "27": "cursor_next         0      5      0     ",
      "28": "cursor_close        0      0      0     ",
      "29": "result              0      0      0     ",
      "30": "ret                 0      0      0     "
    }
  }
}]
select * from test where id < 1 and id < 2
[]
# test: key lt and eq (scan to point lookup)
explain select * from test where id < 1 and id = 2
[{
  "bytecode": {
    "coordinator": {
      "00": "send_hash           0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 2",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary, lookup)",
      "04": "jmp                 28     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 1",
      "07": "ltii                3      1      2     ",
      "08": "jntr                4      3      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 1",
      "11": "ltii                4      2      3     ",
      "12": "jntr                17     4      0     ",
      "13": "cursor_readi32      2      0      0     ",
      "14": "int                 3      -      0     # 2",
      "15": "equii               5      2      3     ",
      "16": "jtr                 19     5      0     ",
      "17": "bool                1      0      0     ",
      "18": "jmp                 20     0      0     ",
      "19": "bool                1      1      0     ",
      "20": "nop                 0      0      0     ",
      "21": "jntr                4      1      0     ",
      "22": "cursor_readi32      1      0      0     ",
      "23": "push                1      0      0     ",
      "24": "cursor_readi32      1      0      1     ",
      "25": "push                1      0      0     ",
      "26": "set_add             0      0      0     ",
      "27": "jmp                 4      0      0     ",
      "28": "cursor_close        0      0      0     ",
      "29": "result              0      0      0     ",
      "30": "ret                 0      0      0     "
    }
  }
}]
select * from test where id < 1 and id = 2
[]
# test: key gt and lt
explain select * from test where id > 1 and id < 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 28     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 1",
      "07": "ltii                3      1      2     ",
      "08": "jntr                4      3      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 1",
      "11": "gtii                4      2      3     ",
      "12": "jntr                17     4      0     ",
      "13": "cursor_readi32      2      0      0     ",
      "14": "int                 3      -      0     # 1",
      "15": "ltii                5      2      3     ",
      "16": "jtr                 19     5      0     ",
      "17": "bool                1      0      0     ",
      "18": "jmp                 20     0      0     ",
      "19": "bool                1      1      0     ",
      "20": "nop                 0      0      0     ",
      "21": "jntr                27     1      0     ",
      "22": "cursor_readi32      1      0      0     ",
      "23": "push                1      0      0     ",
      "24": "cursor_readi32      1      0      1     ",
      "25": "push                1      0      0     ",
      "26": "set_add             0      0      0     ",
      "27": "cursor_next         0      5      0     ",
      "28": "cursor_close        0      0      0     ",
      "29": "result              0      0      0     ",
      "30": "ret                 0      0      0     "
    }
  }
}]
select * from test where id > 1 and id < 1
[]
explain select * from test where id >= 1 and id <= 2
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 28     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 2",
      "07": "lteii               3      1      2     ",
      "08": "jntr                4      3      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 1",
      "11": "gteii               4      2      3     ",
      "12": "jntr                17     4      0     ",
      "13": "cursor_readi32      2      0      0     ",
      "14": "int                 3      -      0     # 2",
      "15": "lteii               5      2      3     ",
      "16": "jtr                 19     5      0     ",
      "17": "bool                1      0      0     ",
      "18": "jmp                 20     0      0     ",
      "19": "bool                1      1      0     ",
      "20": "nop                 0      0      0     ",
      "21": "jntr                27     1      0     ",
      "22": "cursor_readi32      1      0      0     ",
      "23": "push                1      0      0     ",
      "24": "cursor_readi32      1      0      1     ",
      "25": "push                1      0      0     ",
      "26": "set_add             0      0      0     ",
      "27": "cursor_next         0      5      0     ",
      "28": "cursor_close        0      0      0     ",
      "29": "result              0      0      0     ",
      "30": "ret                 0      0      0     "
    }
  }
}]
select * from test where id >= 1 and id <= 2
[[1, 1], [2, 1]]
# test: key gt and lt and eq
explain select * from test where id > 1 and id < 1 and id = 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_hash           0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary, lookup)",
      "04": "jmp                 37     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 1",
      "07": "ltii                3      1      2     ",
      "08": "jntr                4      3      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 1",
      "11": "gtii                4      2      3     ",
      "12": "jntr                26     4      0     ",
      "13": "cursor_readi32      3      0      0     ",
      "14": "int                 5      -      0     # 1",
      "15": "ltii                6      3      5     ",
      "16": "jntr                21     6      0     ",
      "17": "cursor_readi32      3      0      0     ",
      "18": "int                 5      -      0     # 1",
      "19": "equii               7      3      5     ",
      "20": "jtr                 23     7      0     ",
      "21": "bool                2      0      0     ",
      "22": "jmp                 24     0      0     ",
      "23": "bool                2      1      0     ",
      "24": "nop                 0      0      0     ",
      "25": "jtr                 28     2      0     ",
      "26": "bool                1      0      0     ",
      "27": "jmp                 29     0      0     ",
      "28": "bool                1      1      0     ",
      "29": "nop                 0      0      0     ",
      "30": "jntr                4      1      0     ",
      "31": "cursor_readi32      1      0      0     ",
      "32": "push                1      0      0     ",
      "33": "cursor_readi32      1      0      1     ",
      "34": "push                1      0      0     ",
      "35": "set_add             0      0      0     ",
      "36": "jmp                 4      0      0     ",
      "37": "cursor_close        0      0      0     ",
      "38": "result              0      0      0     ",
      "39": "ret                 0      0      0     "
    }
  }
}]
select * from test where id > 1 and id < 1 and id = 1
[]
# test: key gt and lt and eq (non key)
explain select * from test where id > 1 and id < 1 and data = 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 37     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 1",
      "07": "ltii                3      1      2     ",
      "08": "jntr                4      3      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 1",
      "11": "gtii                4      2      3     ",
      "12": "jntr                26     4      0     ",
      "13": "cursor_readi32      3      0      0     ",
      "14": "int                 5      -      0     # 1",
      "15": "ltii                6      3      5     ",
      "16": "jntr                21     6      0     ",
      "17": "cursor_readi32      3      0      1     ",
      "18": "int                 5      -      0     # 1",
      "19": "equii               7      3      5     ",
      "20": "jtr                 23     7      0     ",
      "21": "bool                2      0      0     ",
      "22": "jmp                 24     0      0     ",
      "23": "bool                2      1      0     ",
      "24": "nop                 0      0      0     ",
      "25": "jtr                 28     2      0     ",
      "26": "bool                1      0      0     ",
      "27": "jmp                 29     0      0     ",
      "28": "bool                1      1      0     ",
      "29": "nop                 0      0      0     ",
      "30": "jntr                36     1      0     ",
      "31": "cursor_readi32      1      0      0     ",
      "32": "push                1      0      0     ",
      "33": "cursor_readi32      1      0      1     ",
      "34": "push                1      0      0     ",
      "35": "set_add             0      0      0     ",
      "36": "cursor_next         0      5      0     ",
      "37": "cursor_close        0      0      0     ",
      "38": "result              0      0      0     ",
      "39": "ret                 0      0      0     "
    }
  }
}]
select * from test where id > 1 and id < 1 and data = 1
[]
# test: key eq (start condition)
explain select * from test where id = 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_hash           0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary, lookup)",
      "04": "jmp                 15     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 1",
      "07": "equii               3      1      2     ",
      "08": "jntr                4      3      0     ",
      "09": "cursor_readi32      1      0      0     ",
      "10": "push                1      0      0     ",
      "11": "cursor_readi32      1      0      1     ",
      "12": "push                1      0      0     ",
      "13": "set_add             0      0      0     ",
      "14": "jmp                 4      0      0     ",
      "15": "cursor_close        0      0      0     ",
      "16": "result              0      0      0     ",
      "17": "ret                 0      0      0     "
    }
  }
}]
select * from test where id = 0
[]
select * from test where id = 1
[[1, 1]]
select * from test where id = 2
[[2, 1]]
select * from test where id = 3
[[3, 1]]
select * from test where id = 4
[]
# test: key eq (non key)
explain select * from test where data = 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # -2147483648",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 15     0      0     ",
      "05": "cursor_readi32      1      0      1     ",
      "06": "int                 2      -      0     # 1",
      "07": "equii               3      1      2     ",
      "08": "jntr                14     3      0     ",
      "09": "cursor_readi32      1      0      0     ",
      "10": "push                1      0      0     ",
      "11": "cursor_readi32      1      0      1     ",
      "12": "push                1      0      0     ",
      "13": "set_add             0      0      0     ",
      "14": "cursor_next         0      5      0     ",
      "15": "cursor_close        0      0      0     ",
      "16": "result              0      0      0     ",
      "17": "ret                 0      0      0     "
    }
  }
}]
select * from test where data = 1
[[1, 1], [2, 1], [3, 1]]
# test: key eq and gt
explain select * from test where id = 1 and id > 0
[{
  "bytecode": {
    "coordinator": {
      "00": "send_hash           0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary, lookup)",
      "04": "jmp                 24     0      0     ",
      "05": "cursor_readi32      2      0      0     ",
      "06": "int                 3      -      0     # 1",
      "07": "equii               4      2      3     ",
      "08": "jntr                13     4      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 0",
      "11": "gtii                5      2      3     ",
      "12": "jtr                 15     5      0     ",
      "13": "bool                1      0      0     ",
      "14": "jmp                 16     0      0     ",
      "15": "bool                1      1      0     ",
      "16": "nop                 0      0      0     ",
      "17": "jntr                4      1      0     ",
      "18": "cursor_readi32      1      0      0     ",
      "19": "push                1      0      0     ",
      "20": "cursor_readi32      1      0      1     ",
      "21": "push                1      0      0     ",
      "22": "set_add             0      0      0     ",
      "23": "jmp                 4      0      0     ",
      "24": "cursor_close        0      0      0     ",
      "25": "result              0      0      0     ",
      "26": "ret                 0      0      0     "
    }
  }
}]
select * from test where id = 1 and id > 0
[[1, 1]]
# test: key eq and gt and lt
explain select * from test where id = 1 and id > 0 and id < 10
[{
  "bytecode": {
    "coordinator": {
      "00": "send_hash           0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary, lookup)",
      "04": "jmp                 37     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 10",
      "07": "ltii                3      1      2     ",
      "08": "jntr                4      3      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 1",
      "11": "equii               4      2      3     ",
      "12": "jntr                26     4      0     ",
      "13": "cursor_readi32      3      0      0     ",
      "14": "int                 5      -      0     # 0",
      "15": "gtii                6      3      5     ",
      "16": "jntr                21     6      0     ",
      "17": "cursor_readi32      3      0      0     ",
      "18": "int                 5      -      0     # 10",
      "19": "ltii                7      3      5     ",
      "20": "jtr                 23     7      0     ",
      "21": "bool                2      0      0     ",
      "22": "jmp                 24     0      0     ",
      "23": "bool                2      1      0     ",
      "24": "nop                 0      0      0     ",
      "25": "jtr                 28     2      0     ",
      "26": "bool                1      0      0     ",
      "27": "jmp                 29     0      0     ",
      "28": "bool                1      1      0     ",
      "29": "nop                 0      0      0     ",
      "30": "jntr                4      1      0     ",
      "31": "cursor_readi32      1      0      0     ",
      "32": "push                1      0      0     ",
      "33": "cursor_readi32      1      0      1     ",
      "34": "push                1      0      0     ",
      "35": "set_add             0      0      0     ",
      "36": "jmp                 4      0      0     ",
      "37": "cursor_close        0      0      0     ",
      "38": "result              0      0      0     ",
      "39": "ret                 0      0      0     "
    }
  }
}]
select * from test where id = 1 and id > 0 and id < 10
[[1, 1]]
# test: key eq and eq
explain select * from test where id = 1 and id = 2
[{
  "bytecode": {
    "coordinator": {
      "00": "send_hash           0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary, lookup)",
      "04": "jmp                 24     0      0     ",
      "05": "cursor_readi32      2      0      0     ",
      "06": "int                 3      -      0     # 1",
      "07": "equii               4      2      3     ",
      "08": "jntr                13     4      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 2",
      "11": "equii               5      2      3     ",
      "12": "jtr                 15     5      0     ",
      "13": "bool                1      0      0     ",
      "14": "jmp                 16     0      0     ",
      "15": "bool                1      1      0     ",
      "16": "nop                 0      0      0     ",
      "17": "jntr                4      1      0     ",
      "18": "cursor_readi32      1      0      0     ",
      "19": "push                1      0      0     ",
      "20": "cursor_readi32      1      0      1     ",
      "21": "push                1      0      0     ",
      "22": "set_add             0      0      0     ",
      "23": "jmp                 4      0      0     ",
      "24": "cursor_close        0      0      0     ",
      "25": "result              0      0      0     ",
      "26": "ret                 0      0      0     "
    }
  }
}]
select * from test where id = 1 and id = 2
[]
drop table test
# test: key compound gt 1 (start condition)
create table test (a int, b int, primary key(a, b))
insert into test values (1, 1), (2, 2), (3, 3)
explain select * from test where a > 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "int                 1      -      0     # -2147483648",
      "04": "push                1      0      0     ",
      "05": "cursor_open         0      0      7     # public.test (primary)",
      "06": "jmp                 17     0      0     ",
      "07": "cursor_readi32      1      0      0     ",
      "08": "int                 2      -      0     # 1",
      "09": "gtii                3      1      2     ",
      "10": "jntr                16     3      0     ",
      "11": "cursor_readi32      1      0      0     ",
      "12": "push                1      0      0     ",
      "13": "cursor_readi32      1      0      1     ",
      "14": "push                1      0      0     ",
      "15": "set_add             0      0      0     ",
      "16": "cursor_next         0      7      0     ",
      "17": "cursor_close        0      0      0     ",
      "18": "result              0      0      0     ",
      "19": "ret                 0      0      0     "
    }
  }
}]
select * from test where a > 1
[[2, 2], [3, 3]]
# test: key compound gt full (start condition)
explain select * from test where a > 1 and b > 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "int                 1      -      0     # 1",
      "04": "push                1      0      0     ",
      "05": "cursor_open         0      0      7     # public.test (primary)",
      "06": "jmp                 26     0      0     ",
      "07": "cursor_readi32      2      0      0     ",
      "08": "int                 3      -      0     # 1",
      "09": "gtii                4      2      3     ",
      "10": "jntr                15     4      0     ",
      "11": "cursor_readi32      2      0      1     ",
      "12": "int                 3      -      0     # 1",
      "13": "gtii                5      2      3     ",
      "14": "jtr                 17     5      0     ",
      "15": "bool                1      0      0     ",
      "16": "jmp                 18     0      0     ",
      "17": "bool                1      1      0     ",
      "18": "nop                 0      0      0     ",
      "19": "jntr                25     1      0     ",
      "20": "cursor_readi32      1      0      0     ",
      "21": "push                1      0      0     ",
      "22": "cursor_readi32      1      0      1     ",
      "23": "push                1      0      0     ",
      "24": "set_add             0      0      0     ",
      "25": "cursor_next         0      7      0     ",
      "26": "cursor_close        0      0      0     ",
      "27": "result              0      0      0     ",
      "28": "ret                 0      0      0     "
    }
  }
}]
select * from test where a > 1 and b > 1
[[2, 2], [3, 3]]
# test: key compound gt and lt (stop condition on inner key)
explain select * from test where a > 1 and b < 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "int                 1      -      0     # -2147483648",
      "04": "push                1      0      0     ",
      "05": "cursor_open         0      0      7     # public.test (primary)",
      "06": "jmp                 26     0      0     ",
      "07": "cursor_readi32      2      0      0     ",
      "08": "int                 3      -      0     # 1",
      "09": "gtii                4      2      3     ",
      "10": "jntr                15     4      0     ",
      "11": "cursor_readi32      2      0      1     ",
      "12": "int                 3      -      0     # 1",
      "13": "ltii                5      2      3     ",
      "14": "jtr                 17     5      0     ",
      "15": "bool                1      0      0     ",
      "16": "jmp                 18     0      0     ",
      "17": "bool                1      1      0     ",
      "18": "nop                 0      0      0     ",
      "19": "jntr                25     1      0     ",
      "20": "cursor_readi32      1      0      0     ",
      "21": "push                1      0      0     ",
      "22": "cursor_readi32      1      0      1     ",
      "23": "push                1      0      0     ",
      "24": "set_add             0      0      0     ",
      "25": "cursor_next         0      7      0     ",
      "26": "cursor_close        0      0      0     ",
      "27": "result              0      0      0     ",
      "28": "ret                 0      0      0     "
    }
  }
}]
select * from test where a > 1 and b < 1
[]
# test: key compound gt and lt and lt (stop condition on outer key)
explain select * from test where a > 1 and b < 1 and a < 10
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "int                 1      -      0     # -2147483648",
      "04": "push                1      0      0     ",
      "05": "cursor_open         0      0      7     # public.test (primary)",
      "06": "jmp                 39     0      0     ",
      "07": "cursor_readi32      1      0      0     ",
      "08": "int                 2      -      0     # 10",
      "09": "ltii                3      1      2     ",
      "10": "jntr                6      3      0     ",
      "11": "cursor_readi32      2      0      0     ",
      "12": "int                 3      -      0     # 1",
      "13": "gtii                4      2      3     ",
      "14": "jntr                28     4      0     ",
      "15": "cursor_readi32      3      0      1     ",
      "16": "int                 5      -      0     # 1",
      "17": "ltii                6      3      5     ",
      "18": "jntr                23     6      0     ",
      "19": "cursor_readi32      3      0      0     ",
      "20": "int                 5      -      0     # 10",
      "21": "ltii                7      3      5     ",
      "22": "jtr                 25     7      0     ",
      "23": "bool                2      0      0     ",
      "24": "jmp                 26     0      0     ",
      "25": "bool                2      1      0     ",
      "26": "nop                 0      0      0     ",
      "27": "jtr                 30     2      0     ",
      "28": "bool                1      0      0     ",
      "29": "jmp                 31     0      0     ",
      "30": "bool                1      1      0     ",
      "31": "nop                 0      0      0     ",
      "32": "jntr                38     1      0     ",
      "33": "cursor_readi32      1      0      0     ",
      "34": "push                1      0      0     ",
      "35": "cursor_readi32      1      0      1     ",
      "36": "push                1      0      0     ",
      "37": "set_add             0      0      0     ",
      "38": "cursor_next         0      7      0     ",
      "39": "cursor_close        0      0      0     ",
      "40": "result              0      0      0     ",
      "41": "ret                 0      0      0     "
    }
  }
}]
select * from test where a > 1 and b < 1 and a < 10
[]
# test: key compound gt and eq
explain select * from test where a > 1 and b = 10
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "int                 1      -      0     # 10",
      "04": "push                1      0      0     ",
      "05": "cursor_open         0      0      7     # public.test (primary)",
      "06": "jmp                 26     0      0     ",
      "07": "cursor_readi32      2      0      0     ",
      "08": "int                 3      -      0     # 1",
      "09": "gtii                4      2      3     ",
      "10": "jntr                15     4      0     ",
      "11": "cursor_readi32      2      0      1     ",
      "12": "int                 3      -      0     # 10",
      "13": "equii               5      2      3     ",
      "14": "jtr                 17     5      0     ",
      "15": "bool                1      0      0     ",
      "16": "jmp                 18     0      0     ",
      "17": "bool                1      1      0     ",
      "18": "nop                 0      0      0     ",
      "19": "jntr                25     1      0     ",
      "20": "cursor_readi32      1      0      0     ",
      "21": "push                1      0      0     ",
      "22": "cursor_readi32      1      0      1     ",
      "23": "push                1      0      0     ",
      "24": "set_add             0      0      0     ",
      "25": "cursor_next         0      7      0     ",
      "26": "cursor_close        0      0      0     ",
      "27": "result              0      0      0     ",
      "28": "ret                 0      0      0     "
    }
  }
}]
select * from test where a > 1 and b = 10
[]
# test: key compound gt and eq and eq (inner)
explain select * from test where a > 1 and b = 10 and b = 20
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "int                 1      -      0     # 10",
      "04": "push                1      0      0     ",
      "05": "cursor_open         0      0      7     # public.test (primary)",
      "06": "jmp                 35     0      0     ",
      "07": "cursor_readi32      2      0      0     ",
      "08": "int                 3      -      0     # 1",
      "09": "gtii                4      2      3     ",
      "10": "jntr                24     4      0     ",
      "11": "cursor_readi32      3      0      1     ",
      "12": "int                 5      -      0     # 10",
      "13": "equii               6      3      5     ",
      "14": "jntr                19     6      0     ",
      "15": "cursor_readi32      3      0      1     ",
      "16": "int                 5      -      0     # 20",
      "17": "equii               7      3      5     ",
      "18": "jtr                 21     7      0     ",
      "19": "bool                2      0      0     ",
      "20": "jmp                 22     0      0     ",
      "21": "bool                2      1      0     ",
      "22": "nop                 0      0      0     ",
      "23": "jtr                 26     2      0     ",
      "24": "bool                1      0      0     ",
      "25": "jmp                 27     0      0     ",
      "26": "bool                1      1      0     ",
      "27": "nop                 0      0      0     ",
      "28": "jntr                34     1      0     ",
      "29": "cursor_readi32      1      0      0     ",
      "30": "push                1      0      0     ",
      "31": "cursor_readi32      1      0      1     ",
      "32": "push                1      0      0     ",
      "33": "set_add             0      0      0     ",
      "34": "cursor_next         0      7      0     ",
      "35": "cursor_close        0      0      0     ",
      "36": "result              0      0      0     ",
      "37": "ret                 0      0      0     "
    }
  }
}]
select * from test where a > 1 and b = 10 and b = 20
[]
# test: key compound gt and eq and eq (outer)
explain select * from test where a > 1 and b = 10 and a = 20
[{
  "bytecode": {
    "coordinator": {
      "00": "send_hash           0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 20",
      "02": "push                1      0      0     ",
      "03": "int                 1      -      0     # 10",
      "04": "push                1      0      0     ",
      "05": "cursor_open         0      0      7     # public.test (primary, lookup)",
      "06": "jmp                 35     0      0     ",
      "07": "cursor_readi32      2      0      0     ",
      "08": "int                 3      -      0     # 1",
      "09": "gtii                4      2      3     ",
      "10": "jntr                24     4      0     ",
      "11": "cursor_readi32      3      0      1     ",
      "12": "int                 5      -      0     # 10",
      "13": "equii               6      3      5     ",
      "14": "jntr                19     6      0     ",
      "15": "cursor_readi32      3      0      0     ",
      "16": "int                 5      -      0     # 20",
      "17": "equii               7      3      5     ",
      "18": "jtr                 21     7      0     ",
      "19": "bool                2      0      0     ",
      "20": "jmp                 22     0      0     ",
      "21": "bool                2      1      0     ",
      "22": "nop                 0      0      0     ",
      "23": "jtr                 26     2      0     ",
      "24": "bool                1      0      0     ",
      "25": "jmp                 27     0      0     ",
      "26": "bool                1      1      0     ",
      "27": "nop                 0      0      0     ",
      "28": "jntr                6      1      0     ",
      "29": "cursor_readi32      1      0      0     ",
      "30": "push                1      0      0     ",
      "31": "cursor_readi32      1      0      1     ",
      "32": "push                1      0      0     ",
      "33": "set_add             0      0      0     ",
      "34": "jmp                 6      0      0     ",
      "35": "cursor_close        0      0      0     ",
      "36": "result              0      0      0     ",
      "37": "ret                 0      0      0     "
    }
  }
}]
select * from test where a > 1 and b = 10 and a = 20
[]
# test: key compound eq and eq
explain select * from test where a = 1 and b = 10
[{
  "bytecode": {
    "coordinator": {
      "00": "send_hash           0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "int                 1      -      0     # 10",
      "04": "push                1      0      0     ",
      "05": "cursor_open         0      0      7     # public.test (primary, lookup)",
      "06": "jmp                 26     0      0     ",
      "07": "cursor_readi32      2      0      0     ",
      "08": "int                 3      -      0     # 1",
      "09": "equii               4      2      3     ",
      "10": "jntr                15     4      0     ",
      "11": "cursor_readi32      2      0      1     ",
      "12": "int                 3      -      0     # 10",
      "13": "equii               5      2      3     ",
      "14": "jtr                 17     5      0     ",
      "15": "bool                1      0      0     ",
      "16": "jmp                 18     0      0     ",
      "17": "bool                1      1      0     ",
      "18": "nop                 0      0      0     ",
      "19": "jntr                6      1      0     ",
      "20": "cursor_readi32      1      0      0     ",
      "21": "push                1      0      0     ",
      "22": "cursor_readi32      1      0      1     ",
      "23": "push                1      0      0     ",
      "24": "set_add             0      0      0     ",
      "25": "jmp                 6      0      0     ",
      "26": "cursor_close        0      0      0     ",
      "27": "result              0      0      0     ",
      "28": "ret                 0      0      0     "
    }
  }
}]
select * from test where a = 1 and b = 10
[]
# test: key compound eq and gt
explain select * from test where a = 1 and b > 1
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "int                 1      -      0     # 1",
      "04": "push                1      0      0     ",
      "05": "cursor_open         0      0      7     # public.test (primary)",
      "06": "jmp                 26     0      0     ",
      "07": "cursor_readi32      2      0      0     ",
      "08": "int                 3      -      0     # 1",
      "09": "equii               4      2      3     ",
      "10": "jntr                15     4      0     ",
      "11": "cursor_readi32      2      0      1     ",
      "12": "int                 3      -      0     # 1",
      "13": "gtii                5      2      3     ",
      "14": "jtr                 17     5      0     ",
      "15": "bool                1      0      0     ",
      "16": "jmp                 18     0      0     ",
      "17": "bool                1      1      0     ",
      "18": "nop                 0      0      0     ",
      "19": "jntr                25     1      0     ",
      "20": "cursor_readi32      1      0      0     ",
      "21": "push                1      0      0     ",
      "22": "cursor_readi32      1      0      1     ",
      "23": "push                1      0      0     ",
      "24": "set_add             0      0      0     ",
      "25": "cursor_next         0      7      0     ",
      "26": "cursor_close        0      0      0     ",
      "27": "result              0      0      0     ",
      "28": "ret                 0      0      0     "
    }
  }
}]
select * from test where a = 1 and b > 1
[]
drop table test
# test: key between
create table test (id int primary key, data int default 1)
insert into test (id) values (1), (2), (3)
explain select * from test where id between 1 and 2
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 28     0      0     ",
      "05": "cursor_readi32      1      0      0     ",
      "06": "int                 2      -      0     # 2",
      "07": "lteii               3      1      2     ",
      "08": "jntr                4      3      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 1",
      "11": "gteii               4      2      3     ",
      "12": "jntr                17     4      0     ",
      "13": "cursor_readi32      2      0      0     ",
      "14": "int                 3      -      0     # 2",
      "15": "lteii               5      2      3     ",
      "16": "jtr                 19     5      0     ",
      "17": "bool                1      0      0     ",
      "18": "jmp                 20     0      0     ",
      "19": "bool                1      1      0     ",
      "20": "nop                 0      0      0     ",
      "21": "jntr                27     1      0     ",
      "22": "cursor_readi32      1      0      0     ",
      "23": "push                1      0      0     ",
      "24": "cursor_readi32      1      0      1     ",
      "25": "push                1      0      0     ",
      "26": "set_add             0      0      0     ",
      "27": "cursor_next         0      5      0     ",
      "28": "cursor_close        0      0      0     ",
      "29": "result              0      0      0     ",
      "30": "ret                 0      0      0     "
    }
  }
}]
select * from test where id between 1 and 2
[[1, 1], [2, 1]]
explain select * from test where data between 1 and 2
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # -2147483648",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 24     0      0     ",
      "05": "cursor_readi32      2      0      1     ",
      "06": "int                 3      -      0     # 1",
      "07": "gteii               4      2      3     ",
      "08": "jntr                13     4      0     ",
      "09": "cursor_readi32      2      0      1     ",
      "10": "int                 3      -      0     # 2",
      "11": "lteii               5      2      3     ",
      "12": "jtr                 15     5      0     ",
      "13": "bool                1      0      0     ",
      "14": "jmp                 16     0      0     ",
      "15": "bool                1      1      0     ",
      "16": "nop                 0      0      0     ",
      "17": "jntr                23     1      0     ",
      "18": "cursor_readi32      1      0      0     ",
      "19": "push                1      0      0     ",
      "20": "cursor_readi32      1      0      1     ",
      "21": "push                1      0      0     ",
      "22": "set_add             0      0      0     ",
      "23": "cursor_next         0      5      0     ",
      "24": "cursor_close        0      0      0     ",
      "25": "result              0      0      0     ",
      "26": "ret                 0      0      0     "
    }
  }
}]
select * from test where data between 1 and 2
[[1, 1], [2, 1], [3, 1]]
# test: key not between
explain select * from test where id not between 1 and 2
[{
  "bytecode": {
    "coordinator": {
      "00": "send_all            0      0      -     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      0      0     ",
      "03": "push                0      0      0     ",
      "04": "merge_recv          0      -1     -1    ",
      "05": "cte_set             0      0      0     ",
      "06": "body                0      0      0     ",
      "07": "ret                 0      0      0     "
    },
    "node": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # -2147483648",
      "02": "push                1      0      0     ",
      "03": "cursor_open         0      0      5     # public.test (primary)",
      "04": "jmp                 25     0      0     ",
      "05": "cursor_readi32      2      0      0     ",
      "06": "int                 3      -      0     # 1",
      "07": "gteii               4      2      3     ",
      "08": "jntr                13     4      0     ",
      "09": "cursor_readi32      2      0      0     ",
      "10": "int                 3      -      0     # 2",
      "11": "lteii               5      2      3     ",
      "12": "jtr                 15     5      0     ",
      "13": "bool                1      0      0     ",
      "14": "jmp                 16     0      0     ",
      "15": "bool                1      1      0     ",
      "16": "nop                 0      0      0     ",
      "17": "not                 2      1      0     ",
      "18": "jntr                24     2      0     ",
      "19": "cursor_readi32      1      0      0     ",
      "20": "push                1      0      0     ",
      "21": "cursor_readi32      1      0      1     ",
      "22": "push                1      0      0     ",
      "23": "set_add             0      0      0     ",
      "24": "cursor_next         0      5      0     ",
      "25": "cursor_close        0      0      0     ",
      "26": "result              0      0      0     ",
      "27": "ret                 0      0      0     "
    }
  }
}]
select * from test where id not between 1 and 2
[[3, 1]]
drop table test
disconnect S0
close E0
