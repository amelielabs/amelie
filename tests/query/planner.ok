open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }];
connect E0 S0 127.0.0.1:3485;
# test: from use index
create table test (id int primary key, data int);
create index i on test (data);
insert into test values (0, 2);
insert into test values (1, 1);
insert into test values (2, 0);
explain select * from test;
[{
  "main": {
    "00": "send_all            0      0      18    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      8     # test (primary)",
    "02": "table_readi32       2      1      -     # id",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      -     # data",
    "05": "push                2      0      0     ",
    "06": "set_add             0      0      0     ",
    "07": "table_next          1      2      0     ",
    "08": "free                1      0      0     ",
    "09": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test;
[[0, 2], [1, 1], [2, 0]]
select * from test use;
{"msg": "select * from test use❰;❱ ⟵ INDEX expected"}
select * from test use 1;
{"msg": "select * from test use ❰1❱ ⟵ INDEX expected"}
select * from test use index;
{"msg": "select * from test use index❰;❱ ⟵ ( expected"}
select * from test use index 1;
{"msg": "select * from test use index ❰1❱ ⟵ ( expected"}
select * from test use index (;
{"msg": "select * from test use index (❰;❱ ⟵ <index name> expected"}
select * from test use index (123;
{"msg": "select * from test use index (❰123❱ ⟵ <index name> expected"}
explain select * from test use index (i);
[{
  "main": {
    "00": "send_all            0      0      12    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      8     # test (i)",
    "02": "table_readi32       2      1      -     # id",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      -     # data",
    "05": "push                2      0      0     ",
    "06": "set_add             0      0      0     ",
    "07": "table_next          1      2      0     ",
    "08": "free                1      0      0     ",
    "09": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test use index (i);
[[2, 0], [1, 1], [0, 2]]
drop index i on test;
drop table test;
# test: hash/hash
create table test (id int, data int, primary key (id, data) using hash) partitions 1;
create index i on test (data) using hash;
insert into test values (0, 2);
insert into test values (1, 1);
insert into test values (2, 0);
# test: hash/hash (scan)
explain select * from test;
[{
  "main": {
    "00": "send_all            0      0      18    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      8     # test (primary)",
    "02": "table_readi32       2      1      -     # id",
    "03": "push                2      0      0     ",
    "04": "table_readi32       2      1      -     # data",
    "05": "push                2      0      0     ",
    "06": "set_add             0      0      0     ",
    "07": "table_next          1      2      0     ",
    "08": "free                1      0      0     ",
    "09": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test;
[[1, 1], [0, 2], [2, 0]]
# test: hash/hash (unique point lookup)
create unique index j on test (data) using hash;
explain select * from test where data = 2;
[{
  "main": {
    "00": "send_all            0      0      12    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "push_int            -      0      0     # 2",
    "02": "table_open_partl    1      0      12    # test (j)",
    "03": "table_readi32       2      1      -     # data",
    "04": "int                 3      -      0     # 2",
    "05": "equii               4      2      3     ",
    "06": "jntr                12     4      0     ",
    "07": "table_readi32       2      1      -     # id",
    "08": "push                2      0      0     ",
    "09": "table_readi32       2      1      -     # data",
    "10": "push                2      0      0     ",
    "11": "set_add             0      0      0     ",
    "12": "free                1      0      0     ",
    "13": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test where data = 2;
[]
explain select * from test where id = 1;
[{
  "main": {
    "00": "send_all            0      0      18    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "push_int            -      0      0     # 1",
    "02": "table_open_part     1      0      13    # test (primary)",
    "03": "table_readi32       2      1      -     # id",
    "04": "int                 3      -      0     # 1",
    "05": "equii               4      2      3     ",
    "06": "jntr                12     4      0     ",
    "07": "table_readi32       2      1      -     # id",
    "08": "push                2      0      0     ",
    "09": "table_readi32       2      1      -     # data",
    "10": "push                2      0      0     ",
    "11": "set_add             0      0      0     ",
    "12": "table_next          1      3      0     ",
    "13": "free                1      0      0     ",
    "14": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test where id = 1;
[[1, 1]]
explain select * from test where id = 1 and data = 1;
[{
  "main": {
    "00": "push_int            -      0      0     # 1",
    "01": "push_int            -      0      0     # 1",
    "02": "send_lookup         0      -      18    # test (select, closing)",
    "03": "union               1      0      0     ",
    "04": "recv                1      0      0     ",
    "05": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "push_int            -      0      0     # 1",
    "02": "push_int            -      0      0     # 1",
    "03": "table_open_partl    1      0      17    # test (primary)",
    "04": "table_readi32       2      1      -     # id",
    "05": "int                 3      -      0     # 1",
    "06": "equii               4      2      3     ",
    "07": "table_readi32       2      1      -     # data",
    "08": "int                 3      -      0     # 1",
    "09": "equii               5      2      3     ",
    "10": "and                 2      4      5     ",
    "11": "jntr                17     2      0     ",
    "12": "table_readi32       2      1      -     # id",
    "13": "push                2      0      0     ",
    "14": "table_readi32       2      1      -     # data",
    "15": "push                2      0      0     ",
    "16": "set_add             0      0      0     ",
    "17": "free                1      0      0     ",
    "18": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test where id = 1 and data = 1;
[[1, 1]]
explain select * from test where data = 1 and id = 1;
[{
  "main": {
    "00": "push_int            -      0      0     # 1",
    "01": "push_int            -      0      0     # 1",
    "02": "send_lookup         0      -      18    # test (select, closing)",
    "03": "union               1      0      0     ",
    "04": "recv                1      0      0     ",
    "05": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "push_int            -      0      0     # 1",
    "02": "push_int            -      0      0     # 1",
    "03": "table_open_partl    1      0      17    # test (primary)",
    "04": "table_readi32       2      1      -     # data",
    "05": "int                 3      -      0     # 1",
    "06": "equii               4      2      3     ",
    "07": "table_readi32       2      1      -     # id",
    "08": "int                 3      -      0     # 1",
    "09": "equii               5      2      3     ",
    "10": "and                 2      4      5     ",
    "11": "jntr                17     2      0     ",
    "12": "table_readi32       2      1      -     # id",
    "13": "push                2      0      0     ",
    "14": "table_readi32       2      1      -     # data",
    "15": "push                2      0      0     ",
    "16": "set_add             0      0      0     ",
    "17": "free                1      0      0     ",
    "18": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test where data = 1 and id = 1;
[[1, 1]]
drop table test;
# test: tree/hash
create table test (id int primary key, data int);
create index i on test (data) using hash;
insert into test values (0, 2);
insert into test values (1, 1);
insert into test values (2, 0);
explain select * from test where id = 1;
[{
  "main": {
    "00": "push_int            -      0      0     # 1",
    "01": "send_lookup         0      -      18    # test (select, closing)",
    "02": "union               1      0      0     ",
    "03": "recv                1      0      0     ",
    "04": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "push_int            -      0      0     # 1",
    "02": "table_open_partl    1      0      12    # test (primary)",
    "03": "table_readi32       2      1      -     # id",
    "04": "int                 3      -      0     # 1",
    "05": "equii               4      2      3     ",
    "06": "jntr                12     4      0     ",
    "07": "table_readi32       2      1      -     # id",
    "08": "push                2      0      0     ",
    "09": "table_readi32       2      1      -     # data",
    "10": "push                2      0      0     ",
    "11": "set_add             0      0      0     ",
    "12": "free                1      0      0     ",
    "13": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test where id = 1;
[[1, 1]]
explain select * from test where id > 1;
[{
  "main": {
    "00": "send_all            0      0      18    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "push_int            -      0      0     # 1",
    "02": "table_open_part     1      0      13    # test (primary)",
    "03": "table_readi32       2      1      -     # id",
    "04": "int                 3      -      0     # 1",
    "05": "gtii                4      2      3     ",
    "06": "jntr                12     4      0     ",
    "07": "table_readi32       2      1      -     # id",
    "08": "push                2      0      0     ",
    "09": "table_readi32       2      1      -     # data",
    "10": "push                2      0      0     ",
    "11": "set_add             0      0      0     ",
    "12": "table_next          1      3      0     ",
    "13": "free                1      0      0     ",
    "14": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test where id > 1;
[[2, 0]]
explain select * from test where data > 1;
[{
  "main": {
    "00": "send_all            0      0      18    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      12    # test (primary)",
    "02": "table_readi32       2      1      -     # data",
    "03": "int                 3      -      0     # 1",
    "04": "gtii                4      2      3     ",
    "05": "jntr                11     4      0     ",
    "06": "table_readi32       2      1      -     # id",
    "07": "push                2      0      0     ",
    "08": "table_readi32       2      1      -     # data",
    "09": "push                2      0      0     ",
    "10": "set_add             0      0      0     ",
    "11": "table_next          1      2      0     ",
    "12": "free                1      0      0     ",
    "13": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test where data > 1;
[[0, 2]]
# test: tree/hash (point lookup)
explain select * from test where data = 1;
[{
  "main": {
    "00": "send_all            0      0      18    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      12    # test (primary)",
    "02": "table_readi32       2      1      -     # data",
    "03": "int                 3      -      0     # 1",
    "04": "equii               4      2      3     ",
    "05": "jntr                11     4      0     ",
    "06": "table_readi32       2      1      -     # id",
    "07": "push                2      0      0     ",
    "08": "table_readi32       2      1      -     # data",
    "09": "push                2      0      0     ",
    "10": "set_add             0      0      0     ",
    "11": "table_next          1      2      0     ",
    "12": "free                1      0      0     ",
    "13": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test where data = 1;
[[1, 1]]
select show('table', 'test', true).indexes;
[[{
  "name": "primary",
  "type": 2,
  "unique": true,
  "primary": true,
  "keys": [{
    "column": 0,
    "asc": true
  }]
}, {
  "name": "i",
  "type": 1,
  "unique": false,
  "primary": false,
  "keys": [{
    "column": 1,
    "asc": true
  }, {
    "column": 0,
    "asc": true
  }]
}]]
explain select * from test where data = 1 and id = 1;
[{
  "main": {
    "00": "push_int            -      0      0     # 1",
    "01": "send_lookup         0      -      12    # test (select, closing)",
    "02": "union               1      0      0     ",
    "03": "recv                1      0      0     ",
    "04": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "push_int            -      0      0     # 1",
    "02": "push_int            -      0      0     # 1",
    "03": "table_open_partl    1      0      18    # test (i)",
    "04": "table_readi32       2      1      -     # data",
    "05": "int                 3      -      0     # 1",
    "06": "equii               4      2      3     ",
    "07": "table_readi32       2      1      -     # id",
    "08": "int                 3      -      0     # 1",
    "09": "equii               5      2      3     ",
    "10": "and                 2      4      5     ",
    "11": "jntr                17     2      0     ",
    "12": "table_readi32       2      1      -     # id",
    "13": "push                2      0      0     ",
    "14": "table_readi32       2      1      -     # data",
    "15": "push                2      0      0     ",
    "16": "set_add             0      0      0     ",
    "17": "table_next          1      4      0     ",
    "18": "free                1      0      0     ",
    "19": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test where data = 1 and id = 1;
[[1, 1]]
# test: tree/hash (hash override)
explain select * from test where id = 1 and data = 1;
[{
  "main": {
    "00": "push_int            -      0      0     # 1",
    "01": "send_lookup         0      -      12    # test (select, closing)",
    "02": "union               1      0      0     ",
    "03": "recv                1      0      0     ",
    "04": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "push_int            -      0      0     # 1",
    "02": "push_int            -      0      0     # 1",
    "03": "table_open_partl    1      0      18    # test (i)",
    "04": "table_readi32       2      1      -     # id",
    "05": "int                 3      -      0     # 1",
    "06": "equii               4      2      3     ",
    "07": "table_readi32       2      1      -     # data",
    "08": "int                 3      -      0     # 1",
    "09": "equii               5      2      3     ",
    "10": "and                 2      4      5     ",
    "11": "jntr                17     2      0     ",
    "12": "table_readi32       2      1      -     # id",
    "13": "push                2      0      0     ",
    "14": "table_readi32       2      1      -     # data",
    "15": "push                2      0      0     ",
    "16": "set_add             0      0      0     ",
    "17": "table_next          1      4      0     ",
    "18": "free                1      0      0     ",
    "19": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test where id = 1 and data = 1;
[[1, 1]]
drop table test;
# test: tree/tree
create table test (id int primary key, data int);
create index i on test (data);
insert into test values (0, 2);
insert into test values (1, 1);
insert into test values (2, 0);
# test: tree/tree (scan)
explain select * from test where id > 1;
[{
  "main": {
    "00": "send_all            0      0      18    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "push_int            -      0      0     # 1",
    "02": "table_open_part     1      0      13    # test (primary)",
    "03": "table_readi32       2      1      -     # id",
    "04": "int                 3      -      0     # 1",
    "05": "gtii                4      2      3     ",
    "06": "jntr                12     4      0     ",
    "07": "table_readi32       2      1      -     # id",
    "08": "push                2      0      0     ",
    "09": "table_readi32       2      1      -     # data",
    "10": "push                2      0      0     ",
    "11": "set_add             0      0      0     ",
    "12": "table_next          1      3      0     ",
    "13": "free                1      0      0     ",
    "14": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test where id > 1;
[[2, 0]]
explain select * from test where data > 1;
[{
  "main": {
    "00": "send_all            0      0      12    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "push_int            -      0      0     # 1",
    "02": "table_open_part     1      0      13    # test (i)",
    "03": "table_readi32       2      1      -     # data",
    "04": "int                 3      -      0     # 1",
    "05": "gtii                4      2      3     ",
    "06": "jntr                12     4      0     ",
    "07": "table_readi32       2      1      -     # id",
    "08": "push                2      0      0     ",
    "09": "table_readi32       2      1      -     # data",
    "10": "push                2      0      0     ",
    "11": "set_add             0      0      0     ",
    "12": "table_next          1      3      0     ",
    "13": "free                1      0      0     ",
    "14": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test where data > 1;
[[0, 2]]
# test: tree/tree (stop condition)
explain select * from test where data < 1;
[{
  "main": {
    "00": "send_all            0      0      12    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      16    # test (i)",
    "02": "table_readi32       2      1      -     # data",
    "03": "int                 3      -      0     # 1",
    "04": "ltii                4      2      3     ",
    "05": "jntr                16     4      0     ",
    "06": "table_readi32       2      1      -     # data",
    "07": "int                 3      -      0     # 1",
    "08": "ltii                4      2      3     ",
    "09": "jntr                15     4      0     ",
    "10": "table_readi32       2      1      -     # id",
    "11": "push                2      0      0     ",
    "12": "table_readi32       2      1      -     # data",
    "13": "push                2      0      0     ",
    "14": "set_add             0      0      0     ",
    "15": "table_next          1      2      0     ",
    "16": "free                1      0      0     ",
    "17": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test where data < 1;
[[2, 0]]
explain select * from test where id < 1;
[{
  "main": {
    "00": "send_all            0      0      18    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      16    # test (primary)",
    "02": "table_readi32       2      1      -     # id",
    "03": "int                 3      -      0     # 1",
    "04": "ltii                4      2      3     ",
    "05": "jntr                16     4      0     ",
    "06": "table_readi32       2      1      -     # id",
    "07": "int                 3      -      0     # 1",
    "08": "ltii                4      2      3     ",
    "09": "jntr                15     4      0     ",
    "10": "table_readi32       2      1      -     # id",
    "11": "push                2      0      0     ",
    "12": "table_readi32       2      1      -     # data",
    "13": "push                2      0      0     ",
    "14": "set_add             0      0      0     ",
    "15": "table_next          1      2      0     ",
    "16": "free                1      0      0     ",
    "17": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test where id < 1;
[[0, 2]]
explain select * from test where id < 1 and data < 2;
[{
  "main": {
    "00": "send_all            0      0      18    # test (select, closing)",
    "01": "union               1      0      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set                 0      2      0     ",
    "01": "table_open_part     1      0      20    # test (primary)",
    "02": "table_readi32       2      1      -     # id",
    "03": "int                 3      -      0     # 1",
    "04": "ltii                4      2      3     ",
    "05": "jntr                20     4      0     ",
    "06": "table_readi32       2      1      -     # id",
    "07": "int                 3      -      0     # 1",
    "08": "ltii                4      2      3     ",
    "09": "table_readi32       2      1      -     # data",
    "10": "int                 3      -      0     # 2",
    "11": "ltii                5      2      3     ",
    "12": "and                 2      4      5     ",
    "13": "jntr                19     2      0     ",
    "14": "table_readi32       2      1      -     # id",
    "15": "push                2      0      0     ",
    "16": "table_readi32       2      1      -     # data",
    "17": "push                2      0      0     ",
    "18": "set_add             0      0      0     ",
    "19": "table_next          1      2      0     ",
    "20": "free                1      0      0     ",
    "21": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select * from test where id < 1 and data < 2;
[]
drop table test;
disconnect S0;
close E0;
