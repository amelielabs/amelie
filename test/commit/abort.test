#

env_open E0 "cluster_shards": 3
connect E0 S0

# test: abort
explain abort
abort

# test: insert abort by error
create table test (id int primary key, data int default 0)

insert into test (id) values (0), (1), (2), (3), (1)
select * from test

# test: insert abort by error #2
insert into test (id) values (0), (1), (2), (3)
select * from test

# test: insert abort by error #3
insert into test (id) values (4), (5), (1), (6)
select * from test

# test: insert abort by error #4
insert into test (id) values (4), (5), (1), (6); abort
select * from test

# test: replace abort
explain replace into test values (0, 1), (1, 1), (2, 1), (3, 1); abort
replace into test values (0, 1), (1, 1), (2, 1), (3, 1); abort
select * from test

# test: delete abort
explain delete from test; abort
delete from test; abort
select * from test

# test: update abort
explain update test set data = id; abort
update test set data = id; abort
select * from test

# test: upsert abort
explain insert into test values(1, 0) on conflict do update set data = id; abort
insert into test values(1, 0) on conflict do update set data = id; abort
select * from test
drop table test

# test: reference insert abort by error
create table test (id int primary key, data int default 0) reference

insert into test (id) values (0), (1), (2), (3), (1)
select * from test

# test: reference insert abort by error #2
insert into test (id) values (0), (1), (2), (3)
select * from test

# test: reference insert abort by error #3
insert into test (id) values (4), (5), (1), (6)
select * from test

# test: reference insert abort by error #4
insert into test (id) values (4), (5), (1), (6); abort
select * from test

# test: reference replace abort
explain replace into test values (0, 1), (1, 1), (2, 1), (3, 1); abort
replace into test values (0, 1), (1, 1), (2, 1), (3, 1); abort
select * from test

# test: reference delete abort
explain delete from test; abort
delete from test; abort
select * from test

# test: reference update abort
explain update test set data = id; abort
update test set data = id; abort
select * from test

# test: reference upsert abort
explain insert into test values(1, 0) on conflict do update set data = id; abort
insert into test values(1, 0) on conflict do update set data = id; abort
select * from test
drop table test

disconnect S0
env_close E0
