open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }], "backends": 3
connect E0 S0 127.0.0.1:3485
# test: select from table
create table test (id int primary key, data int default 0)
insert into test (id) values (1), (2), (3)
explain select * from test
[{
  "bytecode": {
    "frontend": {
      "00": "union               0      0      0     ",
      "01": "send_all            0      -      0     # public.test",
      "02": "union_recv          0      0      0     ",
      "03": "union_set           0      0      -1    ",
      "04": "content             0      -      -     ",
      "05": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set                 0      2      0     ",
      "01": "table_open_part     1      0      8     # public.test (primary)",
      "02": "table_readi32       2      1      0     ",
      "03": "push                2      0      0     ",
      "04": "table_readi32       2      1      1     ",
      "05": "push                2      0      0     ",
      "06": "set_add             0      0      0     ",
      "07": "table_next          1      2      0     ",
      "08": "free                1      0      0     ",
      "09": "result              0      0      0     ",
      "10": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select * from test
[[1, 0], [3, 0], [2, 0]]
# test: select from table where
explain select * from test where id > 1
[{
  "bytecode": {
    "frontend": {
      "00": "union               0      0      0     ",
      "01": "send_all            0      -      0     # public.test",
      "02": "union_recv          0      0      0     ",
      "03": "union_set           0      0      -1    ",
      "04": "content             0      -      -     ",
      "05": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "table_open_part     1      0      14    # public.test (primary)",
      "04": "table_readi32       2      1      0     ",
      "05": "int                 3      -      0     # 1",
      "06": "gtii                4      2      3     ",
      "07": "jntr                13     4      0     ",
      "08": "table_readi32       2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "table_readi32       2      1      1     ",
      "11": "push                2      0      0     ",
      "12": "set_add             0      0      0     ",
      "13": "table_next          1      4      0     ",
      "14": "free                1      0      0     ",
      "15": "result              0      0      0     ",
      "16": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select * from test where id > 1
[[3, 0], [2, 0]]
select * from test where id > 2
[[3, 0]]
select * from test where id > 3
[]
# test: select from table where point lookup
explain select * from test where id = 1
[{
  "bytecode": {
    "frontend": {
      "00": "union               0      0      0     ",
      "01": "send_lookup         0      -      -     # public.test",
      "02": "union_recv          0      0      0     ",
      "03": "union_set           0      0      -1    ",
      "04": "content             0      -      -     ",
      "05": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set                 0      2      0     ",
      "01": "int                 1      -      0     # 1",
      "02": "push                1      0      0     ",
      "03": "table_open_partl    1      0      13    # public.test (primary)",
      "04": "table_readi32       2      1      0     ",
      "05": "int                 3      -      0     # 1",
      "06": "equii               4      2      3     ",
      "07": "jntr                13     4      0     ",
      "08": "table_readi32       2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "table_readi32       2      1      1     ",
      "11": "push                2      0      0     ",
      "12": "set_add             0      0      0     ",
      "13": "free                1      0      0     ",
      "14": "result              0      0      0     ",
      "15": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select * from test where id = 1
[[1, 0]]
select * from test where id = 2
[[2, 0]]
select * from test where id = 3
[[3, 0]]
select * from test where id = 4
[]
select * from test where id = 0
[]
# test: select (select expr) from table
select (select test.id) from test
[1, 3, 2]
# test: select (select (select expr)) from table
explain select (select (select (test.id))) from test
[{
  "bytecode": {
    "frontend": {
      "00": "union               0      0      0     ",
      "01": "send_all            0      -      0     # public.test",
      "02": "union_recv          0      0      0     ",
      "03": "union_set           0      0      -1    ",
      "04": "content             0      -      -     ",
      "05": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set                 0      1      0     ",
      "01": "table_open_part     1      0      6     # public.test (primary)",
      "02": "table_readi32       2      1      0     ",
      "03": "push                2      0      0     ",
      "04": "set_add             0      0      0     ",
      "05": "table_next          1      2      0     ",
      "06": "free                1      0      0     ",
      "07": "result              0      0      0     ",
      "08": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select (select (select (test.id))) from test
[1, 3, 2]
explain select (select (select test.id)) from test
[{
  "bytecode": {
    "frontend": {
      "00": "union               0      0      0     ",
      "01": "send_all            0      -      0     # public.test",
      "02": "union_recv          0      0      0     ",
      "03": "union_set           0      0      -1    ",
      "04": "content             0      -      -     ",
      "05": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set                 0      1      0     ",
      "01": "table_open_part     1      0      6     # public.test (primary)",
      "02": "table_readi32       2      1      0     ",
      "03": "push                2      0      0     ",
      "04": "set_add             0      0      0     ",
      "05": "table_next          1      2      0     ",
      "06": "free                1      0      0     ",
      "07": "result              0      0      0     ",
      "08": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select (select (select test.id)) from test
[1, 3, 2]
# test: select (select (select from table)) from table
explain select (select (select id from test t)) from test
[{
  "bytecode": {
    "frontend": {
      "00": "union               0      0      0     ",
      "01": "send_all            0      -      0     # public.test",
      "02": "union_recv          0      0      0     ",
      "03": "union_set           0      0      -1    ",
      "04": "content             0      -      -     ",
      "05": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set                 0      1      0     ",
      "01": "table_open_part     1      0      13    # public.test (primary)",
      "02": "set                 2      1      0     ",
      "03": "table_open          3      20     8     # public.test (primary)",
      "04": "table_readi32       4      3      0     ",
      "05": "push                4      0      0     ",
      "06": "set_add             2      0      0     ",
      "07": "table_next          3      4      0     ",
      "08": "free                3      0      0     ",
      "09": "set_result          3      2      0     ",
      "10": "push                3      0      0     ",
      "11": "set_add             0      0      0     ",
      "12": "table_next          1      2      0     ",
      "13": "free                1      0      0     ",
      "14": "result              0      0      0     ",
      "15": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro_exclusive"]]
}]
# test: select (select (select from table)) from table
create table ref (id int primary key, data int default 0)
insert into ref (id) values (1), (2), (3)
explain select (select (select id from ref)) from test
[{
  "bytecode": {
    "frontend": {
      "00": "union               0      0      0     ",
      "01": "send_all            0      -      0     # public.test",
      "02": "union_recv          0      0      0     ",
      "03": "union_set           0      0      -1    ",
      "04": "content             0      -      -     ",
      "05": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set                 0      1      0     ",
      "01": "table_open_part     1      0      13    # public.test (primary)",
      "02": "set                 2      1      0     ",
      "03": "table_open          3      20     8     # public.ref (primary)",
      "04": "table_readi32       4      3      0     ",
      "05": "push                4      0      0     ",
      "06": "set_add             2      0      0     ",
      "07": "table_next          3      4      0     ",
      "08": "free                3      0      0     ",
      "09": "set_result          3      2      0     ",
      "10": "push                3      0      0     ",
      "11": "set_add             0      0      0     ",
      "12": "table_next          1      2      0     ",
      "13": "free                1      0      0     ",
      "14": "result              0      0      0     ",
      "15": "ret                 0      0      0     "
    }
  },
  "access": [["public.ref", "ro_exclusive"], ["public.test", "ro"]]
}]
select (select (select id from ref)) from test
[1, 1, 1]
# test: select from table where (select from table)
explain select * from test where (select * from test t)
{"msg": "explain select * from test where (❰select❱ ⟵ subquery must return only one column"}
explain select * from test where (select id from test t)
[{
  "bytecode": {
    "frontend": {
      "00": "union               0      0      0     ",
      "01": "send_all            0      -      0     # public.test",
      "02": "union_recv          0      0      0     ",
      "03": "union_set           0      0      -1    ",
      "04": "content             0      -      -     ",
      "05": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set                 0      2      0     ",
      "01": "table_open_part     1      0      17    # public.test (primary)",
      "02": "set                 2      1      0     ",
      "03": "table_open          3      20     8     # public.test (primary)",
      "04": "table_readi32       4      3      0     ",
      "05": "push                4      0      0     ",
      "06": "set_add             2      0      0     ",
      "07": "table_next          3      4      0     ",
      "08": "free                3      0      0     ",
      "09": "set_result          3      2      0     ",
      "10": "jntr                16     3      0     ",
      "11": "table_readi32       2      1      0     ",
      "12": "push                2      0      0     ",
      "13": "table_readi32       2      1      1     ",
      "14": "push                2      0      0     ",
      "15": "set_add             0      0      0     ",
      "16": "table_next          1      2      0     ",
      "17": "free                1      0      0     ",
      "18": "result              0      0      0     ",
      "19": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro_exclusive"]]
}]
# test: select from table where (select from table)
explain select * from test where (select id from ref)
[{
  "bytecode": {
    "frontend": {
      "00": "union               0      0      0     ",
      "01": "send_all            0      -      0     # public.test",
      "02": "union_recv          0      0      0     ",
      "03": "union_set           0      0      -1    ",
      "04": "content             0      -      -     ",
      "05": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set                 0      2      0     ",
      "01": "table_open_part     1      0      17    # public.test (primary)",
      "02": "set                 2      1      0     ",
      "03": "table_open          3      20     8     # public.ref (primary)",
      "04": "table_readi32       4      3      0     ",
      "05": "push                4      0      0     ",
      "06": "set_add             2      0      0     ",
      "07": "table_next          3      4      0     ",
      "08": "free                3      0      0     ",
      "09": "set_result          3      2      0     ",
      "10": "jntr                16     3      0     ",
      "11": "table_readi32       2      1      0     ",
      "12": "push                2      0      0     ",
      "13": "table_readi32       2      1      1     ",
      "14": "push                2      0      0     ",
      "15": "set_add             0      0      0     ",
      "16": "table_next          1      2      0     ",
      "17": "free                1      0      0     ",
      "18": "result              0      0      0     ",
      "19": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"], ["public.ref", "ro_exclusive"]]
}]
select * from test where (select id from ref)
[[1, 0], [3, 0], [2, 0]]
# test: select from table where exists (select from table)
explain select * from test where exists (select 1 from ref where test.id = ref.id)
[{
  "bytecode": {
    "frontend": {
      "00": "union               0      0      0     ",
      "01": "send_all            0      -      0     # public.test",
      "02": "union_recv          0      0      0     ",
      "03": "union_set           0      0      -1    ",
      "04": "content             0      -      -     ",
      "05": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set                 0      2      0     ",
      "01": "table_open_part     1      0      22    # public.test (primary)",
      "02": "set                 2      1      0     ",
      "03": "table_readi32       3      1      0     ",
      "04": "push                3      0      0     ",
      "05": "table_openl         3      20     13    # public.ref (primary)",
      "06": "table_readi32       4      1      0     ",
      "07": "table_readi32       5      3      0     ",
      "08": "equii               6      4      5     ",
      "09": "jntr                13     6      0     ",
      "10": "int                 4      -      0     # 1",
      "11": "push                4      0      0     ",
      "12": "set_add             2      0      0     ",
      "13": "free                3      0      0     ",
      "14": "exists              3      2      0     ",
      "15": "jntr                21     3      0     ",
      "16": "table_readi32       2      1      0     ",
      "17": "push                2      0      0     ",
      "18": "table_readi32       2      1      1     ",
      "19": "push                2      0      0     ",
      "20": "set_add             0      0      0     ",
      "21": "table_next          1      2      0     ",
      "22": "free                1      0      0     ",
      "23": "result              0      0      0     ",
      "24": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"], ["public.ref", "ro_exclusive"]]
}]
select * from test where exists (select 1 from ref where test.id = ref.id)
[[1, 0], [3, 0], [2, 0]]
drop table ref
drop table test
disconnect S0
close E0
