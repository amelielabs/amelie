open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }]
# test: POST / (text/plain)
connect E0 S0 localhost:3485
import text/plain select 1
[1]
# test: POST / (application/json) unsupported
import application/json [1]
{"msg": "unsupported API operation"}
disconnect S0
# test: POST /invalid
connect E0 S0 http://localhost:3485/abc
import text/plain select 1
{"msg": "unsupported API target path"}
disconnect S0
# test: POST /schema/table (text/plain)
connect E0 S0 http://localhost:3485/abc/cba/abc
import text/plain select 1
{"msg": "table 'cba/abc': not exists"}
disconnect S0
# test: POST /schema/table (text/plain) not exists
connect E0 S0 http://localhost:3485/public/test
import text/plain select 1
{"msg": "table 'test': not exists"}
disconnect S0
connect E0 S0 http://localhost:3485
create table test (id int primary key, a int, b int)
create table test2 (obj object, primary key(obj.id int))
create table test3 (id int primary key, ts timestamp, iv interval, vec vector, agg agg(sum))
disconnect S0
# test: POST /schema/table (text/plain) unsupported
connect E0 S0 http://localhost:3485/public/test
import text/plain select 1
{"msg": "unsupported API operation"}
disconnect S0
# test: POST /schema/table (text/csv)
connect E0 S0 http://localhost:3485/public/test
import text/csv 0,0,0
import text/csv 1,0,0
import text/csv 2,0,0
disconnect S0
connect E0 Sx http://localhost:3485/
select * from test
[[0, 0, 0], [1, 0, 0], [2, 0, 0]]
disconnect Sx
# test: POST /schema/table (text/csv) column list
connect E0 S0 http://localhost:3485/public/test?columns=id
import text/csv 3
import text/csv 4
import text/csv 5
disconnect S0
connect E0 S0 http://localhost:3485/public/test?columns=id,a
import text/csv 6,0
disconnect S0
connect E0 Sx http://localhost:3485/
select * from test
[[0, 0, 0], [1, 0, 0], [2, 0, 0], [3, null, null], [4, null, null], [5, null, null], [6, 0, null]]
disconnect Sx
# test: POST /schema/table (application/jsonl)
connect E0 S0 http://localhost:3485/public/test
import application/jsonl [7,0,0][8,0,0][9,0,0]
import application/jsonl [10,0,0][11,
{"msg": "column <a> value expected to be 'int'"}
import application/jsonl [[10,0,0], [11,0,0]]
{"msg": "column <id> value expected to be 'int'"}
import application/jsonl 
disconnect S0
connect E0 Sx http://localhost:3485/
select * from test
[[0, 0, 0], [1, 0, 0], [2, 0, 0], [3, null, null], [4, null, null], [5, null, null], [6, 0, null], [7, 0, 0], [8, 0, 0], [9, 0, 0]]
disconnect Sx
# test: POST /schema/table (application/jsonl) one column
connect E0 S0 http://localhost:3485/public/test2
import application/jsonl [{"id":1}] [{"id":2}]
import application/jsonl {"id":3}{"id":4}
disconnect S0
connect E0 S0 http://localhost:3485/public/test2?columns=obj
import application/jsonl {"id":5}{"id":6}
disconnect S0
connect E0 Sx http://localhost:3485/
select * from test2
[[{
  "id": 1
}], [{
  "id": 2
}], [{
  "id": 3
}], [{
  "id": 4
}], [{
  "id": 5
}], [{
  "id": 6
}]]
disconnect Sx
# test: POST /schema/table (application/json)
connect E0 S0 http://localhost:3485/public/test
import application/json [[10,0,0], [11,0,0]]
import application/json 
{"msg": "JSON array expected"}
import application/json []
{"msg": "JSON array expected"}
import application/json {}
{"msg": "JSON array expected"}
disconnect S0
connect E0 Sx http://localhost:3485/
select * from test
[[0, 0, 0], [1, 0, 0], [2, 0, 0], [3, null, null], [4, null, null], [5, null, null], [6, 0, null], [7, 0, 0], [8, 0, 0], [9, 0, 0], [10, 0, 0], [11, 0, 0]]
disconnect Sx
# test: POST /schema/table (application/json) one column
connect E0 S0 http://localhost:3485/public/test2
import application/json [{"id":7}, {"id":8}]
disconnect S0
connect E0 S0 http://localhost:3485/public/test2?columns=obj
import application/json [{"id":9}{"id":10}]
{"msg": "failed to parse JSON array"}
import application/json [{"id":9}, {"id":10}]
disconnect S0
connect E0 Sx http://localhost:3485/
select * from test2
[[{
  "id": 1
}], [{
  "id": 2
}], [{
  "id": 3
}], [{
  "id": 4
}], [{
  "id": 5
}], [{
  "id": 6
}], [{
  "id": 7
}], [{
  "id": 8
}], [{
  "id": 9
}], [{
  "id": 10
}]]
disconnect Sx
# test: POST /schema/table (auto casting)
connect E0 S0 http://localhost:3485/public/test3
import application/json [ [0, "1970-01-01 00:00:00.001000", "1 hour 5 minutes 6 seconds", [1,2,3], 42] ]
disconnect S0
connect E0 Sx http://localhost:3485/
select * from test3
[[0, "1970-01-01 00:00:00.001+00", "1 hour 5 minutes 6 seconds", [1, 2, 3], 42]]
disconnect Sx
close E0
