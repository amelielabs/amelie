#

open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }]
connect E0 S0 127.0.0.1:3485

# test: if parsing
if
if 1
if 1 do
if 1 then
if 1 then 1
if 1 then select 1
if 1 then select 1;

# test: if
explain if 1 then select 123; end
if 1 then select 123; end

# test: if empty
explain if 1 then end
if 1 then end

# test: if else parsing
if 1 then select 123; else
if 1 then select 123; else 1
if 1 then select 123; else else
if 1 then select 123; else select 321;

# test: if else
explain if 1 then select 123; else select 321; end
if 1 then select 123; else select 321; end

# test: if else else
if 1 then select 123; else select 321; else select 432; end

# test: if elsif parsing
if 1 then select 123; elsif
if 1 then select 123; elsif 2
if 1 then select 123; elsif 2 then
if 1 then select 123; elsif 2 then 1
if 1 then select 123; elsif 2 then select 321
if 1 then select 123; elsif 2 then select 321;

# test: if elsif
explain if 1 then select 123; elsif 2 then select 321; end
if 1 then select 123; elsif 2 then select 321; end

# test: if elsif elsif
explain if 1 then select 123; elsif 2 then select 321; elsif 3 then select 821; end
if 1 then select 123; elsif 2 then select 321; elsif 3 then select 821; end

# test: if elsif else
if 1 then select 123; elsif 2 then select 321; else
if 1 then select 123; elsif 2 then select 321; else 1

explain if 1 then select 123; elsif 2 then select 321; else select 821; end
if 1 then select 123; elsif 2 then select 321; else select 821; end

# test: if elsif elsif else
explain if 1 then select 123; elsif 2 then select 321; elsif 3 then select 821; else select 0; end
if 1 then select 123; elsif 2 then select 321; elsif 3 then select 821; else select 0; end

# test: if if
explain declare x int := 0; if 1 then if 2 then x:= 2; end; end; select x
declare x int := 0; if 1 then if 2 then x:= 2; end; end; select x

# test: if if else
explain declare x int := 0; if 1 then if 0 then x:= 2; else x := 3; end; end; select x
declare x int := 0; if 1 then if 0 then x:= 2; else x := 3; end; end; select x

# test: if if else else
explain declare x int := 0; if 1 then if 0 then x:= 2; else x := 3; end; else x:= 4; end; select x
declare x int := 0; if 1 then if 0 then x:= 2; else x := 3; end; else x:= 4; end; select x
declare x int := 0; if 0 then if 0 then x:= 2; else x := 3; end; else x:= 4; end; select x
declare x int := 0; if 0 then if 0 then x:= 2; end; else x:= 4; end; select x

# test: if insert
create table test (id int primary key)
explain if true then; insert into test values (1); insert into test values (2); end;
if true then; insert into test values (1); insert into test values (2); end;
drop table test

# test: if insert if insert select
create table test (id int primary key)
explain if true then; insert into test values (1); end; if false then insert into test values (2); end; select * from test
if true then; insert into test values (1); end; if false then insert into test values (2); end; select * from test
delete from test
if false then; insert into test values (1); end; if true then insert into test values (2); end; select * from test
drop table test

# test: if insert else insert
create table test (id int primary key)
explain if true then; insert into test values (1); else insert into test values (2); end; select * from test
if true then; insert into test values (1); else insert into test values (2); end; select * from test
if false then; insert into test values (1); else insert into test values (2); end; select * from test
drop table test

# test: if insert elsif insert else insert
create table test (id int primary key)
explain declare x int := 0; if x = 0 then; insert into test values (0); elsif x = 1 then insert into test values (1); else insert into test values (2); end; select * from test
declare x int := 0; if x = 0 then; insert into test values (0); elsif x = 1 then insert into test values (1); else insert into test values (2); end; select * from test
declare x int := 1; if x = 0 then; insert into test values (0); elsif x = 1 then insert into test values (1); else insert into test values (2); end; select * from test
declare x int := 2; if x = 0 then; insert into test values (0); elsif x = 1 then insert into test values (1); else insert into test values (2); end; select * from test
drop table test

# test: if insert returning
create table test (id int primary key)
explain declare x int := 0; if true then; x := insert into test values (123) returning *; end; select x
declare x int := 0; if true then; x := insert into test values (123) returning *; end; select x
drop table test

# test: if select
create table test (id int primary key)
insert into test values (123)
explain declare x int := 0; if true then x := select * from test; end; select x
declare x int := 0; if true then x := select * from test; end; select x

explain declare x int := 0; if true then x := select count(*) from test; end; select x
declare x int := 0; if true then x := select count(*) from test; end; select x

explain declare x int := 0; if false then else x := select count(*) from test; end; select x
declare x int := 0; if false then else x := select count(*) from test; end; select x

explain declare x int := 0; if false then else x := select count(*) from test; end; select 1; select x
declare x int := 0; if false then else x := select count(*) from test; end; select 1; select x

explain declare x int := 0; if false then else x := select count(*) from test; end; select * from test; select x
declare x int := 0; if false then else x := select count(*) from test; end; select * from test; select x

explain declare x int := 0; if true then if false then x := select * from test; end; end; select x
declare x int := 0; if true then if false then x := select * from test; end; end; select x
drop table test

# test: if declare
explain if true then declare x int := 10; end
if true then declare x int := 10; end

explain if true then declare x int := 10; else declare x int := 20; end
if true then declare x int := 10; else declare x int := 20; end
if true then declare x int := 10; else declare x int := 20; end; select x

# test: if declare shadow
declare x int := 2; if true then declare x int := 10; else declare x int := 20; end; select x

# test: if utility
if true then show all; end

# test: cte if
with a as (if true then end) select 1
with a as (select 1) if true then end

disconnect S0
close E0
