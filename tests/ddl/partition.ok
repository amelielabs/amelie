open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }];
connect E0 S0 127.0.0.1:3485;
# test: alter partition statement parsing
alter partition;
{"msg": "alter partition❰;❱ ⟵ int expected"}
alter partition xyz;
{"msg": "alter partition ❰xyz❱ ⟵ int expected"}
alter partition 1;
{"msg": "alter partition 1❰;❱ ⟵ ON expected"}
alter partition 1 on;
{"msg": "alter partition 1 on❰;❱ ⟵ name expected"}
alter partition 1 on xyz;
{"msg": "alter partition 1 on xyz❰;❱ ⟵ command expected"}
alter partition 1 on xyz qwerty;
{"msg": "alter partition 1 on xyz ❰qwerty❱ ⟵ unknown command"}
# test: alter partition refresh
create table test (id int primary key) partitions 1
        tier main using main (id "00000000-0000-0000-0000-000000000000");
show partitions on test;
[{
  "id": 1,
  "tier": "main",
  "storage": "main",
  "ram": true,
  "pending": false,
  "min": 0,
  "max": 8096,
  "lsn": 0,
  "size": 0,
  "compression": 1
}]
insert into test values (123);
alter partition 1 on test refresh;
show partitions on test;
[{
  "id": 2,
  "tier": "main",
  "storage": "main",
  "ram": true,
  "pending": false,
  "min": 0,
  "max": 8096,
  "lsn": 2,
  "size": 524288,
  "compression": 1
}]
# test: alter partition move
create storage b;
alter tier main on test add storage b (id "00000000-0000-0000-0000-000000000001");
show tiers on test;
[{
  "name": "main",
  "compression": "zstd",
  "compression_level": 0,
  "region_size": 65536,
  "object_size": 67108864,
  "storages": [{
    "name": "main",
    "id": "00000000-0000-0000-0000-000000000000",
    "pause": false,
    "partitions": 1
  }, {
    "name": "b",
    "id": "00000000-0000-0000-0000-000000000001",
    "pause": false,
    "partitions": 0
  }]
}]
show partitions on test;
[{
  "id": 2,
  "tier": "main",
  "storage": "main",
  "ram": true,
  "pending": false,
  "min": 0,
  "max": 8096,
  "lsn": 2,
  "size": 524288,
  "compression": 1
}]
alter partition 2 on test move;
{"msg": "alter partition 2 on test move❰;❱ ⟵ TO expected"}
alter partition 2 on test move to;
{"msg": "alter partition 2 on test move to❰;❱ ⟵ name expected"}
alter partition 2 on test move to b;
show partitions on test;
[{
  "id": 3,
  "tier": "main",
  "storage": "b",
  "ram": true,
  "pending": false,
  "min": 0,
  "max": 8096,
  "lsn": 2,
  "size": 524288,
  "compression": 1
}]
# test: alter partition move (same partition)
alter partition 3 on test move to b;
show partitions on test;
[{
  "id": 4,
  "tier": "main",
  "storage": "b",
  "ram": true,
  "pending": false,
  "min": 0,
  "max": 8096,
  "lsn": 2,
  "size": 524288,
  "compression": 1
}]
# test: alter partition move (storage not exists)
alter partition 4 on test move to c;
{"msg": "partition or tier storage not found"}
drop table test;
disconnect S0;
close E0;
