open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }];
connect E0 S0 127.0.0.1:3485;
# test: alter partition statement parsing
alter partition;
{"msg": "alter partition❰;❱ ⟵ int expected"}
alter partition xyz;
{"msg": "alter partition ❰xyz❱ ⟵ int expected"}
alter partition 1;
{"msg": "alter partition 1❰;❱ ⟵ ON expected"}
alter partition 1 on;
{"msg": "alter partition 1 on❰;❱ ⟵ name expected"}
alter partition 1 on xyz;
{"msg": "alter partition 1 on xyz❰;❱ ⟵ command expected"}
alter partition 1 on xyz qwerty;
{"msg": "alter partition 1 on xyz ❰qwerty❱ ⟵ unknown command"}
create storage a;
create storage b;
create storage c;
create table test (id int primary key, a int, b int) partitions 5
    on storage
       a (id "00000000-0000-0000-0000-000000000000"),
       b (id "00000000-0000-0000-0000-000000000001"),
       c (id "00000000-0000-0000-0000-000000000002");
show partitions on test;
[{
  "id": 1,
  "storage": "a",
  "min": 0,
  "max": 1638,
  "lsn": 0,
  "size": 0,
  "compression": 1
}, {
  "id": 2,
  "storage": "b",
  "min": 1638,
  "max": 3276,
  "lsn": 0,
  "size": 0,
  "compression": 1
}, {
  "id": 3,
  "storage": "c",
  "min": 3276,
  "max": 4914,
  "lsn": 0,
  "size": 0,
  "compression": 1
}, {
  "id": 4,
  "storage": "a",
  "min": 4914,
  "max": 6552,
  "lsn": 0,
  "size": 0,
  "compression": 1
}, {
  "id": 5,
  "storage": "b",
  "min": 6552,
  "max": 8192,
  "lsn": 0,
  "size": 0,
  "compression": 1
}]
alter partition 1 on test refresh;
show partitions on test;
[{
  "id": 6,
  "storage": "c",
  "min": 0,
  "max": 1638,
  "lsn": 0,
  "size": 0,
  "compression": 1
}, {
  "id": 2,
  "storage": "b",
  "min": 1638,
  "max": 3276,
  "lsn": 0,
  "size": 0,
  "compression": 1
}, {
  "id": 3,
  "storage": "c",
  "min": 3276,
  "max": 4914,
  "lsn": 0,
  "size": 0,
  "compression": 1
}, {
  "id": 4,
  "storage": "a",
  "min": 4914,
  "max": 6552,
  "lsn": 0,
  "size": 0,
  "compression": 1
}, {
  "id": 5,
  "storage": "b",
  "min": 6552,
  "max": 8192,
  "lsn": 0,
  "size": 0,
  "compression": 1
}]
show partition '6' on test;
[{
  "id": 6,
  "storage": "c",
  "min": 0,
  "max": 1638,
  "lsn": 0,
  "size": 0,
  "compression": 1
}]
# test: alter partition move
alter partition 6 on test move to b;
show partition '8' on test;
[{
  "id": 8,
  "storage": "b",
  "min": 0,
  "max": 1638,
  "lsn": 0,
  "size": 0,
  "compression": 1
}]
# test: alter partition move (same partition)
alter partition 8 on test move to b;
show partition '10' on test;
[{
  "id": 10,
  "storage": "b",
  "min": 0,
  "max": 1638,
  "lsn": 0,
  "size": 0,
  "compression": 1
}]
# test: alter partition move (storage not exists)
alter partition 10 on test move to xyz;
{"msg": "partition or tier storage not found"}
show partition '10' on test;
[{
  "id": 10,
  "storage": "b",
  "min": 0,
  "max": 1638,
  "lsn": 0,
  "size": 0,
  "compression": 1
}]
show partition '12' on test;
[null]
drop table test;
drop storage a;
drop storage b;
drop storage c;
disconnect S0;
close E0;
