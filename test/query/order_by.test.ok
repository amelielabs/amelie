env_open E0
connect E0 S0
connect: on_connect
# test: order by []
select * from [1,3,2] order
query: on_error
{"code": 1, "msg": "ORDER <BY> expected"}
select * from [1,3,2] order by
query: on_error
{"code": 1, "msg": "bad expression"}
select * from [1,3,2] order by * int
1
2
3
explain select * from [1,3,2] order by * int
"
bytecode [coordinator]
--------
 0         set_ordered        0      0      0
 1                 int        1      1      0
 2                push        1      0      0
 3                 int        1      3      0
 4                push        1      0      0
 5                 int        1      2      0
 6                push        1      0      0
 7               array        1      3      0
 8    cursor_open_expr        0      1     10
 9                 jmp       15      0      0
10         cursor_read        2      0      0
11         cursor_read        3      0      0
12                push        3      0      0
13             set_add        0      2      0
14         cursor_next        0     10      0
15        cursor_close        0      0      0
16            set_sort        0      0      0
17            send_set        0      0      0
18                 ret        0      0      0

"
select * from 1 order by * int
query: on_error
{"code": 1, "msg": "FROM: array, map or data type expected"}
select * from 1 order by * string
query: on_error
{"code": 1, "msg": "FROM: array, map or data type expected"}
select (select * from [1,3,2] order by * int)
[1, 2, 3]
select * from (select * from [1,3,2] order by * int)
1
2
3
# test: order by {}
select * from {"a": 1, "b": 3, "c": 2} order by * int
1
2
3
select (select * from {"a": 1, "b": 3, "c": 2} order by * int)
[1, 2, 3]
select * from (select * from {"a": 1, "b": 3, "c": 2} order by * int)
1
2
3
select **, * from {"a": 1, "b": 3, "c": 2} order by ** string
["a", 1]
["b", 3]
["c", 2]
select **, * from {"b": 3, "a": 1, "c": 2} order by ** string
["a", 1]
["b", 3]
["c", 2]
# test: order by asc
select * from [1,3,2] order by * int asc
1
2
3
# test: order by desc
select * from [1,3,2] order by * int desc
3
2
1
# test: order by column
create table test (id int primary key, data int)
insert into test values (1, 1)
insert into test values (2, 3)
insert into test values (3, 2)
explain select * from test order by data
"
bytecode [coordinator]
--------
 0                recv        0      0      0
 1               merge        0      0     -1
 2            send_set        0      0      0
 3                 ret        0      0      0


bytecode [shard 0]
--------
 0         set_ordered        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      4      5      # public.test (primary)
 4                 jmp       10      0      0
 5         cursor_read        1      0      0
 6          cursor_idx        2      0      1
 7                push        2      0      0
 8             set_add        0      1      0
 9         cursor_next        0      5      0
10        cursor_close        0      0      0
11            set_sort        0      0      0
12               ready        0      0      0
13                 ret        0      0      0

"
select * from test order by data
[1, 1]
[3, 2]
[2, 3]
# test: order by column asc
select * from test order by data asc
[1, 1]
[3, 2]
[2, 3]
# test: order by column desc
select * from test order by data desc
[2, 3]
[3, 2]
[1, 1]
# test: order by column type
select * from test order by data int
[1, 1]
[3, 2]
[2, 3]
select * from test order by data int asc
[1, 1]
[3, 2]
[2, 3]
# test: order by target.column
select * from test order by test.data
[1, 1]
[3, 2]
[2, 3]
select * from test order by test.data int
[1, 1]
[3, 2]
[2, 3]
select * from test order by test
query: on_error
{"code": 1, "msg": "ORDER BY expr <type> expected as int or string"}
# test: order by alias.column
select * from test alias order by alias.data
[1, 1]
[3, 2]
[2, 3]
select * from test alias order by alias.data int
[1, 1]
[3, 2]
[2, 3]
# test: order by compound
select * from test order by data, id
[1, 1]
[3, 2]
[2, 3]
select * from test order by data desc, id
[2, 3]
[3, 2]
[1, 1]
select * from test order by id, data
[1, 1]
[2, 3]
[3, 2]
select * from test order by id desc, data
[3, 2]
[2, 3]
[1, 1]
drop table test
disconnect S0
env_close E0
