open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }]
connect E0 S0 localhost:3485
# test: create table statement parsing
create
{"msg": "CREATE <USER|REPLICA|NODE|SCHEMA|TABLE|INDEX|VIEW> expected"}
create junk
{"msg": "CREATE <USER|REPLICA|NODE|SCHEMA|TABLE|INDEX|VIEW> expected"}
create unique
{"msg": "CREATE UNIQUE <INDEX> expected"}
create unique table
{"msg": "CREATE UNIQUE <INDEX> expected"}
create table
{"msg": "CREATE TABLE <name> expected"}
create table "junk_name"
{"msg": "CREATE TABLE <name> expected"}
create table if
{"msg": "IF <NOT> EXISTS expected"}
create table if not
{"msg": "IF NOT <EXISTS> expected"}
create table if not exists
{"msg": "CREATE TABLE <name> expected"}
create table 1234
{"msg": "CREATE TABLE <name> expected"}
create table test(
{"msg": "(<name> expected"}
create table test(0
{"msg": "(<name> expected"}
create table test("123"
{"msg": "(<name> expected"}
create table test(name
{"msg": "name <TYPE> expected"}
create table test(name junk_type
{"msg": "name <TYPE> expected"}
create table test(name int
{"msg": "CREATE TABLE name (name type <,)> expected"}
create table test(name int,
{"msg": "(<name> expected"}
create table test(name int,)
{"msg": "(<name> expected"}
create table if not exists 1234
{"msg": "CREATE TABLE <name> expected"}
create table if not exists test(
{"msg": "(<name> expected"}
create table if not exists test(0
{"msg": "(<name> expected"}
create table if not exists test("123"
{"msg": "(<name> expected"}
create table if not exists test(name
{"msg": "name <TYPE> expected"}
create table if not exists test(name junk_type
{"msg": "name <TYPE> expected"}
create table if not exists test(name int
{"msg": "CREATE TABLE name (name type <,)> expected"}
create table test(name int) junk
{"msg": "primary key is not defined"}
create table test()
{"msg": "(<name> expected"}
# test: column int/integer
create table test(id int primary key, id2 integer)
select columns from system.tables() where name = "test"
[[{
  "name": "id",
  "type": "int",
  "constraint": {
    "not_null": true,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}, {
  "name": "id2",
  "type": "int",
  "constraint": {
    "not_null": false,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}]]
drop table test
# test: column bool/boolean
create table test(id int primary key, a bool, b boolean)
select columns from system.tables() where name = "test"
[[{
  "name": "id",
  "type": "int",
  "constraint": {
    "not_null": true,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}, {
  "name": "a",
  "type": "bool",
  "constraint": {
    "not_null": false,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}, {
  "name": "b",
  "type": "bool",
  "constraint": {
    "not_null": false,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}]]
drop table test
# test: column string/text
create table test(id int primary key, a string, b text)
select columns from system.tables() where name = "test"
[[{
  "name": "id",
  "type": "int",
  "constraint": {
    "not_null": true,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}, {
  "name": "a",
  "type": "string",
  "constraint": {
    "not_null": false,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}, {
  "name": "b",
  "type": "string",
  "constraint": {
    "not_null": false,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}]]
drop table test
# test: column real
create table test(id int primary key, a real)
select columns from system.tables() where name = "test"
[[{
  "name": "id",
  "type": "int",
  "constraint": {
    "not_null": true,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}, {
  "name": "a",
  "type": "real",
  "constraint": {
    "not_null": false,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}]]
drop table test
# test: column object
create table test(id int primary key, a obj, b object)
select columns from system.tables() where name = "test"
[[{
  "name": "id",
  "type": "int",
  "constraint": {
    "not_null": true,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}, {
  "name": "a",
  "type": "object",
  "constraint": {
    "not_null": false,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}, {
  "name": "b",
  "type": "object",
  "constraint": {
    "not_null": false,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}]]
drop table test
# test: column array
create table test(id int primary key, a array)
select columns from system.tables() where name = "test"
[[{
  "name": "id",
  "type": "int",
  "constraint": {
    "not_null": true,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}, {
  "name": "a",
  "type": "array",
  "constraint": {
    "not_null": false,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}]]
drop table test
# test: column timestamp
create table test(id int primary key, a timestamp)
select columns from system.tables() where name = "test"
[[{
  "name": "id",
  "type": "int",
  "constraint": {
    "not_null": true,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}, {
  "name": "a",
  "type": "timestamp",
  "constraint": {
    "not_null": false,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}]]
drop table test
# test: column interval
create table test(id int primary key, a interval)
select columns from system.tables() where name = "test"
[[{
  "name": "id",
  "type": "int",
  "constraint": {
    "not_null": true,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}, {
  "name": "a",
  "type": "interval",
  "constraint": {
    "not_null": false,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}]]
drop table test
# test: column vector
create table test(id int primary key, a vector)
select columns from system.tables() where name = "test"
[[{
  "name": "id",
  "type": "int",
  "constraint": {
    "not_null": true,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}, {
  "name": "a",
  "type": "vector",
  "constraint": {
    "not_null": false,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}]]
drop table test
# test: column agg
create table test(id int primary key, a agg)
{"msg": "AGGREGATE <(> expected"}
create table test(id int primary key, a agg()
{"msg": "AGGREGATE (<type> expected"}
create table test(id int primary key, a agg(hello)
{"msg": "AGGREGATE 'hello' is not supported"}
create table test(id int primary key, a agg(hello))
{"msg": "AGGREGATE 'hello' is not supported"}
create table test(id int primary key, a agg(count), b aggregate(sum))
select columns from system.tables() where name = "test"
[[{
  "name": "id",
  "type": "int",
  "constraint": {
    "not_null": true,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}, {
  "name": "a",
  "type": "aggregate",
  "constraint": {
    "not_null": false,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 1,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}, {
  "name": "b",
  "type": "aggregate",
  "constraint": {
    "not_null": false,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 4,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}]]
drop table test
# test: column any
create table test(id int primary key, data any)
select columns from system.tables() where name = "test"
[[{
  "name": "id",
  "type": "int",
  "constraint": {
    "not_null": true,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}, {
  "name": "data",
  "type": "any",
  "constraint": {
    "not_null": false,
    "not_aggregated": true,
    "generated": 0,
    "modulo": 9223372036854775807,
    "aggregate": 0,
    "as_stored": "",
    "as_aggregated": "",
    "default": null
  }
}]]
insert into test values (0, "")
insert into test values (1, [1,2,3])
insert into test values (2, {"id":48})
insert into test values (3, interval '5 sec')
select data::type from test
["string", "array", "object", "interval"]
drop table test
# test: column redefined
create table test(id int, id int)
{"msg": "<id> column redefined"}
# test: primary key is not defined
create table test(id int)
{"msg": "primary key is not defined"}
# test: primary key clause parsing
create table test(primary)
{"msg": "PRIMARY <KEY> expected"}
create table test(primary key(
{"msg": "KEY (<name> expected"}
create table test(primary key()
{"msg": "KEY (<name> expected"}
create table test(primary key())
{"msg": "KEY (<name> expected"}
create table test(primary key(abc))
{"msg": "<abc> column does not exists"}
create table test(id int, primary key())
{"msg": "KEY (<name> expected"}
create table test(id int, primary key(id, ))
{"msg": "KEY (<name> expected"}
create table test(primary key(id), id int)
{"msg": "<id> column does not exists"}
# test: primary key is not found
create table test(id int, primary key(idd))
{"msg": "<idd> column does not exists"}
# test: primary key redefined
create table test(id int, primary key(id, id))
create table test(id int primary key, primary key(id))
{"msg": "table 'test': already exists"}
create table if not exists test(id int primary key, primary key(id))
select indexes[0].keys from system.tables() where name = "test"
[[{
  "ref": 0,
  "type": "int",
  "path": ""
}, {
  "ref": 0,
  "type": "int",
  "path": ""
}]]
drop table test
# test: primary key redefined #2
create table test(id int primary key primary key)
{"msg": "PRIMARY KEY defined twice"}
# test: primary key ensure valid type
create table test(id obj primary key)
{"msg": "<id> column key can be string, int or timestamp"}
create table test(id obj, primary key(id))
{"msg": "<id> column key can be string, int or timestamp"}
# test: primary key ensure nested key required
create table test(data obj, primary key(data.id))
{"msg": "data.id <TYPE> expected"}
# test: primary key ensure valid nested key type
create table test(data obj, primary key(data.id obj))
{"msg": "<data> column key can be string, int or timestamp"}
create table test(data obj, primary key(data.id integer))
select indexes[0].keys from system.tables() where name = "test"
[[{
  "ref": 0,
  "type": "int",
  "path": "id"
}]]
drop table test
create table test (id int primary key)
create table test (id int primary key)
{"msg": "table 'test': already exists"}
# test: table create if not exists
create table test (id int primary key)
{"msg": "table 'test': already exists"}
create table if not exists test (id int primary key)
select name from system.tables() where name = "test"
["test"]
drop table test
select name from system.tables() where name = "test"
[]
# test: schema default
create table test (id int primary key)
select *.schema from system.tables() where name = "test"
["public"]
drop table test
# test: schema system
create table system.test (id int primary key)
{"msg": "system schema <system> cannot be used to create objects"}
# test: schema default explicit
create table public.test (id int primary key)
select *.schema from system.tables() where name = "test"
["public"]
drop table public.test
# test: schema non-exists
create table test.test (id int primary key)
{"msg": "schema 'test': not exists"}
select *.schema from system.tables() where name = "test"
[]
# test: schema set
create table test (id int primary key)
create schema test
create table test.test (id int primary key)
select *.schema || "." || *.name from system.tables() where name = "test"
["public.test", "test.test"]
select name from system.tables() where *.schema = "test" and name = "test"
["test"]
drop table test
drop table test.test
drop schema test
# test: table create with conflicting view
create view test as select 1
create table test (id int primary key)
{"msg": "view <test> with the same name exists"}
drop view test
# test: distributed
create distributed table test (id int primary key)
select *.name, *.shared from system.tables()
[["test", false]]
drop table test
# test: shared
create shared table test (id int primary key)
select *.name, *.shared from system.tables()
[["test", true]]
drop table test
# test: constraint default
create table test (id int primary key, data int default 1)
select indexes[0].keys from system.tables()
[[{
  "ref": 0,
  "type": "int",
  "path": ""
}]]
drop table test
# test: constraint default with key
create table test (id int default 1 primary key)
drop table test
# test: constraint default with key #2
create table test (id int default 1, primary key(id))
drop table test
# test: constraint default expr validate
create table test (id int primary key, data int default 1 + 1)
{"msg": "only consts allowed as DEFAULT expression"}
# test: constraint not null with key
create table test (id int not null primary key)
select indexes[0].keys from system.tables()
[[{
  "ref": 0,
  "type": "int",
  "path": ""
}]]
drop table test
# test: constraint not null forced for keys
create table test (id int primary key, data int)
select indexes[0].keys from system.tables()
[[{
  "ref": 0,
  "type": "int",
  "path": ""
}]]
drop table test
# test: constraint not null forced for keys #2
create table test (id int, data int, primary key(id))
select indexes[0].keys from system.tables()
[[{
  "ref": 0,
  "type": "int",
  "path": ""
}]]
drop table test
# test: constraint not null
create table test (id int primary key, data int not)
{"msg": "NOT <NULL> expected"}
create table test (id int primary key, data int not null)
select indexes[0].keys from system.tables()
[[{
  "ref": 0,
  "type": "int",
  "path": ""
}]]
insert into test values(1, 1)
insert into test values(2, null)
{"msg": "column <data> value cannot be NULL"}
insert into test values(null, null)
{"msg": "column <id> value cannot be NULL"}
drop table test
# test: constraint not null default
create table test (id int primary key, data int not null default 123)
select indexes[0].keys from system.tables()
[[{
  "ref": 0,
  "type": "int",
  "path": ""
}]]
insert into test values(1, 1)
insert into test values(2, null)
{"msg": "column <data> value cannot be NULL"}
insert into test (id) values(3)
select * from test
[[1, 1], [3, 123]]
drop table test
# test: constraint serial
create table test (id int primary key, data int serial)
select indexes[0].keys from system.tables()
[[{
  "ref": 0,
  "type": "int",
  "path": ""
}]]
drop table test
# test: constraint serial key
create table test (id int serial primary key)
select indexes[0].keys from system.tables()
[[{
  "ref": 0,
  "type": "int",
  "path": ""
}]]
drop table test
# test: constraint serial key #2
create table test (id int serial, primary key(id))
select indexes[0].keys from system.tables()
[[{
  "ref": 0,
  "type": "int",
  "path": ""
}]]
drop table test
# test: constraint serial key type
create table test (id string serial primary key)
{"msg": "SERIAL column <id> must be integer"}
# test: constraint serial multiple columns
create table test (id int serial primary key, data int serial)
select indexes[0].keys from system.tables()
[[{
  "ref": 0,
  "type": "int",
  "path": ""
}]]
drop table test
# test: with parsing
create table test (id int primary key) with
{"msg": "WITH <(> expected"}
create table test (id int primary key) with (
{"msg": "WITH (<name> expected"}
create table test (id int primary key) with (,
{"msg": "WITH (<name> expected"}
create table test (id int primary key) with (abc
{"msg": "WITH: <abc> unrecognized parameter"}
create table test (id int primary key) with (abc = 10)
{"msg": "WITH: <abc> unrecognized parameter"}
create table test (id int primary key) with (abc = "")
{"msg": "WITH: <abc> unrecognized parameter"}
# test: with
create table test (id int primary key) with (uuid = "00000000-0000-0000-0000-000000000000")
{"msg": "WITH: <uuid> unrecognized parameter"}
disconnect S0
close E0
