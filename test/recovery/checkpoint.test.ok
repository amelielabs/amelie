open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }], "shards": 3
connect E0 S0 localhost:3485
# test: default checkpoint
show checkpoint
[0]
# test: checkpoint (no data)
checkpoint
[]
show checkpoint
[0]
# test: create table
create distributed table test (id int primary key serial)
[]
show lsn
[1]
# test: checkpoint
checkpoint
[]
show lsn
[1]
show checkpoint
[1]
# test: restart/recover
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
show lsn
[1]
show checkpoint
[1]
select * from test
[]
# test: insert
insert into test () values (), (), ()
[]
select serial("public", "test")
[3]
# test: restart/recover (checkpoint + wal)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
show lsn
[2]
show checkpoint
[1]
select serial("public", "test")
[3]
select * from test
[[0], [1], [2]]
# test: checkpoint
checkpoint
[]
show lsn
[2]
show checkpoint
[2]
# test: restart/recover (checkpoint)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
show lsn
[2]
show checkpoint
[2]
select serial("public", "test")
[3]
select * from test
[[0], [1], [2]]
# test: create schema
create schema test
[]
alter table public.test rename to test.test
[]
show lsn
[4]
# test: restart/recover (checkpoint + wal)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
show lsn
[4]
show checkpoint
[2]
show schemas
[{
  "name": "system",
  "system": true,
  "create": false
}, {
  "name": "public",
  "system": true,
  "create": true
}, {
  "name": "test",
  "system": false,
  "create": true
}]
select serial("test", "test")
[3]
select * from test.test
[[0], [1], [2]]
# test: checkpoint
checkpoint
[]
show lsn
[4]
show checkpoint
[4]
# test: restart/recover (checkpoint)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
show lsn
[4]
show checkpoint
[4]
show schemas
[{
  "name": "system",
  "system": true,
  "create": false
}, {
  "name": "public",
  "system": true,
  "create": true
}, {
  "name": "test",
  "system": false,
  "create": true
}]
select serial("test", "test")
[3]
select * from test.test
[[0], [1], [2]]
# test: create view
create view test_view as select [1,2,3]
[]
show lsn
[5]
select * from test_view
[1, 2, 3]
# test: restart/recover (checkpoint + wal)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
show lsn
[5]
show checkpoint
[4]
show schemas
[{
  "name": "system",
  "system": true,
  "create": false
}, {
  "name": "public",
  "system": true,
  "create": true
}, {
  "name": "test",
  "system": false,
  "create": true
}]
select serial("test", "test")
[3]
select * from test.test
[[0], [1], [2]]
select * from test_view
[1, 2, 3]
# test: checkpoint
checkpoint
[]
show lsn
[5]
show checkpoint
[5]
# test: restart/recover (checkpoint)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
show lsn
[5]
show checkpoint
[5]
show schemas
[{
  "name": "system",
  "system": true,
  "create": false
}, {
  "name": "public",
  "system": true,
  "create": true
}, {
  "name": "test",
  "system": false,
  "create": true
}]
select serial("test", "test")
[3]
select * from test.test
[[0], [1], [2]]
select * from test_view
[1, 2, 3]
# test: drop
drop view test_view
[]
drop table test.test
[]
show lsn
[7]
# test: restart/recover (checkpoint + wal)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
show lsn
[7]
show checkpoint
[5]
show views
[]
show tables
[]
# test: checkpoint
checkpoint
[]
show lsn
[7]
show checkpoint
[7]
# test: restart/recover (checkpoint)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
show lsn
[7]
show checkpoint
[7]
show views
[]
show tables
[]
disconnect S0
close E0
