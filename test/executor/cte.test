#

open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }], "shards": 3
connect E0 S0 localhost:3485

# test: with(table), expr
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test) select * from a
explain with a as (select * from test) select * from a
drop table test

# test: with(reference), expr
create table test (id int primary key) reference
insert into test 1,2,3
with a as (select * from test) select * from a
explain with a as (select * from test) select * from a
drop table test

# test: with(table), table
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test) select * from test
explain with a as (select * from test) select * from test
drop table test

# test: with(reference), reference (pushdown)
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test) select * from test
explain with a as (select * from test) select * from test
drop table test

# test: with(expr), table (pushdown)
create table test (id int primary key)
insert into test 1,2,3
explain with a as (select * from [5,6,7]) select test.*, a.* from test, a
with a as (select * from [5,6,7]) select test.*, a.* from test, a
drop table test

# test: with(expr), table (pushdown)
create table test (id int primary key)
insert into test 1,2,3
explain with a as (select * from [5,6,7]) select test.*, a.* from test, a
with a as (select * from [5,6,7]) select test.*, a.* from test, a
drop table test

# test: with(table), table (pushdown join)
create table test (id int primary key)
insert into test 1,2,3
with a (id) as (select * from test) select test.* from test join a on (test.id = a.id)
explain with a (id) as (select * from test) select test.* from test join a on (test.id = a.id)

with a (id) as (select * from test) select test.* from test join a on (test.id = a.id) order by test.id
explain with a (id) as (select * from test) select test.* from test join a on (test.id = a.id) order by test.id
drop table test

# test: with (expr), with(table), table (pushdown join)
create table test (id int primary key)
insert into test 1,2,3
with z (id) as (select [*] from [1,2,3]), a (id) as (select * from test) select test.* from test join a on (test.id = a.id) join z on (test.id = z.id)
explain with z (id) as (select [*] from [1,2,3]), a (id) as (select * from test) select test.* from test join a on (test.id = a.id) join z on (test.id = z.id)
drop table test

# test: a(table), b(a)
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test), b as (select * from a) select * from b
explain with a as (select * from test), b as (select * from a) select * from b
drop table test

# test: a(table), b(expr), c(a)
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test), b as (select [1,2,3]), c as (select * from a) select * from c
explain with a as (select * from test), b as (select [1,2,3]), c as (select * from a) select * from c
drop table test

# test: a(table), b(expr), c(table)
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test), b as (select [1,2,3]), c as (select * from test) select * from c
explain with a as (select * from test), b as (select [1,2,3]), c as (select * from test) select * from c
drop table test

# test: a(table), b(table), c(expr)
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test), b as (select * from test), c as (select [1,2,3]) select * from c
explain with a as (select * from test), b as (select * from test), c as (select [1,2,3]) select * from c
drop table test

# test: a(table), b(table), c(expr), d(table)
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test), b as (select * from test), c as (select [1,2,3]), d as (select * from test) select * from d
explain with a as (select * from test), b as (select * from test), c as (select [1,2,3]), d as (select * from test) select * from d
drop table test

# test: a(expr), b(table), c(expr)
create table test (id int primary key)
insert into test 1,2,3
with a as (select [1,2,3]), b as (select * from test), c as (select [1,2,3]) select b.*, c.* from b,c
explain with a as (select [1,2,3]), b as (select * from test), c as (select [1,2,3]) select b.*, c.* from b,c
drop table test

# test: a(expr), b(table), c(table)
create table test (id int primary key)
insert into test 1,2,3
with a as (select [1,2,3]), b as (select * from test), c as (select * from test) select * from c
explain with a as (select [1,2,3]), b as (select * from test), c as (select * from test) select * from c
drop table test

# test: a(table), b(a), c(table)
create table test (id int primary key)
insert into test 1,2,3
with a as (select * from test), b as (select * from a), c as (select * from test) select * from c
explain with a as (select * from test), b as (select * from a), c as (select * from test) select * from c
drop table test

create table test (id int primary key) reference
insert into test 1,2,3
with a as (select * from test), b as (select * from a), c as (select * from test) select * from c
explain with a as (select * from test), b as (select * from a), c as (select * from test) select * from c
drop table test

disconnect S0
close E0
