env_open E0 "cluster_shards": 3
connect E0 S0
connect: on_connect
# test: select from reference
create table test (id int primary key, data int default 0) reference
select *.name, *.reference from system.tables()
["test", true]
insert into test (id) values (1), (2), (3)
explain select * from test
"
bytecode [coordinator]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp        7      0      0
 4         cursor_read        0      0      0
 5                send        0      0      0
 6         cursor_next        0      4      0
 7        cursor_close        0      0      0
 8                 ret        0      0      0

"
select * from test
[1, 0]
[2, 0]
[3, 0]
# test: select from (select from reference)
explain select * from (select * from test)
"
bytecode [coordinator]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9    cursor_open_expr        1      0     11
10                 jmp       14      0      0
11         cursor_read        1      1      0
12                send        1      0      0
13         cursor_next        1     11      0
14        cursor_close        1      0      0
15                 ret        0      0      0

"
select * from (select * from test)
[1, 0]
[2, 0]
[3, 0]
# test: select (select expr) from reference
explain select (select test.*) from test
"
bytecode [coordinator]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp        7      0      0
 4         cursor_read        0      0      0
 5                send        0      0      0
 6         cursor_next        0      4      0
 7        cursor_close        0      0      0
 8                 ret        0      0      0

"
select (select test.*) from test
[1, 0]
[2, 0]
[3, 0]
# test: select (select from reference)
explain select (select * from test)
"
bytecode [coordinator]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        0      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      0      0
 6             set_add        0      1      0
 7         cursor_next        0      5      0
 8        cursor_close        0      0      0
 9                send        0      0      0
10                 ret        0      0      0

"
select (select * from test)
[[1, 0], [2, 0], [3, 0]]
# test: select (select from reference) from expr
explain select (select a.*, * from test) from [1,2,3] a
"
bytecode [coordinator]
--------
 0                 int        0      1      0
 1                push        0      0      0
 2                 int        0      2      0
 3                push        0      0      0
 4                 int        0      3      0
 5                push        0      0      0
 6               array        0      3      0
 7    cursor_open_expr        1      0      9
 8                 jmp       24      0      0
 9                 set        1      0      0
10             int_min        2      0      0
11                push        2      0      0
12         cursor_open        0      0     14      # public.test (primary)
13                 jmp       21      0      0
14         cursor_read        2      1      0
15                push        2      0      0
16         cursor_read        2      0      0
17                push        2      0      0
18               array        2      2      0
19             set_add        1      2      0
20         cursor_next        0     14      0
21        cursor_close        0      0      0
22                send        1      0      0
23         cursor_next        1      9      0
24        cursor_close        1      0      0
25                 ret        0      0      0

"
select (select a.*, * from test) from [1,2,3] a
[[1, [1, 0]], [1, [2, 0]], [1, [3, 0]]]
[[2, [1, 0]], [2, [2, 0]], [2, [3, 0]]]
[[3, [1, 0]], [3, [2, 0]], [3, [3, 0]]]
explain select (select a.*, id from test) from [1,2,3] a
"
bytecode [coordinator]
--------
 0                 int        0      1      0
 1                push        0      0      0
 2                 int        0      2      0
 3                push        0      0      0
 4                 int        0      3      0
 5                push        0      0      0
 6               array        0      3      0
 7    cursor_open_expr        1      0      9
 8                 jmp       24      0      0
 9                 set        1      0      0
10             int_min        2      0      0
11                push        2      0      0
12         cursor_open        0      0     14      # public.test (primary)
13                 jmp       21      0      0
14         cursor_read        2      1      0
15                push        2      0      0
16          cursor_idx        2      0      0
17                push        2      0      0
18               array        2      2      0
19             set_add        1      2      0
20         cursor_next        0     14      0
21        cursor_close        0      0      0
22                send        1      0      0
23         cursor_next        1      9      0
24        cursor_close        1      0      0
25                 ret        0      0      0

"
select (select a.*, id from test) from [1,2,3] a
[[1, 1], [1, 2], [1, 3]]
[[2, 1], [2, 2], [2, 3]]
[[3, 1], [3, 2], [3, 3]]
# test: select (select from reference) from reference
explain select (select a.*, id from test) from test a
"
bytecode [coordinator]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        1      0      4      # public.test (primary)
 3                 jmp       19      0      0
 4                 set        0      0      0
 5             int_min        1      0      0
 6                push        1      0      0
 7         cursor_open        0     20      9      # public.test (primary)
 8                 jmp       16      0      0
 9         cursor_read        1      1      0
10                push        1      0      0
11          cursor_idx        1      0      0
12                push        1      0      0
13               array        1      2      0
14             set_add        0      1      0
15         cursor_next        0      9      0
16        cursor_close        0      0      0
17                send        0      0      0
18         cursor_next        1      4      0
19        cursor_close        1      0      0
20                 ret        0      0      0

"
select (select a.*, id from test) from test a
[[[1, 0], 1], [[1, 0], 2], [[1, 0], 3]]
[[[2, 0], 1], [[2, 0], 2], [[2, 0], 3]]
[[[3, 0], 1], [[3, 0], 2], [[3, 0], 3]]
explain select (select a.id, id from test) from test a
"
bytecode [coordinator]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        1      0      4      # public.test (primary)
 3                 jmp       19      0      0
 4                 set        0      0      0
 5             int_min        1      0      0
 6                push        1      0      0
 7         cursor_open        0     20      9      # public.test (primary)
 8                 jmp       16      0      0
 9          cursor_idx        1      1      0
10                push        1      0      0
11          cursor_idx        1      0      0
12                push        1      0      0
13               array        1      2      0
14             set_add        0      1      0
15         cursor_next        0      9      0
16        cursor_close        0      0      0
17                send        0      0      0
18         cursor_next        1      4      0
19        cursor_close        1      0      0
20                 ret        0      0      0

"
select (select a.id, id from test) from test a
[[1, 1], [1, 2], [1, 3]]
[[2, 1], [2, 2], [2, 3]]
[[3, 1], [3, 2], [3, 3]]
# test: select (select from reference) from (select from expr)
explain select (select a.*, id from test) from (select * from [1,2,3]) a
"
bytecode [coordinator]
--------
 0                 set        0      0      0
 1                 int        1      1      0
 2                push        1      0      0
 3                 int        1      2      0
 4                push        1      0      0
 5                 int        1      3      0
 6                push        1      0      0
 7               array        1      3      0
 8    cursor_open_expr        1      1     10
 9                 jmp       13      0      0
10         cursor_read        2      1      0
11             set_add        0      2      0
12         cursor_next        1     10      0
13        cursor_close        1      0      0
14    cursor_open_expr        2      0     16
15                 jmp       31      0      0
16                 set        1      0      0
17             int_min        2      0      0
18                push        2      0      0
19         cursor_open        0      0     21      # public.test (primary)
20                 jmp       28      0      0
21         cursor_read        2      2      0
22                push        2      0      0
23          cursor_idx        2      0      0
24                push        2      0      0
25               array        2      2      0
26             set_add        1      2      0
27         cursor_next        0     21      0
28        cursor_close        0      0      0
29                send        1      0      0
30         cursor_next        2     16      0
31        cursor_close        2      0      0
32                 ret        0      0      0

"
select (select a.*, id from test) from (select * from [1,2,3]) a
[[1, 1], [1, 2], [1, 3]]
[[2, 1], [2, 2], [2, 3]]
[[3, 1], [3, 2], [3, 3]]
# test: select (select from reference) from (select from reference)
explain select (select a.*, id from test) from (select * from test t) a
"
bytecode [coordinator]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        1      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      1      0
 6             set_add        0      1      0
 7         cursor_next        1      5      0
 8        cursor_close        1      0      0
 9    cursor_open_expr        2      0     11
10                 jmp       26      0      0
11                 set        1      0      0
12             int_min        2      0      0
13                push        2      0      0
14         cursor_open        0     20     16      # public.test (primary)
15                 jmp       23      0      0
16         cursor_read        2      2      0
17                push        2      0      0
18          cursor_idx        2      0      0
19                push        2      0      0
20               array        2      2      0
21             set_add        1      2      0
22         cursor_next        0     16      0
23        cursor_close        0      0      0
24                send        1      0      0
25         cursor_next        2     11      0
26        cursor_close        2      0      0
27                 ret        0      0      0

"
select (select a.*, id from test) from (select * from test t) a
[[[1, 0], 1], [[1, 0], 2], [[1, 0], 3]]
[[[2, 0], 1], [[2, 0], 2], [[2, 0], 3]]
[[[3, 0], 1], [[3, 0], 2], [[3, 0], 3]]
explain select (select a.*[0], id from test) from (select * from test t) a
"
bytecode [coordinator]
--------
 0                 set        0      0      0
 1             int_min        1      0      0
 2                push        1      0      0
 3         cursor_open        1      0      5      # public.test (primary)
 4                 jmp        8      0      0
 5         cursor_read        1      1      0
 6             set_add        0      1      0
 7         cursor_next        1      5      0
 8        cursor_close        1      0      0
 9    cursor_open_expr        2      0     11
10                 jmp       28      0      0
11                 set        1      0      0
12             int_min        2      0      0
13                push        2      0      0
14         cursor_open        0     20     16      # public.test (primary)
15                 jmp       25      0      0
16         cursor_read        2      2      0
17                 int        3      0      0
18                 idx        4      2      3
19                push        4      0      0
20          cursor_idx        2      0      0
21                push        2      0      0
22               array        2      2      0
23             set_add        1      2      0
24         cursor_next        0     16      0
25        cursor_close        0      0      0
26                send        1      0      0
27         cursor_next        2     11      0
28        cursor_close        2      0      0
29                 ret        0      0      0

"
select (select a.*[0], id from test) from (select * from test t) a
[[1, 1], [1, 2], [1, 3]]
[[2, 1], [2, 2], [2, 3]]
[[3, 1], [3, 2], [3, 3]]
# test: select from reference, expr
explain select test.*, t.* from test, [1,2,3] t
"
bytecode [coordinator]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       22      0      0
 4                 int        0      1      0
 5                push        0      0      0
 6                 int        0      2      0
 7                push        0      0      0
 8                 int        0      3      0
 9                push        0      0      0
10               array        0      3      0
11    cursor_open_expr        1      0     13
12                 jmp       20      0      0
13         cursor_read        1      0      0
14                push        1      0      0
15         cursor_read        1      1      0
16                push        1      0      0
17               array        1      2      0
18                send        1      0      0
19         cursor_next        1     13      0
20        cursor_close        1      0      0
21         cursor_next        0      4      0
22        cursor_close        0      0      0
23                 ret        0      0      0

"
select test.*, t.* from test, [1,2,3] t
[[1, 0], 1]
[[1, 0], 2]
[[1, 0], 3]
[[2, 0], 1]
[[2, 0], 2]
[[2, 0], 3]
[[3, 0], 1]
[[3, 0], 2]
[[3, 0], 3]
# test: select from expr, reference
explain select test.*, t.* from [1,2,3] t, test
"
bytecode [coordinator]
--------
 0                 int        0      1      0
 1                push        0      0      0
 2                 int        0      2      0
 3                push        0      0      0
 4                 int        0      3      0
 5                push        0      0      0
 6               array        0      3      0
 7    cursor_open_expr        0      0      9
 8                 jmp       22      0      0
 9             int_min        1      0      0
10                push        1      0      0
11         cursor_open        1      0     13      # public.test (primary)
12                 jmp       20      0      0
13         cursor_read        1      1      0
14                push        1      0      0
15         cursor_read        1      0      0
16                push        1      0      0
17               array        1      2      0
18                send        1      0      0
19         cursor_next        1     13      0
20        cursor_close        1      0      0
21         cursor_next        0      9      0
22        cursor_close        0      0      0
23                 ret        0      0      0

"
select test.*, t.* from [1,2,3] t, test
[[1, 0], 1]
[[2, 0], 1]
[[3, 0], 1]
[[1, 0], 2]
[[2, 0], 2]
[[3, 0], 2]
[[1, 0], 3]
[[2, 0], 3]
[[3, 0], 3]
# test: select from reference, reference
explain select test.*, t.* from test, test t
"
bytecode [coordinator]
--------
 0             int_min        0      0      0
 1                push        0      0      0
 2         cursor_open        0      0      4      # public.test (primary)
 3                 jmp       17      0      0
 4             int_min        0      0      0
 5                push        0      0      0
 6         cursor_open        1     20      8      # public.test (primary)
 7                 jmp       15      0      0
 8         cursor_read        0      0      0
 9                push        0      0      0
10         cursor_read        0      1      0
11                push        0      0      0
12               array        0      2      0
13                send        0      0      0
14         cursor_next        1      8      0
15        cursor_close        1      0      0
16         cursor_next        0      4      0
17        cursor_close        0      0      0
18                 ret        0      0      0

"
select test.*, t.* from test, test t
[[1, 0], [1, 0]]
[[1, 0], [2, 0]]
[[1, 0], [3, 0]]
[[2, 0], [1, 0]]
[[2, 0], [2, 0]]
[[2, 0], [3, 0]]
[[3, 0], [1, 0]]
[[3, 0], [2, 0]]
[[3, 0], [3, 0]]
drop table test
disconnect S0
env_close E0
