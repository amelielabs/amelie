open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }], "shards": 3
connect E0 S0 localhost:3485
# test: select from expr group by empty
explain select * from [] group by *
["
bytecode [coordinator]
--------
 0                 set        0      0      0
 1               group        1      1      0
 2               array        2      0      0
 3    cursor_open_expr        0      2      5
 4                 jmp        9      0      0
 5         cursor_read        3      0      0
 6                push        3      0      0
 7         group_write        1      0      0
 8         cursor_next        0      5      0
 9        cursor_close        0      0      0
10    cursor_open_expr        1      1     12
11                 jmp       15      0      0
12         cursor_read        2      1      0
13             set_add        0      2      0
14         cursor_next        1     12      0
15        cursor_close        1      0      0
16             cte_set        0      0      0
17                body        0      0      0
18                 ret        0      0      0

"]
select * from [] group by *
[]
# test: select from expr group by
explain select * from [0,1,2,3,4] group by *
["
bytecode [coordinator]
--------
 0                 set        0      0      0
 1               group        1      1      0
 2                 int        2      0      0
 3                push        2      0      0
 4                 int        2      1      0
 5                push        2      0      0
 6                 int        2      2      0
 7                push        2      0      0
 8                 int        2      3      0
 9                push        2      0      0
10                 int        2      4      0
11                push        2      0      0
12               array        2      5      0
13    cursor_open_expr        0      2     15
14                 jmp       19      0      0
15         cursor_read        3      0      0
16                push        3      0      0
17         group_write        1      0      0
18         cursor_next        0     15      0
19        cursor_close        0      0      0
20    cursor_open_expr        1      1     22
21                 jmp       25      0      0
22         cursor_read        2      1      0
23             set_add        0      2      0
24         cursor_next        1     22      0
25        cursor_close        1      0      0
26             cte_set        0      0      0
27                body        0      0      0
28                 ret        0      0      0

"]
select * from [0,1,2,3,4] group by *
[0, 1, 2, 3, 4]
# test: select expr from expr group by
explain select 100 + * from [0,1,2,3,4] group by *
["
bytecode [coordinator]
--------
 0                 set        0      0      0
 1               group        1      1      0
 2                 int        2      0      0
 3                push        2      0      0
 4                 int        2      1      0
 5                push        2      0      0
 6                 int        2      2      0
 7                push        2      0      0
 8                 int        2      3      0
 9                push        2      0      0
10                 int        2      4      0
11                push        2      0      0
12               array        2      5      0
13    cursor_open_expr        0      2     15
14                 jmp       19      0      0
15         cursor_read        3      0      0
16                push        3      0      0
17         group_write        1      0      0
18         cursor_next        0     15      0
19        cursor_close        0      0      0
20    cursor_open_expr        1      1     22
21                 jmp       27      0      0
22                 int        2    100      0
23         cursor_read        3      1      0
24                 add        4      2      3
25             set_add        0      4      0
26         cursor_next        1     22      0
27        cursor_close        1      0      0
28             cte_set        0      0      0
29                body        0      0      0
30                 ret        0      0      0

"]
select 100 + * from [0,1,2,3,4] group by *
[100, 101, 102, 103, 104]
# test: select from (select from expr group by)
explain select * from (select * from [0,1,2,3,4] group by *)
["
bytecode [coordinator]
--------
 0                 set        0      0      0
 1                 set        1      0      0
 2               group        2      1      0
 3                 int        3      0      0
 4                push        3      0      0
 5                 int        3      1      0
 6                push        3      0      0
 7                 int        3      2      0
 8                push        3      0      0
 9                 int        3      3      0
10                push        3      0      0
11                 int        3      4      0
12                push        3      0      0
13               array        3      5      0
14    cursor_open_expr        0      3     16
15                 jmp       20      0      0
16         cursor_read        4      0      0
17                push        4      0      0
18         group_write        2      0      0
19         cursor_next        0     16      0
20        cursor_close        0      0      0
21    cursor_open_expr        1      2     23
22                 jmp       26      0      0
23         cursor_read        3      1      0
24             set_add        1      3      0
25         cursor_next        1     23      0
26        cursor_close        1      0      0
27    cursor_open_expr        2      1     29
28                 jmp       32      0      0
29         cursor_read        2      2      0
30             set_add        0      2      0
31         cursor_next        2     29      0
32        cursor_close        2      0      0
33             cte_set        0      0      0
34                body        0      0      0
35                 ret        0      0      0

"]
select * from (select * from [0,1,2,3,4] group by *)
[0, 1, 2, 3, 4]
# test: select from expr group by limit
explain select * from [0,1,2,3,4] group by * limit 1
["
bytecode [coordinator]
--------
 0                 set        0      0      0
 1               group        1      1      0
 2                 int        2      0      0
 3                push        2      0      0
 4                 int        2      1      0
 5                push        2      0      0
 6                 int        2      2      0
 7                push        2      0      0
 8                 int        2      3      0
 9                push        2      0      0
10                 int        2      4      0
11                push        2      0      0
12               array        2      5      0
13    cursor_open_expr        0      2     15
14                 jmp       19      0      0
15         cursor_read        3      0      0
16                push        3      0      0
17         group_write        1      0      0
18         cursor_next        0     15      0
19        cursor_close        0      0      0
20                 int        2      1      0
21           cntr_init        1      0      2
22    cursor_open_expr        1      1     24
23                 jmp       28      0      0
24            cntr_lte        1      0     23
25         cursor_read        2      1      0
26             set_add        0      2      0
27         cursor_next        1     24      0
28        cursor_close        1      0      0
29             cte_set        0      0      0
30                body        0      0      0
31                 ret        0      0      0

"]
select * from [0,1,2,3,4] group by * limit 2
[0, 1]
select * from [0,1,2,3,4] group by * limit 3
[0, 1, 2]
select * from [0,1,2,3,4] group by * limit 4
[0, 1, 2, 3]
# test: select from expr group by limit/offset
explain select * from [0,1,2,3,4] group by * limit 1 offset 1
["
bytecode [coordinator]
--------
 0                 set        0      0      0
 1               group        1      1      0
 2                 int        2      0      0
 3                push        2      0      0
 4                 int        2      1      0
 5                push        2      0      0
 6                 int        2      2      0
 7                push        2      0      0
 8                 int        2      3      0
 9                push        2      0      0
10                 int        2      4      0
11                push        2      0      0
12               array        2      5      0
13    cursor_open_expr        0      2     15
14                 jmp       19      0      0
15         cursor_read        3      0      0
16                push        3      0      0
17         group_write        1      0      0
18         cursor_next        0     15      0
19        cursor_close        0      0      0
20                 int        2      1      0
21           cntr_init        1      1      2
22                 int        2      1      0
23           cntr_init        1      0      2
24    cursor_open_expr        1      1     26
25                 jmp       31      0      0
26            cntr_gte        1      1     30
27            cntr_lte        1      0     25
28         cursor_read        2      1      0
29             set_add        0      2      0
30         cursor_next        1     26      0
31        cursor_close        1      0      0
32             cte_set        0      0      0
33                body        0      0      0
34                 ret        0      0      0

"]
select * from [0,1,2,3,4] group by * limit 1 offset 0
[0]
select * from [0,1,2,3,4] group by * limit 1 offset 1
[1]
select * from [0,1,2,3,4] group by * limit 1 offset 2
[2]
select * from [0,1,2,3,4] group by * limit 1 offset 3
[3]
# test: select from expr group by offset
explain select * from [0,1,2,3,4] group by * offset 1
["
bytecode [coordinator]
--------
 0                 set        0      0      0
 1               group        1      1      0
 2                 int        2      0      0
 3                push        2      0      0
 4                 int        2      1      0
 5                push        2      0      0
 6                 int        2      2      0
 7                push        2      0      0
 8                 int        2      3      0
 9                push        2      0      0
10                 int        2      4      0
11                push        2      0      0
12               array        2      5      0
13    cursor_open_expr        0      2     15
14                 jmp       19      0      0
15         cursor_read        3      0      0
16                push        3      0      0
17         group_write        1      0      0
18         cursor_next        0     15      0
19        cursor_close        0      0      0
20                 int        2      1      0
21           cntr_init        1      1      2
22    cursor_open_expr        1      1     24
23                 jmp       28      0      0
24            cntr_gte        1      1     27
25         cursor_read        2      1      0
26             set_add        0      2      0
27         cursor_next        1     24      0
28        cursor_close        1      0      0
29             cte_set        0      0      0
30                body        0      0      0
31                 ret        0      0      0

"]
select * from [0,1,2,3,4] group by * offset 0
[0, 1, 2, 3, 4]
select * from [0,1,2,3,4] group by * offset 1
[1, 2, 3, 4]
select * from [0,1,2,3,4] group by * offset 2
[2, 3, 4]
select * from [0,1,2,3,4] group by * offset 3
[3, 4]
# test: select from (select from expr group by limit)
explain select * from (select * from [0,1,2,3,4] group by * limit 1)
["
bytecode [coordinator]
--------
 0                 set        0      0      0
 1                 set        1      0      0
 2               group        2      1      0
 3                 int        3      0      0
 4                push        3      0      0
 5                 int        3      1      0
 6                push        3      0      0
 7                 int        3      2      0
 8                push        3      0      0
 9                 int        3      3      0
10                push        3      0      0
11                 int        3      4      0
12                push        3      0      0
13               array        3      5      0
14    cursor_open_expr        0      3     16
15                 jmp       20      0      0
16         cursor_read        4      0      0
17                push        4      0      0
18         group_write        2      0      0
19         cursor_next        0     16      0
20        cursor_close        0      0      0
21                 int        3      1      0
22           cntr_init        1      0      3
23    cursor_open_expr        1      2     25
24                 jmp       29      0      0
25            cntr_lte        1      0     24
26         cursor_read        3      1      0
27             set_add        1      3      0
28         cursor_next        1     25      0
29        cursor_close        1      0      0
30    cursor_open_expr        2      1     32
31                 jmp       35      0      0
32         cursor_read        2      2      0
33             set_add        0      2      0
34         cursor_next        2     32      0
35        cursor_close        2      0      0
36             cte_set        0      0      0
37                body        0      0      0
38                 ret        0      0      0

"]
select * from (select * from [0,1,2,3,4] group by * limit 2)
[0, 1]
select * from (select * from [0,1,2,3,4] group by * limit 3)
[0, 1, 2]
select * from (select * from [0,1,2,3,4] group by * limit 4)
[0, 1, 2, 3]
# test: select from (select from expr group by limit/offset)
explain select * from (select * from [0,1,2,3,4] group by * limit 1 offset 1)
["
bytecode [coordinator]
--------
 0                 set        0      0      0
 1                 set        1      0      0
 2               group        2      1      0
 3                 int        3      0      0
 4                push        3      0      0
 5                 int        3      1      0
 6                push        3      0      0
 7                 int        3      2      0
 8                push        3      0      0
 9                 int        3      3      0
10                push        3      0      0
11                 int        3      4      0
12                push        3      0      0
13               array        3      5      0
14    cursor_open_expr        0      3     16
15                 jmp       20      0      0
16         cursor_read        4      0      0
17                push        4      0      0
18         group_write        2      0      0
19         cursor_next        0     16      0
20        cursor_close        0      0      0
21                 int        3      1      0
22           cntr_init        1      1      3
23                 int        3      1      0
24           cntr_init        1      0      3
25    cursor_open_expr        1      2     27
26                 jmp       32      0      0
27            cntr_gte        1      1     31
28            cntr_lte        1      0     26
29         cursor_read        3      1      0
30             set_add        1      3      0
31         cursor_next        1     27      0
32        cursor_close        1      0      0
33    cursor_open_expr        2      1     35
34                 jmp       38      0      0
35         cursor_read        2      2      0
36             set_add        0      2      0
37         cursor_next        2     35      0
38        cursor_close        2      0      0
39             cte_set        0      0      0
40                body        0      0      0
41                 ret        0      0      0

"]
select * from (select * from [0,1,2,3,4] group by * limit 1 offset 0)
[0]
select * from (select * from [0,1,2,3,4] group by * limit 1 offset 1)
[1]
select * from (select * from [0,1,2,3,4] group by * limit 1 offset 2)
[2]
select * from (select * from [0,1,2,3,4] group by * limit 1 offset 3)
[3]
# test: select from (select from expr group by offset)
explain select * from (select * from [0,1,2,3,4] group by * offset 1)
["
bytecode [coordinator]
--------
 0                 set        0      0      0
 1                 set        1      0      0
 2               group        2      1      0
 3                 int        3      0      0
 4                push        3      0      0
 5                 int        3      1      0
 6                push        3      0      0
 7                 int        3      2      0
 8                push        3      0      0
 9                 int        3      3      0
10                push        3      0      0
11                 int        3      4      0
12                push        3      0      0
13               array        3      5      0
14    cursor_open_expr        0      3     16
15                 jmp       20      0      0
16         cursor_read        4      0      0
17                push        4      0      0
18         group_write        2      0      0
19         cursor_next        0     16      0
20        cursor_close        0      0      0
21                 int        3      1      0
22           cntr_init        1      1      3
23    cursor_open_expr        1      2     25
24                 jmp       29      0      0
25            cntr_gte        1      1     28
26         cursor_read        3      1      0
27             set_add        1      3      0
28         cursor_next        1     25      0
29        cursor_close        1      0      0
30    cursor_open_expr        2      1     32
31                 jmp       35      0      0
32         cursor_read        2      2      0
33             set_add        0      2      0
34         cursor_next        2     32      0
35        cursor_close        2      0      0
36             cte_set        0      0      0
37                body        0      0      0
38                 ret        0      0      0

"]
select * from (select * from [0,1,2,3,4] group by * offset 0)
[0, 1, 2, 3, 4]
select * from (select * from [0,1,2,3,4] group by * offset 1)
[1, 2, 3, 4]
select * from (select * from [0,1,2,3,4] group by * offset 2)
[2, 3, 4]
select * from (select * from [0,1,2,3,4] group by * offset 3)
[3, 4]
# test: select from table group by having
explain select * from [0,1,2,3,4] group by * having * >= 3
["
bytecode [coordinator]
--------
 0                 set        0      0      0
 1               group        1      1      0
 2                 int        2      0      0
 3                push        2      0      0
 4                 int        2      1      0
 5                push        2      0      0
 6                 int        2      2      0
 7                push        2      0      0
 8                 int        2      3      0
 9                push        2      0      0
10                 int        2      4      0
11                push        2      0      0
12               array        2      5      0
13    cursor_open_expr        0      2     15
14                 jmp       19      0      0
15         cursor_read        3      0      0
16                push        3      0      0
17         group_write        1      0      0
18         cursor_next        0     15      0
19        cursor_close        0      0      0
20    cursor_open_expr        1      1     22
21                 jmp       29      0      0
22         cursor_read        2      1      0
23                 int        3      3      0
24                 gte        4      2      3
25                jntr       28      4      0
26         cursor_read        2      1      0
27             set_add        0      2      0
28         cursor_next        1     22      0
29        cursor_close        1      0      0
30             cte_set        0      0      0
31                body        0      0      0
32                 ret        0      0      0

"]
select * from [0,1,2,3,4] group by * having * >= 3
[3, 4]
select * from [0,1,2,3,4] group by * having * = 0
[0]
select * from [0,1,2,3,4] group by * having * = 1
[1]
select * from [0,1,2,3,4] group by * having * = 2
[2]
select * from [0,1,2,3,4] group by * having * = 3
[3]
select * from [0,1,2,3,4] group by * having * = 4
[4]
select * from [0,1,2,3,4] group by * having * = 5
[]
select * from [0,1,2,3,4] group by * having * >= 1 and * <= 3
[1, 2, 3]
# test: select from table group by having limit
explain select * from [0,1,2,3,4] group by * having * >= 1 limit 1
["
bytecode [coordinator]
--------
 0                 set        0      0      0
 1               group        1      1      0
 2                 int        2      0      0
 3                push        2      0      0
 4                 int        2      1      0
 5                push        2      0      0
 6                 int        2      2      0
 7                push        2      0      0
 8                 int        2      3      0
 9                push        2      0      0
10                 int        2      4      0
11                push        2      0      0
12               array        2      5      0
13    cursor_open_expr        0      2     15
14                 jmp       19      0      0
15         cursor_read        3      0      0
16                push        3      0      0
17         group_write        1      0      0
18         cursor_next        0     15      0
19        cursor_close        0      0      0
20                 int        2      1      0
21           cntr_init        1      0      2
22    cursor_open_expr        1      1     24
23                 jmp       32      0      0
24         cursor_read        2      1      0
25                 int        3      1      0
26                 gte        4      2      3
27                jntr       31      4      0
28            cntr_lte        1      0     23
29         cursor_read        2      1      0
30             set_add        0      2      0
31         cursor_next        1     24      0
32        cursor_close        1      0      0
33             cte_set        0      0      0
34                body        0      0      0
35                 ret        0      0      0

"]
select * from [0,1,2,3,4] group by * having * >= 1 limit 1
[1]
select * from [0,1,2,3,4] group by * having * >= 1 limit 2
[1, 2]
# test: select from table group by having limit/offset
explain select * from [0,1,2,3,4] group by * having * >= 1 limit 1 offset 1
["
bytecode [coordinator]
--------
 0                 set        0      0      0
 1               group        1      1      0
 2                 int        2      0      0
 3                push        2      0      0
 4                 int        2      1      0
 5                push        2      0      0
 6                 int        2      2      0
 7                push        2      0      0
 8                 int        2      3      0
 9                push        2      0      0
10                 int        2      4      0
11                push        2      0      0
12               array        2      5      0
13    cursor_open_expr        0      2     15
14                 jmp       19      0      0
15         cursor_read        3      0      0
16                push        3      0      0
17         group_write        1      0      0
18         cursor_next        0     15      0
19        cursor_close        0      0      0
20                 int        2      1      0
21           cntr_init        1      1      2
22                 int        2      1      0
23           cntr_init        1      0      2
24    cursor_open_expr        1      1     26
25                 jmp       35      0      0
26         cursor_read        2      1      0
27                 int        3      1      0
28                 gte        4      2      3
29                jntr       34      4      0
30            cntr_gte        1      1     34
31            cntr_lte        1      0     25
32         cursor_read        2      1      0
33             set_add        0      2      0
34         cursor_next        1     26      0
35        cursor_close        1      0      0
36             cte_set        0      0      0
37                body        0      0      0
38                 ret        0      0      0

"]
select * from [0,1,2,3,4] group by * having * >= 1 limit 1 offset 1
[2]
select * from [0,1,2,3,4] group by * having * >= 1 limit 1 offset 2
[3]
select * from [0,1,2,3,4] group by * having * >= 1 limit 1 offset 3
[4]
# test: select from table group by having offset
explain select * from [0,1,2,3,4] group by * having * >= 1 offset 1
["
bytecode [coordinator]
--------
 0                 set        0      0      0
 1               group        1      1      0
 2                 int        2      0      0
 3                push        2      0      0
 4                 int        2      1      0
 5                push        2      0      0
 6                 int        2      2      0
 7                push        2      0      0
 8                 int        2      3      0
 9                push        2      0      0
10                 int        2      4      0
11                push        2      0      0
12               array        2      5      0
13    cursor_open_expr        0      2     15
14                 jmp       19      0      0
15         cursor_read        3      0      0
16                push        3      0      0
17         group_write        1      0      0
18         cursor_next        0     15      0
19        cursor_close        0      0      0
20                 int        2      1      0
21           cntr_init        1      1      2
22    cursor_open_expr        1      1     24
23                 jmp       32      0      0
24         cursor_read        2      1      0
25                 int        3      1      0
26                 gte        4      2      3
27                jntr       31      4      0
28            cntr_gte        1      1     31
29         cursor_read        2      1      0
30             set_add        0      2      0
31         cursor_next        1     24      0
32        cursor_close        1      0      0
33             cte_set        0      0      0
34                body        0      0      0
35                 ret        0      0      0

"]
select * from [0,1,2,3,4] group by * having * >= 1 offset 1
[2, 3, 4]
select * from [0,1,2,3,4] group by * having * >= 1 offset 2
[3, 4]
select * from [0,1,2,3,4] group by * having * >= 1 offset 3
[4]
disconnect S0
close E0
