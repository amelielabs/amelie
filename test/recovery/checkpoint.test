#

open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }], "shards": 3
connect E0 S0 localhost:3485

# test: default checkpoint
show checkpoint

# test: checkpoint (no data)
checkpoint
show checkpoint

# test: create table
create distributed table test (id int primary key serial)
show lsn

# test: checkpoint
checkpoint
show lsn
show checkpoint

# test: restart/recover
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485
show lsn
show checkpoint
select * from test

# test: insert
insert into test () values (), (), ()
select serial("public", "test")

# test: restart/recover (checkpoint + wal)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485

show lsn
show checkpoint
select serial("public", "test")
select * from test

# test: checkpoint
checkpoint
show lsn
show checkpoint

# test: restart/recover (checkpoint)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485

show lsn
show checkpoint
select serial("public", "test")
select * from test

# test: create schema
create schema test
alter table public.test rename to test.test
show lsn

# test: restart/recover (checkpoint + wal)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485

show lsn
show checkpoint
show schemas
select serial("test", "test")
select * from test.test

# test: checkpoint
checkpoint
show lsn
show checkpoint

# test: restart/recover (checkpoint)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485

show lsn
show checkpoint
show schemas
select serial("test", "test")
select * from test.test

# test: create view
create view test_view as select [1,2,3]
show lsn
select * from test_view

# test: restart/recover (checkpoint + wal)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485

show lsn
show checkpoint
show schemas
select serial("test", "test")
select * from test.test
select * from test_view

# test: checkpoint
checkpoint
show lsn
show checkpoint

# test: restart/recover (checkpoint)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485

show lsn
show checkpoint
show schemas
select serial("test", "test")
select * from test.test
select * from test_view

# test: drop
drop view test_view
drop table test.test
show lsn

# test: restart/recover (checkpoint + wal)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485

show lsn
show checkpoint
show views
show tables

# test: checkpoint
checkpoint
show lsn
show checkpoint

# test: restart/recover (checkpoint)
disconnect S0
close E0
open E0
connect E0 S0 localhost:3485

show lsn
show checkpoint
show views
show tables

disconnect S0
close E0
