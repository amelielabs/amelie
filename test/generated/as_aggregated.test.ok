open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }]
connect E0 S0 localhost:3485
# test: as (expr) aggregated parsing
create table test (id int primary key, data int as (1) aggregated
{"msg": "CREATE TABLE name (name type <,)> expected"}
# test: insert on conflict do aggregate (without aggregated columns)
create table test (id int primary key, data int)
insert into test values (0, 0) on conflict do aggregate
insert into test values (0, 0) on conflict do aggregate
select * from test
[[0, 0]]
drop table test
# test: insert on conflict do aggregate (key column)
create table test (id int primary key as (42) aggregated)
{"msg": "AS AGGREGATED cannot be used with keys"}
# test: insert on conflict do aggregate
create table test (id int primary key, data int as (data + 1) aggregated)
insert into test values (0, 0) on conflict do aggregate
insert into test values (0, 0) on conflict do aggregate
insert into test values (0, 0) on conflict do aggregate
insert into test values (0, 0) on conflict do aggregate
select * from test
[[0, 3]]
drop table test
# test: insert on conflict do aggregate (stored and aggregated)
create table test (id int primary key, data int as (777) stored as (data + 1) aggregated)
insert into test values (0, 0) on conflict do aggregate
insert into test values (0, 0) on conflict do aggregate
insert into test values (0, 0) on conflict do aggregate
insert into test values (0, 0) on conflict do aggregate
select * from test
[[0, 780]]
drop table test
# test: aggregated table
create aggregated table test (id int primary key, hits int default 1 as (hits + 1) aggregated)
insert into test (id) values (0), (1), (2)
insert into test (id) values (0), (1), (2)
insert into test (id) values (0), (1), (2)
select * from test
[[0, 3], [1, 3], [2, 3]]
drop table test
# test: aggregated table (shared)
create shared aggregated table test (id int primary key, hits int default 1 as (hits + 1) aggregated)
insert into test (id) values (0), (1), (2)
insert into test (id) values (0), (1), (2)
insert into test (id) values (0), (1), (2)
select * from test
[[0, 3], [1, 3], [2, 3]]
drop table test
# test: aggregated table (distributed)
create shared aggregated table test (id int primary key, hits int default 1 as (hits + 1) aggregated)
insert into test (id) values (0), (1), (2)
insert into test (id) values (0), (1), (2)
insert into test (id) values (0), (1), (2)
select * from test
[[0, 3], [1, 3], [2, 3]]
drop table test
disconnect S0
close E0
