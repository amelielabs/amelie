#

open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }];
connect E0 S0 127.0.0.1:3485;

create table test (id int primary key, a int, b int) partitions 1;

# test: create tier parsing
create tier;
create tier 1;
create tier i;
create tier i 1;
create tier i on;
create tier i on test 1;
create tier i on test (;
create tier i on test (,;

# test: create tier
create tier t on test;
select show('tier', 't', 'test', true).name;
drop tier t on test;
show tiers on test;

# test: create tier if not exists
create tier t on test ();
create tier if not exists t on test;
select show('tier', 't', 'test', true).name;
drop tier t on test;
show tiers on test;
show tier t on test;

# test: create tier on storage main
create tier t on test on storage;
create tier t on test on storage x;
show tiers on test;
show tier t on test;

create tier t on test on storage main (id "00000000-0000-0000-0000-000000000000") ;
show tier t on test;
drop tier t on test;

# test: create tier on storage main dup
create tier t on test on storage main, main;

# test: create tier on storage storage
create storage test;
create tier t on test on storage
  test (id "00000000-0000-0000-0000-000000000000"),
  main (id "00000000-0000-0000-0000-000000000001");

show tier t on test;
drop tier t on test;
drop storage test;

# test: drop tier parsing
drop tier;
drop tier 1;
drop tier '1';
drop tier i;
drop tier i 1;
drop tier i on;
drop tier i on 1;

# test: drop tier
create tier t on test on storage main (id "00000000-0000-0000-0000-000000000000") ;
drop tier t on test;
show tier t on test;

# test: drop tier if exists
show tier t on test;
show tier if exists t on test;

# test: drop tier storage 
create storage test;
create tier t on test on storage
  test (id "00000000-0000-0000-0000-000000000000"),
  main (id "00000000-0000-0000-0000-000000000001");

show tier t on test;
# error
drop storage test;
drop tier t on test;
drop storage test;

# test: alter tier parsing
alter;
alter tier;
alter tier 1;
alter tier if;
alter tier if not;
alter tier if exists;
alter tier i;
alter tier i 1;
alter tier i on;
alter tier i on test;
alter tier i on test 1;
alter tier i on test rename;
alter tier i on test rename 1;
alter tier i on test rename to;
alter tier i on test rename to 1;
alter tier i on test rename to;

# test: alter tier rename
create tier t on test on storage main (id "00000000-0000-0000-0000-000000000000");
show tier t on test;

alter tier t on test rename to z;
show tier t on test;
show tier z on test;

# test: alter tier rename if exists
alter tier if exists t on test rename to z;
show tier t on test;
show tier z on test;

# test: alter tier rename (conflict)
alter tier z on test rename to z;
show tier z on test;
drop tier z on test;

# test: alter tier storage add
create storage test;
create tier t on test on storage main (id "00000000-0000-0000-0000-000000000000");
show tier t on test;

alter tier t on test add;
alter tier t on test add storage;
alter tier t on test add storage x;
alter tier t on test add storage test (id "00000000-0000-0000-0000-000000000000");
show tier t on test;

# test: alter tier storage add if not exists
alter tier t on test add storage test;
alter tier t on test add storage if not exists test;
show tier t on test;

# test: alter tier storage drop
drop storage test;

alter tier t on test drop;
alter tier t on test drop storage;
alter tier t on test drop storage x;
alter tier t on test drop storage test;
show tier t on test;

# test: alter tier storage drop if exists
alter tier t on test drop storage test;
alter tier t on test drop storage if exists test;
show tier t on test;
drop storage test;
drop tier t on test;

# test: alter tier storage pause
create storage test;
create tier t on test on storage
  main (id "00000000-0000-0000-0000-000000000000"),
  test (id "00000000-0000-0000-0000-000000000001");
show tier t on test;

alter tier t on test pause;
alter tier t on test pause storage;
alter tier t on test pause storage test;
show tier t on test;

# test: alter tier storage pause (one must remain)
alter tier t on test pause storage main;

# test: alter tier storage resume
alter tier t on test resume;
alter tier t on test resume storage;
alter tier t on test resume storage test;
show tier t on test;

drop tier t on test;

# test: alter tier set
create tier t on test on storage main (id "00000000-0000-0000-0000-000000000000");
alter tier t on test set (region_size 123);
show tier t on test;

drop table test;

## test: table on storage (pause/resume)
#create storage a;
#create storage b;
#create storage c;

#create table test (id int primary key, a int, b int) partitions 5
    #on storage
       #a (id "00000000-0000-0000-0000-000000000000"),
       #b (id "00000000-0000-0000-0000-000000000001"),
       #c (id "00000000-0000-0000-0000-000000000002");

#show partitions on test;

#alter tier main on test pause storage b;
#alter tier main on test pause storage c;
#show tiers on test;

## a
#alter partition 13 on test refresh;
#show partition '14' on test;

## a
#alter partition 14 on test refresh;
#show partition '15' on test;

#alter tier main on test resume storage c;

## c
#alter partition 15 on test refresh;
#show partition '16' on test;

#drop table test;
#drop storage a;
#drop storage b;
#drop storage c;

disconnect S0;
close E0;
