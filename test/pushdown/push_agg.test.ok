open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }], "backends": 3
connect E0 S0 127.0.0.1:3485
# test: select count(*) from table empty
create table test_empty (id int primary key, data int, data2 double)
create table test_null (id int primary key, data int, data2 double)
insert into test_null values (0, null, null)
create table test (id int primary key, data int, data2 double)
insert into test values (0, 0, 0.0)
insert into test values (1, 0, 0.0)
insert into test values (2, 1, 1.0)
insert into test values (3, 1, 1.0)
insert into test values (4, 2  2.0)
insert into test values (5, null, null)
insert into test values (6, 3, 3.1)
explain select count(*) from test_empty
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test_empty",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      27     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "count               2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "content             1      -      -     ",
      "14": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test_empty (primary)",
      "02": "bool                1      1      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      27    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "bool                1      1      0     ",
      "11": "push                1      0      0     ",
      "12": "set_get             1      0      0     ",
      "13": "null                2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_agg             0      1      27    ",
      "16": "set_sort            0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  },
  "access": [["public.test_empty", "ro"]]
}]
select count(*) from test_empty
[0]
# test: select count(*) from table
select * from test
[[0, 0, 0], [1, 0, 0], [3, 1, 1], [4, 2, 2], [5, null, null], [6, 3, 3.1], [2, 1, 1]]
explain select count(*) from test
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "count               2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "content             1      -      -     ",
      "14": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "bool                1      1      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "bool                1      1      0     ",
      "11": "push                1      0      0     ",
      "12": "set_get             1      0      0     ",
      "13": "null                2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_agg             0      1      21    ",
      "16": "set_sort            0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select count(*) from test
[7]
# test: select count(column) from table
explain select count(id) from test
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "count               2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "content             1      -      -     ",
      "14": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "bool                1      1      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "table_readi32       2      0      0     ",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "bool                1      1      0     ",
      "11": "push                1      0      0     ",
      "12": "set_get             1      0      0     ",
      "13": "null                2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_agg             0      1      21    ",
      "16": "set_sort            0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select count(id) from test
[7]
# test: select count(null) from table
explain select count(data) from test
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "count               2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "content             1      -      -     ",
      "14": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "bool                1      1      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "table_readi32       2      0      1     ",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "bool                1      1      0     ",
      "11": "push                1      0      0     ",
      "12": "set_get             1      0      0     ",
      "13": "null                2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_agg             0      1      21    ",
      "16": "set_sort            0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select count(data) from test
[6]
explain select count(data) from test_null
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test_null",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      26     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "count               2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "content             1      -      -     ",
      "14": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test_null (primary)",
      "02": "bool                1      1      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "table_readi32       2      0      1     ",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      26    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "bool                1      1      0     ",
      "11": "push                1      0      0     ",
      "12": "set_get             1      0      0     ",
      "13": "null                2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_agg             0      1      26    ",
      "16": "set_sort            0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  },
  "access": [["public.test_null", "ro"]]
}]
select count(data) from test_null
[0]
# test: select count(any) from table
select count('string') from test_null
[1]
select count([]) from test_null
[1]
# test: select count(distinct *) from table
explain select count(distinct *) from test
{"msg": "explain select count(distinct ❰*❱ ⟵ * cannot be used with DISTINCT"}
# test: select count(distinct) from table
explain select count(distinct id) from test
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      24     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "count               2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "content             1      -      -     ",
      "14": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "set_ordered         1      0      3     ",
      "02": "set_assign          0      1      0     ",
      "03": "table_open_part     0      4      11    # public.test (primary)",
      "04": "bool                1      1      0     ",
      "05": "push                1      0      0     ",
      "06": "set_get             1      0      0     ",
      "07": "table_readi32       2      0      0     ",
      "08": "push                2      0      0     ",
      "09": "set_agg             0      1      24    ",
      "10": "table_next          0      4      0     ",
      "11": "table_close         0      0      0     ",
      "12": "bool                1      1      0     ",
      "13": "push                1      0      0     ",
      "14": "set_get             1      0      0     ",
      "15": "null                2      0      0     ",
      "16": "push                2      0      0     ",
      "17": "set_agg             0      1      24    ",
      "18": "set_sort            0      0      0     ",
      "19": "result              0      0      0     ",
      "20": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select count(distinct id) from test
[7]
select count(distinct data) from test
[4]
select count(distinct data2) from test
[4]
select count(distinct data), count(distinct data2) from test
[[4, 4]]
select count(distinct data), count(distinct data2), count(distinct data) from test
[[4, 4, 4]]
select count(distinct 1), count(1), count(distinct null) from test
[[1, 7, 0]]
# test: select sum(column int) from table empty
explain select sum(id) from test_empty
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test_empty",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      27     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "agg                 2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "content             1      -      -     ",
      "14": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test_empty (primary)",
      "02": "bool                1      1      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "table_readi32       2      0      0     ",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      27    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "bool                1      1      0     ",
      "11": "push                1      0      0     ",
      "12": "set_get             1      0      0     ",
      "13": "null                2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_agg             0      1      27    ",
      "16": "set_sort            0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  },
  "access": [["public.test_empty", "ro"]]
}]
select sum(id) from test_empty
[null]
# test: select sum(column int) from table
explain select sum(id) from test
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "agg                 2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "content             1      -      -     ",
      "14": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "bool                1      1      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "table_readi32       2      0      0     ",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "bool                1      1      0     ",
      "11": "push                1      0      0     ",
      "12": "set_get             1      0      0     ",
      "13": "null                2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_agg             0      1      21    ",
      "16": "set_sort            0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select sum(id) from test
[21]
select sum(data) from test
[7]
# test: select sum(column double) from table empty
explain select sum(data2) from test_empty
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test_empty",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      27     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "agg                 2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "content             1      -      -     ",
      "14": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test_empty (primary)",
      "02": "bool                1      1      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "table_readf64       2      0      2     ",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      27    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "bool                1      1      0     ",
      "11": "push                1      0      0     ",
      "12": "set_get             1      0      0     ",
      "13": "null                2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_agg             0      1      27    ",
      "16": "set_sort            0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  },
  "access": [["public.test_empty", "ro"]]
}]
select sum(data2) from test_empty
[null]
# test: select sum(column double) from table
explain select sum(data2) from test
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "agg                 2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "content             1      -      -     ",
      "14": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "bool                1      1      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "table_readf64       2      0      2     ",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "bool                1      1      0     ",
      "11": "push                1      0      0     ",
      "12": "set_get             1      0      0     ",
      "13": "null                2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_agg             0      1      21    ",
      "16": "set_sort            0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select sum(data2) from test_empty
[null]
# test: select sum(any) from table
explain select sum('string') from test
{"msg": "explain select sum(❰'string'❱ ⟵ int or double expected"}
select sum('string') from test
{"msg": "select sum(❰'string'❱ ⟵ int or double expected"}
# test: select sum(null) from table
explain select sum(data) from test_null
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test_null",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      26     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "agg                 2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "content             1      -      -     ",
      "14": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test_null (primary)",
      "02": "bool                1      1      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "table_readi32       2      0      1     ",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      26    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "bool                1      1      0     ",
      "11": "push                1      0      0     ",
      "12": "set_get             1      0      0     ",
      "13": "null                2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_agg             0      1      26    ",
      "16": "set_sort            0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  },
  "access": [["public.test_null", "ro"]]
}]
select sum(data) from test_null
[null]
# test: select avg(column int) from table empty
select avg(id) from test_empty
[null]
# test: select avg(column int) from table
explain select avg(id) from test
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "avgi                2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "content             1      -      -     ",
      "14": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "bool                1      1      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "table_readi32       2      0      0     ",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "bool                1      1      0     ",
      "11": "push                1      0      0     ",
      "12": "set_get             1      0      0     ",
      "13": "null                2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_agg             0      1      21    ",
      "16": "set_sort            0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select avg(id) from test
[3]
select avg(data) from test
[1]
# test: select avg(column double) from table empty
select avg(data2) from test_empty
[null]
# test: select avg(column int) from table
select avg(data2) from test
[1.18333]
# test: select avg(any) from table
explain select avg('string') from test
{"msg": "explain select avg(❰'string'❱ ⟵ int or double expected"}
select avg('string') from test
{"msg": "select avg(❰'string'❱ ⟵ int or double expected"}
# test: select avg(null) from table
explain select avg(data2) from test_null
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test_null",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      26     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "avgf                2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "content             1      -      -     ",
      "14": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test_null (primary)",
      "02": "bool                1      1      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "table_readf64       2      0      2     ",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      26    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "bool                1      1      0     ",
      "11": "push                1      0      0     ",
      "12": "set_get             1      0      0     ",
      "13": "null                2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_agg             0      1      26    ",
      "16": "set_sort            0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  },
  "access": [["public.test_null", "ro"]]
}]
select avg(data2) from test_null
[null]
# test: select min(column int) from table empty
select min(id) from test_empty
[null]
# test: select min(column int) from table
select min(id) from test
[0]
select min(data) from test
[0]
# test: select min(column double) from table empty
select min(data2) from test_empty
[null]
# test: select min(column double) from table
select min(data2) from test
[0]
# test: select min(null) from table
explain select min(data2) from test_null
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test_null",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      26     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "agg                 2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "content             1      -      -     ",
      "14": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test_null (primary)",
      "02": "bool                1      1      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "table_readf64       2      0      2     ",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      26    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "bool                1      1      0     ",
      "11": "push                1      0      0     ",
      "12": "set_get             1      0      0     ",
      "13": "null                2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_agg             0      1      26    ",
      "16": "set_sort            0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  },
  "access": [["public.test_null", "ro"]]
}]
select min(data2) from test_null
[null]
# test: select max(column int) from table empty
select max(id) from test_empty
[null]
# test: select max(column int) from table
select max(id) from test
[6]
select max(data) from test
[3]
# test: select max(column double) from table empty
select max(data2) from test_empty
[null]
# test: select max(column double) from table
select max(data2) from test
[3.1]
# test: select max(null) from table
explain select max(data2) from test_null
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test_null",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      26     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "agg                 2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "content             1      -      -     ",
      "14": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test_null (primary)",
      "02": "bool                1      1      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "table_readf64       2      0      2     ",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      26    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "bool                1      1      0     ",
      "11": "push                1      0      0     ",
      "12": "set_get             1      0      0     ",
      "13": "null                2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_agg             0      1      26    ",
      "16": "set_sort            0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  },
  "access": [["public.test_null", "ro"]]
}]
select max(data2) from test_null
[null]
# test: select count(*), min(column), max(column) from table
select count(*), min(id), max(id) from test
[[7, 0, 6]]
select count(*), min(id), max(id), avg(id) from test
[[7, 0, 6, 3]]
# test: select count(*) from table group by column
explain select id, count(*) from test group by id
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      2      0     ",
      "07": "store_open          1      0      14    ",
      "08": "store_read          2      1      1     ",
      "09": "push                2      0      0     ",
      "10": "count               2      1      0     ",
      "11": "push                2      0      0     ",
      "12": "set_add             1      0      0     ",
      "13": "store_next          1      8      0     ",
      "14": "store_close         1      1      0     ",
      "15": "content             1      -      -     ",
      "16": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "table_readi32       1      0      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "set_sort            0      0      0     ",
      "11": "result              0      0      0     ",
      "12": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select id, count(*) from test group by id
[[0, 1], [1, 1], [2, 1], [3, 1], [4, 1], [5, 1], [6, 1]]
select data, count(*) from test group by data
[[null, 1], [0, 2], [1, 2], [2, 1], [3, 1]]
select data2, count(*) from test group by data2
[[null, 1], [0, 2], [1, 2], [2, 1], [3.1, 1]]
select data, count(*) from test_empty group by data
[]
select data, count(*) from test_null group by data
[[null, 1]]
# test: select count(*) from table group by 1
explain select id, count(*) from test group by 1
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      2      0     ",
      "07": "store_open          1      0      14    ",
      "08": "store_read          2      1      1     ",
      "09": "push                2      0      0     ",
      "10": "count               2      1      0     ",
      "11": "push                2      0      0     ",
      "12": "set_add             1      0      0     ",
      "13": "store_next          1      8      0     ",
      "14": "store_close         1      1      0     ",
      "15": "content             1      -      -     ",
      "16": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "table_readi32       1      0      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "set_sort            0      0      0     ",
      "11": "result              0      0      0     ",
      "12": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select id, count(*) from test group by 1
[[0, 1], [1, 1], [2, 1], [3, 1], [4, 1], [5, 1], [6, 1]]
select data, count(*) from test group by 1
[[null, 1], [0, 2], [1, 2], [2, 1], [3, 1]]
select data2, count(*) from test group by 1
[[null, 1], [0, 2], [1, 2], [2, 1], [3.1, 1]]
select data, count(*) from test_empty group by 1
[]
select data, count(*) from test_null group by 1
[[null, 1]]
# test: select from (select count(*) from table)
explain select * from (select count(*) from test) t
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      12    ",
      "08": "count               2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "set_add             1      0      0     ",
      "11": "store_next          1      8      0     ",
      "12": "store_close         1      1      0     ",
      "13": "set                 0      1      0     ",
      "14": "ref                 2      1      0     ",
      "15": "store_open          0      2      20    ",
      "16": "store_read          3      0      0     ",
      "17": "push                3      0      0     ",
      "18": "set_add             0      0      0     ",
      "19": "store_next          0      16     0     ",
      "20": "store_close         0      1      0     ",
      "21": "content             0      -      -     ",
      "22": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "bool                1      1      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "bool                1      1      0     ",
      "11": "push                1      0      0     ",
      "12": "set_get             1      0      0     ",
      "13": "null                2      0      0     ",
      "14": "push                2      0      0     ",
      "15": "set_agg             0      1      21    ",
      "16": "set_sort            0      0      0     ",
      "17": "result              0      0      0     ",
      "18": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select * from (select count(*) from test) t
[7]
# test: select from (select count(*) from table group by)
explain select * from (select id, count(*) from test group by id) t
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      2      0     ",
      "07": "store_open          1      0      14    ",
      "08": "store_read          2      1      1     ",
      "09": "push                2      0      0     ",
      "10": "count               2      1      0     ",
      "11": "push                2      0      0     ",
      "12": "set_add             1      0      0     ",
      "13": "store_next          1      8      0     ",
      "14": "store_close         1      1      0     ",
      "15": "set                 0      2      0     ",
      "16": "ref                 2      1      0     ",
      "17": "store_open          0      2      24    ",
      "18": "store_read          3      0      0     ",
      "19": "push                3      0      0     ",
      "20": "store_read          3      0      1     ",
      "21": "push                3      0      0     ",
      "22": "set_add             0      0      0     ",
      "23": "store_next          0      18     0     ",
      "24": "store_close         0      1      0     ",
      "25": "content             0      -      -     ",
      "26": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "table_readi32       1      0      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "set_sort            0      0      0     ",
      "11": "result              0      0      0     ",
      "12": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select * from (select id, count(*) from test group by id) t
[[0, 1], [1, 1], [2, 1], [3, 1], [4, 1], [5, 1], [6, 1]]
select * from (select data, count(*) from test group by data) t
[[null, 1], [0, 2], [1, 2], [2, 1], [3, 1]]
select * from (select data, count(*) from test_empty group by data) t
[]
select * from (select data, count(*) from test_null group by data) t
[[null, 1]]
# test: select * from table order by count(*)
select * from test order by count(*)
{"msg": "select ❰*❱ ⟵ column test.id must appear in the GROUP BY clause or be used by an aggregate function"}
select id from test order by count(*)
{"msg": "select ❰id❱ ⟵ column id must appear in the GROUP BY clause or be used by an aggregate function"}
select 1 from test order by count(id)
[1]
# test: select count(*) from table order by 1
select count(*) from test order by 1
[7]
# test: select count(*) as from table order by alias
select count(*) as c from test order by c
[7]
# test: select count(*) from table group by column order by column
explain select id, count(*) from test group by id order by id
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set_ordered         1      2      1     ",
      "07": "store_open          1      0      16    ",
      "08": "store_read          2      1      1     ",
      "09": "push                2      0      0     ",
      "10": "count               2      1      0     ",
      "11": "push                2      0      0     ",
      "12": "store_read          2      1      1     ",
      "13": "push                2      0      0     ",
      "14": "set_add             1      0      0     ",
      "15": "store_next          1      8      0     ",
      "16": "store_close         1      1      0     ",
      "17": "set_sort            1      0      0     ",
      "18": "content             1      -      -     ",
      "19": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "table_readi32       1      0      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "set_sort            0      0      0     ",
      "11": "result              0      0      0     ",
      "12": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select id, count(*) from test group by id order by id
[[0, 1], [1, 1], [2, 1], [3, 1], [4, 1], [5, 1], [6, 1]]
select id, count(*) from test group by id order by data
{"msg": "select id, count(*) from test group by id order by ❰data❱ ⟵ column data must appear in the GROUP BY clause or be used by an aggregate function"}
# test: select count(*) from table group by 1 order by 1
explain select id, count(*) from test group by 1 order by 1
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set_ordered         1      2      1     ",
      "07": "store_open          1      0      16    ",
      "08": "store_read          2      1      1     ",
      "09": "push                2      0      0     ",
      "10": "count               2      1      0     ",
      "11": "push                2      0      0     ",
      "12": "store_read          2      1      1     ",
      "13": "push                2      0      0     ",
      "14": "set_add             1      0      0     ",
      "15": "store_next          1      8      0     ",
      "16": "store_close         1      1      0     ",
      "17": "set_sort            1      0      0     ",
      "18": "content             1      -      -     ",
      "19": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "table_readi32       1      0      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "set_sort            0      0      0     ",
      "11": "result              0      0      0     ",
      "12": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select id, count(*) from test group by 1 order by 1
[[0, 1], [1, 1], [2, 1], [3, 1], [4, 1], [5, 1], [6, 1]]
select data, count(*) from test group by 1 order by 1
[[null, 1], [0, 2], [1, 2], [2, 1], [3, 1]]
select data2, count(*) from test group by 1 order by 1
[[null, 1], [0, 2], [1, 2], [2, 1], [3.1, 1]]
select data, count(*) from test_empty group by 1 order by 1
[]
select data, count(*) from test_null group by 1 order by 1
[[null, 1]]
# test: select from table having (without group by)
select * from test having count(id) > 0
{"msg": "select * from test ❰having❱ ⟵ ; expected"}
select id from test having count(id) > 0
{"msg": "select id from test ❰having❱ ⟵ ; expected"}
select 1 from test having count(id) > 0
{"msg": "select 1 from test ❰having❱ ⟵ ; expected"}
# test: select from table group by having
select id, count(*) from test group by 1
[[0, 1], [1, 1], [2, 1], [3, 1], [4, 1], [5, 1], [6, 1]]
select id, count(*) from test group by 1 having id > 5
[[6, 1]]
select id, count(*) from test group by id having id > 5
[[6, 1]]
explain select id, count(*) from test group by 1 having id > 5
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      2      0     ",
      "07": "store_open          1      0      18    ",
      "08": "store_read          2      1      1     ",
      "09": "int                 3      -      0     # 5",
      "10": "gtii                4      2      3     ",
      "11": "jntr                17     4      0     ",
      "12": "store_read          2      1      1     ",
      "13": "push                2      0      0     ",
      "14": "count               2      1      0     ",
      "15": "push                2      0      0     ",
      "16": "set_add             1      0      0     ",
      "17": "store_next          1      8      0     ",
      "18": "store_close         1      1      0     ",
      "19": "content             1      -      -     ",
      "20": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "table_readi32       1      0      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "set_sort            0      0      0     ",
      "11": "result              0      0      0     ",
      "12": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
# test: select from table group by order by having
select id, count(*) from test group by 1 order by 1
[[0, 1], [1, 1], [2, 1], [3, 1], [4, 1], [5, 1], [6, 1]]
select id, count(*) from test group by 1 having id > 5 order by 1
[[6, 1]]
select id, count(*) from test group by id having id > 5 order by id
[[6, 1]]
# test: select count(*) from table group by having order by
select id, count(*) from test group by id having id >= 3 and id < 6 order by id
[[3, 1], [4, 1], [5, 1]]
select id, count(*) from test group by 1 having id >= 3 and id < 6 order by 1
[[3, 1], [4, 1], [5, 1]]
# test: select from table group by having count(column)
explain select id from test group by id having count(id) > 0
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      16    ",
      "08": "count               2      1      0     ",
      "09": "int                 3      -      0     # 0",
      "10": "gtii                4      2      3     ",
      "11": "jntr                15     4      0     ",
      "12": "store_read          2      1      1     ",
      "13": "push                2      0      0     ",
      "14": "set_add             1      0      0     ",
      "15": "store_next          1      8      0     ",
      "16": "store_close         1      1      0     ",
      "17": "content             1      -      -     ",
      "18": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "table_readi32       1      0      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "table_readi32       2      0      0     ",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "set_sort            0      0      0     ",
      "11": "result              0      0      0     ",
      "12": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select id from test group by id having count(id) > 0
[0, 1, 2, 3, 4, 5, 6]
select data from test group by data
[null, 0, 1, 2, 3]
select data from test
[0, 0, 1, 2, null, 3, 1]
select data from test group by data having count(data) > 1
[0, 1]
# test: select from table group by having count(*)
explain select id from test group by id having count(*) > 0
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      1      0     ",
      "07": "store_open          1      0      16    ",
      "08": "count               2      1      0     ",
      "09": "int                 3      -      0     # 0",
      "10": "gtii                4      2      3     ",
      "11": "jntr                15     4      0     ",
      "12": "store_read          2      1      1     ",
      "13": "push                2      0      0     ",
      "14": "set_add             1      0      0     ",
      "15": "store_next          1      8      0     ",
      "16": "store_close         1      1      0     ",
      "17": "content             1      -      -     ",
      "18": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "table_readi32       1      0      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "set_sort            0      0      0     ",
      "11": "result              0      0      0     ",
      "12": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select id from test group by id having count(*) > 0
[0, 1, 2, 3, 4, 5, 6]
explain select id, count(*) from test group by id having count(*) > 0
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      2      0     ",
      "07": "store_open          1      0      18    ",
      "08": "count               2      1      1     ",
      "09": "int                 3      -      0     # 0",
      "10": "gtii                4      2      3     ",
      "11": "jntr                17     4      0     ",
      "12": "store_read          2      1      2     ",
      "13": "push                2      0      0     ",
      "14": "count               2      1      0     ",
      "15": "push                2      0      0     ",
      "16": "set_add             1      0      0     ",
      "17": "store_next          1      8      0     ",
      "18": "store_close         1      1      0     ",
      "19": "content             1      -      -     ",
      "20": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      2      1     ",
      "01": "table_open_part     0      1      11    # public.test (primary)",
      "02": "table_readi32       1      0      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "int                 2      -      0     # 1",
      "08": "push                2      0      0     ",
      "09": "set_agg             0      1      21    ",
      "10": "table_next          0      2      0     ",
      "11": "table_close         0      0      0     ",
      "12": "set_sort            0      0      0     ",
      "13": "result              0      0      0     ",
      "14": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select id, count(*) from test group by id having count(*) > 0
[[0, 1], [1, 1], [2, 1], [3, 1], [4, 1], [5, 1], [6, 1]]
explain select id, count(*) from test group by 1 having count(*) > 0
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      2      0     ",
      "07": "store_open          1      0      18    ",
      "08": "count               2      1      1     ",
      "09": "int                 3      -      0     # 0",
      "10": "gtii                4      2      3     ",
      "11": "jntr                17     4      0     ",
      "12": "store_read          2      1      2     ",
      "13": "push                2      0      0     ",
      "14": "count               2      1      0     ",
      "15": "push                2      0      0     ",
      "16": "set_add             1      0      0     ",
      "17": "store_next          1      8      0     ",
      "18": "store_close         1      1      0     ",
      "19": "content             1      -      -     ",
      "20": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      2      1     ",
      "01": "table_open_part     0      1      11    # public.test (primary)",
      "02": "table_readi32       1      0      0     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "int                 2      -      0     # 1",
      "08": "push                2      0      0     ",
      "09": "set_agg             0      1      21    ",
      "10": "table_next          0      2      0     ",
      "11": "table_close         0      0      0     ",
      "12": "set_sort            0      0      0     ",
      "13": "result              0      0      0     ",
      "14": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
explain select data, count(*) from test group by data having count(*) > 0
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      2      0     ",
      "07": "store_open          1      0      18    ",
      "08": "count               2      1      1     ",
      "09": "int                 3      -      0     # 0",
      "10": "gtii                4      2      3     ",
      "11": "jntr                17     4      0     ",
      "12": "store_read          2      1      2     ",
      "13": "push                2      0      0     ",
      "14": "count               2      1      0     ",
      "15": "push                2      0      0     ",
      "16": "set_add             1      0      0     ",
      "17": "store_next          1      8      0     ",
      "18": "store_close         1      1      0     ",
      "19": "content             1      -      -     ",
      "20": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      2      1     ",
      "01": "table_open_part     0      1      11    # public.test (primary)",
      "02": "table_readi32       1      0      1     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "int                 2      -      0     # 1",
      "08": "push                2      0      0     ",
      "09": "set_agg             0      1      21    ",
      "10": "table_next          0      2      0     ",
      "11": "table_close         0      0      0     ",
      "12": "set_sort            0      0      0     ",
      "13": "result              0      0      0     ",
      "14": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select data, count(*) from test group by data having count(*) > 0
[[null, 1], [0, 2], [1, 2], [2, 1], [3, 1]]
explain select data, count(*) from test group by 1 having count(*) > 0
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      2      0     ",
      "07": "store_open          1      0      18    ",
      "08": "count               2      1      1     ",
      "09": "int                 3      -      0     # 0",
      "10": "gtii                4      2      3     ",
      "11": "jntr                17     4      0     ",
      "12": "store_read          2      1      2     ",
      "13": "push                2      0      0     ",
      "14": "count               2      1      0     ",
      "15": "push                2      0      0     ",
      "16": "set_add             1      0      0     ",
      "17": "store_next          1      8      0     ",
      "18": "store_close         1      1      0     ",
      "19": "content             1      -      -     ",
      "20": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      2      1     ",
      "01": "table_open_part     0      1      11    # public.test (primary)",
      "02": "table_readi32       1      0      1     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "int                 2      -      0     # 1",
      "08": "push                2      0      0     ",
      "09": "set_agg             0      1      21    ",
      "10": "table_next          0      2      0     ",
      "11": "table_close         0      0      0     ",
      "12": "set_sort            0      0      0     ",
      "13": "result              0      0      0     ",
      "14": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
explain select data, count(*) from test group by data having count(*) > 1
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      2      0     ",
      "07": "store_open          1      0      18    ",
      "08": "count               2      1      1     ",
      "09": "int                 3      -      0     # 1",
      "10": "gtii                4      2      3     ",
      "11": "jntr                17     4      0     ",
      "12": "store_read          2      1      2     ",
      "13": "push                2      0      0     ",
      "14": "count               2      1      0     ",
      "15": "push                2      0      0     ",
      "16": "set_add             1      0      0     ",
      "17": "store_next          1      8      0     ",
      "18": "store_close         1      1      0     ",
      "19": "content             1      -      -     ",
      "20": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      2      1     ",
      "01": "table_open_part     0      1      11    # public.test (primary)",
      "02": "table_readi32       1      0      1     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "int                 2      -      0     # 1",
      "08": "push                2      0      0     ",
      "09": "set_agg             0      1      21    ",
      "10": "table_next          0      2      0     ",
      "11": "table_close         0      0      0     ",
      "12": "set_sort            0      0      0     ",
      "13": "result              0      0      0     ",
      "14": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select data, count(*) from test group by data having count(*) > 1
[[0, 2], [1, 2]]
explain select data, count(*) from test group by 1  having count(*) > 1
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set                 1      2      0     ",
      "07": "store_open          1      0      18    ",
      "08": "count               2      1      1     ",
      "09": "int                 3      -      0     # 1",
      "10": "gtii                4      2      3     ",
      "11": "jntr                17     4      0     ",
      "12": "store_read          2      1      2     ",
      "13": "push                2      0      0     ",
      "14": "count               2      1      0     ",
      "15": "push                2      0      0     ",
      "16": "set_add             1      0      0     ",
      "17": "store_next          1      8      0     ",
      "18": "store_close         1      1      0     ",
      "19": "content             1      -      -     ",
      "20": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      2      1     ",
      "01": "table_open_part     0      1      11    # public.test (primary)",
      "02": "table_readi32       1      0      1     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "int                 2      -      0     # 1",
      "08": "push                2      0      0     ",
      "09": "set_agg             0      1      21    ",
      "10": "table_next          0      2      0     ",
      "11": "table_close         0      0      0     ",
      "12": "set_sort            0      0      0     ",
      "13": "result              0      0      0     ",
      "14": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
# test: select as from table group by having alias (unsupported)
select data, count(*) as c from test group by data having c > 1
{"msg": "select data, count(*) as c from test group by data having ❰c❱ ⟵ column c must appear in the GROUP BY clause or be used by an aggregate function"}
# test: select distinct from table group by
explain select data, count(*) from test group by data order by data
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set_ordered         1      2      1     ",
      "07": "store_open          1      0      16    ",
      "08": "store_read          2      1      1     ",
      "09": "push                2      0      0     ",
      "10": "count               2      1      0     ",
      "11": "push                2      0      0     ",
      "12": "store_read          2      1      1     ",
      "13": "push                2      0      0     ",
      "14": "set_add             1      0      0     ",
      "15": "store_next          1      8      0     ",
      "16": "store_close         1      1      0     ",
      "17": "set_sort            1      0      0     ",
      "18": "content             1      -      -     ",
      "19": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "table_readi32       1      0      1     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "set_sort            0      0      0     ",
      "11": "result              0      0      0     ",
      "12": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select data, count(*) from test group by data order by data
[[null, 1], [0, 2], [1, 2], [2, 1], [3, 1]]
explain select count(*) from test group by data order by data
[{
  "bytecode": {
    "frontend": {
      "00": "send_all            0      -      0     # public.test",
      "01": "recv                0      0      0     ",
      "02": "bool                0      1      0     ",
      "03": "push                0      0      0     ",
      "04": "union_recv          0      -1     -1    ",
      "05": "union_set_aggs      0      21     0     ",
      "06": "set_ordered         1      1      1     ",
      "07": "store_open          1      0      14    ",
      "08": "count               2      1      0     ",
      "09": "push                2      0      0     ",
      "10": "store_read          2      1      1     ",
      "11": "push                2      0      0     ",
      "12": "set_add             1      0      0     ",
      "13": "store_next          1      8      0     ",
      "14": "store_close         1      1      0     ",
      "15": "set_sort            1      0      0     ",
      "16": "content             1      -      -     ",
      "17": "ret                 0      0      0     "
    },
    "backend": {
      "00": "set_ordered         0      1      1     ",
      "01": "table_open_part     0      1      9     # public.test (primary)",
      "02": "table_readi32       1      0      1     ",
      "03": "push                1      0      0     ",
      "04": "set_get             1      0      0     ",
      "05": "int                 2      -      0     # 1",
      "06": "push                2      0      0     ",
      "07": "set_agg             0      1      21    ",
      "08": "table_next          0      2      0     ",
      "09": "table_close         0      0      0     ",
      "10": "set_sort            0      0      0     ",
      "11": "result              0      0      0     ",
      "12": "ret                 0      0      0     "
    }
  },
  "access": [["public.test", "ro"]]
}]
select count(*) from test group by data order by data
[1, 2, 2, 1, 1]
select distinct data from test
[null, 0, 1, 2, 3]
select distinct on (data) data from test
[null, 0, 1, 2, 3]
select distinct on (data) id from test
[5, 0, 3, 4, 6]
select distinct data, count(*) from test group by data
[[null, 1], [0, 2], [1, 2], [2, 1], [3, 1]]
select distinct count(*), data from test group by data
[[1, null], [1, 2], [1, 3], [2, 0], [2, 1]]
select distinct count(data), id from test group by id
[[0, 5], [1, 0], [1, 1], [1, 2], [1, 3], [1, 4], [1, 6]]
select distinct on (count(data)) data from test group by data
{"msg": "select distinct on (❰count❱ ⟵ unexpected aggregate function usage"}
# test: select count(distinct) from table group by
select id, count(distinct data), count(distinct data2) from test group by id
[[0, 1, 1], [1, 1, 1], [2, 1, 1], [3, 1, 1], [4, 1, 1], [5, 0, 0], [6, 1, 1]]
select count(data) from test group by data
[0, 2, 2, 1, 1]
select count(distinct data) from test group by data
[0, 1, 1, 1, 1]
select count(distinct data), count(distinct data2) from test group by true
[[4, 4]]
drop table test
drop table test_empty
drop table test_null
disconnect S0
close E0
