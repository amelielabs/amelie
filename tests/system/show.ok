open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }];
connect E0 S0 127.0.0.1:3485;
# test: show statement parsing
show;
{"msg": "show❰;❱ ⟵ name expected"}
show all junk;
{"msg": "show() ⟵ unexpected name argument"}
show 1234;
{"msg": "show ❰1234❱ ⟵ name expected"}
# test: show users
create user test;
show users abc;
{"msg": "show() ⟵ unexpected name argument"}
show users;
[{
  "name": "test"
}]
# test: show user
show user;
{"msg": "show() ⟵ name argument is missing for 'user'"}
show user unknown;
[null]
show user test;
[{
  "name": "test"
}]
show user test;
[{
  "name": "test"
}]
# test: show storages
show storages;
[{
  "name": "main",
  "path": "main"
}]
# test: show storage
show storage;
{"msg": "show() ⟵ name argument is missing for 'storage'"}
show storage main;
[{
  "name": "main",
  "path": "main"
}]
show storage main extended;
[{
  "name": "main",
  "path": "main"
}]
# test: show databases
create database test;
show databases;
[{
  "name": "main"
}, {
  "name": "test"
}]
# test: show database
show database test;
[{
  "name": "test"
}]
drop database test;
# test: show tables
create table test (id int primary key);
show tables;
[{
  "db": "main",
  "name": "test",
  "unlogged": false
}]
# test: show table
show table;
{"msg": "show() ⟵ name argument is missing for 'table'"}
show table test;
[{
  "db": "main",
  "name": "test",
  "unlogged": false
}]
# test: show functions
create function test_fn (id int) return json
begin
	return {
		"a": 2 + 2,
		"b": id
	};
end;
select test_fn(123);
[{
  "a": 4,
  "b": 123
}]
select test_fn(123).a;
[4]
select 123::test_fn().a;
[4]
show functions;
[{
  "db": "main",
  "name": "test_fn"
}]
show functions extended;
[{
  "db": "main",
  "name": "test_fn",
  "text": "begin\n\treturn {\n\t\t\"a\": 2 + 2,\n\t\t\"b\": id\n\t};\nend",
  "type": 5,
  "args": [{
    "name": "id",
    "type": 2,
    "type_size": 4,
    "deleted": false,
    "constraints": [["default", null]]
  }],
  "returning": []
}]
# test: show function;
show function;
{"msg": "show() ⟵ name argument is missing for 'function'"}
show function test_fn;
[{
  "db": "main",
  "name": "test_fn"
}]
show function test_fn extended;
[{
  "db": "main",
  "name": "test_fn",
  "text": "begin\n\treturn {\n\t\t\"a\": 2 + 2,\n\t\t\"b\": id\n\t};\nend",
  "type": 5,
  "args": [{
    "name": "id",
    "type": 2,
    "type_size": 4,
    "deleted": false,
    "constraints": [["default", null]]
  }],
  "returning": []
}]
# test: show wal
show wal;
[{
  "lsn": 5,
  "lsn_min": 1,
  "files": 1,
  "slots": 0,
  "slots_min": -1,
  "writes": 4,
  "writes_bytes": 796,
  "ops": 4
}]
# test: show replicas
show replicas;
[]
# test: show replica
show replica abc;
{"msg": "failed to parse uuid"}
show replica 'abc';
{"msg": "failed to parse uuid"}
show replica '00000000-0000-0000-0000-000000000000';
[null]
# test: show state
show state;
[{
  "version": "0.9.0",
  "directory": "_output/E0",
  "uuid": "00000000-0000-0000-0000-000000000000",
  "frontends": 1,
  "backends": 1,
  "lsn": 5,
  "psn": 1,
  "catalog": 0,
  "catalog_pending": 5,
  "read_only": false
}]
select show('state');
[{
  "version": "0.9.0",
  "directory": "_output/E0",
  "uuid": "00000000-0000-0000-0000-000000000000",
  "frontends": 1,
  "backends": 1,
  "lsn": 5,
  "psn": 1,
  "catalog": 0,
  "catalog_pending": 5,
  "read_only": false
}]
select show('state').directory;
["_output/E0"]
# test: show config
show config;
[{
  "uuid": "00000000-0000-0000-0000-000000000000",
  "timezone": "UTC",
  "format": "pretty-minimal",
  "log_enable": true,
  "log_to_file": true,
  "log_to_stdout": false,
  "log_connections": true,
  "log_options": true,
  "tls_capath": "",
  "tls_ca": "",
  "tls_cert": "",
  "tls_key": "",
  "listen": [{
    "host": "127.0.0.1",
    "port": 3485
  }],
  "limit_send": 3145728,
  "limit_recv": 1048576,
  "limit_write": 0,
  "frontends": 1,
  "backends": 1,
  "jobs": 3,
  "cpu_affinity": true,
  "wal_worker": false,
  "wal_crc": true,
  "wal_sync_on_create": false,
  "wal_sync_on_close": false,
  "wal_sync_on_write": false,
  "wal_sync_interval": "1 sec",
  "wal_size": 67108864,
  "wal_truncate": 0,
  "storage_crc": true,
  "storage_sync": false,
  "catalog_sync": false,
  "checkpoint_interval": "5 min",
  "repl_readahead": 262144,
  "repl_reconnect_ms": 3000
}]
# test: show all
show all;
[{
  "uuid": "00000000-0000-0000-0000-000000000000",
  "timezone": "UTC",
  "format": "pretty-minimal",
  "log_enable": true,
  "log_to_file": true,
  "log_to_stdout": false,
  "log_connections": true,
  "log_options": true,
  "tls_capath": "",
  "tls_ca": "",
  "tls_cert": "",
  "tls_key": "",
  "listen": [{
    "host": "127.0.0.1",
    "port": 3485
  }],
  "limit_send": 3145728,
  "limit_recv": 1048576,
  "limit_write": 0,
  "frontends": 1,
  "backends": 1,
  "jobs": 3,
  "cpu_affinity": true,
  "wal_worker": false,
  "wal_crc": true,
  "wal_sync_on_create": false,
  "wal_sync_on_close": false,
  "wal_sync_on_write": false,
  "wal_sync_interval": "1 sec",
  "wal_size": 67108864,
  "wal_truncate": 0,
  "storage_crc": true,
  "storage_sync": false,
  "catalog_sync": false,
  "checkpoint_interval": "5 min",
  "repl_readahead": 262144,
  "repl_reconnect_ms": 3000
}]
select show('config').uuid;
["00000000-0000-0000-0000-000000000000"]
select show('config', '123');
{"msg": "show() ⟵ unexpected name argument"}
# test: show name
show log_enable;
[true]
show "log_enable";
[true]
# test: show unknown
show asdf;
{"msg": "show() ⟵ option 'asdf' is not found"}
# test: explain show
explain show log_enable;
[{
  "main": {
    "00": "string              0      0      0     # log_enable",
    "01": "push                0      0      0     ",
    "02": "string              0      11     0     # ",
    "03": "push                0      0      0     ",
    "04": "string              0      12     0     # ",
    "05": "push                0      0      0     ",
    "06": "bool                0      0      0     ",
    "07": "push                0      0      0     ",
    "08": "call                0      -      4     # show()",
    "09": "ret                 0      0      -     "
  },
  "access": []
}]
disconnect S0;
connect E0 S0 127.0.0.1:3485/main?timezone=Asia/Tokyo&format=full;
show all;
[{"result": {"uuid": "00000000-0000-0000-0000-000000000000", "timezone": "Asia/Tokyo", "format": "full", "log_enable": true, "log_to_file": true, "log_to_stdout": false, "log_connections": true, "log_options": true, "tls_capath": "", "tls_ca": "", "tls_cert": "", "tls_key": "", "listen": [{"host": "127.0.0.1", "port": 3485}], "limit_send": 3145728, "limit_recv": 1048576, "limit_write": 0, "frontends": 1, "backends": 1, "jobs": 3, "cpu_affinity": true, "wal_worker": false, "wal_crc": true, "wal_sync_on_create": false, "wal_sync_on_close": false, "wal_sync_on_write": false, "wal_sync_interval": "1 sec", "wal_size": 67108864, "wal_truncate": 0, "storage_crc": true, "storage_sync": false, "catalog_sync": false, "checkpoint_interval": "5 min", "repl_readahead": 262144, "repl_reconnect_ms": 3000}}]
show timezone;
[{"result": "Asia/Tokyo"}]
disconnect S0;
close E0;
