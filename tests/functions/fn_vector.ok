open E0 "uuid": "00000000-0000-0000-0000-000000000000", "listen": [{ "host": "127.0.0.1", "port": 3485 }];
connect E0 S0 127.0.0.1:3485;
# test: cos_distance()
select null::vector::cos_distance([1,3,1,2,0]::vector);
[null]
select [3,2,0,1,4]::vector::cos_distance([1,3,1,2,0]::vector);
[0.481455]
select [1.0, 2.1, 3]::vector * [1.5, 1.5, 1.5]::vector;
[[1.5, 3.15, 4.5]]
explain select [1.0, 2.1, 3]::vector * [1.5, 1.5, 1.5]::vector;
[{
  "main": {
    "00": "value               0      -      0     # vector",
    "01": "value               1      -      0     # vector",
    "02": "mulvv               2      0      1     ",
    "03": "ret                 2      0      -     "
  },
  "access": []
}]
select vector [1.0, 2.1, 3] * vector [1.5, 1.5, 1.5];
[[1.5, 3.15, 4.5]]
explain select vector [1.0, 2.1, 3] * vector [1.5, 1.5, 1.5];
[{
  "main": {
    "00": "vector              0      0      0     ",
    "01": "vector              1      16     0     ",
    "02": "mulvv               2      0      1     ",
    "03": "ret                 2      0      -     "
  },
  "access": []
}]
# test: cos_distance() (similarity search)
create table test (id serial primary key, embedding vector);
insert into test (embedding) values ([3,2,0,1,4]);
insert into test (embedding) values ([2,2,0,1,3]);
insert into test (embedding) values ([1,3,0,1,4]);
select * from test;
[[0, [3, 2, 0, 1, 4]], [1, [2, 2, 0, 1, 3]], [2, [1, 3, 0, 1, 4]]]
select id, embedding::cos_distance(vector [1,3,1,2,0]) from test order by 2 desc;
[[0, 0.481455], [2, 0.403715], [1, 0.391419]]
explain select id, embedding::cos_distance(vector [1,3,1,2,0]) from test order by 2 desc;
[{
  "main": {
    "00": "send_all            0      0      43    # test (select, closing)",
    "01": "union               1      1      0     ",
    "02": "recv                1      0      0     ",
    "03": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set_ordered         0      2      1     ",
    "01": "table_open_part     1      25     16    # test (primary)",
    "02": "table_readi64       2      1      -     # id",
    "03": "push                2      0      0     ",
    "04": "table_readv         2      1      -     # embedding",
    "05": "push                2      0      0     ",
    "06": "push_vector         0      0      0     ",
    "07": "call                2      -      2     # cos_distance()",
    "08": "push                2      0      0     ",
    "09": "table_readv         2      1      -     # embedding",
    "10": "push                2      0      0     ",
    "11": "push_vector         0      0      0     ",
    "12": "call                2      -      2     # cos_distance()",
    "13": "push                2      0      0     ",
    "14": "set_add             0      0      0     ",
    "15": "table_next          1      2      0     ",
    "16": "free                1      0      0     ",
    "17": "set_sort            0      0      0     ",
    "18": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
select id from test order by embedding::cos_distance(vector [1,3,1,2,0]) desc limit 1;
[0]
explain select id from test order by embedding::cos_distance(vector [1,3,1,2,0]) desc limit 1;
[{
  "main": {
    "00": "send_all            0      0      43    # test (select, closing)",
    "01": "union               1      1      0     ",
    "02": "int                 2      -      0     # 1",
    "03": "union_limit         1      2      0     ",
    "04": "recv                1      0      0     ",
    "05": "ret                 1      0      -     "
  },
  "pushdown": {
    "00": "set_ordered         0      1      1     ",
    "01": "table_open_part     1      25     11    # test (primary)",
    "02": "table_readi64       2      1      -     # id",
    "03": "push                2      0      0     ",
    "04": "table_readv         2      1      -     # embedding",
    "05": "push                2      0      0     ",
    "06": "push_vector         0      0      0     ",
    "07": "call                2      -      2     # cos_distance()",
    "08": "push                2      0      0     ",
    "09": "set_add             0      0      0     ",
    "10": "table_next          1      2      0     ",
    "11": "free                1      0      0     ",
    "12": "set_sort            0      0      0     ",
    "13": "ret                 0      0      -     "
  },
  "access": [["test", "shared"]]
}]
disconnect S0;
close E0;
